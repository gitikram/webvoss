(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function gp(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Eu={exports:{}},fs={},Su={exports:{}},be={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Of;function cv(){if(Of)return be;Of=1;var a=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),m=Symbol.iterator;function g(k){return k===null||typeof k!="object"?null:(k=m&&k[m]||k["@@iterator"],typeof k=="function"?k:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,T={};function S(k,F,ae){this.props=k,this.context=F,this.refs=T,this.updater=ae||v}S.prototype.isReactComponent={},S.prototype.setState=function(k,F){if(typeof k!="object"&&typeof k!="function"&&k!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,k,F,"setState")},S.prototype.forceUpdate=function(k){this.updater.enqueueForceUpdate(this,k,"forceUpdate")};function I(){}I.prototype=S.prototype;function b(k,F,ae){this.props=k,this.context=F,this.refs=T,this.updater=ae||v}var w=b.prototype=new I;w.constructor=b,x(w,S.prototype),w.isPureReactComponent=!0;var _=Array.isArray,D=Object.prototype.hasOwnProperty,j={current:null},P={key:!0,ref:!0,__self:!0,__source:!0};function B(k,F,ae){var he,ce={},fe=null,Re=null;if(F!=null)for(he in F.ref!==void 0&&(Re=F.ref),F.key!==void 0&&(fe=""+F.key),F)D.call(F,he)&&!P.hasOwnProperty(he)&&(ce[he]=F[he]);var Te=arguments.length-2;if(Te===1)ce.children=ae;else if(1<Te){for(var ke=Array(Te),Ve=0;Ve<Te;Ve++)ke[Ve]=arguments[Ve+2];ce.children=ke}if(k&&k.defaultProps)for(he in Te=k.defaultProps,Te)ce[he]===void 0&&(ce[he]=Te[he]);return{$$typeof:a,type:k,key:fe,ref:Re,props:ce,_owner:j.current}}function U(k,F){return{$$typeof:a,type:k.type,key:F,ref:k.ref,props:k.props,_owner:k._owner}}function O(k){return typeof k=="object"&&k!==null&&k.$$typeof===a}function Y(k){var F={"=":"=0",":":"=2"};return"$"+k.replace(/[=:]/g,function(ae){return F[ae]})}var ne=/\/+/g;function se(k,F){return typeof k=="object"&&k!==null&&k.key!=null?Y(""+k.key):F.toString(36)}function ue(k,F,ae,he,ce){var fe=typeof k;(fe==="undefined"||fe==="boolean")&&(k=null);var Re=!1;if(k===null)Re=!0;else switch(fe){case"string":case"number":Re=!0;break;case"object":switch(k.$$typeof){case a:case e:Re=!0}}if(Re)return Re=k,ce=ce(Re),k=he===""?"."+se(Re,0):he,_(ce)?(ae="",k!=null&&(ae=k.replace(ne,"$&/")+"/"),ue(ce,F,ae,"",function(Ve){return Ve})):ce!=null&&(O(ce)&&(ce=U(ce,ae+(!ce.key||Re&&Re.key===ce.key?"":(""+ce.key).replace(ne,"$&/")+"/")+k)),F.push(ce)),1;if(Re=0,he=he===""?".":he+":",_(k))for(var Te=0;Te<k.length;Te++){fe=k[Te];var ke=he+se(fe,Te);Re+=ue(fe,F,ae,ke,ce)}else if(ke=g(k),typeof ke=="function")for(k=ke.call(k),Te=0;!(fe=k.next()).done;)fe=fe.value,ke=he+se(fe,Te++),Re+=ue(fe,F,ae,ke,ce);else if(fe==="object")throw F=String(k),Error("Objects are not valid as a React child (found: "+(F==="[object Object]"?"object with keys {"+Object.keys(k).join(", ")+"}":F)+"). If you meant to render a collection of children, use an array instead.");return Re}function oe(k,F,ae){if(k==null)return k;var he=[],ce=0;return ue(k,he,"","",function(fe){return F.call(ae,fe,ce++)}),he}function ee(k){if(k._status===-1){var F=k._result;F=F(),F.then(function(ae){(k._status===0||k._status===-1)&&(k._status=1,k._result=ae)},function(ae){(k._status===0||k._status===-1)&&(k._status=2,k._result=ae)}),k._status===-1&&(k._status=0,k._result=F)}if(k._status===1)return k._result.default;throw k._result}var ie={current:null},H={transition:null},X={ReactCurrentDispatcher:ie,ReactCurrentBatchConfig:H,ReactCurrentOwner:j};function Q(){throw Error("act(...) is not supported in production builds of React.")}return be.Children={map:oe,forEach:function(k,F,ae){oe(k,function(){F.apply(this,arguments)},ae)},count:function(k){var F=0;return oe(k,function(){F++}),F},toArray:function(k){return oe(k,function(F){return F})||[]},only:function(k){if(!O(k))throw Error("React.Children.only expected to receive a single React element child.");return k}},be.Component=S,be.Fragment=t,be.Profiler=i,be.PureComponent=b,be.StrictMode=n,be.Suspense=h,be.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=X,be.act=Q,be.cloneElement=function(k,F,ae){if(k==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+k+".");var he=x({},k.props),ce=k.key,fe=k.ref,Re=k._owner;if(F!=null){if(F.ref!==void 0&&(fe=F.ref,Re=j.current),F.key!==void 0&&(ce=""+F.key),k.type&&k.type.defaultProps)var Te=k.type.defaultProps;for(ke in F)D.call(F,ke)&&!P.hasOwnProperty(ke)&&(he[ke]=F[ke]===void 0&&Te!==void 0?Te[ke]:F[ke])}var ke=arguments.length-2;if(ke===1)he.children=ae;else if(1<ke){Te=Array(ke);for(var Ve=0;Ve<ke;Ve++)Te[Ve]=arguments[Ve+2];he.children=Te}return{$$typeof:a,type:k.type,key:ce,ref:fe,props:he,_owner:Re}},be.createContext=function(k){return k={$$typeof:l,_currentValue:k,_currentValue2:k,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},k.Provider={$$typeof:s,_context:k},k.Consumer=k},be.createElement=B,be.createFactory=function(k){var F=B.bind(null,k);return F.type=k,F},be.createRef=function(){return{current:null}},be.forwardRef=function(k){return{$$typeof:u,render:k}},be.isValidElement=O,be.lazy=function(k){return{$$typeof:f,_payload:{_status:-1,_result:k},_init:ee}},be.memo=function(k,F){return{$$typeof:d,type:k,compare:F===void 0?null:F}},be.startTransition=function(k){var F=H.transition;H.transition={};try{k()}finally{H.transition=F}},be.unstable_act=Q,be.useCallback=function(k,F){return ie.current.useCallback(k,F)},be.useContext=function(k){return ie.current.useContext(k)},be.useDebugValue=function(){},be.useDeferredValue=function(k){return ie.current.useDeferredValue(k)},be.useEffect=function(k,F){return ie.current.useEffect(k,F)},be.useId=function(){return ie.current.useId()},be.useImperativeHandle=function(k,F,ae){return ie.current.useImperativeHandle(k,F,ae)},be.useInsertionEffect=function(k,F){return ie.current.useInsertionEffect(k,F)},be.useLayoutEffect=function(k,F){return ie.current.useLayoutEffect(k,F)},be.useMemo=function(k,F){return ie.current.useMemo(k,F)},be.useReducer=function(k,F,ae){return ie.current.useReducer(k,F,ae)},be.useRef=function(k){return ie.current.useRef(k)},be.useState=function(k){return ie.current.useState(k)},be.useSyncExternalStore=function(k,F,ae){return ie.current.useSyncExternalStore(k,F,ae)},be.useTransition=function(){return ie.current.useTransition()},be.version="18.3.1",be}var Mf;function xc(){return Mf||(Mf=1,Su.exports=cv()),Su.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ff;function dv(){if(Ff)return fs;Ff=1;var a=xc(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,i=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function l(u,h,d){var f,m={},g=null,v=null;d!==void 0&&(g=""+d),h.key!==void 0&&(g=""+h.key),h.ref!==void 0&&(v=h.ref);for(f in h)n.call(h,f)&&!s.hasOwnProperty(f)&&(m[f]=h[f]);if(u&&u.defaultProps)for(f in h=u.defaultProps,h)m[f]===void 0&&(m[f]=h[f]);return{$$typeof:e,type:u,key:g,ref:v,props:m,_owner:i.current}}return fs.Fragment=t,fs.jsx=l,fs.jsxs=l,fs}var Bf;function hv(){return Bf||(Bf=1,Eu.exports=dv()),Eu.exports}var A=hv(),z=xc();const fv=gp(z);var $a={},Tu={exports:{}},kt={},Lu={exports:{}},Au={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uf;function mv(){return Uf||(Uf=1,(function(a){function e(H,X){var Q=H.length;H.push(X);e:for(;0<Q;){var k=Q-1>>>1,F=H[k];if(0<i(F,X))H[k]=X,H[Q]=F,Q=k;else break e}}function t(H){return H.length===0?null:H[0]}function n(H){if(H.length===0)return null;var X=H[0],Q=H.pop();if(Q!==X){H[0]=Q;e:for(var k=0,F=H.length,ae=F>>>1;k<ae;){var he=2*(k+1)-1,ce=H[he],fe=he+1,Re=H[fe];if(0>i(ce,Q))fe<F&&0>i(Re,ce)?(H[k]=Re,H[fe]=Q,k=fe):(H[k]=ce,H[he]=Q,k=he);else if(fe<F&&0>i(Re,Q))H[k]=Re,H[fe]=Q,k=fe;else break e}}return X}function i(H,X){var Q=H.sortIndex-X.sortIndex;return Q!==0?Q:H.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;a.unstable_now=function(){return s.now()}}else{var l=Date,u=l.now();a.unstable_now=function(){return l.now()-u}}var h=[],d=[],f=1,m=null,g=3,v=!1,x=!1,T=!1,S=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(H){for(var X=t(d);X!==null;){if(X.callback===null)n(d);else if(X.startTime<=H)n(d),X.sortIndex=X.expirationTime,e(h,X);else break;X=t(d)}}function _(H){if(T=!1,w(H),!x)if(t(h)!==null)x=!0,ee(D);else{var X=t(d);X!==null&&ie(_,X.startTime-H)}}function D(H,X){x=!1,T&&(T=!1,I(B),B=-1),v=!0;var Q=g;try{for(w(X),m=t(h);m!==null&&(!(m.expirationTime>X)||H&&!Y());){var k=m.callback;if(typeof k=="function"){m.callback=null,g=m.priorityLevel;var F=k(m.expirationTime<=X);X=a.unstable_now(),typeof F=="function"?m.callback=F:m===t(h)&&n(h),w(X)}else n(h);m=t(h)}if(m!==null)var ae=!0;else{var he=t(d);he!==null&&ie(_,he.startTime-X),ae=!1}return ae}finally{m=null,g=Q,v=!1}}var j=!1,P=null,B=-1,U=5,O=-1;function Y(){return!(a.unstable_now()-O<U)}function ne(){if(P!==null){var H=a.unstable_now();O=H;var X=!0;try{X=P(!0,H)}finally{X?se():(j=!1,P=null)}}else j=!1}var se;if(typeof b=="function")se=function(){b(ne)};else if(typeof MessageChannel<"u"){var ue=new MessageChannel,oe=ue.port2;ue.port1.onmessage=ne,se=function(){oe.postMessage(null)}}else se=function(){S(ne,0)};function ee(H){P=H,j||(j=!0,se())}function ie(H,X){B=S(function(){H(a.unstable_now())},X)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(H){H.callback=null},a.unstable_continueExecution=function(){x||v||(x=!0,ee(D))},a.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):U=0<H?Math.floor(1e3/H):5},a.unstable_getCurrentPriorityLevel=function(){return g},a.unstable_getFirstCallbackNode=function(){return t(h)},a.unstable_next=function(H){switch(g){case 1:case 2:case 3:var X=3;break;default:X=g}var Q=g;g=X;try{return H()}finally{g=Q}},a.unstable_pauseExecution=function(){},a.unstable_requestPaint=function(){},a.unstable_runWithPriority=function(H,X){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var Q=g;g=H;try{return X()}finally{g=Q}},a.unstable_scheduleCallback=function(H,X,Q){var k=a.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?k+Q:k):Q=k,H){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=Q+F,H={id:f++,callback:X,priorityLevel:H,startTime:Q,expirationTime:F,sortIndex:-1},Q>k?(H.sortIndex=Q,e(d,H),t(h)===null&&H===t(d)&&(T?(I(B),B=-1):T=!0,ie(_,Q-k))):(H.sortIndex=F,e(h,H),x||v||(x=!0,ee(D))),H},a.unstable_shouldYield=Y,a.unstable_wrapCallback=function(H){var X=g;return function(){var Q=g;g=X;try{return H.apply(this,arguments)}finally{g=Q}}}})(Au)),Au}var $f;function pv(){return $f||($f=1,Lu.exports=mv()),Lu.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jf;function gv(){if(jf)return kt;jf=1;var a=xc(),e=pv();function t(r){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+r,c=1;c<arguments.length;c++)o+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,i={};function s(r,o){l(r,o),l(r+"Capture",o)}function l(r,o){for(i[r]=o,r=0;r<o.length;r++)n.add(o[r])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},m={};function g(r){return h.call(m,r)?!0:h.call(f,r)?!1:d.test(r)?m[r]=!0:(f[r]=!0,!1)}function v(r,o,c,p){if(c!==null&&c.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return p?!1:c!==null?!c.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function x(r,o,c,p){if(o===null||typeof o>"u"||v(r,o,c,p))return!0;if(p)return!1;if(c!==null)switch(c.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function T(r,o,c,p,y,E,R){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=p,this.attributeNamespace=y,this.mustUseProperty=c,this.propertyName=r,this.type=o,this.sanitizeURL=E,this.removeEmptyString=R}var S={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){S[r]=new T(r,0,!1,r,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var o=r[0];S[o]=new T(o,1,!1,r[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(r){S[r]=new T(r,2,!1,r.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){S[r]=new T(r,2,!1,r,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){S[r]=new T(r,3,!1,r.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(r){S[r]=new T(r,3,!0,r,null,!1,!1)}),["capture","download"].forEach(function(r){S[r]=new T(r,4,!1,r,null,!1,!1)}),["cols","rows","size","span"].forEach(function(r){S[r]=new T(r,6,!1,r,null,!1,!1)}),["rowSpan","start"].forEach(function(r){S[r]=new T(r,5,!1,r.toLowerCase(),null,!1,!1)});var I=/[\-:]([a-z])/g;function b(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var o=r.replace(I,b);S[o]=new T(o,1,!1,r,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var o=r.replace(I,b);S[o]=new T(o,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(r){var o=r.replace(I,b);S[o]=new T(o,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(r){S[r]=new T(r,1,!1,r.toLowerCase(),null,!1,!1)}),S.xlinkHref=new T("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(r){S[r]=new T(r,1,!1,r.toLowerCase(),null,!0,!0)});function w(r,o,c,p){var y=S.hasOwnProperty(o)?S[o]:null;(y!==null?y.type!==0:p||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(x(o,c,y,p)&&(c=null),p||y===null?g(o)&&(c===null?r.removeAttribute(o):r.setAttribute(o,""+c)):y.mustUseProperty?r[y.propertyName]=c===null?y.type===3?!1:"":c:(o=y.attributeName,p=y.attributeNamespace,c===null?r.removeAttribute(o):(y=y.type,c=y===3||y===4&&c===!0?"":""+c,p?r.setAttributeNS(p,o,c):r.setAttribute(o,c))))}var _=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,D=Symbol.for("react.element"),j=Symbol.for("react.portal"),P=Symbol.for("react.fragment"),B=Symbol.for("react.strict_mode"),U=Symbol.for("react.profiler"),O=Symbol.for("react.provider"),Y=Symbol.for("react.context"),ne=Symbol.for("react.forward_ref"),se=Symbol.for("react.suspense"),ue=Symbol.for("react.suspense_list"),oe=Symbol.for("react.memo"),ee=Symbol.for("react.lazy"),ie=Symbol.for("react.offscreen"),H=Symbol.iterator;function X(r){return r===null||typeof r!="object"?null:(r=H&&r[H]||r["@@iterator"],typeof r=="function"?r:null)}var Q=Object.assign,k;function F(r){if(k===void 0)try{throw Error()}catch(c){var o=c.stack.trim().match(/\n( *(at )?)/);k=o&&o[1]||""}return`
`+k+r}var ae=!1;function he(r,o){if(!r||ae)return"";ae=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(W){var p=W}Reflect.construct(r,[],o)}else{try{o.call()}catch(W){p=W}r.call(o.prototype)}else{try{throw Error()}catch(W){p=W}r()}}catch(W){if(W&&p&&typeof W.stack=="string"){for(var y=W.stack.split(`
`),E=p.stack.split(`
`),R=y.length-1,C=E.length-1;1<=R&&0<=C&&y[R]!==E[C];)C--;for(;1<=R&&0<=C;R--,C--)if(y[R]!==E[C]){if(R!==1||C!==1)do if(R--,C--,0>C||y[R]!==E[C]){var N=`
`+y[R].replace(" at new "," at ");return r.displayName&&N.includes("<anonymous>")&&(N=N.replace("<anonymous>",r.displayName)),N}while(1<=R&&0<=C);break}}}finally{ae=!1,Error.prepareStackTrace=c}return(r=r?r.displayName||r.name:"")?F(r):""}function ce(r){switch(r.tag){case 5:return F(r.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return r=he(r.type,!1),r;case 11:return r=he(r.type.render,!1),r;case 1:return r=he(r.type,!0),r;default:return""}}function fe(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case P:return"Fragment";case j:return"Portal";case U:return"Profiler";case B:return"StrictMode";case se:return"Suspense";case ue:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case Y:return(r.displayName||"Context")+".Consumer";case O:return(r._context.displayName||"Context")+".Provider";case ne:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case oe:return o=r.displayName||null,o!==null?o:fe(r.type)||"Memo";case ee:o=r._payload,r=r._init;try{return fe(r(o))}catch{}}return null}function Re(r){var o=r.type;switch(r.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=o.render,r=r.displayName||r.name||"",o.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return fe(o);case 8:return o===B?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function Te(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function ke(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Ve(r){var o=ke(r)?"checked":"value",c=Object.getOwnPropertyDescriptor(r.constructor.prototype,o),p=""+r[o];if(!r.hasOwnProperty(o)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var y=c.get,E=c.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return y.call(this)},set:function(R){p=""+R,E.call(this,R)}}),Object.defineProperty(r,o,{enumerable:c.enumerable}),{getValue:function(){return p},setValue:function(R){p=""+R},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function Kt(r){r._valueTracker||(r._valueTracker=Ve(r))}function Ds(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var c=o.getValue(),p="";return r&&(p=ke(r)?r.checked?"true":"false":r.value),r=p,r!==c?(o.setValue(r),!0):!1}function Vn(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function vr(r,o){var c=o.checked;return Q({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??r._wrapperState.initialChecked})}function Co(r,o){var c=o.defaultValue==null?"":o.defaultValue,p=o.checked!=null?o.checked:o.defaultChecked;c=Te(o.value!=null?o.value:c),r._wrapperState={initialChecked:p,initialValue:c,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function Ce(r,o){o=o.checked,o!=null&&w(r,"checked",o,!1)}function tt(r,o){Ce(r,o);var c=Te(o.value),p=o.type;if(c!=null)p==="number"?(c===0&&r.value===""||r.value!=c)&&(r.value=""+c):r.value!==""+c&&(r.value=""+c);else if(p==="submit"||p==="reset"){r.removeAttribute("value");return}o.hasOwnProperty("value")?en(r,o.type,c):o.hasOwnProperty("defaultValue")&&en(r,o.type,Te(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(r.defaultChecked=!!o.defaultChecked)}function St(r,o,c){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var p=o.type;if(!(p!=="submit"&&p!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+r._wrapperState.initialValue,c||o===r.value||(r.value=o),r.defaultValue=o}c=r.name,c!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,c!==""&&(r.name=c)}function en(r,o,c){(o!=="number"||Vn(r.ownerDocument)!==r)&&(c==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+c&&(r.defaultValue=""+c))}var dt=Array.isArray;function Nt(r,o,c,p){if(r=r.options,o){o={};for(var y=0;y<c.length;y++)o["$"+c[y]]=!0;for(c=0;c<r.length;c++)y=o.hasOwnProperty("$"+r[c].value),r[c].selected!==y&&(r[c].selected=y),y&&p&&(r[c].defaultSelected=!0)}else{for(c=""+Te(c),o=null,y=0;y<r.length;y++){if(r[y].value===c){r[y].selected=!0,p&&(r[y].defaultSelected=!0);return}o!==null||r[y].disabled||(o=r[y])}o!==null&&(o.selected=!0)}}function tn(r,o){if(o.dangerouslySetInnerHTML!=null)throw Error(t(91));return Q({},o,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function bi(r,o){var c=o.value;if(c==null){if(c=o.children,o=o.defaultValue,c!=null){if(o!=null)throw Error(t(92));if(dt(c)){if(1<c.length)throw Error(t(93));c=c[0]}o=c}o==null&&(o=""),c=o}r._wrapperState={initialValue:Te(c)}}function xr(r,o){var c=Te(o.value),p=Te(o.defaultValue);c!=null&&(c=""+c,c!==r.value&&(r.value=c),o.defaultValue==null&&r.defaultValue!==c&&(r.defaultValue=c)),p!=null&&(r.defaultValue=""+p)}function _i(r){var o=r.textContent;o===r._wrapperState.initialValue&&o!==""&&o!==null&&(r.value=o)}function Kn(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ur(r,o){return r==null||r==="http://www.w3.org/1999/xhtml"?Kn(o):r==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var $r,ki=(function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,c,p,y){MSApp.execUnsafeLocalFunction(function(){return r(o,c,p,y)})}:r})(function(r,o){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=o;else{for($r=$r||document.createElement("div"),$r.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=$r.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;o.firstChild;)r.appendChild(o.firstChild)}});function Hn(r,o){if(o){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=o;return}}r.textContent=o}var nn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},m0=["Webkit","ms","Moz","O"];Object.keys(nn).forEach(function(r){m0.forEach(function(o){o=o+r.charAt(0).toUpperCase()+r.substring(1),nn[o]=nn[r]})});function qc(r,o,c){return o==null||typeof o=="boolean"||o===""?"":c||typeof o!="number"||o===0||nn.hasOwnProperty(r)&&nn[r]?(""+o).trim():o+"px"}function Qc(r,o){r=r.style;for(var c in o)if(o.hasOwnProperty(c)){var p=c.indexOf("--")===0,y=qc(c,o[c],p);c==="float"&&(c="cssFloat"),p?r.setProperty(c,y):r[c]=y}}var p0=Q({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Do(r,o){if(o){if(p0[r]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(t(137,r));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(t(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(t(61))}if(o.style!=null&&typeof o.style!="object")throw Error(t(62))}}function Po(r,o){if(r.indexOf("-")===-1)return typeof o.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var No=null;function Oo(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Mo=null,jr=null,Gr=null;function Xc(r){if(r=Ji(r)){if(typeof Mo!="function")throw Error(t(280));var o=r.stateNode;o&&(o=ta(o),Mo(r.stateNode,r.type,o))}}function Jc(r){jr?Gr?Gr.push(r):Gr=[r]:jr=r}function Zc(){if(jr){var r=jr,o=Gr;if(Gr=jr=null,Xc(r),o)for(r=0;r<o.length;r++)Xc(o[r])}}function ed(r,o){return r(o)}function td(){}var Fo=!1;function nd(r,o,c){if(Fo)return r(o,c);Fo=!0;try{return ed(r,o,c)}finally{Fo=!1,(jr!==null||Gr!==null)&&(td(),Zc())}}function Ci(r,o){var c=r.stateNode;if(c===null)return null;var p=ta(c);if(p===null)return null;c=p[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(r=r.type,p=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!p;break e;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(t(231,o,typeof c));return c}var Bo=!1;if(u)try{var Di={};Object.defineProperty(Di,"passive",{get:function(){Bo=!0}}),window.addEventListener("test",Di,Di),window.removeEventListener("test",Di,Di)}catch{Bo=!1}function g0(r,o,c,p,y,E,R,C,N){var W=Array.prototype.slice.call(arguments,3);try{o.apply(c,W)}catch(Z){this.onError(Z)}}var Pi=!1,Ps=null,Ns=!1,Uo=null,y0={onError:function(r){Pi=!0,Ps=r}};function v0(r,o,c,p,y,E,R,C,N){Pi=!1,Ps=null,g0.apply(y0,arguments)}function x0(r,o,c,p,y,E,R,C,N){if(v0.apply(this,arguments),Pi){if(Pi){var W=Ps;Pi=!1,Ps=null}else throw Error(t(198));Ns||(Ns=!0,Uo=W)}}function Er(r){var o=r,c=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,(o.flags&4098)!==0&&(c=o.return),r=o.return;while(r)}return o.tag===3?c:null}function rd(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function id(r){if(Er(r)!==r)throw Error(t(188))}function E0(r){var o=r.alternate;if(!o){if(o=Er(r),o===null)throw Error(t(188));return o!==r?null:r}for(var c=r,p=o;;){var y=c.return;if(y===null)break;var E=y.alternate;if(E===null){if(p=y.return,p!==null){c=p;continue}break}if(y.child===E.child){for(E=y.child;E;){if(E===c)return id(y),r;if(E===p)return id(y),o;E=E.sibling}throw Error(t(188))}if(c.return!==p.return)c=y,p=E;else{for(var R=!1,C=y.child;C;){if(C===c){R=!0,c=y,p=E;break}if(C===p){R=!0,p=y,c=E;break}C=C.sibling}if(!R){for(C=E.child;C;){if(C===c){R=!0,c=E,p=y;break}if(C===p){R=!0,p=E,c=y;break}C=C.sibling}if(!R)throw Error(t(189))}}if(c.alternate!==p)throw Error(t(190))}if(c.tag!==3)throw Error(t(188));return c.stateNode.current===c?r:o}function sd(r){return r=E0(r),r!==null?ad(r):null}function ad(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var o=ad(r);if(o!==null)return o;r=r.sibling}return null}var od=e.unstable_scheduleCallback,ld=e.unstable_cancelCallback,S0=e.unstable_shouldYield,T0=e.unstable_requestPaint,Je=e.unstable_now,L0=e.unstable_getCurrentPriorityLevel,$o=e.unstable_ImmediatePriority,ud=e.unstable_UserBlockingPriority,Os=e.unstable_NormalPriority,A0=e.unstable_LowPriority,cd=e.unstable_IdlePriority,Ms=null,mn=null;function I0(r){if(mn&&typeof mn.onCommitFiberRoot=="function")try{mn.onCommitFiberRoot(Ms,r,void 0,(r.current.flags&128)===128)}catch{}}var rn=Math.clz32?Math.clz32:b0,R0=Math.log,w0=Math.LN2;function b0(r){return r>>>=0,r===0?32:31-(R0(r)/w0|0)|0}var Fs=64,Bs=4194304;function Ni(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function Us(r,o){var c=r.pendingLanes;if(c===0)return 0;var p=0,y=r.suspendedLanes,E=r.pingedLanes,R=c&268435455;if(R!==0){var C=R&~y;C!==0?p=Ni(C):(E&=R,E!==0&&(p=Ni(E)))}else R=c&~y,R!==0?p=Ni(R):E!==0&&(p=Ni(E));if(p===0)return 0;if(o!==0&&o!==p&&(o&y)===0&&(y=p&-p,E=o&-o,y>=E||y===16&&(E&4194240)!==0))return o;if((p&4)!==0&&(p|=c&16),o=r.entangledLanes,o!==0)for(r=r.entanglements,o&=p;0<o;)c=31-rn(o),y=1<<c,p|=r[c],o&=~y;return p}function _0(r,o){switch(r){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function k0(r,o){for(var c=r.suspendedLanes,p=r.pingedLanes,y=r.expirationTimes,E=r.pendingLanes;0<E;){var R=31-rn(E),C=1<<R,N=y[R];N===-1?((C&c)===0||(C&p)!==0)&&(y[R]=_0(C,o)):N<=o&&(r.expiredLanes|=C),E&=~C}}function jo(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function dd(){var r=Fs;return Fs<<=1,(Fs&4194240)===0&&(Fs=64),r}function Go(r){for(var o=[],c=0;31>c;c++)o.push(r);return o}function Oi(r,o,c){r.pendingLanes|=o,o!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,o=31-rn(o),r[o]=c}function C0(r,o){var c=r.pendingLanes&~o;r.pendingLanes=o,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=o,r.mutableReadLanes&=o,r.entangledLanes&=o,o=r.entanglements;var p=r.eventTimes;for(r=r.expirationTimes;0<c;){var y=31-rn(c),E=1<<y;o[y]=0,p[y]=-1,r[y]=-1,c&=~E}}function Vo(r,o){var c=r.entangledLanes|=o;for(r=r.entanglements;c;){var p=31-rn(c),y=1<<p;y&o|r[p]&o&&(r[p]|=o),c&=~y}}var Ne=0;function hd(r){return r&=-r,1<r?4<r?(r&268435455)!==0?16:536870912:4:1}var fd,Ko,md,pd,gd,Ho=!1,$s=[],Wn=null,zn=null,Yn=null,Mi=new Map,Fi=new Map,qn=[],D0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function yd(r,o){switch(r){case"focusin":case"focusout":Wn=null;break;case"dragenter":case"dragleave":zn=null;break;case"mouseover":case"mouseout":Yn=null;break;case"pointerover":case"pointerout":Mi.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fi.delete(o.pointerId)}}function Bi(r,o,c,p,y,E){return r===null||r.nativeEvent!==E?(r={blockedOn:o,domEventName:c,eventSystemFlags:p,nativeEvent:E,targetContainers:[y]},o!==null&&(o=Ji(o),o!==null&&Ko(o)),r):(r.eventSystemFlags|=p,o=r.targetContainers,y!==null&&o.indexOf(y)===-1&&o.push(y),r)}function P0(r,o,c,p,y){switch(o){case"focusin":return Wn=Bi(Wn,r,o,c,p,y),!0;case"dragenter":return zn=Bi(zn,r,o,c,p,y),!0;case"mouseover":return Yn=Bi(Yn,r,o,c,p,y),!0;case"pointerover":var E=y.pointerId;return Mi.set(E,Bi(Mi.get(E)||null,r,o,c,p,y)),!0;case"gotpointercapture":return E=y.pointerId,Fi.set(E,Bi(Fi.get(E)||null,r,o,c,p,y)),!0}return!1}function vd(r){var o=Sr(r.target);if(o!==null){var c=Er(o);if(c!==null){if(o=c.tag,o===13){if(o=rd(c),o!==null){r.blockedOn=o,gd(r.priority,function(){md(c)});return}}else if(o===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function js(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var c=zo(r.domEventName,r.eventSystemFlags,o[0],r.nativeEvent);if(c===null){c=r.nativeEvent;var p=new c.constructor(c.type,c);No=p,c.target.dispatchEvent(p),No=null}else return o=Ji(c),o!==null&&Ko(o),r.blockedOn=c,!1;o.shift()}return!0}function xd(r,o,c){js(r)&&c.delete(o)}function N0(){Ho=!1,Wn!==null&&js(Wn)&&(Wn=null),zn!==null&&js(zn)&&(zn=null),Yn!==null&&js(Yn)&&(Yn=null),Mi.forEach(xd),Fi.forEach(xd)}function Ui(r,o){r.blockedOn===o&&(r.blockedOn=null,Ho||(Ho=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,N0)))}function $i(r){function o(y){return Ui(y,r)}if(0<$s.length){Ui($s[0],r);for(var c=1;c<$s.length;c++){var p=$s[c];p.blockedOn===r&&(p.blockedOn=null)}}for(Wn!==null&&Ui(Wn,r),zn!==null&&Ui(zn,r),Yn!==null&&Ui(Yn,r),Mi.forEach(o),Fi.forEach(o),c=0;c<qn.length;c++)p=qn[c],p.blockedOn===r&&(p.blockedOn=null);for(;0<qn.length&&(c=qn[0],c.blockedOn===null);)vd(c),c.blockedOn===null&&qn.shift()}var Vr=_.ReactCurrentBatchConfig,Gs=!0;function O0(r,o,c,p){var y=Ne,E=Vr.transition;Vr.transition=null;try{Ne=1,Wo(r,o,c,p)}finally{Ne=y,Vr.transition=E}}function M0(r,o,c,p){var y=Ne,E=Vr.transition;Vr.transition=null;try{Ne=4,Wo(r,o,c,p)}finally{Ne=y,Vr.transition=E}}function Wo(r,o,c,p){if(Gs){var y=zo(r,o,c,p);if(y===null)cl(r,o,p,Vs,c),yd(r,p);else if(P0(y,r,o,c,p))p.stopPropagation();else if(yd(r,p),o&4&&-1<D0.indexOf(r)){for(;y!==null;){var E=Ji(y);if(E!==null&&fd(E),E=zo(r,o,c,p),E===null&&cl(r,o,p,Vs,c),E===y)break;y=E}y!==null&&p.stopPropagation()}else cl(r,o,p,null,c)}}var Vs=null;function zo(r,o,c,p){if(Vs=null,r=Oo(p),r=Sr(r),r!==null)if(o=Er(r),o===null)r=null;else if(c=o.tag,c===13){if(r=rd(o),r!==null)return r;r=null}else if(c===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null);return Vs=r,null}function Ed(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(L0()){case $o:return 1;case ud:return 4;case Os:case A0:return 16;case cd:return 536870912;default:return 16}default:return 16}}var Qn=null,Yo=null,Ks=null;function Sd(){if(Ks)return Ks;var r,o=Yo,c=o.length,p,y="value"in Qn?Qn.value:Qn.textContent,E=y.length;for(r=0;r<c&&o[r]===y[r];r++);var R=c-r;for(p=1;p<=R&&o[c-p]===y[E-p];p++);return Ks=y.slice(r,1<p?1-p:void 0)}function Hs(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function Ws(){return!0}function Td(){return!1}function Ot(r){function o(c,p,y,E,R){this._reactName=c,this._targetInst=y,this.type=p,this.nativeEvent=E,this.target=R,this.currentTarget=null;for(var C in r)r.hasOwnProperty(C)&&(c=r[C],this[C]=c?c(E):E[C]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?Ws:Td,this.isPropagationStopped=Td,this}return Q(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Ws)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Ws)},persist:function(){},isPersistent:Ws}),o}var Kr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},qo=Ot(Kr),ji=Q({},Kr,{view:0,detail:0}),F0=Ot(ji),Qo,Xo,Gi,zs=Q({},ji,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zo,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Gi&&(Gi&&r.type==="mousemove"?(Qo=r.screenX-Gi.screenX,Xo=r.screenY-Gi.screenY):Xo=Qo=0,Gi=r),Qo)},movementY:function(r){return"movementY"in r?r.movementY:Xo}}),Ld=Ot(zs),B0=Q({},zs,{dataTransfer:0}),U0=Ot(B0),$0=Q({},ji,{relatedTarget:0}),Jo=Ot($0),j0=Q({},Kr,{animationName:0,elapsedTime:0,pseudoElement:0}),G0=Ot(j0),V0=Q({},Kr,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),K0=Ot(V0),H0=Q({},Kr,{data:0}),Ad=Ot(H0),W0={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},z0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Y0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function q0(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=Y0[r])?!!o[r]:!1}function Zo(){return q0}var Q0=Q({},ji,{key:function(r){if(r.key){var o=W0[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=Hs(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?z0[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zo,charCode:function(r){return r.type==="keypress"?Hs(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Hs(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),X0=Ot(Q0),J0=Q({},zs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Id=Ot(J0),Z0=Q({},ji,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zo}),ey=Ot(Z0),ty=Q({},Kr,{propertyName:0,elapsedTime:0,pseudoElement:0}),ny=Ot(ty),ry=Q({},zs,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),iy=Ot(ry),sy=[9,13,27,32],el=u&&"CompositionEvent"in window,Vi=null;u&&"documentMode"in document&&(Vi=document.documentMode);var ay=u&&"TextEvent"in window&&!Vi,Rd=u&&(!el||Vi&&8<Vi&&11>=Vi),wd=" ",bd=!1;function _d(r,o){switch(r){case"keyup":return sy.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function kd(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Hr=!1;function oy(r,o){switch(r){case"compositionend":return kd(o);case"keypress":return o.which!==32?null:(bd=!0,wd);case"textInput":return r=o.data,r===wd&&bd?null:r;default:return null}}function ly(r,o){if(Hr)return r==="compositionend"||!el&&_d(r,o)?(r=Sd(),Ks=Yo=Qn=null,Hr=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Rd&&o.locale!=="ko"?null:o.data;default:return null}}var uy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Cd(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!uy[r.type]:o==="textarea"}function Dd(r,o,c,p){Jc(p),o=Js(o,"onChange"),0<o.length&&(c=new qo("onChange","change",null,c,p),r.push({event:c,listeners:o}))}var Ki=null,Hi=null;function cy(r){Qd(r,0)}function Ys(r){var o=Qr(r);if(Ds(o))return r}function dy(r,o){if(r==="change")return o}var Pd=!1;if(u){var tl;if(u){var nl="oninput"in document;if(!nl){var Nd=document.createElement("div");Nd.setAttribute("oninput","return;"),nl=typeof Nd.oninput=="function"}tl=nl}else tl=!1;Pd=tl&&(!document.documentMode||9<document.documentMode)}function Od(){Ki&&(Ki.detachEvent("onpropertychange",Md),Hi=Ki=null)}function Md(r){if(r.propertyName==="value"&&Ys(Hi)){var o=[];Dd(o,Hi,r,Oo(r)),nd(cy,o)}}function hy(r,o,c){r==="focusin"?(Od(),Ki=o,Hi=c,Ki.attachEvent("onpropertychange",Md)):r==="focusout"&&Od()}function fy(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Ys(Hi)}function my(r,o){if(r==="click")return Ys(o)}function py(r,o){if(r==="input"||r==="change")return Ys(o)}function gy(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var sn=typeof Object.is=="function"?Object.is:gy;function Wi(r,o){if(sn(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var c=Object.keys(r),p=Object.keys(o);if(c.length!==p.length)return!1;for(p=0;p<c.length;p++){var y=c[p];if(!h.call(o,y)||!sn(r[y],o[y]))return!1}return!0}function Fd(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Bd(r,o){var c=Fd(r);r=0;for(var p;c;){if(c.nodeType===3){if(p=r+c.textContent.length,r<=o&&p>=o)return{node:c,offset:o-r};r=p}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Fd(c)}}function Ud(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?Ud(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function $d(){for(var r=window,o=Vn();o instanceof r.HTMLIFrameElement;){try{var c=typeof o.contentWindow.location.href=="string"}catch{c=!1}if(c)r=o.contentWindow;else break;o=Vn(r.document)}return o}function rl(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}function yy(r){var o=$d(),c=r.focusedElem,p=r.selectionRange;if(o!==c&&c&&c.ownerDocument&&Ud(c.ownerDocument.documentElement,c)){if(p!==null&&rl(c)){if(o=p.start,r=p.end,r===void 0&&(r=o),"selectionStart"in c)c.selectionStart=o,c.selectionEnd=Math.min(r,c.value.length);else if(r=(o=c.ownerDocument||document)&&o.defaultView||window,r.getSelection){r=r.getSelection();var y=c.textContent.length,E=Math.min(p.start,y);p=p.end===void 0?E:Math.min(p.end,y),!r.extend&&E>p&&(y=p,p=E,E=y),y=Bd(c,E);var R=Bd(c,p);y&&R&&(r.rangeCount!==1||r.anchorNode!==y.node||r.anchorOffset!==y.offset||r.focusNode!==R.node||r.focusOffset!==R.offset)&&(o=o.createRange(),o.setStart(y.node,y.offset),r.removeAllRanges(),E>p?(r.addRange(o),r.extend(R.node,R.offset)):(o.setEnd(R.node,R.offset),r.addRange(o)))}}for(o=[],r=c;r=r.parentNode;)r.nodeType===1&&o.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<o.length;c++)r=o[c],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var vy=u&&"documentMode"in document&&11>=document.documentMode,Wr=null,il=null,zi=null,sl=!1;function jd(r,o,c){var p=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;sl||Wr==null||Wr!==Vn(p)||(p=Wr,"selectionStart"in p&&rl(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),zi&&Wi(zi,p)||(zi=p,p=Js(il,"onSelect"),0<p.length&&(o=new qo("onSelect","select",null,o,c),r.push({event:o,listeners:p}),o.target=Wr)))}function qs(r,o){var c={};return c[r.toLowerCase()]=o.toLowerCase(),c["Webkit"+r]="webkit"+o,c["Moz"+r]="moz"+o,c}var zr={animationend:qs("Animation","AnimationEnd"),animationiteration:qs("Animation","AnimationIteration"),animationstart:qs("Animation","AnimationStart"),transitionend:qs("Transition","TransitionEnd")},al={},Gd={};u&&(Gd=document.createElement("div").style,"AnimationEvent"in window||(delete zr.animationend.animation,delete zr.animationiteration.animation,delete zr.animationstart.animation),"TransitionEvent"in window||delete zr.transitionend.transition);function Qs(r){if(al[r])return al[r];if(!zr[r])return r;var o=zr[r],c;for(c in o)if(o.hasOwnProperty(c)&&c in Gd)return al[r]=o[c];return r}var Vd=Qs("animationend"),Kd=Qs("animationiteration"),Hd=Qs("animationstart"),Wd=Qs("transitionend"),zd=new Map,Yd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Xn(r,o){zd.set(r,o),s(o,[r])}for(var ol=0;ol<Yd.length;ol++){var ll=Yd[ol],xy=ll.toLowerCase(),Ey=ll[0].toUpperCase()+ll.slice(1);Xn(xy,"on"+Ey)}Xn(Vd,"onAnimationEnd"),Xn(Kd,"onAnimationIteration"),Xn(Hd,"onAnimationStart"),Xn("dblclick","onDoubleClick"),Xn("focusin","onFocus"),Xn("focusout","onBlur"),Xn(Wd,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Sy=new Set("cancel close invalid load scroll toggle".split(" ").concat(Yi));function qd(r,o,c){var p=r.type||"unknown-event";r.currentTarget=c,x0(p,o,void 0,r),r.currentTarget=null}function Qd(r,o){o=(o&4)!==0;for(var c=0;c<r.length;c++){var p=r[c],y=p.event;p=p.listeners;e:{var E=void 0;if(o)for(var R=p.length-1;0<=R;R--){var C=p[R],N=C.instance,W=C.currentTarget;if(C=C.listener,N!==E&&y.isPropagationStopped())break e;qd(y,C,W),E=N}else for(R=0;R<p.length;R++){if(C=p[R],N=C.instance,W=C.currentTarget,C=C.listener,N!==E&&y.isPropagationStopped())break e;qd(y,C,W),E=N}}}if(Ns)throw r=Uo,Ns=!1,Uo=null,r}function je(r,o){var c=o[gl];c===void 0&&(c=o[gl]=new Set);var p=r+"__bubble";c.has(p)||(Xd(o,r,2,!1),c.add(p))}function ul(r,o,c){var p=0;o&&(p|=4),Xd(c,r,p,o)}var Xs="_reactListening"+Math.random().toString(36).slice(2);function qi(r){if(!r[Xs]){r[Xs]=!0,n.forEach(function(c){c!=="selectionchange"&&(Sy.has(c)||ul(c,!1,r),ul(c,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[Xs]||(o[Xs]=!0,ul("selectionchange",!1,o))}}function Xd(r,o,c,p){switch(Ed(o)){case 1:var y=O0;break;case 4:y=M0;break;default:y=Wo}c=y.bind(null,o,c,r),y=void 0,!Bo||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(y=!0),p?y!==void 0?r.addEventListener(o,c,{capture:!0,passive:y}):r.addEventListener(o,c,!0):y!==void 0?r.addEventListener(o,c,{passive:y}):r.addEventListener(o,c,!1)}function cl(r,o,c,p,y){var E=p;if((o&1)===0&&(o&2)===0&&p!==null)e:for(;;){if(p===null)return;var R=p.tag;if(R===3||R===4){var C=p.stateNode.containerInfo;if(C===y||C.nodeType===8&&C.parentNode===y)break;if(R===4)for(R=p.return;R!==null;){var N=R.tag;if((N===3||N===4)&&(N=R.stateNode.containerInfo,N===y||N.nodeType===8&&N.parentNode===y))return;R=R.return}for(;C!==null;){if(R=Sr(C),R===null)return;if(N=R.tag,N===5||N===6){p=E=R;continue e}C=C.parentNode}}p=p.return}nd(function(){var W=E,Z=Oo(c),te=[];e:{var J=zd.get(r);if(J!==void 0){var de=qo,ge=r;switch(r){case"keypress":if(Hs(c)===0)break e;case"keydown":case"keyup":de=X0;break;case"focusin":ge="focus",de=Jo;break;case"focusout":ge="blur",de=Jo;break;case"beforeblur":case"afterblur":de=Jo;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":de=Ld;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":de=U0;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":de=ey;break;case Vd:case Kd:case Hd:de=G0;break;case Wd:de=ny;break;case"scroll":de=F0;break;case"wheel":de=iy;break;case"copy":case"cut":case"paste":de=K0;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":de=Id}var ye=(o&4)!==0,Ze=!ye&&r==="scroll",V=ye?J!==null?J+"Capture":null:J;ye=[];for(var M=W,K;M!==null;){K=M;var re=K.stateNode;if(K.tag===5&&re!==null&&(K=re,V!==null&&(re=Ci(M,V),re!=null&&ye.push(Qi(M,re,K)))),Ze)break;M=M.return}0<ye.length&&(J=new de(J,ge,null,c,Z),te.push({event:J,listeners:ye}))}}if((o&7)===0){e:{if(J=r==="mouseover"||r==="pointerover",de=r==="mouseout"||r==="pointerout",J&&c!==No&&(ge=c.relatedTarget||c.fromElement)&&(Sr(ge)||ge[bn]))break e;if((de||J)&&(J=Z.window===Z?Z:(J=Z.ownerDocument)?J.defaultView||J.parentWindow:window,de?(ge=c.relatedTarget||c.toElement,de=W,ge=ge?Sr(ge):null,ge!==null&&(Ze=Er(ge),ge!==Ze||ge.tag!==5&&ge.tag!==6)&&(ge=null)):(de=null,ge=W),de!==ge)){if(ye=Ld,re="onMouseLeave",V="onMouseEnter",M="mouse",(r==="pointerout"||r==="pointerover")&&(ye=Id,re="onPointerLeave",V="onPointerEnter",M="pointer"),Ze=de==null?J:Qr(de),K=ge==null?J:Qr(ge),J=new ye(re,M+"leave",de,c,Z),J.target=Ze,J.relatedTarget=K,re=null,Sr(Z)===W&&(ye=new ye(V,M+"enter",ge,c,Z),ye.target=K,ye.relatedTarget=Ze,re=ye),Ze=re,de&&ge)t:{for(ye=de,V=ge,M=0,K=ye;K;K=Yr(K))M++;for(K=0,re=V;re;re=Yr(re))K++;for(;0<M-K;)ye=Yr(ye),M--;for(;0<K-M;)V=Yr(V),K--;for(;M--;){if(ye===V||V!==null&&ye===V.alternate)break t;ye=Yr(ye),V=Yr(V)}ye=null}else ye=null;de!==null&&Jd(te,J,de,ye,!1),ge!==null&&Ze!==null&&Jd(te,Ze,ge,ye,!0)}}e:{if(J=W?Qr(W):window,de=J.nodeName&&J.nodeName.toLowerCase(),de==="select"||de==="input"&&J.type==="file")var xe=dy;else if(Cd(J))if(Pd)xe=py;else{xe=fy;var Ee=hy}else(de=J.nodeName)&&de.toLowerCase()==="input"&&(J.type==="checkbox"||J.type==="radio")&&(xe=my);if(xe&&(xe=xe(r,W))){Dd(te,xe,c,Z);break e}Ee&&Ee(r,J,W),r==="focusout"&&(Ee=J._wrapperState)&&Ee.controlled&&J.type==="number"&&en(J,"number",J.value)}switch(Ee=W?Qr(W):window,r){case"focusin":(Cd(Ee)||Ee.contentEditable==="true")&&(Wr=Ee,il=W,zi=null);break;case"focusout":zi=il=Wr=null;break;case"mousedown":sl=!0;break;case"contextmenu":case"mouseup":case"dragend":sl=!1,jd(te,c,Z);break;case"selectionchange":if(vy)break;case"keydown":case"keyup":jd(te,c,Z)}var Se;if(el)e:{switch(r){case"compositionstart":var Le="onCompositionStart";break e;case"compositionend":Le="onCompositionEnd";break e;case"compositionupdate":Le="onCompositionUpdate";break e}Le=void 0}else Hr?_d(r,c)&&(Le="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(Le="onCompositionStart");Le&&(Rd&&c.locale!=="ko"&&(Hr||Le!=="onCompositionStart"?Le==="onCompositionEnd"&&Hr&&(Se=Sd()):(Qn=Z,Yo="value"in Qn?Qn.value:Qn.textContent,Hr=!0)),Ee=Js(W,Le),0<Ee.length&&(Le=new Ad(Le,r,null,c,Z),te.push({event:Le,listeners:Ee}),Se?Le.data=Se:(Se=kd(c),Se!==null&&(Le.data=Se)))),(Se=ay?oy(r,c):ly(r,c))&&(W=Js(W,"onBeforeInput"),0<W.length&&(Z=new Ad("onBeforeInput","beforeinput",null,c,Z),te.push({event:Z,listeners:W}),Z.data=Se))}Qd(te,o)})}function Qi(r,o,c){return{instance:r,listener:o,currentTarget:c}}function Js(r,o){for(var c=o+"Capture",p=[];r!==null;){var y=r,E=y.stateNode;y.tag===5&&E!==null&&(y=E,E=Ci(r,c),E!=null&&p.unshift(Qi(r,E,y)),E=Ci(r,o),E!=null&&p.push(Qi(r,E,y))),r=r.return}return p}function Yr(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function Jd(r,o,c,p,y){for(var E=o._reactName,R=[];c!==null&&c!==p;){var C=c,N=C.alternate,W=C.stateNode;if(N!==null&&N===p)break;C.tag===5&&W!==null&&(C=W,y?(N=Ci(c,E),N!=null&&R.unshift(Qi(c,N,C))):y||(N=Ci(c,E),N!=null&&R.push(Qi(c,N,C)))),c=c.return}R.length!==0&&r.push({event:o,listeners:R})}var Ty=/\r\n?/g,Ly=/\u0000|\uFFFD/g;function Zd(r){return(typeof r=="string"?r:""+r).replace(Ty,`
`).replace(Ly,"")}function Zs(r,o,c){if(o=Zd(o),Zd(r)!==o&&c)throw Error(t(425))}function ea(){}var dl=null,hl=null;function fl(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var ml=typeof setTimeout=="function"?setTimeout:void 0,Ay=typeof clearTimeout=="function"?clearTimeout:void 0,eh=typeof Promise=="function"?Promise:void 0,Iy=typeof queueMicrotask=="function"?queueMicrotask:typeof eh<"u"?function(r){return eh.resolve(null).then(r).catch(Ry)}:ml;function Ry(r){setTimeout(function(){throw r})}function pl(r,o){var c=o,p=0;do{var y=c.nextSibling;if(r.removeChild(c),y&&y.nodeType===8)if(c=y.data,c==="/$"){if(p===0){r.removeChild(y),$i(o);return}p--}else c!=="$"&&c!=="$?"&&c!=="$!"||p++;c=y}while(c);$i(o)}function Jn(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return r}function th(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"){if(o===0)return r;o--}else c==="/$"&&o++}r=r.previousSibling}return null}var qr=Math.random().toString(36).slice(2),pn="__reactFiber$"+qr,Xi="__reactProps$"+qr,bn="__reactContainer$"+qr,gl="__reactEvents$"+qr,wy="__reactListeners$"+qr,by="__reactHandles$"+qr;function Sr(r){var o=r[pn];if(o)return o;for(var c=r.parentNode;c;){if(o=c[bn]||c[pn]){if(c=o.alternate,o.child!==null||c!==null&&c.child!==null)for(r=th(r);r!==null;){if(c=r[pn])return c;r=th(r)}return o}r=c,c=r.parentNode}return null}function Ji(r){return r=r[pn]||r[bn],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Qr(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(t(33))}function ta(r){return r[Xi]||null}var yl=[],Xr=-1;function Zn(r){return{current:r}}function Ge(r){0>Xr||(r.current=yl[Xr],yl[Xr]=null,Xr--)}function $e(r,o){Xr++,yl[Xr]=r.current,r.current=o}var er={},yt=Zn(er),It=Zn(!1),Tr=er;function Jr(r,o){var c=r.type.contextTypes;if(!c)return er;var p=r.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===o)return p.__reactInternalMemoizedMaskedChildContext;var y={},E;for(E in c)y[E]=o[E];return p&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=o,r.__reactInternalMemoizedMaskedChildContext=y),y}function Rt(r){return r=r.childContextTypes,r!=null}function na(){Ge(It),Ge(yt)}function nh(r,o,c){if(yt.current!==er)throw Error(t(168));$e(yt,o),$e(It,c)}function rh(r,o,c){var p=r.stateNode;if(o=o.childContextTypes,typeof p.getChildContext!="function")return c;p=p.getChildContext();for(var y in p)if(!(y in o))throw Error(t(108,Re(r)||"Unknown",y));return Q({},c,p)}function ra(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||er,Tr=yt.current,$e(yt,r),$e(It,It.current),!0}function ih(r,o,c){var p=r.stateNode;if(!p)throw Error(t(169));c?(r=rh(r,o,Tr),p.__reactInternalMemoizedMergedChildContext=r,Ge(It),Ge(yt),$e(yt,r)):Ge(It),$e(It,c)}var _n=null,ia=!1,vl=!1;function sh(r){_n===null?_n=[r]:_n.push(r)}function _y(r){ia=!0,sh(r)}function tr(){if(!vl&&_n!==null){vl=!0;var r=0,o=Ne;try{var c=_n;for(Ne=1;r<c.length;r++){var p=c[r];do p=p(!0);while(p!==null)}_n=null,ia=!1}catch(y){throw _n!==null&&(_n=_n.slice(r+1)),od($o,tr),y}finally{Ne=o,vl=!1}}return null}var Zr=[],ei=0,sa=null,aa=0,Ht=[],Wt=0,Lr=null,kn=1,Cn="";function Ar(r,o){Zr[ei++]=aa,Zr[ei++]=sa,sa=r,aa=o}function ah(r,o,c){Ht[Wt++]=kn,Ht[Wt++]=Cn,Ht[Wt++]=Lr,Lr=r;var p=kn;r=Cn;var y=32-rn(p)-1;p&=~(1<<y),c+=1;var E=32-rn(o)+y;if(30<E){var R=y-y%5;E=(p&(1<<R)-1).toString(32),p>>=R,y-=R,kn=1<<32-rn(o)+y|c<<y|p,Cn=E+r}else kn=1<<E|c<<y|p,Cn=r}function xl(r){r.return!==null&&(Ar(r,1),ah(r,1,0))}function El(r){for(;r===sa;)sa=Zr[--ei],Zr[ei]=null,aa=Zr[--ei],Zr[ei]=null;for(;r===Lr;)Lr=Ht[--Wt],Ht[Wt]=null,Cn=Ht[--Wt],Ht[Wt]=null,kn=Ht[--Wt],Ht[Wt]=null}var Mt=null,Ft=null,Ke=!1,an=null;function oh(r,o){var c=Qt(5,null,null,0);c.elementType="DELETED",c.stateNode=o,c.return=r,o=r.deletions,o===null?(r.deletions=[c],r.flags|=16):o.push(c)}function lh(r,o){switch(r.tag){case 5:var c=r.type;return o=o.nodeType!==1||c.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(r.stateNode=o,Mt=r,Ft=Jn(o.firstChild),!0):!1;case 6:return o=r.pendingProps===""||o.nodeType!==3?null:o,o!==null?(r.stateNode=o,Mt=r,Ft=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(c=Lr!==null?{id:kn,overflow:Cn}:null,r.memoizedState={dehydrated:o,treeContext:c,retryLane:1073741824},c=Qt(18,null,null,0),c.stateNode=o,c.return=r,r.child=c,Mt=r,Ft=null,!0):!1;default:return!1}}function Sl(r){return(r.mode&1)!==0&&(r.flags&128)===0}function Tl(r){if(Ke){var o=Ft;if(o){var c=o;if(!lh(r,o)){if(Sl(r))throw Error(t(418));o=Jn(c.nextSibling);var p=Mt;o&&lh(r,o)?oh(p,c):(r.flags=r.flags&-4097|2,Ke=!1,Mt=r)}}else{if(Sl(r))throw Error(t(418));r.flags=r.flags&-4097|2,Ke=!1,Mt=r}}}function uh(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Mt=r}function oa(r){if(r!==Mt)return!1;if(!Ke)return uh(r),Ke=!0,!1;var o;if((o=r.tag!==3)&&!(o=r.tag!==5)&&(o=r.type,o=o!=="head"&&o!=="body"&&!fl(r.type,r.memoizedProps)),o&&(o=Ft)){if(Sl(r))throw ch(),Error(t(418));for(;o;)oh(r,o),o=Jn(o.nextSibling)}if(uh(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(t(317));e:{for(r=r.nextSibling,o=0;r;){if(r.nodeType===8){var c=r.data;if(c==="/$"){if(o===0){Ft=Jn(r.nextSibling);break e}o--}else c!=="$"&&c!=="$!"&&c!=="$?"||o++}r=r.nextSibling}Ft=null}}else Ft=Mt?Jn(r.stateNode.nextSibling):null;return!0}function ch(){for(var r=Ft;r;)r=Jn(r.nextSibling)}function ti(){Ft=Mt=null,Ke=!1}function Ll(r){an===null?an=[r]:an.push(r)}var ky=_.ReactCurrentBatchConfig;function Zi(r,o,c){if(r=c.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(t(309));var p=c.stateNode}if(!p)throw Error(t(147,r));var y=p,E=""+r;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===E?o.ref:(o=function(R){var C=y.refs;R===null?delete C[E]:C[E]=R},o._stringRef=E,o)}if(typeof r!="string")throw Error(t(284));if(!c._owner)throw Error(t(290,r))}return r}function la(r,o){throw r=Object.prototype.toString.call(o),Error(t(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r))}function dh(r){var o=r._init;return o(r._payload)}function hh(r){function o(V,M){if(r){var K=V.deletions;K===null?(V.deletions=[M],V.flags|=16):K.push(M)}}function c(V,M){if(!r)return null;for(;M!==null;)o(V,M),M=M.sibling;return null}function p(V,M){for(V=new Map;M!==null;)M.key!==null?V.set(M.key,M):V.set(M.index,M),M=M.sibling;return V}function y(V,M){return V=ur(V,M),V.index=0,V.sibling=null,V}function E(V,M,K){return V.index=K,r?(K=V.alternate,K!==null?(K=K.index,K<M?(V.flags|=2,M):K):(V.flags|=2,M)):(V.flags|=1048576,M)}function R(V){return r&&V.alternate===null&&(V.flags|=2),V}function C(V,M,K,re){return M===null||M.tag!==6?(M=mu(K,V.mode,re),M.return=V,M):(M=y(M,K),M.return=V,M)}function N(V,M,K,re){var xe=K.type;return xe===P?Z(V,M,K.props.children,re,K.key):M!==null&&(M.elementType===xe||typeof xe=="object"&&xe!==null&&xe.$$typeof===ee&&dh(xe)===M.type)?(re=y(M,K.props),re.ref=Zi(V,M,K),re.return=V,re):(re=Da(K.type,K.key,K.props,null,V.mode,re),re.ref=Zi(V,M,K),re.return=V,re)}function W(V,M,K,re){return M===null||M.tag!==4||M.stateNode.containerInfo!==K.containerInfo||M.stateNode.implementation!==K.implementation?(M=pu(K,V.mode,re),M.return=V,M):(M=y(M,K.children||[]),M.return=V,M)}function Z(V,M,K,re,xe){return M===null||M.tag!==7?(M=Dr(K,V.mode,re,xe),M.return=V,M):(M=y(M,K),M.return=V,M)}function te(V,M,K){if(typeof M=="string"&&M!==""||typeof M=="number")return M=mu(""+M,V.mode,K),M.return=V,M;if(typeof M=="object"&&M!==null){switch(M.$$typeof){case D:return K=Da(M.type,M.key,M.props,null,V.mode,K),K.ref=Zi(V,null,M),K.return=V,K;case j:return M=pu(M,V.mode,K),M.return=V,M;case ee:var re=M._init;return te(V,re(M._payload),K)}if(dt(M)||X(M))return M=Dr(M,V.mode,K,null),M.return=V,M;la(V,M)}return null}function J(V,M,K,re){var xe=M!==null?M.key:null;if(typeof K=="string"&&K!==""||typeof K=="number")return xe!==null?null:C(V,M,""+K,re);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case D:return K.key===xe?N(V,M,K,re):null;case j:return K.key===xe?W(V,M,K,re):null;case ee:return xe=K._init,J(V,M,xe(K._payload),re)}if(dt(K)||X(K))return xe!==null?null:Z(V,M,K,re,null);la(V,K)}return null}function de(V,M,K,re,xe){if(typeof re=="string"&&re!==""||typeof re=="number")return V=V.get(K)||null,C(M,V,""+re,xe);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case D:return V=V.get(re.key===null?K:re.key)||null,N(M,V,re,xe);case j:return V=V.get(re.key===null?K:re.key)||null,W(M,V,re,xe);case ee:var Ee=re._init;return de(V,M,K,Ee(re._payload),xe)}if(dt(re)||X(re))return V=V.get(K)||null,Z(M,V,re,xe,null);la(M,re)}return null}function ge(V,M,K,re){for(var xe=null,Ee=null,Se=M,Le=M=0,ut=null;Se!==null&&Le<K.length;Le++){Se.index>Le?(ut=Se,Se=null):ut=Se.sibling;var Pe=J(V,Se,K[Le],re);if(Pe===null){Se===null&&(Se=ut);break}r&&Se&&Pe.alternate===null&&o(V,Se),M=E(Pe,M,Le),Ee===null?xe=Pe:Ee.sibling=Pe,Ee=Pe,Se=ut}if(Le===K.length)return c(V,Se),Ke&&Ar(V,Le),xe;if(Se===null){for(;Le<K.length;Le++)Se=te(V,K[Le],re),Se!==null&&(M=E(Se,M,Le),Ee===null?xe=Se:Ee.sibling=Se,Ee=Se);return Ke&&Ar(V,Le),xe}for(Se=p(V,Se);Le<K.length;Le++)ut=de(Se,V,Le,K[Le],re),ut!==null&&(r&&ut.alternate!==null&&Se.delete(ut.key===null?Le:ut.key),M=E(ut,M,Le),Ee===null?xe=ut:Ee.sibling=ut,Ee=ut);return r&&Se.forEach(function(cr){return o(V,cr)}),Ke&&Ar(V,Le),xe}function ye(V,M,K,re){var xe=X(K);if(typeof xe!="function")throw Error(t(150));if(K=xe.call(K),K==null)throw Error(t(151));for(var Ee=xe=null,Se=M,Le=M=0,ut=null,Pe=K.next();Se!==null&&!Pe.done;Le++,Pe=K.next()){Se.index>Le?(ut=Se,Se=null):ut=Se.sibling;var cr=J(V,Se,Pe.value,re);if(cr===null){Se===null&&(Se=ut);break}r&&Se&&cr.alternate===null&&o(V,Se),M=E(cr,M,Le),Ee===null?xe=cr:Ee.sibling=cr,Ee=cr,Se=ut}if(Pe.done)return c(V,Se),Ke&&Ar(V,Le),xe;if(Se===null){for(;!Pe.done;Le++,Pe=K.next())Pe=te(V,Pe.value,re),Pe!==null&&(M=E(Pe,M,Le),Ee===null?xe=Pe:Ee.sibling=Pe,Ee=Pe);return Ke&&Ar(V,Le),xe}for(Se=p(V,Se);!Pe.done;Le++,Pe=K.next())Pe=de(Se,V,Le,Pe.value,re),Pe!==null&&(r&&Pe.alternate!==null&&Se.delete(Pe.key===null?Le:Pe.key),M=E(Pe,M,Le),Ee===null?xe=Pe:Ee.sibling=Pe,Ee=Pe);return r&&Se.forEach(function(uv){return o(V,uv)}),Ke&&Ar(V,Le),xe}function Ze(V,M,K,re){if(typeof K=="object"&&K!==null&&K.type===P&&K.key===null&&(K=K.props.children),typeof K=="object"&&K!==null){switch(K.$$typeof){case D:e:{for(var xe=K.key,Ee=M;Ee!==null;){if(Ee.key===xe){if(xe=K.type,xe===P){if(Ee.tag===7){c(V,Ee.sibling),M=y(Ee,K.props.children),M.return=V,V=M;break e}}else if(Ee.elementType===xe||typeof xe=="object"&&xe!==null&&xe.$$typeof===ee&&dh(xe)===Ee.type){c(V,Ee.sibling),M=y(Ee,K.props),M.ref=Zi(V,Ee,K),M.return=V,V=M;break e}c(V,Ee);break}else o(V,Ee);Ee=Ee.sibling}K.type===P?(M=Dr(K.props.children,V.mode,re,K.key),M.return=V,V=M):(re=Da(K.type,K.key,K.props,null,V.mode,re),re.ref=Zi(V,M,K),re.return=V,V=re)}return R(V);case j:e:{for(Ee=K.key;M!==null;){if(M.key===Ee)if(M.tag===4&&M.stateNode.containerInfo===K.containerInfo&&M.stateNode.implementation===K.implementation){c(V,M.sibling),M=y(M,K.children||[]),M.return=V,V=M;break e}else{c(V,M);break}else o(V,M);M=M.sibling}M=pu(K,V.mode,re),M.return=V,V=M}return R(V);case ee:return Ee=K._init,Ze(V,M,Ee(K._payload),re)}if(dt(K))return ge(V,M,K,re);if(X(K))return ye(V,M,K,re);la(V,K)}return typeof K=="string"&&K!==""||typeof K=="number"?(K=""+K,M!==null&&M.tag===6?(c(V,M.sibling),M=y(M,K),M.return=V,V=M):(c(V,M),M=mu(K,V.mode,re),M.return=V,V=M),R(V)):c(V,M)}return Ze}var ni=hh(!0),fh=hh(!1),ua=Zn(null),ca=null,ri=null,Al=null;function Il(){Al=ri=ca=null}function Rl(r){var o=ua.current;Ge(ua),r._currentValue=o}function wl(r,o,c){for(;r!==null;){var p=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,p!==null&&(p.childLanes|=o)):p!==null&&(p.childLanes&o)!==o&&(p.childLanes|=o),r===c)break;r=r.return}}function ii(r,o){ca=r,Al=ri=null,r=r.dependencies,r!==null&&r.firstContext!==null&&((r.lanes&o)!==0&&(wt=!0),r.firstContext=null)}function zt(r){var o=r._currentValue;if(Al!==r)if(r={context:r,memoizedValue:o,next:null},ri===null){if(ca===null)throw Error(t(308));ri=r,ca.dependencies={lanes:0,firstContext:r}}else ri=ri.next=r;return o}var Ir=null;function bl(r){Ir===null?Ir=[r]:Ir.push(r)}function mh(r,o,c,p){var y=o.interleaved;return y===null?(c.next=c,bl(o)):(c.next=y.next,y.next=c),o.interleaved=c,Dn(r,p)}function Dn(r,o){r.lanes|=o;var c=r.alternate;for(c!==null&&(c.lanes|=o),c=r,r=r.return;r!==null;)r.childLanes|=o,c=r.alternate,c!==null&&(c.childLanes|=o),c=r,r=r.return;return c.tag===3?c.stateNode:null}var nr=!1;function _l(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ph(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Pn(r,o){return{eventTime:r,lane:o,tag:0,payload:null,callback:null,next:null}}function rr(r,o,c){var p=r.updateQueue;if(p===null)return null;if(p=p.shared,(De&2)!==0){var y=p.pending;return y===null?o.next=o:(o.next=y.next,y.next=o),p.pending=o,Dn(r,c)}return y=p.interleaved,y===null?(o.next=o,bl(p)):(o.next=y.next,y.next=o),p.interleaved=o,Dn(r,c)}function da(r,o,c){if(o=o.updateQueue,o!==null&&(o=o.shared,(c&4194240)!==0)){var p=o.lanes;p&=r.pendingLanes,c|=p,o.lanes=c,Vo(r,c)}}function gh(r,o){var c=r.updateQueue,p=r.alternate;if(p!==null&&(p=p.updateQueue,c===p)){var y=null,E=null;if(c=c.firstBaseUpdate,c!==null){do{var R={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};E===null?y=E=R:E=E.next=R,c=c.next}while(c!==null);E===null?y=E=o:E=E.next=o}else y=E=o;c={baseState:p.baseState,firstBaseUpdate:y,lastBaseUpdate:E,shared:p.shared,effects:p.effects},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=o:r.next=o,c.lastBaseUpdate=o}function ha(r,o,c,p){var y=r.updateQueue;nr=!1;var E=y.firstBaseUpdate,R=y.lastBaseUpdate,C=y.shared.pending;if(C!==null){y.shared.pending=null;var N=C,W=N.next;N.next=null,R===null?E=W:R.next=W,R=N;var Z=r.alternate;Z!==null&&(Z=Z.updateQueue,C=Z.lastBaseUpdate,C!==R&&(C===null?Z.firstBaseUpdate=W:C.next=W,Z.lastBaseUpdate=N))}if(E!==null){var te=y.baseState;R=0,Z=W=N=null,C=E;do{var J=C.lane,de=C.eventTime;if((p&J)===J){Z!==null&&(Z=Z.next={eventTime:de,lane:0,tag:C.tag,payload:C.payload,callback:C.callback,next:null});e:{var ge=r,ye=C;switch(J=o,de=c,ye.tag){case 1:if(ge=ye.payload,typeof ge=="function"){te=ge.call(de,te,J);break e}te=ge;break e;case 3:ge.flags=ge.flags&-65537|128;case 0:if(ge=ye.payload,J=typeof ge=="function"?ge.call(de,te,J):ge,J==null)break e;te=Q({},te,J);break e;case 2:nr=!0}}C.callback!==null&&C.lane!==0&&(r.flags|=64,J=y.effects,J===null?y.effects=[C]:J.push(C))}else de={eventTime:de,lane:J,tag:C.tag,payload:C.payload,callback:C.callback,next:null},Z===null?(W=Z=de,N=te):Z=Z.next=de,R|=J;if(C=C.next,C===null){if(C=y.shared.pending,C===null)break;J=C,C=J.next,J.next=null,y.lastBaseUpdate=J,y.shared.pending=null}}while(!0);if(Z===null&&(N=te),y.baseState=N,y.firstBaseUpdate=W,y.lastBaseUpdate=Z,o=y.shared.interleaved,o!==null){y=o;do R|=y.lane,y=y.next;while(y!==o)}else E===null&&(y.shared.lanes=0);br|=R,r.lanes=R,r.memoizedState=te}}function yh(r,o,c){if(r=o.effects,o.effects=null,r!==null)for(o=0;o<r.length;o++){var p=r[o],y=p.callback;if(y!==null){if(p.callback=null,p=c,typeof y!="function")throw Error(t(191,y));y.call(p)}}}var es={},gn=Zn(es),ts=Zn(es),ns=Zn(es);function Rr(r){if(r===es)throw Error(t(174));return r}function kl(r,o){switch($e(ns,o),$e(ts,r),$e(gn,es),r=o.nodeType,r){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:Ur(null,"");break;default:r=r===8?o.parentNode:o,o=r.namespaceURI||null,r=r.tagName,o=Ur(o,r)}Ge(gn),$e(gn,o)}function si(){Ge(gn),Ge(ts),Ge(ns)}function vh(r){Rr(ns.current);var o=Rr(gn.current),c=Ur(o,r.type);o!==c&&($e(ts,r),$e(gn,c))}function Cl(r){ts.current===r&&(Ge(gn),Ge(ts))}var He=Zn(0);function fa(r){for(var o=r;o!==null;){if(o.tag===13){var c=o.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Dl=[];function Pl(){for(var r=0;r<Dl.length;r++)Dl[r]._workInProgressVersionPrimary=null;Dl.length=0}var ma=_.ReactCurrentDispatcher,Nl=_.ReactCurrentBatchConfig,wr=0,We=null,rt=null,ot=null,pa=!1,rs=!1,is=0,Cy=0;function vt(){throw Error(t(321))}function Ol(r,o){if(o===null)return!1;for(var c=0;c<o.length&&c<r.length;c++)if(!sn(r[c],o[c]))return!1;return!0}function Ml(r,o,c,p,y,E){if(wr=E,We=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,ma.current=r===null||r.memoizedState===null?Oy:My,r=c(p,y),rs){E=0;do{if(rs=!1,is=0,25<=E)throw Error(t(301));E+=1,ot=rt=null,o.updateQueue=null,ma.current=Fy,r=c(p,y)}while(rs)}if(ma.current=va,o=rt!==null&&rt.next!==null,wr=0,ot=rt=We=null,pa=!1,o)throw Error(t(300));return r}function Fl(){var r=is!==0;return is=0,r}function yn(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ot===null?We.memoizedState=ot=r:ot=ot.next=r,ot}function Yt(){if(rt===null){var r=We.alternate;r=r!==null?r.memoizedState:null}else r=rt.next;var o=ot===null?We.memoizedState:ot.next;if(o!==null)ot=o,rt=r;else{if(r===null)throw Error(t(310));rt=r,r={memoizedState:rt.memoizedState,baseState:rt.baseState,baseQueue:rt.baseQueue,queue:rt.queue,next:null},ot===null?We.memoizedState=ot=r:ot=ot.next=r}return ot}function ss(r,o){return typeof o=="function"?o(r):o}function Bl(r){var o=Yt(),c=o.queue;if(c===null)throw Error(t(311));c.lastRenderedReducer=r;var p=rt,y=p.baseQueue,E=c.pending;if(E!==null){if(y!==null){var R=y.next;y.next=E.next,E.next=R}p.baseQueue=y=E,c.pending=null}if(y!==null){E=y.next,p=p.baseState;var C=R=null,N=null,W=E;do{var Z=W.lane;if((wr&Z)===Z)N!==null&&(N=N.next={lane:0,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null}),p=W.hasEagerState?W.eagerState:r(p,W.action);else{var te={lane:Z,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null};N===null?(C=N=te,R=p):N=N.next=te,We.lanes|=Z,br|=Z}W=W.next}while(W!==null&&W!==E);N===null?R=p:N.next=C,sn(p,o.memoizedState)||(wt=!0),o.memoizedState=p,o.baseState=R,o.baseQueue=N,c.lastRenderedState=p}if(r=c.interleaved,r!==null){y=r;do E=y.lane,We.lanes|=E,br|=E,y=y.next;while(y!==r)}else y===null&&(c.lanes=0);return[o.memoizedState,c.dispatch]}function Ul(r){var o=Yt(),c=o.queue;if(c===null)throw Error(t(311));c.lastRenderedReducer=r;var p=c.dispatch,y=c.pending,E=o.memoizedState;if(y!==null){c.pending=null;var R=y=y.next;do E=r(E,R.action),R=R.next;while(R!==y);sn(E,o.memoizedState)||(wt=!0),o.memoizedState=E,o.baseQueue===null&&(o.baseState=E),c.lastRenderedState=E}return[E,p]}function xh(){}function Eh(r,o){var c=We,p=Yt(),y=o(),E=!sn(p.memoizedState,y);if(E&&(p.memoizedState=y,wt=!0),p=p.queue,$l(Lh.bind(null,c,p,r),[r]),p.getSnapshot!==o||E||ot!==null&&ot.memoizedState.tag&1){if(c.flags|=2048,as(9,Th.bind(null,c,p,y,o),void 0,null),lt===null)throw Error(t(349));(wr&30)!==0||Sh(c,o,y)}return y}function Sh(r,o,c){r.flags|=16384,r={getSnapshot:o,value:c},o=We.updateQueue,o===null?(o={lastEffect:null,stores:null},We.updateQueue=o,o.stores=[r]):(c=o.stores,c===null?o.stores=[r]:c.push(r))}function Th(r,o,c,p){o.value=c,o.getSnapshot=p,Ah(o)&&Ih(r)}function Lh(r,o,c){return c(function(){Ah(o)&&Ih(r)})}function Ah(r){var o=r.getSnapshot;r=r.value;try{var c=o();return!sn(r,c)}catch{return!0}}function Ih(r){var o=Dn(r,1);o!==null&&cn(o,r,1,-1)}function Rh(r){var o=yn();return typeof r=="function"&&(r=r()),o.memoizedState=o.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ss,lastRenderedState:r},o.queue=r,r=r.dispatch=Ny.bind(null,We,r),[o.memoizedState,r]}function as(r,o,c,p){return r={tag:r,create:o,destroy:c,deps:p,next:null},o=We.updateQueue,o===null?(o={lastEffect:null,stores:null},We.updateQueue=o,o.lastEffect=r.next=r):(c=o.lastEffect,c===null?o.lastEffect=r.next=r:(p=c.next,c.next=r,r.next=p,o.lastEffect=r)),r}function wh(){return Yt().memoizedState}function ga(r,o,c,p){var y=yn();We.flags|=r,y.memoizedState=as(1|o,c,void 0,p===void 0?null:p)}function ya(r,o,c,p){var y=Yt();p=p===void 0?null:p;var E=void 0;if(rt!==null){var R=rt.memoizedState;if(E=R.destroy,p!==null&&Ol(p,R.deps)){y.memoizedState=as(o,c,E,p);return}}We.flags|=r,y.memoizedState=as(1|o,c,E,p)}function bh(r,o){return ga(8390656,8,r,o)}function $l(r,o){return ya(2048,8,r,o)}function _h(r,o){return ya(4,2,r,o)}function kh(r,o){return ya(4,4,r,o)}function Ch(r,o){if(typeof o=="function")return r=r(),o(r),function(){o(null)};if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function Dh(r,o,c){return c=c!=null?c.concat([r]):null,ya(4,4,Ch.bind(null,o,r),c)}function jl(){}function Ph(r,o){var c=Yt();o=o===void 0?null:o;var p=c.memoizedState;return p!==null&&o!==null&&Ol(o,p[1])?p[0]:(c.memoizedState=[r,o],r)}function Nh(r,o){var c=Yt();o=o===void 0?null:o;var p=c.memoizedState;return p!==null&&o!==null&&Ol(o,p[1])?p[0]:(r=r(),c.memoizedState=[r,o],r)}function Oh(r,o,c){return(wr&21)===0?(r.baseState&&(r.baseState=!1,wt=!0),r.memoizedState=c):(sn(c,o)||(c=dd(),We.lanes|=c,br|=c,r.baseState=!0),o)}function Dy(r,o){var c=Ne;Ne=c!==0&&4>c?c:4,r(!0);var p=Nl.transition;Nl.transition={};try{r(!1),o()}finally{Ne=c,Nl.transition=p}}function Mh(){return Yt().memoizedState}function Py(r,o,c){var p=or(r);if(c={lane:p,action:c,hasEagerState:!1,eagerState:null,next:null},Fh(r))Bh(o,c);else if(c=mh(r,o,c,p),c!==null){var y=Lt();cn(c,r,p,y),Uh(c,o,p)}}function Ny(r,o,c){var p=or(r),y={lane:p,action:c,hasEagerState:!1,eagerState:null,next:null};if(Fh(r))Bh(o,y);else{var E=r.alternate;if(r.lanes===0&&(E===null||E.lanes===0)&&(E=o.lastRenderedReducer,E!==null))try{var R=o.lastRenderedState,C=E(R,c);if(y.hasEagerState=!0,y.eagerState=C,sn(C,R)){var N=o.interleaved;N===null?(y.next=y,bl(o)):(y.next=N.next,N.next=y),o.interleaved=y;return}}catch{}finally{}c=mh(r,o,y,p),c!==null&&(y=Lt(),cn(c,r,p,y),Uh(c,o,p))}}function Fh(r){var o=r.alternate;return r===We||o!==null&&o===We}function Bh(r,o){rs=pa=!0;var c=r.pending;c===null?o.next=o:(o.next=c.next,c.next=o),r.pending=o}function Uh(r,o,c){if((c&4194240)!==0){var p=o.lanes;p&=r.pendingLanes,c|=p,o.lanes=c,Vo(r,c)}}var va={readContext:zt,useCallback:vt,useContext:vt,useEffect:vt,useImperativeHandle:vt,useInsertionEffect:vt,useLayoutEffect:vt,useMemo:vt,useReducer:vt,useRef:vt,useState:vt,useDebugValue:vt,useDeferredValue:vt,useTransition:vt,useMutableSource:vt,useSyncExternalStore:vt,useId:vt,unstable_isNewReconciler:!1},Oy={readContext:zt,useCallback:function(r,o){return yn().memoizedState=[r,o===void 0?null:o],r},useContext:zt,useEffect:bh,useImperativeHandle:function(r,o,c){return c=c!=null?c.concat([r]):null,ga(4194308,4,Ch.bind(null,o,r),c)},useLayoutEffect:function(r,o){return ga(4194308,4,r,o)},useInsertionEffect:function(r,o){return ga(4,2,r,o)},useMemo:function(r,o){var c=yn();return o=o===void 0?null:o,r=r(),c.memoizedState=[r,o],r},useReducer:function(r,o,c){var p=yn();return o=c!==void 0?c(o):o,p.memoizedState=p.baseState=o,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:o},p.queue=r,r=r.dispatch=Py.bind(null,We,r),[p.memoizedState,r]},useRef:function(r){var o=yn();return r={current:r},o.memoizedState=r},useState:Rh,useDebugValue:jl,useDeferredValue:function(r){return yn().memoizedState=r},useTransition:function(){var r=Rh(!1),o=r[0];return r=Dy.bind(null,r[1]),yn().memoizedState=r,[o,r]},useMutableSource:function(){},useSyncExternalStore:function(r,o,c){var p=We,y=yn();if(Ke){if(c===void 0)throw Error(t(407));c=c()}else{if(c=o(),lt===null)throw Error(t(349));(wr&30)!==0||Sh(p,o,c)}y.memoizedState=c;var E={value:c,getSnapshot:o};return y.queue=E,bh(Lh.bind(null,p,E,r),[r]),p.flags|=2048,as(9,Th.bind(null,p,E,c,o),void 0,null),c},useId:function(){var r=yn(),o=lt.identifierPrefix;if(Ke){var c=Cn,p=kn;c=(p&~(1<<32-rn(p)-1)).toString(32)+c,o=":"+o+"R"+c,c=is++,0<c&&(o+="H"+c.toString(32)),o+=":"}else c=Cy++,o=":"+o+"r"+c.toString(32)+":";return r.memoizedState=o},unstable_isNewReconciler:!1},My={readContext:zt,useCallback:Ph,useContext:zt,useEffect:$l,useImperativeHandle:Dh,useInsertionEffect:_h,useLayoutEffect:kh,useMemo:Nh,useReducer:Bl,useRef:wh,useState:function(){return Bl(ss)},useDebugValue:jl,useDeferredValue:function(r){var o=Yt();return Oh(o,rt.memoizedState,r)},useTransition:function(){var r=Bl(ss)[0],o=Yt().memoizedState;return[r,o]},useMutableSource:xh,useSyncExternalStore:Eh,useId:Mh,unstable_isNewReconciler:!1},Fy={readContext:zt,useCallback:Ph,useContext:zt,useEffect:$l,useImperativeHandle:Dh,useInsertionEffect:_h,useLayoutEffect:kh,useMemo:Nh,useReducer:Ul,useRef:wh,useState:function(){return Ul(ss)},useDebugValue:jl,useDeferredValue:function(r){var o=Yt();return rt===null?o.memoizedState=r:Oh(o,rt.memoizedState,r)},useTransition:function(){var r=Ul(ss)[0],o=Yt().memoizedState;return[r,o]},useMutableSource:xh,useSyncExternalStore:Eh,useId:Mh,unstable_isNewReconciler:!1};function on(r,o){if(r&&r.defaultProps){o=Q({},o),r=r.defaultProps;for(var c in r)o[c]===void 0&&(o[c]=r[c]);return o}return o}function Gl(r,o,c,p){o=r.memoizedState,c=c(p,o),c=c==null?o:Q({},o,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var xa={isMounted:function(r){return(r=r._reactInternals)?Er(r)===r:!1},enqueueSetState:function(r,o,c){r=r._reactInternals;var p=Lt(),y=or(r),E=Pn(p,y);E.payload=o,c!=null&&(E.callback=c),o=rr(r,E,y),o!==null&&(cn(o,r,y,p),da(o,r,y))},enqueueReplaceState:function(r,o,c){r=r._reactInternals;var p=Lt(),y=or(r),E=Pn(p,y);E.tag=1,E.payload=o,c!=null&&(E.callback=c),o=rr(r,E,y),o!==null&&(cn(o,r,y,p),da(o,r,y))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var c=Lt(),p=or(r),y=Pn(c,p);y.tag=2,o!=null&&(y.callback=o),o=rr(r,y,p),o!==null&&(cn(o,r,p,c),da(o,r,p))}};function $h(r,o,c,p,y,E,R){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(p,E,R):o.prototype&&o.prototype.isPureReactComponent?!Wi(c,p)||!Wi(y,E):!0}function jh(r,o,c){var p=!1,y=er,E=o.contextType;return typeof E=="object"&&E!==null?E=zt(E):(y=Rt(o)?Tr:yt.current,p=o.contextTypes,E=(p=p!=null)?Jr(r,y):er),o=new o(c,E),r.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=xa,r.stateNode=o,o._reactInternals=r,p&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=y,r.__reactInternalMemoizedMaskedChildContext=E),o}function Gh(r,o,c,p){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(c,p),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(c,p),o.state!==r&&xa.enqueueReplaceState(o,o.state,null)}function Vl(r,o,c,p){var y=r.stateNode;y.props=c,y.state=r.memoizedState,y.refs={},_l(r);var E=o.contextType;typeof E=="object"&&E!==null?y.context=zt(E):(E=Rt(o)?Tr:yt.current,y.context=Jr(r,E)),y.state=r.memoizedState,E=o.getDerivedStateFromProps,typeof E=="function"&&(Gl(r,o,E,c),y.state=r.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(o=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),o!==y.state&&xa.enqueueReplaceState(y,y.state,null),ha(r,c,y,p),y.state=r.memoizedState),typeof y.componentDidMount=="function"&&(r.flags|=4194308)}function ai(r,o){try{var c="",p=o;do c+=ce(p),p=p.return;while(p);var y=c}catch(E){y=`
Error generating stack: `+E.message+`
`+E.stack}return{value:r,source:o,stack:y,digest:null}}function Kl(r,o,c){return{value:r,source:null,stack:c??null,digest:o??null}}function Hl(r,o){try{console.error(o.value)}catch(c){setTimeout(function(){throw c})}}var By=typeof WeakMap=="function"?WeakMap:Map;function Vh(r,o,c){c=Pn(-1,c),c.tag=3,c.payload={element:null};var p=o.value;return c.callback=function(){Ra||(Ra=!0,au=p),Hl(r,o)},c}function Kh(r,o,c){c=Pn(-1,c),c.tag=3;var p=r.type.getDerivedStateFromError;if(typeof p=="function"){var y=o.value;c.payload=function(){return p(y)},c.callback=function(){Hl(r,o)}}var E=r.stateNode;return E!==null&&typeof E.componentDidCatch=="function"&&(c.callback=function(){Hl(r,o),typeof p!="function"&&(sr===null?sr=new Set([this]):sr.add(this));var R=o.stack;this.componentDidCatch(o.value,{componentStack:R!==null?R:""})}),c}function Hh(r,o,c){var p=r.pingCache;if(p===null){p=r.pingCache=new By;var y=new Set;p.set(o,y)}else y=p.get(o),y===void 0&&(y=new Set,p.set(o,y));y.has(c)||(y.add(c),r=Jy.bind(null,r,o,c),o.then(r,r))}function Wh(r){do{var o;if((o=r.tag===13)&&(o=r.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return r;r=r.return}while(r!==null);return null}function zh(r,o,c,p,y){return(r.mode&1)===0?(r===o?r.flags|=65536:(r.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(o=Pn(-1,1),o.tag=2,rr(c,o,1))),c.lanes|=1),r):(r.flags|=65536,r.lanes=y,r)}var Uy=_.ReactCurrentOwner,wt=!1;function Tt(r,o,c,p){o.child=r===null?fh(o,null,c,p):ni(o,r.child,c,p)}function Yh(r,o,c,p,y){c=c.render;var E=o.ref;return ii(o,y),p=Ml(r,o,c,p,E,y),c=Fl(),r!==null&&!wt?(o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~y,Nn(r,o,y)):(Ke&&c&&xl(o),o.flags|=1,Tt(r,o,p,y),o.child)}function qh(r,o,c,p,y){if(r===null){var E=c.type;return typeof E=="function"&&!fu(E)&&E.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(o.tag=15,o.type=E,Qh(r,o,E,p,y)):(r=Da(c.type,null,p,o,o.mode,y),r.ref=o.ref,r.return=o,o.child=r)}if(E=r.child,(r.lanes&y)===0){var R=E.memoizedProps;if(c=c.compare,c=c!==null?c:Wi,c(R,p)&&r.ref===o.ref)return Nn(r,o,y)}return o.flags|=1,r=ur(E,p),r.ref=o.ref,r.return=o,o.child=r}function Qh(r,o,c,p,y){if(r!==null){var E=r.memoizedProps;if(Wi(E,p)&&r.ref===o.ref)if(wt=!1,o.pendingProps=p=E,(r.lanes&y)!==0)(r.flags&131072)!==0&&(wt=!0);else return o.lanes=r.lanes,Nn(r,o,y)}return Wl(r,o,c,p,y)}function Xh(r,o,c){var p=o.pendingProps,y=p.children,E=r!==null?r.memoizedState:null;if(p.mode==="hidden")if((o.mode&1)===0)o.memoizedState={baseLanes:0,cachePool:null,transitions:null},$e(li,Bt),Bt|=c;else{if((c&1073741824)===0)return r=E!==null?E.baseLanes|c:c,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:r,cachePool:null,transitions:null},o.updateQueue=null,$e(li,Bt),Bt|=r,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=E!==null?E.baseLanes:c,$e(li,Bt),Bt|=p}else E!==null?(p=E.baseLanes|c,o.memoizedState=null):p=c,$e(li,Bt),Bt|=p;return Tt(r,o,y,c),o.child}function Jh(r,o){var c=o.ref;(r===null&&c!==null||r!==null&&r.ref!==c)&&(o.flags|=512,o.flags|=2097152)}function Wl(r,o,c,p,y){var E=Rt(c)?Tr:yt.current;return E=Jr(o,E),ii(o,y),c=Ml(r,o,c,p,E,y),p=Fl(),r!==null&&!wt?(o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~y,Nn(r,o,y)):(Ke&&p&&xl(o),o.flags|=1,Tt(r,o,c,y),o.child)}function Zh(r,o,c,p,y){if(Rt(c)){var E=!0;ra(o)}else E=!1;if(ii(o,y),o.stateNode===null)Sa(r,o),jh(o,c,p),Vl(o,c,p,y),p=!0;else if(r===null){var R=o.stateNode,C=o.memoizedProps;R.props=C;var N=R.context,W=c.contextType;typeof W=="object"&&W!==null?W=zt(W):(W=Rt(c)?Tr:yt.current,W=Jr(o,W));var Z=c.getDerivedStateFromProps,te=typeof Z=="function"||typeof R.getSnapshotBeforeUpdate=="function";te||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(C!==p||N!==W)&&Gh(o,R,p,W),nr=!1;var J=o.memoizedState;R.state=J,ha(o,p,R,y),N=o.memoizedState,C!==p||J!==N||It.current||nr?(typeof Z=="function"&&(Gl(o,c,Z,p),N=o.memoizedState),(C=nr||$h(o,c,C,p,J,N,W))?(te||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(o.flags|=4194308)):(typeof R.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=p,o.memoizedState=N),R.props=p,R.state=N,R.context=W,p=C):(typeof R.componentDidMount=="function"&&(o.flags|=4194308),p=!1)}else{R=o.stateNode,ph(r,o),C=o.memoizedProps,W=o.type===o.elementType?C:on(o.type,C),R.props=W,te=o.pendingProps,J=R.context,N=c.contextType,typeof N=="object"&&N!==null?N=zt(N):(N=Rt(c)?Tr:yt.current,N=Jr(o,N));var de=c.getDerivedStateFromProps;(Z=typeof de=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(C!==te||J!==N)&&Gh(o,R,p,N),nr=!1,J=o.memoizedState,R.state=J,ha(o,p,R,y);var ge=o.memoizedState;C!==te||J!==ge||It.current||nr?(typeof de=="function"&&(Gl(o,c,de,p),ge=o.memoizedState),(W=nr||$h(o,c,W,p,J,ge,N)||!1)?(Z||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(p,ge,N),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(p,ge,N)),typeof R.componentDidUpdate=="function"&&(o.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof R.componentDidUpdate!="function"||C===r.memoizedProps&&J===r.memoizedState||(o.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||C===r.memoizedProps&&J===r.memoizedState||(o.flags|=1024),o.memoizedProps=p,o.memoizedState=ge),R.props=p,R.state=ge,R.context=N,p=W):(typeof R.componentDidUpdate!="function"||C===r.memoizedProps&&J===r.memoizedState||(o.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||C===r.memoizedProps&&J===r.memoizedState||(o.flags|=1024),p=!1)}return zl(r,o,c,p,E,y)}function zl(r,o,c,p,y,E){Jh(r,o);var R=(o.flags&128)!==0;if(!p&&!R)return y&&ih(o,c,!1),Nn(r,o,E);p=o.stateNode,Uy.current=o;var C=R&&typeof c.getDerivedStateFromError!="function"?null:p.render();return o.flags|=1,r!==null&&R?(o.child=ni(o,r.child,null,E),o.child=ni(o,null,C,E)):Tt(r,o,C,E),o.memoizedState=p.state,y&&ih(o,c,!0),o.child}function ef(r){var o=r.stateNode;o.pendingContext?nh(r,o.pendingContext,o.pendingContext!==o.context):o.context&&nh(r,o.context,!1),kl(r,o.containerInfo)}function tf(r,o,c,p,y){return ti(),Ll(y),o.flags|=256,Tt(r,o,c,p),o.child}var Yl={dehydrated:null,treeContext:null,retryLane:0};function ql(r){return{baseLanes:r,cachePool:null,transitions:null}}function nf(r,o,c){var p=o.pendingProps,y=He.current,E=!1,R=(o.flags&128)!==0,C;if((C=R)||(C=r!==null&&r.memoizedState===null?!1:(y&2)!==0),C?(E=!0,o.flags&=-129):(r===null||r.memoizedState!==null)&&(y|=1),$e(He,y&1),r===null)return Tl(o),r=o.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?((o.mode&1)===0?o.lanes=1:r.data==="$!"?o.lanes=8:o.lanes=1073741824,null):(R=p.children,r=p.fallback,E?(p=o.mode,E=o.child,R={mode:"hidden",children:R},(p&1)===0&&E!==null?(E.childLanes=0,E.pendingProps=R):E=Pa(R,p,0,null),r=Dr(r,p,c,null),E.return=o,r.return=o,E.sibling=r,o.child=E,o.child.memoizedState=ql(c),o.memoizedState=Yl,r):Ql(o,R));if(y=r.memoizedState,y!==null&&(C=y.dehydrated,C!==null))return $y(r,o,R,p,C,y,c);if(E){E=p.fallback,R=o.mode,y=r.child,C=y.sibling;var N={mode:"hidden",children:p.children};return(R&1)===0&&o.child!==y?(p=o.child,p.childLanes=0,p.pendingProps=N,o.deletions=null):(p=ur(y,N),p.subtreeFlags=y.subtreeFlags&14680064),C!==null?E=ur(C,E):(E=Dr(E,R,c,null),E.flags|=2),E.return=o,p.return=o,p.sibling=E,o.child=p,p=E,E=o.child,R=r.child.memoizedState,R=R===null?ql(c):{baseLanes:R.baseLanes|c,cachePool:null,transitions:R.transitions},E.memoizedState=R,E.childLanes=r.childLanes&~c,o.memoizedState=Yl,p}return E=r.child,r=E.sibling,p=ur(E,{mode:"visible",children:p.children}),(o.mode&1)===0&&(p.lanes=c),p.return=o,p.sibling=null,r!==null&&(c=o.deletions,c===null?(o.deletions=[r],o.flags|=16):c.push(r)),o.child=p,o.memoizedState=null,p}function Ql(r,o){return o=Pa({mode:"visible",children:o},r.mode,0,null),o.return=r,r.child=o}function Ea(r,o,c,p){return p!==null&&Ll(p),ni(o,r.child,null,c),r=Ql(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function $y(r,o,c,p,y,E,R){if(c)return o.flags&256?(o.flags&=-257,p=Kl(Error(t(422))),Ea(r,o,R,p)):o.memoizedState!==null?(o.child=r.child,o.flags|=128,null):(E=p.fallback,y=o.mode,p=Pa({mode:"visible",children:p.children},y,0,null),E=Dr(E,y,R,null),E.flags|=2,p.return=o,E.return=o,p.sibling=E,o.child=p,(o.mode&1)!==0&&ni(o,r.child,null,R),o.child.memoizedState=ql(R),o.memoizedState=Yl,E);if((o.mode&1)===0)return Ea(r,o,R,null);if(y.data==="$!"){if(p=y.nextSibling&&y.nextSibling.dataset,p)var C=p.dgst;return p=C,E=Error(t(419)),p=Kl(E,p,void 0),Ea(r,o,R,p)}if(C=(R&r.childLanes)!==0,wt||C){if(p=lt,p!==null){switch(R&-R){case 4:y=2;break;case 16:y=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:y=32;break;case 536870912:y=268435456;break;default:y=0}y=(y&(p.suspendedLanes|R))!==0?0:y,y!==0&&y!==E.retryLane&&(E.retryLane=y,Dn(r,y),cn(p,r,y,-1))}return hu(),p=Kl(Error(t(421))),Ea(r,o,R,p)}return y.data==="$?"?(o.flags|=128,o.child=r.child,o=Zy.bind(null,r),y._reactRetry=o,null):(r=E.treeContext,Ft=Jn(y.nextSibling),Mt=o,Ke=!0,an=null,r!==null&&(Ht[Wt++]=kn,Ht[Wt++]=Cn,Ht[Wt++]=Lr,kn=r.id,Cn=r.overflow,Lr=o),o=Ql(o,p.children),o.flags|=4096,o)}function rf(r,o,c){r.lanes|=o;var p=r.alternate;p!==null&&(p.lanes|=o),wl(r.return,o,c)}function Xl(r,o,c,p,y){var E=r.memoizedState;E===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:p,tail:c,tailMode:y}:(E.isBackwards=o,E.rendering=null,E.renderingStartTime=0,E.last=p,E.tail=c,E.tailMode=y)}function sf(r,o,c){var p=o.pendingProps,y=p.revealOrder,E=p.tail;if(Tt(r,o,p.children,c),p=He.current,(p&2)!==0)p=p&1|2,o.flags|=128;else{if(r!==null&&(r.flags&128)!==0)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&rf(r,c,o);else if(r.tag===19)rf(r,c,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}p&=1}if($e(He,p),(o.mode&1)===0)o.memoizedState=null;else switch(y){case"forwards":for(c=o.child,y=null;c!==null;)r=c.alternate,r!==null&&fa(r)===null&&(y=c),c=c.sibling;c=y,c===null?(y=o.child,o.child=null):(y=c.sibling,c.sibling=null),Xl(o,!1,y,c,E);break;case"backwards":for(c=null,y=o.child,o.child=null;y!==null;){if(r=y.alternate,r!==null&&fa(r)===null){o.child=y;break}r=y.sibling,y.sibling=c,c=y,y=r}Xl(o,!0,c,null,E);break;case"together":Xl(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Sa(r,o){(o.mode&1)===0&&r!==null&&(r.alternate=null,o.alternate=null,o.flags|=2)}function Nn(r,o,c){if(r!==null&&(o.dependencies=r.dependencies),br|=o.lanes,(c&o.childLanes)===0)return null;if(r!==null&&o.child!==r.child)throw Error(t(153));if(o.child!==null){for(r=o.child,c=ur(r,r.pendingProps),o.child=c,c.return=o;r.sibling!==null;)r=r.sibling,c=c.sibling=ur(r,r.pendingProps),c.return=o;c.sibling=null}return o.child}function jy(r,o,c){switch(o.tag){case 3:ef(o),ti();break;case 5:vh(o);break;case 1:Rt(o.type)&&ra(o);break;case 4:kl(o,o.stateNode.containerInfo);break;case 10:var p=o.type._context,y=o.memoizedProps.value;$e(ua,p._currentValue),p._currentValue=y;break;case 13:if(p=o.memoizedState,p!==null)return p.dehydrated!==null?($e(He,He.current&1),o.flags|=128,null):(c&o.child.childLanes)!==0?nf(r,o,c):($e(He,He.current&1),r=Nn(r,o,c),r!==null?r.sibling:null);$e(He,He.current&1);break;case 19:if(p=(c&o.childLanes)!==0,(r.flags&128)!==0){if(p)return sf(r,o,c);o.flags|=128}if(y=o.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),$e(He,He.current),p)break;return null;case 22:case 23:return o.lanes=0,Xh(r,o,c)}return Nn(r,o,c)}var af,Jl,of,lf;af=function(r,o){for(var c=o.child;c!==null;){if(c.tag===5||c.tag===6)r.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},Jl=function(){},of=function(r,o,c,p){var y=r.memoizedProps;if(y!==p){r=o.stateNode,Rr(gn.current);var E=null;switch(c){case"input":y=vr(r,y),p=vr(r,p),E=[];break;case"select":y=Q({},y,{value:void 0}),p=Q({},p,{value:void 0}),E=[];break;case"textarea":y=tn(r,y),p=tn(r,p),E=[];break;default:typeof y.onClick!="function"&&typeof p.onClick=="function"&&(r.onclick=ea)}Do(c,p);var R;c=null;for(W in y)if(!p.hasOwnProperty(W)&&y.hasOwnProperty(W)&&y[W]!=null)if(W==="style"){var C=y[W];for(R in C)C.hasOwnProperty(R)&&(c||(c={}),c[R]="")}else W!=="dangerouslySetInnerHTML"&&W!=="children"&&W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&W!=="autoFocus"&&(i.hasOwnProperty(W)?E||(E=[]):(E=E||[]).push(W,null));for(W in p){var N=p[W];if(C=y!=null?y[W]:void 0,p.hasOwnProperty(W)&&N!==C&&(N!=null||C!=null))if(W==="style")if(C){for(R in C)!C.hasOwnProperty(R)||N&&N.hasOwnProperty(R)||(c||(c={}),c[R]="");for(R in N)N.hasOwnProperty(R)&&C[R]!==N[R]&&(c||(c={}),c[R]=N[R])}else c||(E||(E=[]),E.push(W,c)),c=N;else W==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,C=C?C.__html:void 0,N!=null&&C!==N&&(E=E||[]).push(W,N)):W==="children"?typeof N!="string"&&typeof N!="number"||(E=E||[]).push(W,""+N):W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&(i.hasOwnProperty(W)?(N!=null&&W==="onScroll"&&je("scroll",r),E||C===N||(E=[])):(E=E||[]).push(W,N))}c&&(E=E||[]).push("style",c);var W=E;(o.updateQueue=W)&&(o.flags|=4)}},lf=function(r,o,c,p){c!==p&&(o.flags|=4)};function os(r,o){if(!Ke)switch(r.tailMode){case"hidden":o=r.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var p=null;c!==null;)c.alternate!==null&&(p=c),c=c.sibling;p===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:p.sibling=null}}function xt(r){var o=r.alternate!==null&&r.alternate.child===r.child,c=0,p=0;if(o)for(var y=r.child;y!==null;)c|=y.lanes|y.childLanes,p|=y.subtreeFlags&14680064,p|=y.flags&14680064,y.return=r,y=y.sibling;else for(y=r.child;y!==null;)c|=y.lanes|y.childLanes,p|=y.subtreeFlags,p|=y.flags,y.return=r,y=y.sibling;return r.subtreeFlags|=p,r.childLanes=c,o}function Gy(r,o,c){var p=o.pendingProps;switch(El(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xt(o),null;case 1:return Rt(o.type)&&na(),xt(o),null;case 3:return p=o.stateNode,si(),Ge(It),Ge(yt),Pl(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(r===null||r.child===null)&&(oa(o)?o.flags|=4:r===null||r.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,an!==null&&(uu(an),an=null))),Jl(r,o),xt(o),null;case 5:Cl(o);var y=Rr(ns.current);if(c=o.type,r!==null&&o.stateNode!=null)of(r,o,c,p,y),r.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!p){if(o.stateNode===null)throw Error(t(166));return xt(o),null}if(r=Rr(gn.current),oa(o)){p=o.stateNode,c=o.type;var E=o.memoizedProps;switch(p[pn]=o,p[Xi]=E,r=(o.mode&1)!==0,c){case"dialog":je("cancel",p),je("close",p);break;case"iframe":case"object":case"embed":je("load",p);break;case"video":case"audio":for(y=0;y<Yi.length;y++)je(Yi[y],p);break;case"source":je("error",p);break;case"img":case"image":case"link":je("error",p),je("load",p);break;case"details":je("toggle",p);break;case"input":Co(p,E),je("invalid",p);break;case"select":p._wrapperState={wasMultiple:!!E.multiple},je("invalid",p);break;case"textarea":bi(p,E),je("invalid",p)}Do(c,E),y=null;for(var R in E)if(E.hasOwnProperty(R)){var C=E[R];R==="children"?typeof C=="string"?p.textContent!==C&&(E.suppressHydrationWarning!==!0&&Zs(p.textContent,C,r),y=["children",C]):typeof C=="number"&&p.textContent!==""+C&&(E.suppressHydrationWarning!==!0&&Zs(p.textContent,C,r),y=["children",""+C]):i.hasOwnProperty(R)&&C!=null&&R==="onScroll"&&je("scroll",p)}switch(c){case"input":Kt(p),St(p,E,!0);break;case"textarea":Kt(p),_i(p);break;case"select":case"option":break;default:typeof E.onClick=="function"&&(p.onclick=ea)}p=y,o.updateQueue=p,p!==null&&(o.flags|=4)}else{R=y.nodeType===9?y:y.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=Kn(c)),r==="http://www.w3.org/1999/xhtml"?c==="script"?(r=R.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof p.is=="string"?r=R.createElement(c,{is:p.is}):(r=R.createElement(c),c==="select"&&(R=r,p.multiple?R.multiple=!0:p.size&&(R.size=p.size))):r=R.createElementNS(r,c),r[pn]=o,r[Xi]=p,af(r,o,!1,!1),o.stateNode=r;e:{switch(R=Po(c,p),c){case"dialog":je("cancel",r),je("close",r),y=p;break;case"iframe":case"object":case"embed":je("load",r),y=p;break;case"video":case"audio":for(y=0;y<Yi.length;y++)je(Yi[y],r);y=p;break;case"source":je("error",r),y=p;break;case"img":case"image":case"link":je("error",r),je("load",r),y=p;break;case"details":je("toggle",r),y=p;break;case"input":Co(r,p),y=vr(r,p),je("invalid",r);break;case"option":y=p;break;case"select":r._wrapperState={wasMultiple:!!p.multiple},y=Q({},p,{value:void 0}),je("invalid",r);break;case"textarea":bi(r,p),y=tn(r,p),je("invalid",r);break;default:y=p}Do(c,y),C=y;for(E in C)if(C.hasOwnProperty(E)){var N=C[E];E==="style"?Qc(r,N):E==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,N!=null&&ki(r,N)):E==="children"?typeof N=="string"?(c!=="textarea"||N!=="")&&Hn(r,N):typeof N=="number"&&Hn(r,""+N):E!=="suppressContentEditableWarning"&&E!=="suppressHydrationWarning"&&E!=="autoFocus"&&(i.hasOwnProperty(E)?N!=null&&E==="onScroll"&&je("scroll",r):N!=null&&w(r,E,N,R))}switch(c){case"input":Kt(r),St(r,p,!1);break;case"textarea":Kt(r),_i(r);break;case"option":p.value!=null&&r.setAttribute("value",""+Te(p.value));break;case"select":r.multiple=!!p.multiple,E=p.value,E!=null?Nt(r,!!p.multiple,E,!1):p.defaultValue!=null&&Nt(r,!!p.multiple,p.defaultValue,!0);break;default:typeof y.onClick=="function"&&(r.onclick=ea)}switch(c){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}}p&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return xt(o),null;case 6:if(r&&o.stateNode!=null)lf(r,o,r.memoizedProps,p);else{if(typeof p!="string"&&o.stateNode===null)throw Error(t(166));if(c=Rr(ns.current),Rr(gn.current),oa(o)){if(p=o.stateNode,c=o.memoizedProps,p[pn]=o,(E=p.nodeValue!==c)&&(r=Mt,r!==null))switch(r.tag){case 3:Zs(p.nodeValue,c,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Zs(p.nodeValue,c,(r.mode&1)!==0)}E&&(o.flags|=4)}else p=(c.nodeType===9?c:c.ownerDocument).createTextNode(p),p[pn]=o,o.stateNode=p}return xt(o),null;case 13:if(Ge(He),p=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(Ke&&Ft!==null&&(o.mode&1)!==0&&(o.flags&128)===0)ch(),ti(),o.flags|=98560,E=!1;else if(E=oa(o),p!==null&&p.dehydrated!==null){if(r===null){if(!E)throw Error(t(318));if(E=o.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(t(317));E[pn]=o}else ti(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;xt(o),E=!1}else an!==null&&(uu(an),an=null),E=!0;if(!E)return o.flags&65536?o:null}return(o.flags&128)!==0?(o.lanes=c,o):(p=p!==null,p!==(r!==null&&r.memoizedState!==null)&&p&&(o.child.flags|=8192,(o.mode&1)!==0&&(r===null||(He.current&1)!==0?it===0&&(it=3):hu())),o.updateQueue!==null&&(o.flags|=4),xt(o),null);case 4:return si(),Jl(r,o),r===null&&qi(o.stateNode.containerInfo),xt(o),null;case 10:return Rl(o.type._context),xt(o),null;case 17:return Rt(o.type)&&na(),xt(o),null;case 19:if(Ge(He),E=o.memoizedState,E===null)return xt(o),null;if(p=(o.flags&128)!==0,R=E.rendering,R===null)if(p)os(E,!1);else{if(it!==0||r!==null&&(r.flags&128)!==0)for(r=o.child;r!==null;){if(R=fa(r),R!==null){for(o.flags|=128,os(E,!1),p=R.updateQueue,p!==null&&(o.updateQueue=p,o.flags|=4),o.subtreeFlags=0,p=c,c=o.child;c!==null;)E=c,r=p,E.flags&=14680066,R=E.alternate,R===null?(E.childLanes=0,E.lanes=r,E.child=null,E.subtreeFlags=0,E.memoizedProps=null,E.memoizedState=null,E.updateQueue=null,E.dependencies=null,E.stateNode=null):(E.childLanes=R.childLanes,E.lanes=R.lanes,E.child=R.child,E.subtreeFlags=0,E.deletions=null,E.memoizedProps=R.memoizedProps,E.memoizedState=R.memoizedState,E.updateQueue=R.updateQueue,E.type=R.type,r=R.dependencies,E.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),c=c.sibling;return $e(He,He.current&1|2),o.child}r=r.sibling}E.tail!==null&&Je()>ui&&(o.flags|=128,p=!0,os(E,!1),o.lanes=4194304)}else{if(!p)if(r=fa(R),r!==null){if(o.flags|=128,p=!0,c=r.updateQueue,c!==null&&(o.updateQueue=c,o.flags|=4),os(E,!0),E.tail===null&&E.tailMode==="hidden"&&!R.alternate&&!Ke)return xt(o),null}else 2*Je()-E.renderingStartTime>ui&&c!==1073741824&&(o.flags|=128,p=!0,os(E,!1),o.lanes=4194304);E.isBackwards?(R.sibling=o.child,o.child=R):(c=E.last,c!==null?c.sibling=R:o.child=R,E.last=R)}return E.tail!==null?(o=E.tail,E.rendering=o,E.tail=o.sibling,E.renderingStartTime=Je(),o.sibling=null,c=He.current,$e(He,p?c&1|2:c&1),o):(xt(o),null);case 22:case 23:return du(),p=o.memoizedState!==null,r!==null&&r.memoizedState!==null!==p&&(o.flags|=8192),p&&(o.mode&1)!==0?(Bt&1073741824)!==0&&(xt(o),o.subtreeFlags&6&&(o.flags|=8192)):xt(o),null;case 24:return null;case 25:return null}throw Error(t(156,o.tag))}function Vy(r,o){switch(El(o),o.tag){case 1:return Rt(o.type)&&na(),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return si(),Ge(It),Ge(yt),Pl(),r=o.flags,(r&65536)!==0&&(r&128)===0?(o.flags=r&-65537|128,o):null;case 5:return Cl(o),null;case 13:if(Ge(He),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(t(340));ti()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return Ge(He),null;case 4:return si(),null;case 10:return Rl(o.type._context),null;case 22:case 23:return du(),null;case 24:return null;default:return null}}var Ta=!1,Et=!1,Ky=typeof WeakSet=="function"?WeakSet:Set,pe=null;function oi(r,o){var c=r.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(p){Qe(r,o,p)}else c.current=null}function Zl(r,o,c){try{c()}catch(p){Qe(r,o,p)}}var uf=!1;function Hy(r,o){if(dl=Gs,r=$d(),rl(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else e:{c=(c=r.ownerDocument)&&c.defaultView||window;var p=c.getSelection&&c.getSelection();if(p&&p.rangeCount!==0){c=p.anchorNode;var y=p.anchorOffset,E=p.focusNode;p=p.focusOffset;try{c.nodeType,E.nodeType}catch{c=null;break e}var R=0,C=-1,N=-1,W=0,Z=0,te=r,J=null;t:for(;;){for(var de;te!==c||y!==0&&te.nodeType!==3||(C=R+y),te!==E||p!==0&&te.nodeType!==3||(N=R+p),te.nodeType===3&&(R+=te.nodeValue.length),(de=te.firstChild)!==null;)J=te,te=de;for(;;){if(te===r)break t;if(J===c&&++W===y&&(C=R),J===E&&++Z===p&&(N=R),(de=te.nextSibling)!==null)break;te=J,J=te.parentNode}te=de}c=C===-1||N===-1?null:{start:C,end:N}}else c=null}c=c||{start:0,end:0}}else c=null;for(hl={focusedElem:r,selectionRange:c},Gs=!1,pe=o;pe!==null;)if(o=pe,r=o.child,(o.subtreeFlags&1028)!==0&&r!==null)r.return=o,pe=r;else for(;pe!==null;){o=pe;try{var ge=o.alternate;if((o.flags&1024)!==0)switch(o.tag){case 0:case 11:case 15:break;case 1:if(ge!==null){var ye=ge.memoizedProps,Ze=ge.memoizedState,V=o.stateNode,M=V.getSnapshotBeforeUpdate(o.elementType===o.type?ye:on(o.type,ye),Ze);V.__reactInternalSnapshotBeforeUpdate=M}break;case 3:var K=o.stateNode.containerInfo;K.nodeType===1?K.textContent="":K.nodeType===9&&K.documentElement&&K.removeChild(K.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(re){Qe(o,o.return,re)}if(r=o.sibling,r!==null){r.return=o.return,pe=r;break}pe=o.return}return ge=uf,uf=!1,ge}function ls(r,o,c){var p=o.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var y=p=p.next;do{if((y.tag&r)===r){var E=y.destroy;y.destroy=void 0,E!==void 0&&Zl(o,c,E)}y=y.next}while(y!==p)}}function La(r,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var c=o=o.next;do{if((c.tag&r)===r){var p=c.create;c.destroy=p()}c=c.next}while(c!==o)}}function eu(r){var o=r.ref;if(o!==null){var c=r.stateNode;switch(r.tag){case 5:r=c;break;default:r=c}typeof o=="function"?o(r):o.current=r}}function cf(r){var o=r.alternate;o!==null&&(r.alternate=null,cf(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&(delete o[pn],delete o[Xi],delete o[gl],delete o[wy],delete o[by])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function df(r){return r.tag===5||r.tag===3||r.tag===4}function hf(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||df(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function tu(r,o,c){var p=r.tag;if(p===5||p===6)r=r.stateNode,o?c.nodeType===8?c.parentNode.insertBefore(r,o):c.insertBefore(r,o):(c.nodeType===8?(o=c.parentNode,o.insertBefore(r,c)):(o=c,o.appendChild(r)),c=c._reactRootContainer,c!=null||o.onclick!==null||(o.onclick=ea));else if(p!==4&&(r=r.child,r!==null))for(tu(r,o,c),r=r.sibling;r!==null;)tu(r,o,c),r=r.sibling}function nu(r,o,c){var p=r.tag;if(p===5||p===6)r=r.stateNode,o?c.insertBefore(r,o):c.appendChild(r);else if(p!==4&&(r=r.child,r!==null))for(nu(r,o,c),r=r.sibling;r!==null;)nu(r,o,c),r=r.sibling}var ht=null,ln=!1;function ir(r,o,c){for(c=c.child;c!==null;)ff(r,o,c),c=c.sibling}function ff(r,o,c){if(mn&&typeof mn.onCommitFiberUnmount=="function")try{mn.onCommitFiberUnmount(Ms,c)}catch{}switch(c.tag){case 5:Et||oi(c,o);case 6:var p=ht,y=ln;ht=null,ir(r,o,c),ht=p,ln=y,ht!==null&&(ln?(r=ht,c=c.stateNode,r.nodeType===8?r.parentNode.removeChild(c):r.removeChild(c)):ht.removeChild(c.stateNode));break;case 18:ht!==null&&(ln?(r=ht,c=c.stateNode,r.nodeType===8?pl(r.parentNode,c):r.nodeType===1&&pl(r,c),$i(r)):pl(ht,c.stateNode));break;case 4:p=ht,y=ln,ht=c.stateNode.containerInfo,ln=!0,ir(r,o,c),ht=p,ln=y;break;case 0:case 11:case 14:case 15:if(!Et&&(p=c.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){y=p=p.next;do{var E=y,R=E.destroy;E=E.tag,R!==void 0&&((E&2)!==0||(E&4)!==0)&&Zl(c,o,R),y=y.next}while(y!==p)}ir(r,o,c);break;case 1:if(!Et&&(oi(c,o),p=c.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=c.memoizedProps,p.state=c.memoizedState,p.componentWillUnmount()}catch(C){Qe(c,o,C)}ir(r,o,c);break;case 21:ir(r,o,c);break;case 22:c.mode&1?(Et=(p=Et)||c.memoizedState!==null,ir(r,o,c),Et=p):ir(r,o,c);break;default:ir(r,o,c)}}function mf(r){var o=r.updateQueue;if(o!==null){r.updateQueue=null;var c=r.stateNode;c===null&&(c=r.stateNode=new Ky),o.forEach(function(p){var y=ev.bind(null,r,p);c.has(p)||(c.add(p),p.then(y,y))})}}function un(r,o){var c=o.deletions;if(c!==null)for(var p=0;p<c.length;p++){var y=c[p];try{var E=r,R=o,C=R;e:for(;C!==null;){switch(C.tag){case 5:ht=C.stateNode,ln=!1;break e;case 3:ht=C.stateNode.containerInfo,ln=!0;break e;case 4:ht=C.stateNode.containerInfo,ln=!0;break e}C=C.return}if(ht===null)throw Error(t(160));ff(E,R,y),ht=null,ln=!1;var N=y.alternate;N!==null&&(N.return=null),y.return=null}catch(W){Qe(y,o,W)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)pf(o,r),o=o.sibling}function pf(r,o){var c=r.alternate,p=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(un(o,r),vn(r),p&4){try{ls(3,r,r.return),La(3,r)}catch(ye){Qe(r,r.return,ye)}try{ls(5,r,r.return)}catch(ye){Qe(r,r.return,ye)}}break;case 1:un(o,r),vn(r),p&512&&c!==null&&oi(c,c.return);break;case 5:if(un(o,r),vn(r),p&512&&c!==null&&oi(c,c.return),r.flags&32){var y=r.stateNode;try{Hn(y,"")}catch(ye){Qe(r,r.return,ye)}}if(p&4&&(y=r.stateNode,y!=null)){var E=r.memoizedProps,R=c!==null?c.memoizedProps:E,C=r.type,N=r.updateQueue;if(r.updateQueue=null,N!==null)try{C==="input"&&E.type==="radio"&&E.name!=null&&Ce(y,E),Po(C,R);var W=Po(C,E);for(R=0;R<N.length;R+=2){var Z=N[R],te=N[R+1];Z==="style"?Qc(y,te):Z==="dangerouslySetInnerHTML"?ki(y,te):Z==="children"?Hn(y,te):w(y,Z,te,W)}switch(C){case"input":tt(y,E);break;case"textarea":xr(y,E);break;case"select":var J=y._wrapperState.wasMultiple;y._wrapperState.wasMultiple=!!E.multiple;var de=E.value;de!=null?Nt(y,!!E.multiple,de,!1):J!==!!E.multiple&&(E.defaultValue!=null?Nt(y,!!E.multiple,E.defaultValue,!0):Nt(y,!!E.multiple,E.multiple?[]:"",!1))}y[Xi]=E}catch(ye){Qe(r,r.return,ye)}}break;case 6:if(un(o,r),vn(r),p&4){if(r.stateNode===null)throw Error(t(162));y=r.stateNode,E=r.memoizedProps;try{y.nodeValue=E}catch(ye){Qe(r,r.return,ye)}}break;case 3:if(un(o,r),vn(r),p&4&&c!==null&&c.memoizedState.isDehydrated)try{$i(o.containerInfo)}catch(ye){Qe(r,r.return,ye)}break;case 4:un(o,r),vn(r);break;case 13:un(o,r),vn(r),y=r.child,y.flags&8192&&(E=y.memoizedState!==null,y.stateNode.isHidden=E,!E||y.alternate!==null&&y.alternate.memoizedState!==null||(su=Je())),p&4&&mf(r);break;case 22:if(Z=c!==null&&c.memoizedState!==null,r.mode&1?(Et=(W=Et)||Z,un(o,r),Et=W):un(o,r),vn(r),p&8192){if(W=r.memoizedState!==null,(r.stateNode.isHidden=W)&&!Z&&(r.mode&1)!==0)for(pe=r,Z=r.child;Z!==null;){for(te=pe=Z;pe!==null;){switch(J=pe,de=J.child,J.tag){case 0:case 11:case 14:case 15:ls(4,J,J.return);break;case 1:oi(J,J.return);var ge=J.stateNode;if(typeof ge.componentWillUnmount=="function"){p=J,c=J.return;try{o=p,ge.props=o.memoizedProps,ge.state=o.memoizedState,ge.componentWillUnmount()}catch(ye){Qe(p,c,ye)}}break;case 5:oi(J,J.return);break;case 22:if(J.memoizedState!==null){vf(te);continue}}de!==null?(de.return=J,pe=de):vf(te)}Z=Z.sibling}e:for(Z=null,te=r;;){if(te.tag===5){if(Z===null){Z=te;try{y=te.stateNode,W?(E=y.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none"):(C=te.stateNode,N=te.memoizedProps.style,R=N!=null&&N.hasOwnProperty("display")?N.display:null,C.style.display=qc("display",R))}catch(ye){Qe(r,r.return,ye)}}}else if(te.tag===6){if(Z===null)try{te.stateNode.nodeValue=W?"":te.memoizedProps}catch(ye){Qe(r,r.return,ye)}}else if((te.tag!==22&&te.tag!==23||te.memoizedState===null||te===r)&&te.child!==null){te.child.return=te,te=te.child;continue}if(te===r)break e;for(;te.sibling===null;){if(te.return===null||te.return===r)break e;Z===te&&(Z=null),te=te.return}Z===te&&(Z=null),te.sibling.return=te.return,te=te.sibling}}break;case 19:un(o,r),vn(r),p&4&&mf(r);break;case 21:break;default:un(o,r),vn(r)}}function vn(r){var o=r.flags;if(o&2){try{e:{for(var c=r.return;c!==null;){if(df(c)){var p=c;break e}c=c.return}throw Error(t(160))}switch(p.tag){case 5:var y=p.stateNode;p.flags&32&&(Hn(y,""),p.flags&=-33);var E=hf(r);nu(r,E,y);break;case 3:case 4:var R=p.stateNode.containerInfo,C=hf(r);tu(r,C,R);break;default:throw Error(t(161))}}catch(N){Qe(r,r.return,N)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function Wy(r,o,c){pe=r,gf(r)}function gf(r,o,c){for(var p=(r.mode&1)!==0;pe!==null;){var y=pe,E=y.child;if(y.tag===22&&p){var R=y.memoizedState!==null||Ta;if(!R){var C=y.alternate,N=C!==null&&C.memoizedState!==null||Et;C=Ta;var W=Et;if(Ta=R,(Et=N)&&!W)for(pe=y;pe!==null;)R=pe,N=R.child,R.tag===22&&R.memoizedState!==null?xf(y):N!==null?(N.return=R,pe=N):xf(y);for(;E!==null;)pe=E,gf(E),E=E.sibling;pe=y,Ta=C,Et=W}yf(r)}else(y.subtreeFlags&8772)!==0&&E!==null?(E.return=y,pe=E):yf(r)}}function yf(r){for(;pe!==null;){var o=pe;if((o.flags&8772)!==0){var c=o.alternate;try{if((o.flags&8772)!==0)switch(o.tag){case 0:case 11:case 15:Et||La(5,o);break;case 1:var p=o.stateNode;if(o.flags&4&&!Et)if(c===null)p.componentDidMount();else{var y=o.elementType===o.type?c.memoizedProps:on(o.type,c.memoizedProps);p.componentDidUpdate(y,c.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var E=o.updateQueue;E!==null&&yh(o,E,p);break;case 3:var R=o.updateQueue;if(R!==null){if(c=null,o.child!==null)switch(o.child.tag){case 5:c=o.child.stateNode;break;case 1:c=o.child.stateNode}yh(o,R,c)}break;case 5:var C=o.stateNode;if(c===null&&o.flags&4){c=C;var N=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":N.autoFocus&&c.focus();break;case"img":N.src&&(c.src=N.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var W=o.alternate;if(W!==null){var Z=W.memoizedState;if(Z!==null){var te=Z.dehydrated;te!==null&&$i(te)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Et||o.flags&512&&eu(o)}catch(J){Qe(o,o.return,J)}}if(o===r){pe=null;break}if(c=o.sibling,c!==null){c.return=o.return,pe=c;break}pe=o.return}}function vf(r){for(;pe!==null;){var o=pe;if(o===r){pe=null;break}var c=o.sibling;if(c!==null){c.return=o.return,pe=c;break}pe=o.return}}function xf(r){for(;pe!==null;){var o=pe;try{switch(o.tag){case 0:case 11:case 15:var c=o.return;try{La(4,o)}catch(N){Qe(o,c,N)}break;case 1:var p=o.stateNode;if(typeof p.componentDidMount=="function"){var y=o.return;try{p.componentDidMount()}catch(N){Qe(o,y,N)}}var E=o.return;try{eu(o)}catch(N){Qe(o,E,N)}break;case 5:var R=o.return;try{eu(o)}catch(N){Qe(o,R,N)}}}catch(N){Qe(o,o.return,N)}if(o===r){pe=null;break}var C=o.sibling;if(C!==null){C.return=o.return,pe=C;break}pe=o.return}}var zy=Math.ceil,Aa=_.ReactCurrentDispatcher,ru=_.ReactCurrentOwner,qt=_.ReactCurrentBatchConfig,De=0,lt=null,nt=null,ft=0,Bt=0,li=Zn(0),it=0,us=null,br=0,Ia=0,iu=0,cs=null,bt=null,su=0,ui=1/0,On=null,Ra=!1,au=null,sr=null,wa=!1,ar=null,ba=0,ds=0,ou=null,_a=-1,ka=0;function Lt(){return(De&6)!==0?Je():_a!==-1?_a:_a=Je()}function or(r){return(r.mode&1)===0?1:(De&2)!==0&&ft!==0?ft&-ft:ky.transition!==null?(ka===0&&(ka=dd()),ka):(r=Ne,r!==0||(r=window.event,r=r===void 0?16:Ed(r.type)),r)}function cn(r,o,c,p){if(50<ds)throw ds=0,ou=null,Error(t(185));Oi(r,c,p),((De&2)===0||r!==lt)&&(r===lt&&((De&2)===0&&(Ia|=c),it===4&&lr(r,ft)),_t(r,p),c===1&&De===0&&(o.mode&1)===0&&(ui=Je()+500,ia&&tr()))}function _t(r,o){var c=r.callbackNode;k0(r,o);var p=Us(r,r===lt?ft:0);if(p===0)c!==null&&ld(c),r.callbackNode=null,r.callbackPriority=0;else if(o=p&-p,r.callbackPriority!==o){if(c!=null&&ld(c),o===1)r.tag===0?_y(Sf.bind(null,r)):sh(Sf.bind(null,r)),Iy(function(){(De&6)===0&&tr()}),c=null;else{switch(hd(p)){case 1:c=$o;break;case 4:c=ud;break;case 16:c=Os;break;case 536870912:c=cd;break;default:c=Os}c=_f(c,Ef.bind(null,r))}r.callbackPriority=o,r.callbackNode=c}}function Ef(r,o){if(_a=-1,ka=0,(De&6)!==0)throw Error(t(327));var c=r.callbackNode;if(ci()&&r.callbackNode!==c)return null;var p=Us(r,r===lt?ft:0);if(p===0)return null;if((p&30)!==0||(p&r.expiredLanes)!==0||o)o=Ca(r,p);else{o=p;var y=De;De|=2;var E=Lf();(lt!==r||ft!==o)&&(On=null,ui=Je()+500,kr(r,o));do try{Qy();break}catch(C){Tf(r,C)}while(!0);Il(),Aa.current=E,De=y,nt!==null?o=0:(lt=null,ft=0,o=it)}if(o!==0){if(o===2&&(y=jo(r),y!==0&&(p=y,o=lu(r,y))),o===1)throw c=us,kr(r,0),lr(r,p),_t(r,Je()),c;if(o===6)lr(r,p);else{if(y=r.current.alternate,(p&30)===0&&!Yy(y)&&(o=Ca(r,p),o===2&&(E=jo(r),E!==0&&(p=E,o=lu(r,E))),o===1))throw c=us,kr(r,0),lr(r,p),_t(r,Je()),c;switch(r.finishedWork=y,r.finishedLanes=p,o){case 0:case 1:throw Error(t(345));case 2:Cr(r,bt,On);break;case 3:if(lr(r,p),(p&130023424)===p&&(o=su+500-Je(),10<o)){if(Us(r,0)!==0)break;if(y=r.suspendedLanes,(y&p)!==p){Lt(),r.pingedLanes|=r.suspendedLanes&y;break}r.timeoutHandle=ml(Cr.bind(null,r,bt,On),o);break}Cr(r,bt,On);break;case 4:if(lr(r,p),(p&4194240)===p)break;for(o=r.eventTimes,y=-1;0<p;){var R=31-rn(p);E=1<<R,R=o[R],R>y&&(y=R),p&=~E}if(p=y,p=Je()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*zy(p/1960))-p,10<p){r.timeoutHandle=ml(Cr.bind(null,r,bt,On),p);break}Cr(r,bt,On);break;case 5:Cr(r,bt,On);break;default:throw Error(t(329))}}}return _t(r,Je()),r.callbackNode===c?Ef.bind(null,r):null}function lu(r,o){var c=cs;return r.current.memoizedState.isDehydrated&&(kr(r,o).flags|=256),r=Ca(r,o),r!==2&&(o=bt,bt=c,o!==null&&uu(o)),r}function uu(r){bt===null?bt=r:bt.push.apply(bt,r)}function Yy(r){for(var o=r;;){if(o.flags&16384){var c=o.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var p=0;p<c.length;p++){var y=c[p],E=y.getSnapshot;y=y.value;try{if(!sn(E(),y))return!1}catch{return!1}}}if(c=o.child,o.subtreeFlags&16384&&c!==null)c.return=o,o=c;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function lr(r,o){for(o&=~iu,o&=~Ia,r.suspendedLanes|=o,r.pingedLanes&=~o,r=r.expirationTimes;0<o;){var c=31-rn(o),p=1<<c;r[c]=-1,o&=~p}}function Sf(r){if((De&6)!==0)throw Error(t(327));ci();var o=Us(r,0);if((o&1)===0)return _t(r,Je()),null;var c=Ca(r,o);if(r.tag!==0&&c===2){var p=jo(r);p!==0&&(o=p,c=lu(r,p))}if(c===1)throw c=us,kr(r,0),lr(r,o),_t(r,Je()),c;if(c===6)throw Error(t(345));return r.finishedWork=r.current.alternate,r.finishedLanes=o,Cr(r,bt,On),_t(r,Je()),null}function cu(r,o){var c=De;De|=1;try{return r(o)}finally{De=c,De===0&&(ui=Je()+500,ia&&tr())}}function _r(r){ar!==null&&ar.tag===0&&(De&6)===0&&ci();var o=De;De|=1;var c=qt.transition,p=Ne;try{if(qt.transition=null,Ne=1,r)return r()}finally{Ne=p,qt.transition=c,De=o,(De&6)===0&&tr()}}function du(){Bt=li.current,Ge(li)}function kr(r,o){r.finishedWork=null,r.finishedLanes=0;var c=r.timeoutHandle;if(c!==-1&&(r.timeoutHandle=-1,Ay(c)),nt!==null)for(c=nt.return;c!==null;){var p=c;switch(El(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&na();break;case 3:si(),Ge(It),Ge(yt),Pl();break;case 5:Cl(p);break;case 4:si();break;case 13:Ge(He);break;case 19:Ge(He);break;case 10:Rl(p.type._context);break;case 22:case 23:du()}c=c.return}if(lt=r,nt=r=ur(r.current,null),ft=Bt=o,it=0,us=null,iu=Ia=br=0,bt=cs=null,Ir!==null){for(o=0;o<Ir.length;o++)if(c=Ir[o],p=c.interleaved,p!==null){c.interleaved=null;var y=p.next,E=c.pending;if(E!==null){var R=E.next;E.next=y,p.next=R}c.pending=p}Ir=null}return r}function Tf(r,o){do{var c=nt;try{if(Il(),ma.current=va,pa){for(var p=We.memoizedState;p!==null;){var y=p.queue;y!==null&&(y.pending=null),p=p.next}pa=!1}if(wr=0,ot=rt=We=null,rs=!1,is=0,ru.current=null,c===null||c.return===null){it=1,us=o,nt=null;break}e:{var E=r,R=c.return,C=c,N=o;if(o=ft,C.flags|=32768,N!==null&&typeof N=="object"&&typeof N.then=="function"){var W=N,Z=C,te=Z.tag;if((Z.mode&1)===0&&(te===0||te===11||te===15)){var J=Z.alternate;J?(Z.updateQueue=J.updateQueue,Z.memoizedState=J.memoizedState,Z.lanes=J.lanes):(Z.updateQueue=null,Z.memoizedState=null)}var de=Wh(R);if(de!==null){de.flags&=-257,zh(de,R,C,E,o),de.mode&1&&Hh(E,W,o),o=de,N=W;var ge=o.updateQueue;if(ge===null){var ye=new Set;ye.add(N),o.updateQueue=ye}else ge.add(N);break e}else{if((o&1)===0){Hh(E,W,o),hu();break e}N=Error(t(426))}}else if(Ke&&C.mode&1){var Ze=Wh(R);if(Ze!==null){(Ze.flags&65536)===0&&(Ze.flags|=256),zh(Ze,R,C,E,o),Ll(ai(N,C));break e}}E=N=ai(N,C),it!==4&&(it=2),cs===null?cs=[E]:cs.push(E),E=R;do{switch(E.tag){case 3:E.flags|=65536,o&=-o,E.lanes|=o;var V=Vh(E,N,o);gh(E,V);break e;case 1:C=N;var M=E.type,K=E.stateNode;if((E.flags&128)===0&&(typeof M.getDerivedStateFromError=="function"||K!==null&&typeof K.componentDidCatch=="function"&&(sr===null||!sr.has(K)))){E.flags|=65536,o&=-o,E.lanes|=o;var re=Kh(E,C,o);gh(E,re);break e}}E=E.return}while(E!==null)}If(c)}catch(xe){o=xe,nt===c&&c!==null&&(nt=c=c.return);continue}break}while(!0)}function Lf(){var r=Aa.current;return Aa.current=va,r===null?va:r}function hu(){(it===0||it===3||it===2)&&(it=4),lt===null||(br&268435455)===0&&(Ia&268435455)===0||lr(lt,ft)}function Ca(r,o){var c=De;De|=2;var p=Lf();(lt!==r||ft!==o)&&(On=null,kr(r,o));do try{qy();break}catch(y){Tf(r,y)}while(!0);if(Il(),De=c,Aa.current=p,nt!==null)throw Error(t(261));return lt=null,ft=0,it}function qy(){for(;nt!==null;)Af(nt)}function Qy(){for(;nt!==null&&!S0();)Af(nt)}function Af(r){var o=bf(r.alternate,r,Bt);r.memoizedProps=r.pendingProps,o===null?If(r):nt=o,ru.current=null}function If(r){var o=r;do{var c=o.alternate;if(r=o.return,(o.flags&32768)===0){if(c=Gy(c,o,Bt),c!==null){nt=c;return}}else{if(c=Vy(c,o),c!==null){c.flags&=32767,nt=c;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{it=6,nt=null;return}}if(o=o.sibling,o!==null){nt=o;return}nt=o=r}while(o!==null);it===0&&(it=5)}function Cr(r,o,c){var p=Ne,y=qt.transition;try{qt.transition=null,Ne=1,Xy(r,o,c,p)}finally{qt.transition=y,Ne=p}return null}function Xy(r,o,c,p){do ci();while(ar!==null);if((De&6)!==0)throw Error(t(327));c=r.finishedWork;var y=r.finishedLanes;if(c===null)return null;if(r.finishedWork=null,r.finishedLanes=0,c===r.current)throw Error(t(177));r.callbackNode=null,r.callbackPriority=0;var E=c.lanes|c.childLanes;if(C0(r,E),r===lt&&(nt=lt=null,ft=0),(c.subtreeFlags&2064)===0&&(c.flags&2064)===0||wa||(wa=!0,_f(Os,function(){return ci(),null})),E=(c.flags&15990)!==0,(c.subtreeFlags&15990)!==0||E){E=qt.transition,qt.transition=null;var R=Ne;Ne=1;var C=De;De|=4,ru.current=null,Hy(r,c),pf(c,r),yy(hl),Gs=!!dl,hl=dl=null,r.current=c,Wy(c),T0(),De=C,Ne=R,qt.transition=E}else r.current=c;if(wa&&(wa=!1,ar=r,ba=y),E=r.pendingLanes,E===0&&(sr=null),I0(c.stateNode),_t(r,Je()),o!==null)for(p=r.onRecoverableError,c=0;c<o.length;c++)y=o[c],p(y.value,{componentStack:y.stack,digest:y.digest});if(Ra)throw Ra=!1,r=au,au=null,r;return(ba&1)!==0&&r.tag!==0&&ci(),E=r.pendingLanes,(E&1)!==0?r===ou?ds++:(ds=0,ou=r):ds=0,tr(),null}function ci(){if(ar!==null){var r=hd(ba),o=qt.transition,c=Ne;try{if(qt.transition=null,Ne=16>r?16:r,ar===null)var p=!1;else{if(r=ar,ar=null,ba=0,(De&6)!==0)throw Error(t(331));var y=De;for(De|=4,pe=r.current;pe!==null;){var E=pe,R=E.child;if((pe.flags&16)!==0){var C=E.deletions;if(C!==null){for(var N=0;N<C.length;N++){var W=C[N];for(pe=W;pe!==null;){var Z=pe;switch(Z.tag){case 0:case 11:case 15:ls(8,Z,E)}var te=Z.child;if(te!==null)te.return=Z,pe=te;else for(;pe!==null;){Z=pe;var J=Z.sibling,de=Z.return;if(cf(Z),Z===W){pe=null;break}if(J!==null){J.return=de,pe=J;break}pe=de}}}var ge=E.alternate;if(ge!==null){var ye=ge.child;if(ye!==null){ge.child=null;do{var Ze=ye.sibling;ye.sibling=null,ye=Ze}while(ye!==null)}}pe=E}}if((E.subtreeFlags&2064)!==0&&R!==null)R.return=E,pe=R;else e:for(;pe!==null;){if(E=pe,(E.flags&2048)!==0)switch(E.tag){case 0:case 11:case 15:ls(9,E,E.return)}var V=E.sibling;if(V!==null){V.return=E.return,pe=V;break e}pe=E.return}}var M=r.current;for(pe=M;pe!==null;){R=pe;var K=R.child;if((R.subtreeFlags&2064)!==0&&K!==null)K.return=R,pe=K;else e:for(R=M;pe!==null;){if(C=pe,(C.flags&2048)!==0)try{switch(C.tag){case 0:case 11:case 15:La(9,C)}}catch(xe){Qe(C,C.return,xe)}if(C===R){pe=null;break e}var re=C.sibling;if(re!==null){re.return=C.return,pe=re;break e}pe=C.return}}if(De=y,tr(),mn&&typeof mn.onPostCommitFiberRoot=="function")try{mn.onPostCommitFiberRoot(Ms,r)}catch{}p=!0}return p}finally{Ne=c,qt.transition=o}}return!1}function Rf(r,o,c){o=ai(c,o),o=Vh(r,o,1),r=rr(r,o,1),o=Lt(),r!==null&&(Oi(r,1,o),_t(r,o))}function Qe(r,o,c){if(r.tag===3)Rf(r,r,c);else for(;o!==null;){if(o.tag===3){Rf(o,r,c);break}else if(o.tag===1){var p=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(sr===null||!sr.has(p))){r=ai(c,r),r=Kh(o,r,1),o=rr(o,r,1),r=Lt(),o!==null&&(Oi(o,1,r),_t(o,r));break}}o=o.return}}function Jy(r,o,c){var p=r.pingCache;p!==null&&p.delete(o),o=Lt(),r.pingedLanes|=r.suspendedLanes&c,lt===r&&(ft&c)===c&&(it===4||it===3&&(ft&130023424)===ft&&500>Je()-su?kr(r,0):iu|=c),_t(r,o)}function wf(r,o){o===0&&((r.mode&1)===0?o=1:(o=Bs,Bs<<=1,(Bs&130023424)===0&&(Bs=4194304)));var c=Lt();r=Dn(r,o),r!==null&&(Oi(r,o,c),_t(r,c))}function Zy(r){var o=r.memoizedState,c=0;o!==null&&(c=o.retryLane),wf(r,c)}function ev(r,o){var c=0;switch(r.tag){case 13:var p=r.stateNode,y=r.memoizedState;y!==null&&(c=y.retryLane);break;case 19:p=r.stateNode;break;default:throw Error(t(314))}p!==null&&p.delete(o),wf(r,c)}var bf;bf=function(r,o,c){if(r!==null)if(r.memoizedProps!==o.pendingProps||It.current)wt=!0;else{if((r.lanes&c)===0&&(o.flags&128)===0)return wt=!1,jy(r,o,c);wt=(r.flags&131072)!==0}else wt=!1,Ke&&(o.flags&1048576)!==0&&ah(o,aa,o.index);switch(o.lanes=0,o.tag){case 2:var p=o.type;Sa(r,o),r=o.pendingProps;var y=Jr(o,yt.current);ii(o,c),y=Ml(null,o,p,r,y,c);var E=Fl();return o.flags|=1,typeof y=="object"&&y!==null&&typeof y.render=="function"&&y.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,Rt(p)?(E=!0,ra(o)):E=!1,o.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,_l(o),y.updater=xa,o.stateNode=y,y._reactInternals=o,Vl(o,p,r,c),o=zl(null,o,p,!0,E,c)):(o.tag=0,Ke&&E&&xl(o),Tt(null,o,y,c),o=o.child),o;case 16:p=o.elementType;e:{switch(Sa(r,o),r=o.pendingProps,y=p._init,p=y(p._payload),o.type=p,y=o.tag=nv(p),r=on(p,r),y){case 0:o=Wl(null,o,p,r,c);break e;case 1:o=Zh(null,o,p,r,c);break e;case 11:o=Yh(null,o,p,r,c);break e;case 14:o=qh(null,o,p,on(p.type,r),c);break e}throw Error(t(306,p,""))}return o;case 0:return p=o.type,y=o.pendingProps,y=o.elementType===p?y:on(p,y),Wl(r,o,p,y,c);case 1:return p=o.type,y=o.pendingProps,y=o.elementType===p?y:on(p,y),Zh(r,o,p,y,c);case 3:e:{if(ef(o),r===null)throw Error(t(387));p=o.pendingProps,E=o.memoizedState,y=E.element,ph(r,o),ha(o,p,null,c);var R=o.memoizedState;if(p=R.element,E.isDehydrated)if(E={element:p,isDehydrated:!1,cache:R.cache,pendingSuspenseBoundaries:R.pendingSuspenseBoundaries,transitions:R.transitions},o.updateQueue.baseState=E,o.memoizedState=E,o.flags&256){y=ai(Error(t(423)),o),o=tf(r,o,p,c,y);break e}else if(p!==y){y=ai(Error(t(424)),o),o=tf(r,o,p,c,y);break e}else for(Ft=Jn(o.stateNode.containerInfo.firstChild),Mt=o,Ke=!0,an=null,c=fh(o,null,p,c),o.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(ti(),p===y){o=Nn(r,o,c);break e}Tt(r,o,p,c)}o=o.child}return o;case 5:return vh(o),r===null&&Tl(o),p=o.type,y=o.pendingProps,E=r!==null?r.memoizedProps:null,R=y.children,fl(p,y)?R=null:E!==null&&fl(p,E)&&(o.flags|=32),Jh(r,o),Tt(r,o,R,c),o.child;case 6:return r===null&&Tl(o),null;case 13:return nf(r,o,c);case 4:return kl(o,o.stateNode.containerInfo),p=o.pendingProps,r===null?o.child=ni(o,null,p,c):Tt(r,o,p,c),o.child;case 11:return p=o.type,y=o.pendingProps,y=o.elementType===p?y:on(p,y),Yh(r,o,p,y,c);case 7:return Tt(r,o,o.pendingProps,c),o.child;case 8:return Tt(r,o,o.pendingProps.children,c),o.child;case 12:return Tt(r,o,o.pendingProps.children,c),o.child;case 10:e:{if(p=o.type._context,y=o.pendingProps,E=o.memoizedProps,R=y.value,$e(ua,p._currentValue),p._currentValue=R,E!==null)if(sn(E.value,R)){if(E.children===y.children&&!It.current){o=Nn(r,o,c);break e}}else for(E=o.child,E!==null&&(E.return=o);E!==null;){var C=E.dependencies;if(C!==null){R=E.child;for(var N=C.firstContext;N!==null;){if(N.context===p){if(E.tag===1){N=Pn(-1,c&-c),N.tag=2;var W=E.updateQueue;if(W!==null){W=W.shared;var Z=W.pending;Z===null?N.next=N:(N.next=Z.next,Z.next=N),W.pending=N}}E.lanes|=c,N=E.alternate,N!==null&&(N.lanes|=c),wl(E.return,c,o),C.lanes|=c;break}N=N.next}}else if(E.tag===10)R=E.type===o.type?null:E.child;else if(E.tag===18){if(R=E.return,R===null)throw Error(t(341));R.lanes|=c,C=R.alternate,C!==null&&(C.lanes|=c),wl(R,c,o),R=E.sibling}else R=E.child;if(R!==null)R.return=E;else for(R=E;R!==null;){if(R===o){R=null;break}if(E=R.sibling,E!==null){E.return=R.return,R=E;break}R=R.return}E=R}Tt(r,o,y.children,c),o=o.child}return o;case 9:return y=o.type,p=o.pendingProps.children,ii(o,c),y=zt(y),p=p(y),o.flags|=1,Tt(r,o,p,c),o.child;case 14:return p=o.type,y=on(p,o.pendingProps),y=on(p.type,y),qh(r,o,p,y,c);case 15:return Qh(r,o,o.type,o.pendingProps,c);case 17:return p=o.type,y=o.pendingProps,y=o.elementType===p?y:on(p,y),Sa(r,o),o.tag=1,Rt(p)?(r=!0,ra(o)):r=!1,ii(o,c),jh(o,p,y),Vl(o,p,y,c),zl(null,o,p,!0,r,c);case 19:return sf(r,o,c);case 22:return Xh(r,o,c)}throw Error(t(156,o.tag))};function _f(r,o){return od(r,o)}function tv(r,o,c,p){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qt(r,o,c,p){return new tv(r,o,c,p)}function fu(r){return r=r.prototype,!(!r||!r.isReactComponent)}function nv(r){if(typeof r=="function")return fu(r)?1:0;if(r!=null){if(r=r.$$typeof,r===ne)return 11;if(r===oe)return 14}return 2}function ur(r,o){var c=r.alternate;return c===null?(c=Qt(r.tag,o,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=o,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&14680064,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,o=r.dependencies,c.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c}function Da(r,o,c,p,y,E){var R=2;if(p=r,typeof r=="function")fu(r)&&(R=1);else if(typeof r=="string")R=5;else e:switch(r){case P:return Dr(c.children,y,E,o);case B:R=8,y|=8;break;case U:return r=Qt(12,c,o,y|2),r.elementType=U,r.lanes=E,r;case se:return r=Qt(13,c,o,y),r.elementType=se,r.lanes=E,r;case ue:return r=Qt(19,c,o,y),r.elementType=ue,r.lanes=E,r;case ie:return Pa(c,y,E,o);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case O:R=10;break e;case Y:R=9;break e;case ne:R=11;break e;case oe:R=14;break e;case ee:R=16,p=null;break e}throw Error(t(130,r==null?r:typeof r,""))}return o=Qt(R,c,o,y),o.elementType=r,o.type=p,o.lanes=E,o}function Dr(r,o,c,p){return r=Qt(7,r,p,o),r.lanes=c,r}function Pa(r,o,c,p){return r=Qt(22,r,p,o),r.elementType=ie,r.lanes=c,r.stateNode={isHidden:!1},r}function mu(r,o,c){return r=Qt(6,r,null,o),r.lanes=c,r}function pu(r,o,c){return o=Qt(4,r.children!==null?r.children:[],r.key,o),o.lanes=c,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}function rv(r,o,c,p,y){this.tag=o,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Go(0),this.expirationTimes=Go(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Go(0),this.identifierPrefix=p,this.onRecoverableError=y,this.mutableSourceEagerHydrationData=null}function gu(r,o,c,p,y,E,R,C,N){return r=new rv(r,o,c,C,N),o===1?(o=1,E===!0&&(o|=8)):o=0,E=Qt(3,null,null,o),r.current=E,E.stateNode=r,E.memoizedState={element:p,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},_l(E),r}function iv(r,o,c){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:j,key:p==null?null:""+p,children:r,containerInfo:o,implementation:c}}function kf(r){if(!r)return er;r=r._reactInternals;e:{if(Er(r)!==r||r.tag!==1)throw Error(t(170));var o=r;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(Rt(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(t(171))}if(r.tag===1){var c=r.type;if(Rt(c))return rh(r,c,o)}return o}function Cf(r,o,c,p,y,E,R,C,N){return r=gu(c,p,!0,r,y,E,R,C,N),r.context=kf(null),c=r.current,p=Lt(),y=or(c),E=Pn(p,y),E.callback=o??null,rr(c,E,y),r.current.lanes=y,Oi(r,y,p),_t(r,p),r}function Na(r,o,c,p){var y=o.current,E=Lt(),R=or(y);return c=kf(c),o.context===null?o.context=c:o.pendingContext=c,o=Pn(E,R),o.payload={element:r},p=p===void 0?null:p,p!==null&&(o.callback=p),r=rr(y,o,R),r!==null&&(cn(r,y,R,E),da(r,y,R)),R}function Oa(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function Df(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<o?c:o}}function yu(r,o){Df(r,o),(r=r.alternate)&&Df(r,o)}function sv(){return null}var Pf=typeof reportError=="function"?reportError:function(r){console.error(r)};function vu(r){this._internalRoot=r}Ma.prototype.render=vu.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(t(409));Na(r,o,null,null)},Ma.prototype.unmount=vu.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;_r(function(){Na(null,r,null,null)}),o[bn]=null}};function Ma(r){this._internalRoot=r}Ma.prototype.unstable_scheduleHydration=function(r){if(r){var o=pd();r={blockedOn:null,target:r,priority:o};for(var c=0;c<qn.length&&o!==0&&o<qn[c].priority;c++);qn.splice(c,0,r),c===0&&vd(r)}};function xu(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Fa(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function Nf(){}function av(r,o,c,p,y){if(y){if(typeof p=="function"){var E=p;p=function(){var W=Oa(R);E.call(W)}}var R=Cf(o,p,r,0,null,!1,!1,"",Nf);return r._reactRootContainer=R,r[bn]=R.current,qi(r.nodeType===8?r.parentNode:r),_r(),R}for(;y=r.lastChild;)r.removeChild(y);if(typeof p=="function"){var C=p;p=function(){var W=Oa(N);C.call(W)}}var N=gu(r,0,!1,null,null,!1,!1,"",Nf);return r._reactRootContainer=N,r[bn]=N.current,qi(r.nodeType===8?r.parentNode:r),_r(function(){Na(o,N,c,p)}),N}function Ba(r,o,c,p,y){var E=c._reactRootContainer;if(E){var R=E;if(typeof y=="function"){var C=y;y=function(){var N=Oa(R);C.call(N)}}Na(o,R,r,y)}else R=av(c,o,r,y,p);return Oa(R)}fd=function(r){switch(r.tag){case 3:var o=r.stateNode;if(o.current.memoizedState.isDehydrated){var c=Ni(o.pendingLanes);c!==0&&(Vo(o,c|1),_t(o,Je()),(De&6)===0&&(ui=Je()+500,tr()))}break;case 13:_r(function(){var p=Dn(r,1);if(p!==null){var y=Lt();cn(p,r,1,y)}}),yu(r,1)}},Ko=function(r){if(r.tag===13){var o=Dn(r,134217728);if(o!==null){var c=Lt();cn(o,r,134217728,c)}yu(r,134217728)}},md=function(r){if(r.tag===13){var o=or(r),c=Dn(r,o);if(c!==null){var p=Lt();cn(c,r,o,p)}yu(r,o)}},pd=function(){return Ne},gd=function(r,o){var c=Ne;try{return Ne=r,o()}finally{Ne=c}},Mo=function(r,o,c){switch(o){case"input":if(tt(r,c),o=c.name,c.type==="radio"&&o!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<c.length;o++){var p=c[o];if(p!==r&&p.form===r.form){var y=ta(p);if(!y)throw Error(t(90));Ds(p),tt(p,y)}}}break;case"textarea":xr(r,c);break;case"select":o=c.value,o!=null&&Nt(r,!!c.multiple,o,!1)}},ed=cu,td=_r;var ov={usingClientEntryPoint:!1,Events:[Ji,Qr,ta,Jc,Zc,cu]},hs={findFiberByHostInstance:Sr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},lv={bundleType:hs.bundleType,version:hs.version,rendererPackageName:hs.rendererPackageName,rendererConfig:hs.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=sd(r),r===null?null:r.stateNode},findFiberByHostInstance:hs.findFiberByHostInstance||sv,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ua=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ua.isDisabled&&Ua.supportsFiber)try{Ms=Ua.inject(lv),mn=Ua}catch{}}return kt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ov,kt.createPortal=function(r,o){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!xu(o))throw Error(t(200));return iv(r,o,null,c)},kt.createRoot=function(r,o){if(!xu(r))throw Error(t(299));var c=!1,p="",y=Pf;return o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(p=o.identifierPrefix),o.onRecoverableError!==void 0&&(y=o.onRecoverableError)),o=gu(r,1,!1,null,null,c,!1,p,y),r[bn]=o.current,qi(r.nodeType===8?r.parentNode:r),new vu(o)},kt.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(t(188)):(r=Object.keys(r).join(","),Error(t(268,r)));return r=sd(o),r=r===null?null:r.stateNode,r},kt.flushSync=function(r){return _r(r)},kt.hydrate=function(r,o,c){if(!Fa(o))throw Error(t(200));return Ba(null,r,o,!0,c)},kt.hydrateRoot=function(r,o,c){if(!xu(r))throw Error(t(405));var p=c!=null&&c.hydratedSources||null,y=!1,E="",R=Pf;if(c!=null&&(c.unstable_strictMode===!0&&(y=!0),c.identifierPrefix!==void 0&&(E=c.identifierPrefix),c.onRecoverableError!==void 0&&(R=c.onRecoverableError)),o=Cf(o,null,r,1,c??null,y,!1,E,R),r[bn]=o.current,qi(r),p)for(r=0;r<p.length;r++)c=p[r],y=c._getVersion,y=y(c._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[c,y]:o.mutableSourceEagerHydrationData.push(c,y);return new Ma(o)},kt.render=function(r,o,c){if(!Fa(o))throw Error(t(200));return Ba(null,r,o,!1,c)},kt.unmountComponentAtNode=function(r){if(!Fa(r))throw Error(t(40));return r._reactRootContainer?(_r(function(){Ba(null,null,r,!1,function(){r._reactRootContainer=null,r[bn]=null})}),!0):!1},kt.unstable_batchedUpdates=cu,kt.unstable_renderSubtreeIntoContainer=function(r,o,c,p){if(!Fa(c))throw Error(t(200));if(r==null||r._reactInternals===void 0)throw Error(t(38));return Ba(r,o,c,!1,p)},kt.version="18.3.1-next-f1338f8080-20240426",kt}var Gf;function yv(){if(Gf)return Tu.exports;Gf=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),Tu.exports=gv(),Tu.exports}var Vf;function vv(){if(Vf)return $a;Vf=1;var a=yv();return $a.createRoot=a.createRoot,$a.hydrateRoot=a.hydrateRoot,$a}var xv=vv();const Ev=gp(xv);/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Kf="popstate";function Sv(a={}){function e(n,i){let{pathname:s,search:l,hash:u}=n.location;return Ju("",{pathname:s,search:l,hash:u},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(n,i){return typeof i=="string"?i:Es(i)}return Lv(e,t,null,a)}function qe(a,e){if(a===!1||a===null||typeof a>"u")throw new Error(e)}function In(a,e){if(!a){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Tv(){return Math.random().toString(36).substring(2,10)}function Hf(a,e){return{usr:a.state,key:a.key,idx:e}}function Ju(a,e,t=null,n){return{pathname:typeof a=="string"?a:a.pathname,search:"",hash:"",...typeof e=="string"?Ri(e):e,state:t,key:e&&e.key||n||Tv()}}function Es({pathname:a="/",search:e="",hash:t=""}){return e&&e!=="?"&&(a+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(a+=t.charAt(0)==="#"?t:"#"+t),a}function Ri(a){let e={};if(a){let t=a.indexOf("#");t>=0&&(e.hash=a.substring(t),a=a.substring(0,t));let n=a.indexOf("?");n>=0&&(e.search=a.substring(n),a=a.substring(0,n)),a&&(e.pathname=a)}return e}function Lv(a,e,t,n={}){let{window:i=document.defaultView,v5Compat:s=!1}=n,l=i.history,u="POP",h=null,d=f();d==null&&(d=0,l.replaceState({...l.state,idx:d},""));function f(){return(l.state||{idx:null}).idx}function m(){u="POP";let S=f(),I=S==null?null:S-d;d=S,h&&h({action:u,location:T.location,delta:I})}function g(S,I){u="PUSH";let b=Ju(T.location,S,I);d=f()+1;let w=Hf(b,d),_=T.createHref(b);try{l.pushState(w,"",_)}catch(D){if(D instanceof DOMException&&D.name==="DataCloneError")throw D;i.location.assign(_)}s&&h&&h({action:u,location:T.location,delta:1})}function v(S,I){u="REPLACE";let b=Ju(T.location,S,I);d=f();let w=Hf(b,d),_=T.createHref(b);l.replaceState(w,"",_),s&&h&&h({action:u,location:T.location,delta:0})}function x(S){return Av(S)}let T={get action(){return u},get location(){return a(i,l)},listen(S){if(h)throw new Error("A history only accepts one active listener");return i.addEventListener(Kf,m),h=S,()=>{i.removeEventListener(Kf,m),h=null}},createHref(S){return e(i,S)},createURL:x,encodeLocation(S){let I=x(S);return{pathname:I.pathname,search:I.search,hash:I.hash}},push:g,replace:v,go(S){return l.go(S)}};return T}function Av(a,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),qe(t,"No window.location.(origin|href) available to create URL");let n=typeof a=="string"?a:Es(a);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=t+n),new URL(n,t)}function yp(a,e,t="/"){return Iv(a,e,t,!1)}function Iv(a,e,t,n){let i=typeof e=="string"?Ri(e):e,s=jn(i.pathname||"/",t);if(s==null)return null;let l=vp(a);Rv(l);let u=null;for(let h=0;u==null&&h<l.length;++h){let d=Fv(s);u=Ov(l[h],d,n)}return u}function vp(a,e=[],t=[],n="",i=!1){let s=(l,u,h=i,d)=>{let f={relativePath:d===void 0?l.path||"":d,caseSensitive:l.caseSensitive===!0,childrenIndex:u,route:l};if(f.relativePath.startsWith("/")){if(!f.relativePath.startsWith(n)&&h)return;qe(f.relativePath.startsWith(n),`Absolute route path "${f.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),f.relativePath=f.relativePath.slice(n.length)}let m=$n([n,f.relativePath]),g=t.concat(f);l.children&&l.children.length>0&&(qe(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${m}".`),vp(l.children,e,g,m,h)),!(l.path==null&&!l.index)&&e.push({path:m,score:Pv(m,l.index),routesMeta:g})};return a.forEach((l,u)=>{var h;if(l.path===""||!((h=l.path)!=null&&h.includes("?")))s(l,u);else for(let d of xp(l.path))s(l,u,!0,d)}),e}function xp(a){let e=a.split("/");if(e.length===0)return[];let[t,...n]=e,i=t.endsWith("?"),s=t.replace(/\?$/,"");if(n.length===0)return i?[s,""]:[s];let l=xp(n.join("/")),u=[];return u.push(...l.map(h=>h===""?s:[s,h].join("/"))),i&&u.push(...l),u.map(h=>a.startsWith("/")&&h===""?"/":h)}function Rv(a){a.sort((e,t)=>e.score!==t.score?t.score-e.score:Nv(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}var wv=/^:[\w-]+$/,bv=3,_v=2,kv=1,Cv=10,Dv=-2,Wf=a=>a==="*";function Pv(a,e){let t=a.split("/"),n=t.length;return t.some(Wf)&&(n+=Dv),e&&(n+=_v),t.filter(i=>!Wf(i)).reduce((i,s)=>i+(wv.test(s)?bv:s===""?kv:Cv),n)}function Nv(a,e){return a.length===e.length&&a.slice(0,-1).every((n,i)=>n===e[i])?a[a.length-1]-e[e.length-1]:0}function Ov(a,e,t=!1){let{routesMeta:n}=a,i={},s="/",l=[];for(let u=0;u<n.length;++u){let h=n[u],d=u===n.length-1,f=s==="/"?e:e.slice(s.length)||"/",m=mo({path:h.relativePath,caseSensitive:h.caseSensitive,end:d},f),g=h.route;if(!m&&d&&t&&!n[n.length-1].route.index&&(m=mo({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},f)),!m)return null;Object.assign(i,m.params),l.push({params:i,pathname:$n([s,m.pathname]),pathnameBase:jv($n([s,m.pathnameBase])),route:g}),m.pathnameBase!=="/"&&(s=$n([s,m.pathnameBase]))}return l}function mo(a,e){typeof a=="string"&&(a={path:a,caseSensitive:!1,end:!0});let[t,n]=Mv(a.path,a.caseSensitive,a.end),i=e.match(t);if(!i)return null;let s=i[0],l=s.replace(/(.)\/+$/,"$1"),u=i.slice(1);return{params:n.reduce((d,{paramName:f,isOptional:m},g)=>{if(f==="*"){let x=u[g]||"";l=s.slice(0,s.length-x.length).replace(/(.)\/+$/,"$1")}const v=u[g];return m&&!v?d[f]=void 0:d[f]=(v||"").replace(/%2F/g,"/"),d},{}),pathname:s,pathnameBase:l,pattern:a}}function Mv(a,e=!1,t=!0){In(a==="*"||!a.endsWith("*")||a.endsWith("/*"),`Route path "${a}" will be treated as if it were "${a.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${a.replace(/\*$/,"/*")}".`);let n=[],i="^"+a.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,u,h)=>(n.push({paramName:u,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return a.endsWith("*")?(n.push({paramName:"*"}),i+=a==="*"||a==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":a!==""&&a!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function Fv(a){try{return a.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return In(!1,`The URL path "${a}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),a}}function jn(a,e){if(e==="/")return a;if(!a.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=a.charAt(t);return n&&n!=="/"?null:a.slice(t)||"/"}var Bv=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function Uv(a,e="/"){let{pathname:t,search:n="",hash:i=""}=typeof a=="string"?Ri(a):a,s;return t?(t=t.replace(/\/\/+/g,"/"),t.startsWith("/")?s=zf(t.substring(1),"/"):s=zf(t,e)):s=e,{pathname:s,search:Gv(n),hash:Vv(i)}}function zf(a,e){let t=e.replace(/\/+$/,"").split("/");return a.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function Iu(a,e,t,n){return`Cannot include a '${a}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function $v(a){return a.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Ep(a){let e=$v(a);return e.map((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)}function Sp(a,e,t,n=!1){let i;typeof a=="string"?i=Ri(a):(i={...a},qe(!i.pathname||!i.pathname.includes("?"),Iu("?","pathname","search",i)),qe(!i.pathname||!i.pathname.includes("#"),Iu("#","pathname","hash",i)),qe(!i.search||!i.search.includes("#"),Iu("#","search","hash",i)));let s=a===""||i.pathname==="",l=s?"/":i.pathname,u;if(l==null)u=t;else{let m=e.length-1;if(!n&&l.startsWith("..")){let g=l.split("/");for(;g[0]==="..";)g.shift(),m-=1;i.pathname=g.join("/")}u=m>=0?e[m]:"/"}let h=Uv(i,u),d=l&&l!=="/"&&l.endsWith("/"),f=(s||l===".")&&t.endsWith("/");return!h.pathname.endsWith("/")&&(d||f)&&(h.pathname+="/"),h}var $n=a=>a.join("/").replace(/\/\/+/g,"/"),jv=a=>a.replace(/\/+$/,"").replace(/^\/*/,"/"),Gv=a=>!a||a==="?"?"":a.startsWith("?")?a:"?"+a,Vv=a=>!a||a==="#"?"":a.startsWith("#")?a:"#"+a,Kv=class{constructor(a,e,t,n=!1){this.status=a,this.statusText=e||"",this.internal=n,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function Hv(a){return a!=null&&typeof a.status=="number"&&typeof a.statusText=="string"&&typeof a.internal=="boolean"&&"data"in a}function Wv(a){return a.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Tp=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Lp(a,e){let t=a;if(typeof t!="string"||!Bv.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let n=t,i=!1;if(Tp)try{let s=new URL(window.location.href),l=t.startsWith("//")?new URL(s.protocol+t):new URL(t),u=jn(l.pathname,e);l.origin===s.origin&&u!=null?t=u+l.search+l.hash:i=!0}catch{In(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:n,isExternal:i,to:t}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Ap=["POST","PUT","PATCH","DELETE"];new Set(Ap);var zv=["GET",...Ap];new Set(zv);var wi=z.createContext(null);wi.displayName="DataRouter";var Ro=z.createContext(null);Ro.displayName="DataRouterState";var Yv=z.createContext(!1),Ip=z.createContext({isTransitioning:!1});Ip.displayName="ViewTransition";var qv=z.createContext(new Map);qv.displayName="Fetchers";var Qv=z.createContext(null);Qv.displayName="Await";var Jt=z.createContext(null);Jt.displayName="Navigation";var bs=z.createContext(null);bs.displayName="Location";var Gn=z.createContext({outlet:null,matches:[],isDataRoute:!1});Gn.displayName="Route";var Ec=z.createContext(null);Ec.displayName="RouteError";var Rp="REACT_ROUTER_ERROR",Xv="REDIRECT",Jv="ROUTE_ERROR_RESPONSE";function Zv(a){if(a.startsWith(`${Rp}:${Xv}:{`))try{let e=JSON.parse(a.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function ex(a){if(a.startsWith(`${Rp}:${Jv}:{`))try{let e=JSON.parse(a.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new Kv(e.status,e.statusText,e.data)}catch{}}function tx(a,{relative:e}={}){qe(_s(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:n}=z.useContext(Jt),{hash:i,pathname:s,search:l}=ks(a,{relative:e}),u=s;return t!=="/"&&(u=s==="/"?t:$n([t,s])),n.createHref({pathname:u,search:l,hash:i})}function _s(){return z.useContext(bs)!=null}function Br(){return qe(_s(),"useLocation() may be used only in the context of a <Router> component."),z.useContext(bs).location}var wp="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function bp(a){z.useContext(Jt).static||z.useLayoutEffect(a)}function nx(){let{isDataRoute:a}=z.useContext(Gn);return a?px():rx()}function rx(){qe(_s(),"useNavigate() may be used only in the context of a <Router> component.");let a=z.useContext(wi),{basename:e,navigator:t}=z.useContext(Jt),{matches:n}=z.useContext(Gn),{pathname:i}=Br(),s=JSON.stringify(Ep(n)),l=z.useRef(!1);return bp(()=>{l.current=!0}),z.useCallback((h,d={})=>{if(In(l.current,wp),!l.current)return;if(typeof h=="number"){t.go(h);return}let f=Sp(h,JSON.parse(s),i,d.relative==="path");a==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:$n([e,f.pathname])),(d.replace?t.replace:t.push)(f,d.state,d)},[e,t,s,i,a])}z.createContext(null);function ks(a,{relative:e}={}){let{matches:t}=z.useContext(Gn),{pathname:n}=Br(),i=JSON.stringify(Ep(t));return z.useMemo(()=>Sp(a,JSON.parse(i),n,e==="path"),[a,i,n,e])}function ix(a,e){return _p(a,e)}function _p(a,e,t,n,i){var b;qe(_s(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=z.useContext(Jt),{matches:l}=z.useContext(Gn),u=l[l.length-1],h=u?u.params:{},d=u?u.pathname:"/",f=u?u.pathnameBase:"/",m=u&&u.route;{let w=m&&m.path||"";Cp(d,!m||w.endsWith("*")||w.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${w}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${w}"> to <Route path="${w==="/"?"*":`${w}/*`}">.`)}let g=Br(),v;if(e){let w=typeof e=="string"?Ri(e):e;qe(f==="/"||((b=w.pathname)==null?void 0:b.startsWith(f)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${w.pathname}" was given in the \`location\` prop.`),v=w}else v=g;let x=v.pathname||"/",T=x;if(f!=="/"){let w=f.replace(/^\//,"").split("/");T="/"+x.replace(/^\//,"").split("/").slice(w.length).join("/")}let S=yp(a,{pathname:T});In(m||S!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),In(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let I=ux(S&&S.map(w=>Object.assign({},w,{params:Object.assign({},h,w.params),pathname:$n([f,s.encodeLocation?s.encodeLocation(w.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?f:$n([f,s.encodeLocation?s.encodeLocation(w.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathnameBase])})),l,t,n,i);return e&&I?z.createElement(bs.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},I):I}function sx(){let a=mx(),e=Hv(a)?`${a.status} ${a.statusText}`:a instanceof Error?a.message:JSON.stringify(a),t=a instanceof Error?a.stack:null,n="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:n},s={padding:"2px 4px",backgroundColor:n},l=null;return console.error("Error handled by React Router default ErrorBoundary:",a),l=z.createElement(z.Fragment,null,z.createElement("p",null," Hey developer "),z.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",z.createElement("code",{style:s},"ErrorBoundary")," or"," ",z.createElement("code",{style:s},"errorElement")," prop on your route.")),z.createElement(z.Fragment,null,z.createElement("h2",null,"Unexpected Application Error!"),z.createElement("h3",{style:{fontStyle:"italic"}},e),t?z.createElement("pre",{style:i},t):null,l)}var ax=z.createElement(sx,null),kp=class extends z.Component{constructor(a){super(a),this.state={location:a.location,revalidation:a.revalidation,error:a.error}}static getDerivedStateFromError(a){return{error:a}}static getDerivedStateFromProps(a,e){return e.location!==a.location||e.revalidation!=="idle"&&a.revalidation==="idle"?{error:a.error,location:a.location,revalidation:a.revalidation}:{error:a.error!==void 0?a.error:e.error,location:e.location,revalidation:a.revalidation||e.revalidation}}componentDidCatch(a,e){this.props.onError?this.props.onError(a,e):console.error("React Router caught the following error during render",a)}render(){let a=this.state.error;if(this.context&&typeof a=="object"&&a&&"digest"in a&&typeof a.digest=="string"){const t=ex(a.digest);t&&(a=t)}let e=a!==void 0?z.createElement(Gn.Provider,{value:this.props.routeContext},z.createElement(Ec.Provider,{value:a,children:this.props.component})):this.props.children;return this.context?z.createElement(ox,{error:a},e):e}};kp.contextType=Yv;var Ru=new WeakMap;function ox({children:a,error:e}){let{basename:t}=z.useContext(Jt);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let n=Zv(e.digest);if(n){let i=Ru.get(e);if(i)throw i;let s=Lp(n.location,t);if(Tp&&!Ru.get(e))if(s.isExternal||n.reloadDocument)window.location.href=s.absoluteURL||s.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(s.to,{replace:n.replace}));throw Ru.set(e,l),l}return z.createElement("meta",{httpEquiv:"refresh",content:`0;url=${s.absoluteURL||s.to}`})}}return a}function lx({routeContext:a,match:e,children:t}){let n=z.useContext(wi);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),z.createElement(Gn.Provider,{value:a},t)}function ux(a,e=[],t=null,n=null,i=null){if(a==null){if(!t)return null;if(t.errors)a=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)a=t.matches;else return null}let s=a,l=t==null?void 0:t.errors;if(l!=null){let f=s.findIndex(m=>m.route.id&&(l==null?void 0:l[m.route.id])!==void 0);qe(f>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),s=s.slice(0,Math.min(s.length,f+1))}let u=!1,h=-1;if(t)for(let f=0;f<s.length;f++){let m=s[f];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(h=f),m.route.id){let{loaderData:g,errors:v}=t,x=m.route.loader&&!g.hasOwnProperty(m.route.id)&&(!v||v[m.route.id]===void 0);if(m.route.lazy||x){u=!0,h>=0?s=s.slice(0,h+1):s=[s[0]];break}}}let d=t&&n?(f,m)=>{var g,v;n(f,{location:t.location,params:((v=(g=t.matches)==null?void 0:g[0])==null?void 0:v.params)??{},unstable_pattern:Wv(t.matches),errorInfo:m})}:void 0;return s.reduceRight((f,m,g)=>{let v,x=!1,T=null,S=null;t&&(v=l&&m.route.id?l[m.route.id]:void 0,T=m.route.errorElement||ax,u&&(h<0&&g===0?(Cp("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),x=!0,S=null):h===g&&(x=!0,S=m.route.hydrateFallbackElement||null)));let I=e.concat(s.slice(0,g+1)),b=()=>{let w;return v?w=T:x?w=S:m.route.Component?w=z.createElement(m.route.Component,null):m.route.element?w=m.route.element:w=f,z.createElement(lx,{match:m,routeContext:{outlet:f,matches:I,isDataRoute:t!=null},children:w})};return t&&(m.route.ErrorBoundary||m.route.errorElement||g===0)?z.createElement(kp,{location:t.location,revalidation:t.revalidation,component:T,error:v,children:b(),routeContext:{outlet:null,matches:I,isDataRoute:!0},onError:d}):b()},null)}function Sc(a){return`${a} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function cx(a){let e=z.useContext(wi);return qe(e,Sc(a)),e}function dx(a){let e=z.useContext(Ro);return qe(e,Sc(a)),e}function hx(a){let e=z.useContext(Gn);return qe(e,Sc(a)),e}function Tc(a){let e=hx(a),t=e.matches[e.matches.length-1];return qe(t.route.id,`${a} can only be used on routes that contain a unique "id"`),t.route.id}function fx(){return Tc("useRouteId")}function mx(){var n;let a=z.useContext(Ec),e=dx("useRouteError"),t=Tc("useRouteError");return a!==void 0?a:(n=e.errors)==null?void 0:n[t]}function px(){let{router:a}=cx("useNavigate"),e=Tc("useNavigate"),t=z.useRef(!1);return bp(()=>{t.current=!0}),z.useCallback(async(i,s={})=>{In(t.current,wp),t.current&&(typeof i=="number"?await a.navigate(i):await a.navigate(i,{fromRouteId:e,...s}))},[a,e])}var Yf={};function Cp(a,e,t){!e&&!Yf[a]&&(Yf[a]=!0,In(!1,t))}z.memo(gx);function gx({routes:a,future:e,state:t,onError:n}){return _p(a,void 0,t,n,e)}function yi(a){qe(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function yx({basename:a="/",children:e=null,location:t,navigationType:n="POP",navigator:i,static:s=!1,unstable_useTransitions:l}){qe(!_s(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let u=a.replace(/^\/*/,"/"),h=z.useMemo(()=>({basename:u,navigator:i,static:s,unstable_useTransitions:l,future:{}}),[u,i,s,l]);typeof t=="string"&&(t=Ri(t));let{pathname:d="/",search:f="",hash:m="",state:g=null,key:v="default"}=t,x=z.useMemo(()=>{let T=jn(d,u);return T==null?null:{location:{pathname:T,search:f,hash:m,state:g,key:v},navigationType:n}},[u,d,f,m,g,v,n]);return In(x!=null,`<Router basename="${u}"> is not able to match the URL "${d}${f}${m}" because it does not start with the basename, so the <Router> won't render anything.`),x==null?null:z.createElement(Jt.Provider,{value:h},z.createElement(bs.Provider,{children:e,value:x}))}function vx({children:a,location:e}){return ix(Zu(a),e)}function Zu(a,e=[]){let t=[];return z.Children.forEach(a,(n,i)=>{if(!z.isValidElement(n))return;let s=[...e,i];if(n.type===z.Fragment){t.push.apply(t,Zu(n.props.children,s));return}qe(n.type===yi,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),qe(!n.props.index||!n.props.children,"An index route cannot have child routes.");let l={id:n.props.id||s.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,middleware:n.props.middleware,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(l.children=Zu(n.props.children,s)),t.push(l)}),t}var ro="get",io="application/x-www-form-urlencoded";function wo(a){return typeof HTMLElement<"u"&&a instanceof HTMLElement}function xx(a){return wo(a)&&a.tagName.toLowerCase()==="button"}function Ex(a){return wo(a)&&a.tagName.toLowerCase()==="form"}function Sx(a){return wo(a)&&a.tagName.toLowerCase()==="input"}function Tx(a){return!!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)}function Lx(a,e){return a.button===0&&(!e||e==="_self")&&!Tx(a)}var ja=null;function Ax(){if(ja===null)try{new FormData(document.createElement("form"),0),ja=!1}catch{ja=!0}return ja}var Ix=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function wu(a){return a!=null&&!Ix.has(a)?(In(!1,`"${a}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${io}"`),null):a}function Rx(a,e){let t,n,i,s,l;if(Ex(a)){let u=a.getAttribute("action");n=u?jn(u,e):null,t=a.getAttribute("method")||ro,i=wu(a.getAttribute("enctype"))||io,s=new FormData(a)}else if(xx(a)||Sx(a)&&(a.type==="submit"||a.type==="image")){let u=a.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=a.getAttribute("formaction")||u.getAttribute("action");if(n=h?jn(h,e):null,t=a.getAttribute("formmethod")||u.getAttribute("method")||ro,i=wu(a.getAttribute("formenctype"))||wu(u.getAttribute("enctype"))||io,s=new FormData(u,a),!Ax()){let{name:d,type:f,value:m}=a;if(f==="image"){let g=d?`${d}.`:"";s.append(`${g}x`,"0"),s.append(`${g}y`,"0")}else d&&s.append(d,m)}}else{if(wo(a))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=ro,n=null,i=io,l=a}return s&&i==="text/plain"&&(l=s,s=void 0),{action:n,method:t.toLowerCase(),encType:i,formData:s,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Lc(a,e){if(a===!1||a===null||typeof a>"u")throw new Error(e)}function wx(a,e,t,n){let i=typeof a=="string"?new URL(a,typeof window>"u"?"server://singlefetch/":window.location.origin):a;return t?i.pathname.endsWith("/")?i.pathname=`${i.pathname}_.${n}`:i.pathname=`${i.pathname}.${n}`:i.pathname==="/"?i.pathname=`_root.${n}`:e&&jn(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${n}`,i}async function bx(a,e){if(a.id in e)return e[a.id];try{let t=await import(a.module);return e[a.id]=t,t}catch(t){return console.error(`Error loading route module \`${a.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function _x(a){return a==null?!1:a.href==null?a.rel==="preload"&&typeof a.imageSrcSet=="string"&&typeof a.imageSizes=="string":typeof a.rel=="string"&&typeof a.href=="string"}async function kx(a,e,t){let n=await Promise.all(a.map(async i=>{let s=e.routes[i.route.id];if(s){let l=await bx(s,t);return l.links?l.links():[]}return[]}));return Nx(n.flat(1).filter(_x).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function qf(a,e,t,n,i,s){let l=(h,d)=>t[d]?h.route.id!==t[d].route.id:!0,u=(h,d)=>{var f;return t[d].pathname!==h.pathname||((f=t[d].route.path)==null?void 0:f.endsWith("*"))&&t[d].params["*"]!==h.params["*"]};return s==="assets"?e.filter((h,d)=>l(h,d)||u(h,d)):s==="data"?e.filter((h,d)=>{var m;let f=n.routes[h.route.id];if(!f||!f.hasLoader)return!1;if(l(h,d)||u(h,d))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((m=t[0])==null?void 0:m.params)||{},nextUrl:new URL(a,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function Cx(a,e,{includeHydrateFallback:t}={}){return Dx(a.map(n=>{let i=e.routes[n.route.id];if(!i)return[];let s=[i.module];return i.clientActionModule&&(s=s.concat(i.clientActionModule)),i.clientLoaderModule&&(s=s.concat(i.clientLoaderModule)),t&&i.hydrateFallbackModule&&(s=s.concat(i.hydrateFallbackModule)),i.imports&&(s=s.concat(i.imports)),s}).flat(1))}function Dx(a){return[...new Set(a)]}function Px(a){let e={},t=Object.keys(a).sort();for(let n of t)e[n]=a[n];return e}function Nx(a,e){let t=new Set;return new Set(e),a.reduce((n,i)=>{let s=JSON.stringify(Px(i));return t.has(s)||(t.add(s),n.push({key:s,link:i})),n},[])}function Dp(){let a=z.useContext(wi);return Lc(a,"You must render this element inside a <DataRouterContext.Provider> element"),a}function Ox(){let a=z.useContext(Ro);return Lc(a,"You must render this element inside a <DataRouterStateContext.Provider> element"),a}var Ac=z.createContext(void 0);Ac.displayName="FrameworkContext";function Pp(){let a=z.useContext(Ac);return Lc(a,"You must render this element inside a <HydratedRouter> element"),a}function Mx(a,e){let t=z.useContext(Ac),[n,i]=z.useState(!1),[s,l]=z.useState(!1),{onFocus:u,onBlur:h,onMouseEnter:d,onMouseLeave:f,onTouchStart:m}=e,g=z.useRef(null);z.useEffect(()=>{if(a==="render"&&l(!0),a==="viewport"){let T=I=>{I.forEach(b=>{l(b.isIntersecting)})},S=new IntersectionObserver(T,{threshold:.5});return g.current&&S.observe(g.current),()=>{S.disconnect()}}},[a]),z.useEffect(()=>{if(n){let T=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(T)}}},[n]);let v=()=>{i(!0)},x=()=>{i(!1),l(!1)};return t?a!=="intent"?[s,g,{}]:[s,g,{onFocus:ms(u,v),onBlur:ms(h,x),onMouseEnter:ms(d,v),onMouseLeave:ms(f,x),onTouchStart:ms(m,v)}]:[!1,g,{}]}function ms(a,e){return t=>{a&&a(t),t.defaultPrevented||e(t)}}function Fx({page:a,...e}){let{router:t}=Dp(),n=z.useMemo(()=>yp(t.routes,a,t.basename),[t.routes,a,t.basename]);return n?z.createElement(Ux,{page:a,matches:n,...e}):null}function Bx(a){let{manifest:e,routeModules:t}=Pp(),[n,i]=z.useState([]);return z.useEffect(()=>{let s=!1;return kx(a,e,t).then(l=>{s||i(l)}),()=>{s=!0}},[a,e,t]),n}function Ux({page:a,matches:e,...t}){let n=Br(),{future:i,manifest:s,routeModules:l}=Pp(),{basename:u}=Dp(),{loaderData:h,matches:d}=Ox(),f=z.useMemo(()=>qf(a,e,d,s,n,"data"),[a,e,d,s,n]),m=z.useMemo(()=>qf(a,e,d,s,n,"assets"),[a,e,d,s,n]),g=z.useMemo(()=>{if(a===n.pathname+n.search+n.hash)return[];let T=new Set,S=!1;if(e.forEach(b=>{var _;let w=s.routes[b.route.id];!w||!w.hasLoader||(!f.some(D=>D.route.id===b.route.id)&&b.route.id in h&&((_=l[b.route.id])!=null&&_.shouldRevalidate)||w.hasClientLoader?S=!0:T.add(b.route.id))}),T.size===0)return[];let I=wx(a,u,i.unstable_trailingSlashAwareDataRequests,"data");return S&&T.size>0&&I.searchParams.set("_routes",e.filter(b=>T.has(b.route.id)).map(b=>b.route.id).join(",")),[I.pathname+I.search]},[u,i.unstable_trailingSlashAwareDataRequests,h,n,s,f,e,a,l]),v=z.useMemo(()=>Cx(m,s),[m,s]),x=Bx(m);return z.createElement(z.Fragment,null,g.map(T=>z.createElement("link",{key:T,rel:"prefetch",as:"fetch",href:T,...t})),v.map(T=>z.createElement("link",{key:T,rel:"modulepreload",href:T,...t})),x.map(({key:T,link:S})=>z.createElement("link",{key:T,nonce:t.nonce,...S,crossOrigin:S.crossOrigin??t.crossOrigin})))}function $x(...a){return e=>{a.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var jx=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{jx&&(window.__reactRouterVersion="7.13.0")}catch{}function Gx({basename:a,children:e,unstable_useTransitions:t,window:n}){let i=z.useRef();i.current==null&&(i.current=Sv({window:n,v5Compat:!0}));let s=i.current,[l,u]=z.useState({action:s.action,location:s.location}),h=z.useCallback(d=>{t===!1?u(d):z.startTransition(()=>u(d))},[t]);return z.useLayoutEffect(()=>s.listen(h),[s,h]),z.createElement(yx,{basename:a,children:e,location:l.location,navigationType:l.action,navigator:s,unstable_useTransitions:t})}var Np=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Dt=z.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:i,reloadDocument:s,replace:l,state:u,target:h,to:d,preventScrollReset:f,viewTransition:m,unstable_defaultShouldRevalidate:g,...v},x){let{basename:T,unstable_useTransitions:S}=z.useContext(Jt),I=typeof d=="string"&&Np.test(d),b=Lp(d,T);d=b.to;let w=tx(d,{relative:i}),[_,D,j]=Mx(n,v),P=Wx(d,{replace:l,state:u,target:h,preventScrollReset:f,relative:i,viewTransition:m,unstable_defaultShouldRevalidate:g,unstable_useTransitions:S});function B(O){e&&e(O),O.defaultPrevented||P(O)}let U=z.createElement("a",{...v,...j,href:b.absoluteURL||w,onClick:b.isExternal||s?e:B,ref:$x(x,D),target:h,"data-discover":!I&&t==="render"?"true":void 0});return _&&!I?z.createElement(z.Fragment,null,U,z.createElement(Fx,{page:w})):U});Dt.displayName="Link";var Vx=z.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:i=!1,style:s,to:l,viewTransition:u,children:h,...d},f){let m=ks(l,{relative:d.relative}),g=Br(),v=z.useContext(Ro),{navigator:x,basename:T}=z.useContext(Jt),S=v!=null&&Xx(m)&&u===!0,I=x.encodeLocation?x.encodeLocation(m).pathname:m.pathname,b=g.pathname,w=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;t||(b=b.toLowerCase(),w=w?w.toLowerCase():null,I=I.toLowerCase()),w&&T&&(w=jn(w,T)||w);const _=I!=="/"&&I.endsWith("/")?I.length-1:I.length;let D=b===I||!i&&b.startsWith(I)&&b.charAt(_)==="/",j=w!=null&&(w===I||!i&&w.startsWith(I)&&w.charAt(I.length)==="/"),P={isActive:D,isPending:j,isTransitioning:S},B=D?e:void 0,U;typeof n=="function"?U=n(P):U=[n,D?"active":null,j?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let O=typeof s=="function"?s(P):s;return z.createElement(Dt,{...d,"aria-current":B,className:U,ref:f,style:O,to:l,viewTransition:u},typeof h=="function"?h(P):h)});Vx.displayName="NavLink";var Kx=z.forwardRef(({discover:a="render",fetcherKey:e,navigate:t,reloadDocument:n,replace:i,state:s,method:l=ro,action:u,onSubmit:h,relative:d,preventScrollReset:f,viewTransition:m,unstable_defaultShouldRevalidate:g,...v},x)=>{let{unstable_useTransitions:T}=z.useContext(Jt),S=qx(),I=Qx(u,{relative:d}),b=l.toLowerCase()==="get"?"get":"post",w=typeof u=="string"&&Np.test(u),_=D=>{if(h&&h(D),D.defaultPrevented)return;D.preventDefault();let j=D.nativeEvent.submitter,P=(j==null?void 0:j.getAttribute("formmethod"))||l,B=()=>S(j||D.currentTarget,{fetcherKey:e,method:P,navigate:t,replace:i,state:s,relative:d,preventScrollReset:f,viewTransition:m,unstable_defaultShouldRevalidate:g});T&&t!==!1?z.startTransition(()=>B()):B()};return z.createElement("form",{ref:x,method:b,action:I,onSubmit:n?h:_,...v,"data-discover":!w&&a==="render"?"true":void 0})});Kx.displayName="Form";function Hx(a){return`${a} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Op(a){let e=z.useContext(wi);return qe(e,Hx(a)),e}function Wx(a,{target:e,replace:t,state:n,preventScrollReset:i,relative:s,viewTransition:l,unstable_defaultShouldRevalidate:u,unstable_useTransitions:h}={}){let d=nx(),f=Br(),m=ks(a,{relative:s});return z.useCallback(g=>{if(Lx(g,e)){g.preventDefault();let v=t!==void 0?t:Es(f)===Es(m),x=()=>d(a,{replace:v,state:n,preventScrollReset:i,relative:s,viewTransition:l,unstable_defaultShouldRevalidate:u});h?z.startTransition(()=>x()):x()}},[f,d,m,t,n,e,a,i,s,l,u,h])}var zx=0,Yx=()=>`__${String(++zx)}__`;function qx(){let{router:a}=Op("useSubmit"),{basename:e}=z.useContext(Jt),t=fx(),n=a.fetch,i=a.navigate;return z.useCallback(async(s,l={})=>{let{action:u,method:h,encType:d,formData:f,body:m}=Rx(s,e);if(l.navigate===!1){let g=l.fetcherKey||Yx();await n(g,t,l.action||u,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:f,body:m,formMethod:l.method||h,formEncType:l.encType||d,flushSync:l.flushSync})}else await i(l.action||u,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:f,body:m,formMethod:l.method||h,formEncType:l.encType||d,replace:l.replace,state:l.state,fromRouteId:t,flushSync:l.flushSync,viewTransition:l.viewTransition})},[n,i,e,t])}function Qx(a,{relative:e}={}){let{basename:t}=z.useContext(Jt),n=z.useContext(Gn);qe(n,"useFormAction must be used inside a RouteContext");let[i]=n.matches.slice(-1),s={...ks(a||".",{relative:e})},l=Br();if(a==null){s.search=l.search;let u=new URLSearchParams(s.search),h=u.getAll("index");if(h.some(f=>f==="")){u.delete("index"),h.filter(m=>m).forEach(m=>u.append("index",m));let f=u.toString();s.search=f?`?${f}`:""}}return(!a||a===".")&&i.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(s.pathname=s.pathname==="/"?t:$n([t,s.pathname])),Es(s)}function Xx(a,{relative:e}={}){let t=z.useContext(Ip);qe(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=Op("useViewTransitionState"),i=ks(a,{relative:e});if(!t.isTransitioning)return!1;let s=jn(t.currentLocation.pathname,n)||t.currentLocation.pathname,l=jn(t.nextLocation.pathname,n)||t.nextLocation.pathname;return mo(i.pathname,l)!=null||mo(i.pathname,s)!=null}const Jx=()=>{const[a,e]=z.useState(!1),t=[{name:"Projects",href:"/projects"},{name:"Feedback",href:"/feedback"},{name:"About Us",href:"/about"},{name:"Contact Us",href:"/contact"}];return A.jsx("nav",{className:"fixed top-0 left-0 right-0 z-50 flex justify-center p-4 md:p-6 transition-all duration-300",children:A.jsxs("div",{className:`flex flex-col w-full max-w-7xl transition-all duration-500 rounded-[32px] md:rounded-full border border-white/5 bg-black/40 backdrop-blur-2xl overflow-hidden ${a?"max-h-[600px] px-6 py-6":"max-h-[80px] px-6 md:px-8 py-3"}`,children:[A.jsxs("div",{className:"flex items-center justify-between w-full",children:[A.jsx(Dt,{to:"/",className:"flex items-center gap-2",children:A.jsx("span",{className:"text-xl md:text-2xl font-bold text-white tracking-tighter font-bricolage",children:"webvoss"})}),A.jsx("div",{className:"hidden md:flex items-center gap-8 text-sm font-medium text-white/50",children:t.map(n=>A.jsx(Dt,{to:n.href,className:"hover:text-white transition-colors duration-300",children:n.name},n.name))}),A.jsxs("div",{className:"flex items-center gap-4",children:[A.jsx("button",{className:"hidden md:block px-8 py-2.5 text-sm font-bold bg-white text-black rounded-full hover:bg-white/90 transition-all shadow-lg shadow-white/10 active:scale-95",children:"Book a Demo"}),A.jsxs("button",{className:"flex md:hidden flex-col gap-1.5 p-1",onClick:()=>e(!a),children:[A.jsx("span",{className:`w-6 h-0.5 bg-white transition-all ${a?"rotate-45 translate-y-2":""}`}),A.jsx("span",{className:`w-6 h-0.5 bg-white transition-all ${a?"opacity-0":""}`}),A.jsx("span",{className:`w-6 h-0.5 bg-white transition-all ${a?"-rotate-45 -translate-y-2":""}`})]})]})]}),A.jsxs("div",{className:`flex flex-col gap-6 pt-10 pb-4 md:hidden ${a?"opacity-100 translate-y-0":"opacity-0 -translate-y-10 pointer-events-none"} transition-all duration-500`,children:[A.jsx("div",{className:"flex flex-col gap-4",children:t.map(n=>A.jsx(Dt,{to:n.href,onClick:()=>e(!1),className:"text-lg font-medium text-white/50 hover:text-white transition-colors border-b border-white/5 pb-2",children:n.name},n.name))}),A.jsx("div",{className:"pt-2",children:A.jsx("button",{className:"w-full py-4 text-sm font-bold bg-white text-black rounded-full hover:bg-white/90 transition-all shadow-lg shadow-white/10 active:scale-95",children:"Book a Demo"})})]})]})})},Zx=()=>A.jsxs("footer",{className:"py-16 md:py-24 border-t border-white/5 relative bg-background overflow-hidden",children:[A.jsxs("div",{className:"container mx-auto px-6 relative z-10",children:[A.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-12 md:gap-16 mb-16 md:mb-24 animate-on-scroll",children:[A.jsxs("div",{className:"col-span-2",children:[A.jsx("div",{className:"flex items-center gap-2 mb-8",children:A.jsx("span",{className:"text-xl font-bold text-white tracking-tighter",children:"webvoss"})}),A.jsx("p",{className:"text-white/30 text-base max-w-xs font-medium leading-relaxed mb-8",children:"The next generation of website building powered by creative webvoss excellence."}),A.jsx("div",{className:"flex gap-4",children:[1,2,3,4].map(a=>A.jsx("div",{className:"w-10 h-10 rounded-full border border-white/5 bg-white/[0.03] hover:bg-white/10 transition-all flex items-center justify-center cursor-pointer",children:A.jsx("div",{className:"w-3 h-3 border border-white/20 rounded-sm"})},a))})]}),A.jsxs("div",{children:[A.jsx("h4",{className:"text-white font-bold mb-8 tracking-tight",children:"Product"}),A.jsxs("ul",{className:"space-y-4 text-white/30 text-sm font-bold",children:[A.jsx("li",{children:A.jsx(Dt,{to:"/#features",className:"hover:text-white transition-colors",children:"Services"})}),A.jsx("li",{children:A.jsx(Dt,{to:"/#pricing",className:"hover:text-white transition-colors",children:"Pricing"})}),A.jsx("li",{children:A.jsx(Dt,{to:"#",className:"hover:text-white transition-colors",children:"Changelog"})}),A.jsx("li",{children:A.jsx(Dt,{to:"#",className:"hover:text-white transition-colors",children:"Integrations"})})]})]}),A.jsxs("div",{children:[A.jsx("h4",{className:"text-white font-bold mb-8 tracking-tight",children:"Company"}),A.jsxs("ul",{className:"space-y-4 text-white/30 text-sm font-bold",children:[A.jsx("li",{children:A.jsx(Dt,{to:"/about",className:"hover:text-white transition-colors",children:"About Us"})}),A.jsx("li",{children:A.jsx(Dt,{to:"#",className:"hover:text-white transition-colors",children:"Careers"})}),A.jsx("li",{children:A.jsx(Dt,{to:"#",className:"hover:text-white transition-colors",children:"Blog"})})]})]}),A.jsxs("div",{children:[A.jsx("h4",{className:"text-white font-bold mb-8 tracking-tight",children:"Legal"}),A.jsxs("ul",{className:"space-y-4 text-white/30 text-sm font-bold",children:[A.jsx("li",{children:A.jsx(Dt,{to:"#",className:"hover:text-white transition-colors",children:"Privacy"})}),A.jsx("li",{children:A.jsx(Dt,{to:"#",className:"hover:text-white transition-colors",children:"Terms"})})]})]})]}),A.jsxs("div",{className:"pt-8 flex flex-col items-center",children:[A.jsx("div",{className:"text-[22vw] font-bold leading-none select-none tracking-tighter text-footer-outline lowercase",children:"webvoss"}),A.jsx("p",{className:"text-white/10 text-xs font-bold uppercase tracking-[0.5em] mt-8",children:" 2026 webvoss Design Labs. All rights reserved."})]})]}),A.jsx("div",{className:"absolute -bottom-[20%] left-1/2 -translate-x-1/2 w-[100%] h-[50%] bg-red-600/5 blur-[120px] rounded-full"})]}),Cs=({children:a,className:e="",...t})=>A.jsx("button",{className:`shiny-cta-red ${e}`,...t,children:a}),le=Number.isFinite||function(a){return typeof a=="number"&&isFinite(a)},eE=Number.isSafeInteger||function(a){return typeof a=="number"&&Math.abs(a)<=tE},tE=Number.MAX_SAFE_INTEGER||9007199254740991;let ve=(function(a){return a.NETWORK_ERROR="networkError",a.MEDIA_ERROR="mediaError",a.KEY_SYSTEM_ERROR="keySystemError",a.MUX_ERROR="muxError",a.OTHER_ERROR="otherError",a})({}),G=(function(a){return a.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",a.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",a.KEY_SYSTEM_NO_SESSION="keySystemNoSession",a.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",a.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",a.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",a.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",a.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",a.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",a.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",a.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",a.MANIFEST_LOAD_ERROR="manifestLoadError",a.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",a.MANIFEST_PARSING_ERROR="manifestParsingError",a.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",a.LEVEL_EMPTY_ERROR="levelEmptyError",a.LEVEL_LOAD_ERROR="levelLoadError",a.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",a.LEVEL_PARSING_ERROR="levelParsingError",a.LEVEL_SWITCH_ERROR="levelSwitchError",a.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",a.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",a.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",a.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",a.FRAG_LOAD_ERROR="fragLoadError",a.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",a.FRAG_DECRYPT_ERROR="fragDecryptError",a.FRAG_PARSING_ERROR="fragParsingError",a.FRAG_GAP="fragGap",a.REMUX_ALLOC_ERROR="remuxAllocError",a.KEY_LOAD_ERROR="keyLoadError",a.KEY_LOAD_TIMEOUT="keyLoadTimeOut",a.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",a.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",a.BUFFER_APPEND_ERROR="bufferAppendError",a.BUFFER_APPENDING_ERROR="bufferAppendingError",a.BUFFER_STALLED_ERROR="bufferStalledError",a.BUFFER_FULL_ERROR="bufferFullError",a.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",a.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",a.ASSET_LIST_LOAD_ERROR="assetListLoadError",a.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",a.ASSET_LIST_PARSING_ERROR="assetListParsingError",a.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",a.INTERNAL_EXCEPTION="internalException",a.INTERNAL_ABORTED="aborted",a.ATTACH_MEDIA_ERROR="attachMediaError",a.UNKNOWN="unknown",a})({}),L=(function(a){return a.MEDIA_ATTACHING="hlsMediaAttaching",a.MEDIA_ATTACHED="hlsMediaAttached",a.MEDIA_DETACHING="hlsMediaDetaching",a.MEDIA_DETACHED="hlsMediaDetached",a.MEDIA_ENDED="hlsMediaEnded",a.STALL_RESOLVED="hlsStallResolved",a.BUFFER_RESET="hlsBufferReset",a.BUFFER_CODECS="hlsBufferCodecs",a.BUFFER_CREATED="hlsBufferCreated",a.BUFFER_APPENDING="hlsBufferAppending",a.BUFFER_APPENDED="hlsBufferAppended",a.BUFFER_EOS="hlsBufferEos",a.BUFFERED_TO_END="hlsBufferedToEnd",a.BUFFER_FLUSHING="hlsBufferFlushing",a.BUFFER_FLUSHED="hlsBufferFlushed",a.MANIFEST_LOADING="hlsManifestLoading",a.MANIFEST_LOADED="hlsManifestLoaded",a.MANIFEST_PARSED="hlsManifestParsed",a.LEVEL_SWITCHING="hlsLevelSwitching",a.LEVEL_SWITCHED="hlsLevelSwitched",a.LEVEL_LOADING="hlsLevelLoading",a.LEVEL_LOADED="hlsLevelLoaded",a.LEVEL_UPDATED="hlsLevelUpdated",a.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",a.LEVELS_UPDATED="hlsLevelsUpdated",a.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",a.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",a.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",a.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",a.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",a.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",a.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",a.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",a.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",a.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",a.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",a.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",a.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",a.CUES_PARSED="hlsCuesParsed",a.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",a.INIT_PTS_FOUND="hlsInitPtsFound",a.FRAG_LOADING="hlsFragLoading",a.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",a.FRAG_LOADED="hlsFragLoaded",a.FRAG_DECRYPTED="hlsFragDecrypted",a.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",a.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",a.FRAG_PARSING_METADATA="hlsFragParsingMetadata",a.FRAG_PARSED="hlsFragParsed",a.FRAG_BUFFERED="hlsFragBuffered",a.FRAG_CHANGED="hlsFragChanged",a.FPS_DROP="hlsFpsDrop",a.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",a.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",a.ERROR="hlsError",a.DESTROYING="hlsDestroying",a.KEY_LOADING="hlsKeyLoading",a.KEY_LOADED="hlsKeyLoaded",a.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",a.BACK_BUFFER_REACHED="hlsBackBufferReached",a.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",a.ASSET_LIST_LOADING="hlsAssetListLoading",a.ASSET_LIST_LOADED="hlsAssetListLoaded",a.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",a.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",a.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",a.INTERSTITIAL_STARTED="hlsInterstitialStarted",a.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",a.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",a.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",a.INTERSTITIAL_ENDED="hlsInterstitialEnded",a.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",a.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",a.EVENT_CUE_ENTER="hlsEventCueEnter",a})({});var _e={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},me={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class di{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class nE{constructor(e,t,n,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new di(e),this.fast_=new di(t),this.defaultTTFB_=i,this.ttfb_=new di(e)}update(e,t){const{slow_:n,fast_:i,ttfb_:s}=this;n.halfLife!==e&&(this.slow_=new di(e,n.getEstimate(),n.getTotalWeight())),i.halfLife!==t&&(this.fast_=new di(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new di(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,i=e/1e3,s=n/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function rE(a,e,t){return(e=sE(e))in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function Fe(){return Fe=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a},Fe.apply(null,arguments)}function Qf(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),t.push.apply(t,n)}return t}function Oe(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Qf(Object(t),!0).forEach(function(n){rE(a,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):Qf(Object(t)).forEach(function(n){Object.defineProperty(a,n,Object.getOwnPropertyDescriptor(t,n))})}return a}function iE(a,e){if(typeof a!="object"||!a)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var n=t.call(a,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(a)}function sE(a){var e=iE(a,"string");return typeof e=="symbol"?e:e+""}class Zt{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=fr,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const fr=function(){},aE={trace:fr,debug:fr,log:fr,warn:fr,info:fr,error:fr};function ec(){return Fe({},aE)}function oE(a,e){const t=self.console[a];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${a}] >`):fr}function Xf(a,e,t){return e[a]?e[a].bind(e):oE(a,t)}const tc=ec();function lE(a,e,t){const n=ec();if(typeof console=="object"&&a===!0||typeof a=="object"){const i=["debug","log","info","warn","error"];i.forEach(s=>{n[s]=Xf(s,a,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return ec()}i.forEach(s=>{tc[s]=Xf(s,a)})}else Fe(tc,n);return n}const Me=tc;function gr(a=!0){return typeof self>"u"?void 0:(a||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function uE(a){return typeof self<"u"&&a===self.ManagedMediaSource}function Mp(a,e){const t=Object.keys(a),n=Object.keys(e),i=t.length,s=n.length;return!i||!s||i===s&&!t.some(l=>n.indexOf(l)===-1)}function Vt(a,e=!1){if(typeof TextDecoder<"u"){const d=new TextDecoder("utf-8").decode(a);if(e){const f=d.indexOf("\0");return f!==-1?d.substring(0,f):d}return d.replace(/\0/g,"")}const t=a.length;let n,i,s,l="",u=0;for(;u<t;){if(n=a[u++],n===0&&e)return l;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(n);break;case 12:case 13:i=a[u++],l+=String.fromCharCode((n&31)<<6|i&63);break;case 14:i=a[u++],s=a[u++],l+=String.fromCharCode((n&15)<<12|(i&63)<<6|(s&63)<<0);break}}return l}function pt(a){let e="";for(let t=0;t<a.length;t++){let n=a[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function Fp(a){return Uint8Array.from(a.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function cE(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var bu={exports:{}},Jf;function dE(){return Jf||(Jf=1,(function(a,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,l=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,u={buildAbsoluteURL:function(h,d,f){if(f=f||{},h=h.trim(),d=d.trim(),!d){if(!f.alwaysNormalize)return h;var m=u.parseURL(h);if(!m)throw new Error("Error trying to parse base URL.");return m.path=u.normalizePath(m.path),u.buildURLFromParts(m)}var g=u.parseURL(d);if(!g)throw new Error("Error trying to parse relative URL.");if(g.scheme)return f.alwaysNormalize?(g.path=u.normalizePath(g.path),u.buildURLFromParts(g)):d;var v=u.parseURL(h);if(!v)throw new Error("Error trying to parse base URL.");if(!v.netLoc&&v.path&&v.path[0]!=="/"){var x=i.exec(v.path);v.netLoc=x[1],v.path=x[2]}v.netLoc&&!v.path&&(v.path="/");var T={scheme:v.scheme,netLoc:g.netLoc,path:null,params:g.params,query:g.query,fragment:g.fragment};if(!g.netLoc&&(T.netLoc=v.netLoc,g.path[0]!=="/"))if(!g.path)T.path=v.path,g.params||(T.params=v.params,g.query||(T.query=v.query));else{var S=v.path,I=S.substring(0,S.lastIndexOf("/")+1)+g.path;T.path=u.normalizePath(I)}return T.path===null&&(T.path=f.alwaysNormalize?u.normalizePath(g.path):g.path),u.buildURLFromParts(T)},parseURL:function(h){var d=n.exec(h);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(h){for(h=h.split("").reverse().join("").replace(s,"");h.length!==(h=h.replace(l,"")).length;);return h.split("").reverse().join("")},buildURLFromParts:function(h){return h.scheme+h.netLoc+h.path+h.params+h.query+h.fragment}};a.exports=u})()})(bu)),bu.exports}var Ic=dE();class Rc{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Be={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Bp{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,fE(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let i;n.length===1?i=(t==null?void 0:t.byteRangeEndOffset)||0:i=parseInt(n[1]),this._byteRange=[i,parseInt(n[0])+i]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Be.AUDIO]:null,[Be.VIDEO]:null,[Be.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Rc),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Ic.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Be.AUDIO]=null,e[Be.VIDEO]=null,e[Be.AUDIOVIDEO]=null}}function et(a){return a.sn!=="initSegment"}class _u extends Bp{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(le(e)&&le(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const n=Object.keys(t);if(n.length===1){const i=this._decryptdata=t[n[0]]||null;i&&(this._decryptdata=i.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=le(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const n=Object.keys(this.levelkeys),i=n.length;if(i>1||i===1&&(t=this.levelkeys[n[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!le(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return et(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const i=t[e];i&&!((n=this._decryptdata)!=null&&n.keyId)&&(this._decryptdata=i.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,i,s,l=!1){const{elementaryStreams:u}=this,h=u[e];if(!h){u[e]={startPTS:t,endPTS:n,startDTS:i,endDTS:s,partial:l};return}h.startPTS=Math.min(h.startPTS,t),h.endPTS=Math.max(h.endPTS,n),h.startDTS=Math.min(h.startDTS,i),h.endDTS=Math.max(h.endDTS,s)}}class hE extends Bp{constructor(e,t,n,i,s){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const l=e.enumeratedString("BYTERANGE");l&&this.setByteRange(l,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Up(a,e){const t=Object.getPrototypeOf(a);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||Up(t,e)}}function fE(a,e){const t=Up(a,e);t&&(t.enumerable=!0,Object.defineProperty(a,e,t))}const Zf=Math.pow(2,32)-1,mE=[].push,$p={video:1,audio:2,id3:3,text:4};function st(a){return String.fromCharCode.apply(null,a)}function jp(a,e){const t=a[e]<<8|a[e+1];return t<0?65536+t:t}function Ae(a,e){const t=Gp(a,e);return t<0?4294967296+t:t}function em(a,e){let t=Ae(a,e);return t*=Math.pow(2,32),t+=Ae(a,e+4),t}function Gp(a,e){return a[e]<<24|a[e+1]<<16|a[e+2]<<8|a[e+3]}function pE(a){const e=a.byteLength;for(let t=0;t<e;){const n=Ae(a,t);if(n>8&&a[t+4]===109&&a[t+5]===111&&a[t+6]===111&&a[t+7]===102)return!0;t=n>1?t+n:e}return!1}function we(a,e){const t=[];if(!e.length)return t;const n=a.byteLength;for(let i=0;i<n;){const s=Ae(a,i),l=st(a.subarray(i+4,i+8)),u=s>1?i+s:n;if(l===e[0])if(e.length===1)t.push(a.subarray(i+8,u));else{const h=we(a.subarray(i+8,u),e.slice(1));h.length&&mE.apply(t,h)}i=u}return t}function gE(a){const e=[],t=a[0];let n=8;const i=Ae(a,n);n+=4;let s=0,l=0;t===0?(s=Ae(a,n),l=Ae(a,n+4),n+=8):(s=em(a,n),l=em(a,n+8),n+=16),n+=2;let u=a.length+l;const h=jp(a,n);n+=2;for(let d=0;d<h;d++){let f=n;const m=Ae(a,f);f+=4;const g=m&2147483647;if((m&2147483648)>>>31===1)return Me.warn("SIDX has hierarchical references (not supported)"),null;const x=Ae(a,f);f+=4,e.push({referenceSize:g,subsegmentDuration:x,info:{duration:x/i,start:u,end:u+g-1}}),u+=g,f+=4,n=f}return{earliestPresentationTime:s,timescale:i,version:t,referencesCount:h,references:e}}function Vp(a){const e=[],t=we(a,["moov","trak"]);for(let i=0;i<t.length;i++){const s=t[i],l=we(s,["tkhd"])[0];if(l){let u=l[0];const h=Ae(l,u===0?12:20),d=we(s,["mdia","mdhd"])[0];if(d){u=d[0];const f=Ae(d,u===0?12:20),m=we(s,["mdia","hdlr"])[0];if(m){const g=st(m.subarray(8,12)),v={soun:Be.AUDIO,vide:Be.VIDEO}[g],x=we(s,["mdia","minf","stbl","stsd"])[0],T=yE(x);v?(e[h]={timescale:f,type:v,stsd:T},e[v]=Oe({timescale:f,id:h},T)):e[h]={timescale:f,type:g,stsd:T}}}}}return we(a,["moov","mvex","trex"]).forEach(i=>{const s=Ae(i,4),l=e[s];l&&(l.default={duration:Ae(i,12),flags:Ae(i,20)})}),e}function yE(a){const e=a.subarray(8),t=e.subarray(86),n=st(e.subarray(4,8));let i=n,s;const l=n==="enca"||n==="encv";if(l){const d=we(e,[n])[0].subarray(n==="enca"?28:78);we(d,["sinf"]).forEach(m=>{const g=we(m,["schm"])[0];if(g){const v=st(g.subarray(4,8));if(v==="cbcs"||v==="cenc"){const x=we(m,["frma"])[0];x&&(i=st(x))}}})}const u=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const h=we(t,["avcC"])[0];h&&h.length>3&&(i+="."+Va(h[1])+Va(h[2])+Va(h[3]),s=Ga(u==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const h=we(e,[n])[0],d=we(h.subarray(28),["esds"])[0];if(d&&d.length>7){let f=4;if(d[f++]!==3)break;f=ku(d,f),f+=2;const m=d[f++];if(m&128&&(f+=2),m&64&&(f+=d[f++]),d[f++]!==4)break;f=ku(d,f);const g=d[f++];if(g===64)i+="."+Va(g);else break;if(f+=12,d[f++]!==5)break;f=ku(d,f);const v=d[f++];let x=(v&248)>>3;x===31&&(x+=1+((v&7)<<3)+((d[f]&224)>>5)),i+="."+x}break}case"hvc1":case"hev1":{const h=we(t,["hvcC"])[0];if(h&&h.length>12){const d=h[1],f=["","A","B","C"][d>>6],m=d&31,g=Ae(h,2),v=(d&32)>>5?"H":"L",x=h[12],T=h.subarray(6,12);i+="."+f+m,i+="."+vE(g).toString(16).toUpperCase(),i+="."+v+x;let S="";for(let I=T.length;I--;){const b=T[I];(b||S)&&(S="."+b.toString(16).toUpperCase()+S)}i+=S}s=Ga(u=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{i=Ga(i,t)||i;break}case"vp09":{const h=we(t,["vpcC"])[0];if(h&&h.length>6){const d=h[4],f=h[5],m=h[6]>>4&15;i+="."+Sn(d)+"."+Sn(f)+"."+Sn(m)}break}case"av01":{const h=we(t,["av1C"])[0];if(h&&h.length>2){const d=h[1]>>>5,f=h[1]&31,m=h[2]>>>7?"H":"M",g=(h[2]&64)>>6,v=(h[2]&32)>>5,x=d===2&&g?v?12:10:g?10:8,T=(h[2]&16)>>4,S=(h[2]&8)>>3,I=(h[2]&4)>>2,b=h[2]&3;i+="."+d+"."+Sn(f)+m+"."+Sn(x)+"."+T+"."+S+I+b+"."+Sn(1)+"."+Sn(1)+"."+Sn(1)+"."+0,s=Ga("dav1",t)}break}}return{codec:i,encrypted:l,supplemental:s}}function Ga(a,e){const t=we(e,["dvvC"]),n=t.length?t[0]:we(e,["dvcC"])[0];if(n){const i=n[2]>>1&127,s=n[2]<<5&32|n[3]>>3&31;return a+"."+Sn(i)+"."+Sn(s)}}function vE(a){let e=0;for(let t=0;t<32;t++)e|=(a>>t&1)<<31-t;return e>>>0}function ku(a,e){const t=e+5;for(;a[e++]&128&&e<t;);return e}function Va(a){return("0"+a.toString(16).toUpperCase()).slice(-2)}function Sn(a){return(a<10?"0":"")+a}function xE(a,e){if(!a||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&Kp(a,(n,i)=>{const s=n.subarray(8,24);s.some(l=>l!==0)||(Me.log(`[eme] Patching keyId in 'enc${i?"a":"v"}>sinf>>tenc' box: ${pt(s)} -> ${pt(t)}`),n.set(t,8))})}function EE(a){const e=[];return Kp(a,t=>e.push(t.subarray(8,24))),e}function Kp(a,e){we(a,["moov","trak"]).forEach(n=>{const i=we(n,["mdia","minf","stbl","stsd"])[0];if(!i)return;const s=i.subarray(8);let l=we(s,["enca"]);const u=l.length>0;u||(l=we(s,["encv"])),l.forEach(h=>{const d=u?h.subarray(28):h.subarray(78);we(d,["sinf"]).forEach(m=>{const g=Hp(m);g&&e(g,u)})})})}function Hp(a){const e=we(a,["schm"])[0];if(e){const t=st(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const n=we(a,["schi","tenc"])[0];if(n)return n}}}function SE(a,e,t){const n={},i=we(a,["moof","traf"]);for(let s=0;s<i.length;s++){const l=i[s],u=we(l,["tfhd"])[0],h=Ae(u,4),d=e[h];if(!d)continue;n[h]||(n[h]={start:NaN,duration:0,sampleCount:0,timescale:d.timescale,type:d.type});const f=n[h],m=we(l,["tfdt"])[0];if(m){const w=m[0];let _=Ae(m,4);w===1&&(_===Zf?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(_*=Zf+1,_+=Ae(m,8))),le(_)&&(!le(f.start)||_<f.start)&&(f.start=_)}const g=d.default,v=Ae(u,0)|(g==null?void 0:g.flags);let x=(g==null?void 0:g.duration)||0;v&8&&(v&2?x=Ae(u,12):x=Ae(u,8));const T=we(l,["trun"]);let S=f.start||0,I=0,b=x;for(let w=0;w<T.length;w++){const _=T[w],D=Ae(_,4),j=f.sampleCount;f.sampleCount+=D;const P=_[3]&1,B=_[3]&4,U=_[2]&1,O=_[2]&2,Y=_[2]&4,ne=_[2]&8;let se=8,ue=D;for(P&&(se+=4),B&&D&&(!(_[se+1]&1)&&f.keyFrameIndex===void 0&&(f.keyFrameIndex=j),se+=4,U?(b=Ae(_,se),se+=4):b=x,O&&(se+=4),ne&&(se+=4),S+=b,I+=b,ue--);ue--;)U?(b=Ae(_,se),se+=4):b=x,O&&(se+=4),Y&&(_[se+1]&1||f.keyFrameIndex===void 0&&(f.keyFrameIndex=f.sampleCount-(ue+1),f.keyFrameStart=S),se+=4),ne&&(se+=4),S+=b,I+=b;!I&&x&&(I+=x*D)}f.duration+=I}if(!Object.keys(n).some(s=>n[s].duration)){let s=1/0,l=0;const u=we(a,["sidx"]);for(let h=0;h<u.length;h++){const d=gE(u[h]);if(d!=null&&d.references){s=Math.min(s,d.earliestPresentationTime/d.timescale);const f=d.references.reduce((m,g)=>m+g.info.duration||0,0);l=Math.max(l,f+d.earliestPresentationTime/d.timescale)}}l&&le(l)&&Object.keys(n).forEach(h=>{n[h].duration||(n[h].duration=l*n[h].timescale-n[h].start)})}return n}function TE(a){const e={valid:null,remainder:null},t=we(a,["moof"]);if(t.length<2)return e.remainder=a,e;const n=t[t.length-1];return e.valid=a.slice(0,n.byteOffset-8),e.remainder=a.slice(n.byteOffset-8),e}function Xt(a,e){const t=new Uint8Array(a.length+e.length);return t.set(a),t.set(e,a.length),t}function tm(a,e){const t=[],n=e.samples,i=e.timescale,s=e.id;let l=!1;return we(n,["moof"]).map(h=>{const d=h.byteOffset-8;we(h,["traf"]).map(m=>{const g=we(m,["tfdt"]).map(v=>{const x=v[0];let T=Ae(v,4);return x===1&&(T*=Math.pow(2,32),T+=Ae(v,8)),T/i})[0];return g!==void 0&&(a=g),we(m,["tfhd"]).map(v=>{const x=Ae(v,4),T=Ae(v,0)&16777215,S=(T&1)!==0,I=(T&2)!==0,b=(T&8)!==0;let w=0;const _=(T&16)!==0;let D=0;const j=(T&32)!==0;let P=8;x===s&&(S&&(P+=8),I&&(P+=4),b&&(w=Ae(v,P),P+=4),_&&(D=Ae(v,P),P+=4),j&&(P+=4),e.type==="video"&&(l=bo(e.codec)),we(m,["trun"]).map(B=>{const U=B[0],O=Ae(B,0)&16777215,Y=(O&1)!==0;let ne=0;const se=(O&4)!==0,ue=(O&256)!==0;let oe=0;const ee=(O&512)!==0;let ie=0;const H=(O&1024)!==0,X=(O&2048)!==0;let Q=0;const k=Ae(B,4);let F=8;Y&&(ne=Ae(B,F),F+=4),se&&(F+=4);let ae=ne+d;for(let he=0;he<k;he++){if(ue?(oe=Ae(B,F),F+=4):oe=w,ee?(ie=Ae(B,F),F+=4):ie=D,H&&(F+=4),X&&(U===0?Q=Ae(B,F):Q=Gp(B,F),F+=4),e.type===Be.VIDEO){let ce=0;for(;ce<ie;){const fe=Ae(n,ae);if(ae+=4,LE(l,n[ae])){const Re=n.subarray(ae,ae+fe);wc(Re,l?2:1,a+Q/i,t)}ae+=fe,ce+=fe+4}}a+=oe/i}}))})})}),t}function bo(a){if(!a)return!1;const e=a.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function LE(a,e){if(a){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function wc(a,e,t,n){const i=Wp(a);let s=0;s+=e;let l=0,u=0,h=0;for(;s<i.length;){l=0;do{if(s>=i.length)break;h=i[s++],l+=h}while(h===255);u=0;do{if(s>=i.length)break;h=i[s++],u+=h}while(h===255);const d=i.length-s;let f=s;if(u<d)s+=u;else if(u>d){Me.error(`Malformed SEI payload. ${u} is too small, only ${d} bytes left to parse.`);break}if(l===4){if(i[f++]===181){const g=jp(i,f);if(f+=2,g===49){const v=Ae(i,f);if(f+=4,v===1195456820){const x=i[f++];if(x===3){const T=i[f++],S=31&T,I=64&T,b=I?2+S*3:0,w=new Uint8Array(b);if(I){w[0]=T;for(let _=1;_<b;_++)w[_]=i[f++]}n.push({type:x,payloadType:l,pts:t,bytes:w})}}}}}else if(l===5&&u>16){const m=[];for(let x=0;x<16;x++){const T=i[f++].toString(16);m.push(T.length==1?"0"+T:T),(x===3||x===5||x===7||x===9)&&m.push("-")}const g=u-16,v=new Uint8Array(g);for(let x=0;x<g;x++)v[x]=i[f++];n.push({payloadType:l,pts:t,uuid:m.join(""),userData:Vt(v),userDataBytes:v})}}}function Wp(a){const e=a.byteLength,t=[];let n=1;for(;n<e-2;)a[n]===0&&a[n+1]===0&&a[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return a;const i=e-t.length,s=new Uint8Array(i);let l=0;for(n=0;n<i;l++,n++)l===t[0]&&(l++,t.shift()),s[n]=a[l];return s}function AE(a){const e=a[0];let t="",n="",i=0,s=0,l=0,u=0,h=0,d=0;if(e===0){for(;st(a.subarray(d,d+1))!=="\0";)t+=st(a.subarray(d,d+1)),d+=1;for(t+=st(a.subarray(d,d+1)),d+=1;st(a.subarray(d,d+1))!=="\0";)n+=st(a.subarray(d,d+1)),d+=1;n+=st(a.subarray(d,d+1)),d+=1,i=Ae(a,12),s=Ae(a,16),u=Ae(a,20),h=Ae(a,24),d=28}else if(e===1){d+=4,i=Ae(a,d),d+=4;const m=Ae(a,d);d+=4;const g=Ae(a,d);for(d+=4,l=2**32*m+g,eE(l)||(l=Number.MAX_SAFE_INTEGER,Me.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),u=Ae(a,d),d+=4,h=Ae(a,d),d+=4;st(a.subarray(d,d+1))!=="\0";)t+=st(a.subarray(d,d+1)),d+=1;for(t+=st(a.subarray(d,d+1)),d+=1;st(a.subarray(d,d+1))!=="\0";)n+=st(a.subarray(d,d+1)),d+=1;n+=st(a.subarray(d,d+1)),d+=1}const f=a.subarray(d,a.byteLength);return{schemeIdUri:t,value:n,timeScale:i,presentationTime:l,presentationTimeDelta:s,eventDuration:u,id:h,payload:f}}function IE(a,...e){const t=e.length;let n=8,i=t;for(;i--;)n+=e[i].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=n&255,s.set(a,4),i=0,n=8;i<t;i++)s.set(e[i],n),n+=e[i].byteLength;return s}function RE(a,e,t){if(a.byteLength!==16)throw new RangeError("Invalid system id");let n,i;n=0,i=new Uint8Array;let s;n>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const l=new Uint8Array(4);return t.byteLength>0&&new DataView(l.buffer).setUint32(0,t.byteLength,!1),IE([112,115,115,104],new Uint8Array([n,0,0,0]),a,s,i,l,t)}function wE(a){const e=[];if(a instanceof ArrayBuffer){const t=a.byteLength;let n=0;for(;n+32<t;){const i=new DataView(a,n),s=bE(i);e.push(s),n+=s.size}}return e}function bE(a){const e=a.getUint32(0),t=a.byteOffset,n=a.byteLength;if(n<e)return{offset:t,size:n};if(a.getUint32(4)!==1886614376)return{offset:t,size:e};const s=a.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const l=a.buffer,u=pt(new Uint8Array(l,t+12,16));let h=null,d=null,f=0;if(s===0)f=28;else{const g=a.getUint32(28);if(!g||n<32+g*16)return{offset:t,size:e};h=[];for(let v=0;v<g;v++)h.push(new Uint8Array(l,t+32+v*16,16));f=32+g*16}if(!f)return{offset:t,size:e};const m=a.getUint32(f);return e-32<m?{offset:t,size:e}:(d=new Uint8Array(l,t+f+4,m),{version:s,systemId:u,kids:h,data:d,offset:t,size:e})}const zp=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Ai={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function bc(a,e){const t=Ai[e];return!!t&&!!t[a.slice(0,4)]}function Ss(a,e,t=!0){return!a.split(",").some(n=>!_c(n,e,t))}function _c(a,e,t=!0){var n;const i=gr(t);return(n=i==null?void 0:i.isTypeSupported(Ts(a,e)))!=null?n:!1}function Ts(a,e){return`${e}/mp4;codecs=${a}`}function nm(a){if(a){const e=a.substring(0,4);return Ai.video[e]}return 2}function po(a){const e=zp();return a.split(",").reduce((t,n)=>{const s=e&&bo(n)?9:Ai.video[n];return s?(s*2+t)/(t?3:2):(Ai.audio[n]+t)/(t?2:1)},0)}const Cu={};function _E(a,e=!0){if(Cu[a])return Cu[a];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[a];for(let i=0;i<t.length;i++){var n;if(_c(t[i],"audio",e))return Cu[a]=t[i],t[i];if(t[i]==="mp3"&&(n=gr(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return a}const kE=/flac|opus|mp4a\.40\.34/i;function go(a,e=!0){return a.replace(kE,t=>_E(t.toLowerCase(),e))}function CE(a,e){const t=[];if(a){const n=a.split(",");for(let i=0;i<n.length;i++)bc(n[i],"video")||t.push(n[i])}return e&&t.push(e),t.join(",")}function so(a,e){if(a&&(a.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(a)!==-1)&&(rm(a,"audio")||rm(a,"video")))return a;if(e){const t=e.split(",");if(t.length>1){if(a){for(let n=t.length;n--;)if(t[n].substring(0,4)===a.substring(0,4))return t[n]}return t[0]}}return e||a}function rm(a,e){return bc(a,e)&&_c(a,e)}function DE(a){const e=a.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function PE(a){if(a.startsWith("av01.")){const e=a.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return a}function im(a){const e=gr(a)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function nc(a){return a.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const NE={supported:!0,powerEfficient:!0,smooth:!0},OE={supported:!1,smooth:!1,powerEfficient:!1},Yp={supported:!0,configurations:[],decodingInfoResults:[NE]};function qp(a,e){return{supported:!1,configurations:e,decodingInfoResults:[OE],error:a}}function ME(a,e,t,n,i,s){const l=a.videoCodec,u=a.audioCodec?a.audioGroups:null,h=s==null?void 0:s.audioCodec,d=s==null?void 0:s.channels,f=d?parseInt(d):h?1/0:2;let m=null;if(u!=null&&u.length)try{u.length===1&&u[0]?m=e.groups[u[0]].channels:m=u.reduce((g,v)=>{if(v){const x=e.groups[v];if(!x)throw new Error(`Audio track group ${v} not found`);Object.keys(x.channels).forEach(T=>{g[T]=(g[T]||0)+x.channels[T]})}return g},{2:0})}catch{return!0}return l!==void 0&&(l.split(",").some(g=>bo(g))||a.width>1920&&a.height>1088||a.height>1920&&a.width>1088||a.frameRate>Math.max(n,30)||a.videoRange!=="SDR"&&a.videoRange!==t||a.bitrate>Math.max(i,8e6))||!!m&&le(f)&&Object.keys(m).some(g=>parseInt(g)>f)}function Qp(a,e,t,n={}){const i=a.videoCodec;if(!i&&!a.audioCodec||!t)return Promise.resolve(Yp);const s=[],l=FE(a),u=l.length,h=BE(a,e,u>0),d=h.length;for(let f=u||1*d||1;f--;){const m={type:"media-source"};if(u&&(m.video=l[f%u]),d){m.audio=h[f%d];const g=m.audio.bitrate;m.video&&g&&(m.video.bitrate-=g)}s.push(m)}if(i){const f=navigator.userAgent;if(i.split(",").some(m=>bo(m))&&zp())return Promise.resolve(qp(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${f})`),s))}return Promise.all(s.map(f=>{const m=$E(f);return n[m]||(n[m]=t.decodingInfo(f))})).then(f=>({supported:!f.some(m=>!m.supported),configurations:s,decodingInfoResults:f})).catch(f=>({supported:!1,configurations:s,decodingInfoResults:[],error:f}))}function FE(a){var e;const t=(e=a.videoCodec)==null?void 0:e.split(","),n=Xp(a),i=a.width||640,s=a.height||480,l=a.frameRate||30,u=a.videoRange.toLowerCase();return t?t.map(h=>{const d={contentType:Ts(PE(h),"video"),width:i,height:s,bitrate:n,framerate:l};return u!=="sdr"&&(d.transferFunction=u),d}):[]}function BE(a,e,t){var n;const i=(n=a.audioCodec)==null?void 0:n.split(","),s=Xp(a);return i&&a.audioGroups?a.audioGroups.reduce((l,u)=>{var h;const d=u?(h=e.groups[u])==null?void 0:h.tracks:null;return d?d.reduce((f,m)=>{if(m.groupId===u){const g=parseFloat(m.channels||"");i.forEach(v=>{const x={contentType:Ts(v,"audio"),bitrate:t?UE(v,s):s};g&&(x.channels=""+g),f.push(x)})}return f},l):l},[]):[]}function UE(a,e){if(e<=1)return 1;let t=128e3;return a==="ec-3"?t=768e3:a==="ac-3"&&(t=64e4),Math.min(e/2,t)}function Xp(a){return Math.ceil(Math.max(a.bitrate*.9,a.averageBitrate)/1e3)*1e3||1}function $E(a){let e="";const{audio:t,video:n}=a;if(n){const i=nc(n.contentType);e+=`${i}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(t){const i=nc(t.contentType);e+=`${n?"_":""}${i}_c${t.channels}`}return e}const rc=["NONE","TYPE-0","TYPE-1",null];function jE(a){return rc.indexOf(a)>-1}const yo=["SDR","PQ","HLG"];function GE(a){return!!a&&yo.indexOf(a)>-1}var ao={No:"",Yes:"YES",v2:"v2"};function sm(a){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=a,i=n<e/2;return e&&i?t?ao.v2:ao.Yes:ao.No}class am{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Ls{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return om(this._audioGroups,e)}hasSubtitleGroup(e){return om(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function om(a,e){return!e||!a?!1:a.indexOf(e)!==-1}function VE(){if(typeof matchMedia=="function"){const a=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(a.media!==e.media)return a.matches===!0}return!1}function KE(a,e){let t=!1,n=[];if(a&&(t=a!=="SDR",n=[a]),e){n=e.allowedVideoRanges||yo.slice(0);const i=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:i&&VE(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const HE=a=>{const e=new WeakSet;return(t,n)=>{if(a&&(n=a(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},Ue=(a,e)=>JSON.stringify(a,HE(e));function WE(a,e,t,n,i){const s=Object.keys(a),l=n==null?void 0:n.channels,u=n==null?void 0:n.audioCodec,h=i==null?void 0:i.videoCodec,d=l&&parseInt(l)===2;let f=!1,m=!1,g=1/0,v=1/0,x=1/0,T=1/0,S=0,I=[];const{preferHDR:b,allowedVideoRanges:w}=KE(e,i);for(let B=s.length;B--;){const U=a[s[B]];f||(f=U.channels[2]>0),g=Math.min(g,U.minHeight),v=Math.min(v,U.minFramerate),x=Math.min(x,U.minBitrate),w.filter(Y=>U.videoRanges[Y]>0).length>0&&(m=!0)}g=le(g)?g:0,v=le(v)?v:0;const _=Math.max(1080,g),D=Math.max(30,v);x=le(x)?x:t,t=Math.max(x,t),m||(e=void 0);const j=s.length>1;return{codecSet:s.reduce((B,U)=>{const O=a[U];if(U===B)return B;if(I=m?w.filter(Y=>O.videoRanges[Y]>0):[],j){if(O.minBitrate>t)return xn(U,`min bitrate of ${O.minBitrate} > current estimate of ${t}`),B;if(!O.hasDefaultAudio)return xn(U,"no renditions with default or auto-select sound found"),B;if(u&&U.indexOf(u.substring(0,4))%5!==0)return xn(U,`audio codec preference "${u}" not found`),B;if(l&&!d){if(!O.channels[l])return xn(U,`no renditions with ${l} channel sound found (channels options: ${Object.keys(O.channels)})`),B}else if((!u||d)&&f&&O.channels[2]===0)return xn(U,"no renditions with stereo sound found"),B;if(O.minHeight>_)return xn(U,`min resolution of ${O.minHeight} > maximum of ${_}`),B;if(O.minFramerate>D)return xn(U,`min framerate of ${O.minFramerate} > maximum of ${D}`),B;if(!I.some(Y=>O.videoRanges[Y]>0))return xn(U,`no variants with VIDEO-RANGE of ${Ue(I)} found`),B;if(h&&U.indexOf(h.substring(0,4))%5!==0)return xn(U,`video codec preference "${h}" not found`),B;if(O.maxScore<S)return xn(U,`max score of ${O.maxScore} < selected max of ${S}`),B}return B&&(po(U)>=po(B)||O.fragmentError>a[B].fragmentError)?B:(T=O.minIndex,S=O.maxScore,U)},void 0),videoRanges:I,preferHDR:b,minFramerate:v,minBitrate:x,minIndex:T}}function xn(a,e){Me.log(`[abr] start candidates with "${a}" ignored because ${e}`)}function Jp(a){return a.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const i=t.channels||"2";return n.channels[i]=(n.channels[i]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function zE(a,e,t,n){return a.slice(t,n+1).reduce((i,s,l)=>{if(!s.codecSet)return i;const u=s.audioGroups;let h=i[s.codecSet];h||(i[s.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:l,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!u,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,s.bitrate);const d=Math.min(s.height,s.width);return h.minHeight=Math.min(h.minHeight,d),h.minFramerate=Math.min(h.minFramerate,s.frameRate),h.minIndex=Math.min(h.minIndex,l),h.maxScore=Math.max(h.maxScore,s.score),h.fragmentError+=s.fragmentError,h.videoRanges[s.videoRange]=(h.videoRanges[s.videoRange]||0)+1,u&&u.forEach(f=>{if(!f)return;const m=e.groups[f];m&&(h.hasDefaultAudio=h.hasDefaultAudio||e.hasDefaultAudio?m.hasDefault:m.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(m.channels).forEach(g=>{h.channels[g]=(h.channels[g]||0)+m.channels[g]}))}),i},{})}function lm(a){if(!a)return a;const{lang:e,assocLang:t,characteristics:n,channels:i,audioCodec:s}=a;return{lang:e,assocLang:t,characteristics:n,channels:i,audioCodec:s}}function Ln(a,e,t){if("attrs"in a){const n=e.indexOf(a);if(n!==-1)return n}for(let n=0;n<e.length;n++){const i=e[n];if(Mr(a,i,t))return n}return-1}function Mr(a,e,t){const{groupId:n,name:i,lang:s,assocLang:l,default:u}=a,h=a.forced;return(n===void 0||e.groupId===n)&&(i===void 0||e.name===i)&&(s===void 0||YE(s,e.lang))&&(s===void 0||e.assocLang===l)&&(u===void 0||e.default===u)&&(h===void 0||e.forced===h)&&(!("characteristics"in a)||qE(a.characteristics||"",e.characteristics))&&(t===void 0||t(a,e))}function YE(a,e="--"){return a.length===e.length?a===e:a.startsWith(e)||e.startsWith(a)}function qE(a,e=""){const t=a.split(","),n=e.split(",");return t.length===n.length&&!t.some(i=>n.indexOf(i)===-1)}function Or(a,e){const{audioCodec:t,channels:n}=a;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function QE(a,e,t,n,i){const s=e[n],u=e.reduce((g,v,x)=>{const T=v.uri;return(g[T]||(g[T]=[])).push(x),g},{})[s.uri];u.length>1&&(n=Math.max.apply(Math,u));const h=s.videoRange,d=s.frameRate,f=s.codecSet.substring(0,4),m=um(e,n,g=>{if(g.videoRange!==h||g.frameRate!==d||g.codecSet.substring(0,4)!==f)return!1;const v=g.audioGroups,x=t.filter(T=>!v||v.indexOf(T.groupId)!==-1);return Ln(a,x,i)>-1});return m>-1?m:um(e,n,g=>{const v=g.audioGroups,x=t.filter(T=>!v||v.indexOf(T.groupId)!==-1);return Ln(a,x,i)>-1})}function um(a,e,t){for(let n=e;n>-1;n--)if(t(a[n]))return n;for(let n=e+1;n<a.length;n++)if(t(a[n]))return n;return-1}function vo(a,e){var t;return!!a&&a!==((t=e.loadLevelObj)==null?void 0:t.uri)}class XE extends Zt{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:i,partCurrent:s,hls:l}=this,{autoLevelEnabled:u,media:h}=l;if(!i||!h)return;const d=performance.now(),f=s?s.stats:i.stats,m=s?s.duration:i.duration,g=d-f.loading.start,v=l.minAutoLevel,x=i.level,T=this._nextAutoLevel;if(f.aborted||f.loaded&&f.loaded===f.total||x<=v){this.clearTimer(),this._nextAutoLevel=-1;return}if(!u)return;const S=T>-1&&T!==x,I=!!t||S;if(!I&&(h.paused||!h.playbackRate||!h.readyState))return;const b=l.mainForwardBufferInfo;if(!I&&b===null)return;const w=this.bwEstimator.getEstimateTTFB(),_=Math.abs(h.playbackRate);if(g<=Math.max(w,1e3*(m/(_*2))))return;const D=b?b.len/_:0,j=f.loading.first?f.loading.first-f.loading.start:-1,P=f.loaded&&j>-1,B=this.getBwEstimate(),U=l.levels,O=U[x],Y=Math.max(f.loaded,Math.round(m*(i.bitrate||O.averageBitrate)/8));let ne=P?g-j:g;ne<1&&P&&(ne=Math.min(g,f.loaded*8/B));const se=P?f.loaded*1e3/ne:0,ue=w/1e3,oe=se?(Y-f.loaded)/se:Y*8/B+ue;if(oe<=D)return;const ee=se?se*8:B,ie=((n=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,H=this.hls.config.abrBandWidthUpFactor;let X=Number.POSITIVE_INFINITY,Q;for(Q=x-1;Q>v;Q--){const he=U[Q].maxBitrate,ce=!U[Q].details||ie;if(X=this.getTimeToLoadFrag(ue,ee,m*he,ce),X<Math.min(D,m+ue))break}if(X>=oe||X>m*10)return;P?this.bwEstimator.sample(g-Math.min(w,j),f.loaded):this.bwEstimator.sampleTTFB(g);const k=U[Q].maxBitrate;this.getBwEstimate()*H>k&&this.resetEstimator(k);const F=this.findBestLevel(k,v,Q,0,D,1,1);F>-1&&(Q=F),this.warn(`Fragment ${i.sn}${s?" part "+s.index:""} of level ${x} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${D.toFixed(3)} s
      Estimated load time for current fragment: ${oe.toFixed(3)} s
      Estimated load time for down switch fragment: ${X.toFixed(3)} s
      TTFB estimate: ${j|0} ms
      Current BW estimate: ${le(B)?B|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${Q} @ ${k|0} bps`),l.nextLoadLevel=l.nextAutoLevel=Q,this.clearTimer();const ae=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===Q&&Q>0){const he=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${Q>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${he.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,Q>v){let ce=this.findBestLevel(this.hls.levels[v].bitrate,v,Q,0,he,1,1);ce===-1&&(ce=v),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ce,this.resetEstimator(this.hls.levels[ce].bitrate)}}};S||oe>X*2?ae():this.timer=self.setInterval(ae,X*1e3),l.trigger(L.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:s,stats:f})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new nE(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(L.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var i;this.fragCurrent=n,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case G.BUFFER_ADD_CODEC_ERROR:case G.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case G.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:i,partCurrent:s}=this;if(n&&i&&n.sn===i.sn&&n.level===i.level){const l=performance.now(),u=s?s.stats:n.stats,h=l-u.loading.start,d=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&d>-1){const m=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(h-Math.min(m,d),u.loaded)}else this.bwEstimator.sampleTTFB(h)}break}}}getTimeToLoadFrag(e,t,n,i){const s=e+n/t,l=i?e+this.lastLevelLoadSec:0;return s+l}onLevelLoaded(e,t){const n=this.hls.config,{loading:i}=t.stats,s=i.end-i.first;le(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const i=n?n.stats:t.stats;if(t.type===me.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=n?n.duration:t.duration,l=this.hls.levels[t.level],u=(l.loaded?l.loaded.bytes:0)+i.loaded,h=(l.loaded?l.loaded.duration:0)+s;l.loaded={bytes:u,duration:h},l.realBitrate=Math.round(8*u/h)}if(t.bitrateTest){const s={stats:i,frag:t,part:n,id:t.type};this.onFragBuffered(L.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:i}=t,s=i!=null&&i.stats.loaded?i.stats:n.stats;if(s.aborted||this.ignoreFragment(n))return;const l=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(l,s.loaded),s.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==me.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,s=this.findBestLevel(n,t,e,0,i,1,1);if(s>-1)return s;const l=this.hls.firstLevel,u=Math.min(Math.max(l,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${l} clamped to ${u}`),u}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=n&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const l=this.hls.levels;if(l.length>Math.max(e,s)&&l[e].loadError<=l[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:i,config:s,minAutoLevel:l}=n,u=t?t.duration:e?e.duration:0,h=this.getBwEstimate(),d=this.getStarvationDelay();let f=s.abrBandWidthFactor,m=s.abrBandWidthUpFactor;if(d){const S=this.findBestLevel(h,l,i,d,0,f,m);if(S>=0)return this.rebufferNotice=-1,S}let g=u?Math.min(u,s.maxStarvationDelay):s.maxStarvationDelay;if(!d){const S=this.bitrateTestDelay;S&&(g=(u?Math.min(u,s.maxLoadingDelay):s.maxLoadingDelay)-S,this.info(`bitrate test took ${Math.round(1e3*S)}ms, set first fragment max fetchDuration to ${Math.round(1e3*g)} ms`),f=m=1)}const v=this.findBestLevel(h,l,i,d,g,f,m);if(this.rebufferNotice!==v&&(this.rebufferNotice=v,this.info(`${d?"rebuffering expected":"buffer is empty"}, optimal quality level ${v}`)),v>-1)return v;const x=n.levels[l],T=n.loadLevelObj;return T&&(x==null?void 0:x.bitrate)<T.bitrate?l:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,i,s,l,u){var h;const d=i+s,f=this.lastLoadedFragLevel,m=f===-1?this.hls.firstLevel:f,{fragCurrent:g,partCurrent:v}=this,{levels:x,allAudioTracks:T,loadLevel:S,config:I}=this.hls;if(x.length===1)return 0;const b=x[m],w=!!((h=this.hls.latestLevelDetails)!=null&&h.live),_=S===-1||f===-1;let D,j="SDR",P=(b==null?void 0:b.frameRate)||0;const{audioPreference:B,videoPreference:U}=I,O=this.audioTracksByGroup||(this.audioTracksByGroup=Jp(T));let Y=-1;if(_){if(this.firstSelection!==-1)return this.firstSelection;const ee=this.codecTiers||(this.codecTiers=zE(x,O,t,n)),ie=WE(ee,j,e,B,U),{codecSet:H,videoRanges:X,minFramerate:Q,minBitrate:k,minIndex:F,preferHDR:ae}=ie;Y=F,D=H,j=ae?X[X.length-1]:X[0],P=Q,e=Math.max(e,k),this.log(`picked start tier ${Ue(ie)}`)}else D=b==null?void 0:b.codecSet,j=b==null?void 0:b.videoRange;const ne=v?v.duration:g?g.duration:0,se=this.bwEstimator.getEstimateTTFB()/1e3,ue=[];for(let ee=n;ee>=t;ee--){var oe;const ie=x[ee],H=ee>m;if(!ie)continue;if(I.useMediaCapabilities&&!ie.supportedResult&&!ie.supportedPromise){const ce=navigator.mediaCapabilities;typeof(ce==null?void 0:ce.decodingInfo)=="function"&&ME(ie,O,j,P,e,B)?(ie.supportedPromise=Qp(ie,O,ce,this.supportedCache),ie.supportedPromise.then(fe=>{if(!this.hls)return;ie.supportedResult=fe;const Re=this.hls.levels,Te=Re.indexOf(ie);fe.error?this.warn(`MediaCapabilities decodingInfo error: "${fe.error}" for level ${Te} ${Ue(fe)}`):fe.supported?fe.decodingInfoResults.some(ke=>ke.smooth===!1||ke.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Te} not smooth or powerEfficient: ${Ue(fe)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Te} ${Ue(fe)}`),Te>-1&&Re.length>1&&(this.log(`Removing unsupported level ${Te}`),this.hls.removeLevel(Te),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(fe=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${fe}`)})):ie.supportedResult=Yp}if((D&&ie.codecSet!==D||j&&ie.videoRange!==j||H&&P>ie.frameRate||!H&&P>0&&P<ie.frameRate||(oe=ie.supportedResult)!=null&&(oe=oe.decodingInfoResults)!=null&&oe.some(ce=>ce.smooth===!1))&&(!_||ee!==Y)){ue.push(ee);continue}const X=ie.details,Q=(v?X==null?void 0:X.partTarget:X==null?void 0:X.averagetargetduration)||ne;let k;H?k=u*e:k=l*e;const F=ne&&i>=ne*2&&s===0?ie.averageBitrate:ie.maxBitrate,ae=this.getTimeToLoadFrag(se,k,F*Q,X===void 0);if(k>=F&&(ee===f||ie.loadError===0&&ie.fragmentError===0)&&(ae<=se||!le(ae)||w&&!this.bitrateTestDelay||ae<d)){const ce=this.forcedAutoLevel;return ee!==S&&(ce===-1||ce!==S)&&(ue.length&&this.trace(`Skipped level(s) ${ue.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${x[ue[0]].codecs}" ${x[ue[0]].videoRange}; not compatible with "${D}" ${j}`),this.info(`switch candidate:${m}->${ee} adjustedbw(${Math.round(k)})-bitrate=${Math.round(k-F)} ttfb:${se.toFixed(1)} avgDuration:${Q.toFixed(1)} maxFetchDuration:${d.toFixed(1)} fetchDuration:${ae.toFixed(1)} firstSelection:${_} codecSet:${ie.codecSet} videoRange:${ie.videoRange} hls.loadLevel:${S}`)),_&&(this.firstSelection=ee),ee}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const Zp={search:function(a,e){let t=0,n=a.length-1,i=null,s=null;for(;t<=n;){i=(t+n)/2|0,s=a[i];const l=e(s);if(l>0)t=i+1;else if(l<0)n=i-1;else return s}return null}};function JE(a,e,t){if(e===null||!Array.isArray(a)||!a.length||!le(e))return null;const n=a[0].programDateTime;if(e<(n||0))return null;const i=a[a.length-1].endProgramDateTime;if(e>=(i||0))return null;for(let s=0;s<a.length;++s){const l=a[s];if(eS(e,t,l))return l}return null}function Fr(a,e,t=0,n=0,i=.005){let s=null;if(a){s=e[1+a.sn-e[0].sn]||null;const u=a.endDTS-t;u>0&&u<15e-7&&(t+=15e-7),s&&a.level!==s.level&&s.end<=a.end&&(s=e[2+a.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!a||a.level===s.level)&&cm(t,n,s)===0||ZE(s,a,Math.min(i,n))))return s;const l=Zp.search(e,cm.bind(null,t,n));return l&&(l!==a||!s)?l:s}function ZE(a,e,t){if(e&&e.start===0&&e.level<a.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((i,s)=>(s[0]==="INF"&&(i+=parseFloat(s[1])),i),t);return a.start<=n}return!1}function cm(a=0,e=0,t){if(t.start<=a&&t.start+t.duration>a)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=a?1:t.start-n>a&&t.start?-1:0}function eS(a,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>a}function eg(a,e,t){if(a&&a.startCC<=e&&a.endCC>=e){let n=a.fragments;const{fragmentHint:i}=a;i&&(n=n.concat(i));let s;return Zp.search(n,l=>l.cc<e?1:l.cc>e?-1:(s=l,l.end<=t?1:l.start>t?-1:0)),s||null}return null}function xo(a){switch(a.details){case G.FRAG_LOAD_TIMEOUT:case G.KEY_LOAD_TIMEOUT:case G.LEVEL_LOAD_TIMEOUT:case G.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function tg(a){return a.details.startsWith("key")}function ng(a){return tg(a)&&!!a.frag&&!a.frag.decryptdata}function dm(a,e){const t=xo(e);return a.default[`${t?"timeout":"error"}Retry`]}function kc(a,e){const t=a.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*a.retryDelayMs,a.maxRetryDelayMs)}function hm(a){return Oe(Oe({},a),{errorRetry:null,timeoutRetry:null})}function Eo(a,e,t,n){if(!a)return!1;const i=n==null?void 0:n.code,s=e<a.maxNumRetry&&(tS(i)||!!t);return a.shouldRetry?a.shouldRetry(a,e,t,n,s):s}function tS(a){return ic(a)||!!a&&(a<400||a>499)}function ic(a){return a===0&&navigator.onLine===!1}var mt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},$t={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class nS extends Zt{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.ERROR,this.onError,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.ERROR,this.onError,this),e.off(L.ERROR,this.onErrorOut,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===me.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||n===-1?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if((n=e.details)!=null&&n.hasKey(t))return!0;const i=e.audioGroups;if(i)return this.hls.allAudioTracks.filter(l=>i.indexOf(l.groupId)>=0).some(l=>{var u;return(u=l.details)==null?void 0:u.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const i=this.hls,s=t.context;switch(t.details){case G.FRAG_LOAD_ERROR:case G.FRAG_LOAD_TIMEOUT:case G.KEY_LOAD_ERROR:case G.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case G.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=Ei();return}case G.FRAG_GAP:case G.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=mt.SendAlternateToPenaltyBox;return}case G.LEVEL_EMPTY_ERROR:case G.LEVEL_PARSING_ERROR:{var l;const h=t.parent===me.MAIN?t.level:i.loadLevel;t.details===G.LEVEL_EMPTY_ERROR&&((l=t.context)!=null&&(l=l.levelDetails)!=null&&l.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,h):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,h))}return;case G.LEVEL_LOAD_ERROR:case G.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case G.AUDIO_TRACK_LOAD_ERROR:case G.AUDIO_TRACK_LOAD_TIMEOUT:case G.SUBTITLE_LOAD_ERROR:case G.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const h=i.loadLevelObj;if(h&&(s.type===_e.AUDIO_TRACK&&h.hasAudioGroup(s.groupId)||s.type===_e.SUBTITLE_TRACK&&h.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=mt.SendAlternateToPenaltyBox,t.errorAction.flags=$t.MoveAllAlternatesMatchingHost;return}}return;case G.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:mt.SendAlternateToPenaltyBox,flags:$t.MoveAllAlternatesMatchingHDCP};return;case G.KEY_SYSTEM_SESSION_UPDATE_FAILED:case G.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case G.KEY_SYSTEM_NO_SESSION:t.errorAction={action:mt.SendAlternateToPenaltyBox,flags:$t.MoveAllAlternatesMatchingKey};return;case G.BUFFER_ADD_CODEC_ERROR:case G.REMUX_ALLOC_ERROR:case G.BUFFER_APPEND_ERROR:if(!t.errorAction){var u;t.errorAction=this.getLevelSwitchAction(t,(u=t.level)!=null?u:i.loadLevel)}return;case G.INTERNAL_EXCEPTION:case G.BUFFER_APPENDING_ERROR:case G.BUFFER_FULL_ERROR:case G.LEVEL_SWITCH_ERROR:case G.BUFFER_STALLED_ERROR:case G.BUFFER_SEEK_OVER_HOLE:case G.BUFFER_NUDGE_ON_STALL:t.errorAction=Ei();return}t.type===ve.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Ei())}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,i=dm(n.config.playlistLoadPolicy,e),s=this.playlistError++;if(Eo(i,s,xo(e),e.response))return{action:mt.RetryRequest,flags:$t.None,retryConfig:i,retryCount:s};const u=this.getLevelSwitchAction(e,t);return i&&(u.retryConfig=i,u.retryCount=s),u}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),i=t.levels[n],{fragLoadPolicy:s,keyLoadPolicy:l}=t.config,u=dm(tg(e)?l:s,e),h=t.levels.reduce((f,m)=>f+m.fragmentError,0);if(i&&(e.details!==G.FRAG_GAP&&i.fragmentError++,!ng(e)&&Eo(u,h,xo(e),e.response)))return{action:mt.RetryRequest,flags:$t.None,retryConfig:u,retryCount:h};const d=this.getLevelSwitchAction(e,n);return u&&(d.retryConfig=u,d.retryCount=h),d}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const i=this.hls.levels[t];if(i){var s,l;const d=e.details;i.loadError++,d===G.BUFFER_APPEND_ERROR&&i.fragmentError++;let f=-1;const{levels:m,loadLevel:g,minAutoLevel:v,maxAutoLevel:x}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const T=(s=e.frag)==null?void 0:s.type,I=(T===me.AUDIO&&d===G.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(d===G.BUFFER_ADD_CODEC_ERROR||d===G.BUFFER_APPEND_ERROR))&&m.some(({audioCodec:j})=>i.audioCodec!==j),w=e.sourceBufferName==="video"&&(d===G.BUFFER_ADD_CODEC_ERROR||d===G.BUFFER_APPEND_ERROR)&&m.some(({codecSet:j,audioCodec:P})=>i.codecSet!==j&&i.audioCodec===P),{type:_,groupId:D}=(l=e.context)!=null?l:{};for(let j=m.length;j--;){const P=(j+g)%m.length;if(P!==g&&P>=v&&P<=x&&m[P].loadError===0){var u,h;const B=m[P];if(d===G.FRAG_GAP&&T===me.MAIN&&e.frag){const U=m[P].details;if(U){const O=Fr(e.frag,U.fragments,e.frag.start);if(O!=null&&O.gap)continue}}else{if(_===_e.AUDIO_TRACK&&B.hasAudioGroup(D)||_===_e.SUBTITLE_TRACK&&B.hasSubtitleGroup(D))continue;if(T===me.AUDIO&&(u=i.audioGroups)!=null&&u.some(U=>B.hasAudioGroup(U))||T===me.SUBTITLE&&(h=i.subtitleGroups)!=null&&h.some(U=>B.hasSubtitleGroup(U))||I&&i.audioCodec===B.audioCodec||w&&i.codecSet===B.codecSet||!I&&i.codecSet!==B.codecSet)continue}f=P;break}}if(f>-1&&n.loadLevel!==f)return e.levelRetry=!0,this.playlistError=0,{action:mt.SendAlternateToPenaltyBox,flags:$t.None,nextAutoLevel:f}}return{action:mt.SendAlternateToPenaltyBox,flags:$t.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case mt.DoNothing:break;case mt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==G.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:i}=n,s=n.nextAutoLevel;switch(i){case $t.None:this.switchLevel(e,s);break;case $t.MoveAllAlternatesMatchingHDCP:{const h=this.getVariantLevelIndex(e.frag),d=t.levels[h],f=d==null?void 0:d.attrs["HDCP-LEVEL"];if(n.hdcpLevel=f,f==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(f){t.maxHdcpLevel=rc[rc.indexOf(f)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case $t.MoveAllAlternatesMatchingKey:{const h=e.decryptdata;if(h){const d=this.hls.levels,f=d.length;for(let g=f;g--;)if(this.variantHasKey(d[g],h)){var l,u;this.log(`Banned key found in level ${g} (${d[g].bitrate}bps) or audio group "${(l=d[g].audioGroups)==null?void 0:l.join(",")}" (${(u=e.frag)==null?void 0:u.type} fragment) ${pt(h.keyId||[])}`),d[g].fragmentError++,d[g].loadError++,this.log(`Removing level ${g} with key error (${e.error})`),this.hls.removeLevel(g)}const m=e.frag;if(this.hls.levels.length<f)n.resolved=!0;else if(m&&m.type!==me.MAIN){const g=m.decryptdata;g&&!h.matches(g)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,s)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===G.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=nc(e.mimeType),i=this.hls.levels;for(let s=i.length;s--;)i[s][`${e.sourceBufferName}Codec`]===n&&(this.log(`Removing level ${s} for ${e.details} ("${n}" not supported)`),this.hls.removeLevel(s))}}}function Ei(a){const e={action:mt.DoNothing,flags:$t.None};return a&&(e.resolved=!0),e}var at={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class rS{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let i=n.length;i--;){const s=n[i];if(!s)break;if(s.start<=e&&e<=s.end&&s.loaded)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:i}=this,s=Object.keys(i);for(let l=s.length;l--;){const u=i[s[l]];if((u==null?void 0:u.body.type)===t&&(!n||u.buffered)){const h=u.body;if(h.start<=e&&e<=h.end)return h}}return null}detectEvictedFragments(e,t,n,i,s){this.timeRanges&&(this.timeRanges[e]=t);const l=(i==null?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(u=>{const h=this.fragments[u];if(!h||l>=h.body.sn)return;if(!h.buffered&&(!h.loaded||s)){h.body.type===n&&this.removeFragment(h.body);return}const d=h.range[e];if(d){if(d.time.length===0){this.removeFragment(h.body);return}d.time.some(f=>{const m=!this.isTimeBuffered(f.startPTS,f.endPTS,t);return m&&this.removeFragment(h.body),m})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,i=hi(n),s=this.fragments[i];if(!s||s.buffered&&n.gap)return;const l=!n.relurl;Object.keys(t).forEach(u=>{const h=n.elementaryStreams[u];if(!h)return;const d=t[u],f=l||h.partial===!0;s.range[u]=this.getBufferedTimes(n,e.part,f,d)}),s.loaded=null,Object.keys(s.range).length?(this.bufferedEnd(s,n),Ka(s)||this.removeParts(n.sn-1,n.type)):this.removeFragment(s.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=fm(n,i=>i.fragment.sn>=e))}fragBuffered(e,t){const n=hi(e);let i=this.fragments[n];!i&&t&&(i=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,this.bufferedEnd(i,e))}getBufferedTimes(e,t,n,i){const s={time:[],partial:n},l=e.start,u=e.end,h=e.minEndPTS||u,d=e.maxStartPTS||l;for(let f=0;f<i.length;f++){const m=i.start(f)-this.bufferPadding,g=i.end(f)+this.bufferPadding;if(d>=m&&h<=g){s.time.push({startPTS:Math.max(l,i.start(f)),endPTS:Math.min(u,i.end(f))});break}else if(l<g&&u>m){const v=Math.max(l,i.start(f)),x=Math.min(u,i.end(f));x>v&&(s.partial=!0,s.time.push({startPTS:v,endPTS:x}))}else if(u<=m)break}return s}getPartialFragment(e){let t=null,n,i,s,l=0;const{bufferPadding:u,fragments:h}=this;return Object.keys(h).forEach(d=>{const f=h[d];f&&Ka(f)&&(i=f.body.start-u,s=f.body.end+u,e>=i&&e<=s&&(n=Math.min(e-i,s-e),l<=n&&(t=f.body,l=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Ka(t))}getState(e){const t=hi(e),n=this.fragments[t];return n?n.buffered?Ka(n)?at.PARTIAL:at.OK:at.APPENDING:at.NOT_LOADED}isTimeBuffered(e,t,n){let i,s;for(let l=0;l<n.length;l++){if(i=n.start(l)-this.bufferPadding,s=n.end(l)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,i=t.part?null:t,s=hi(n);this.fragments[s]={body:n,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:i,timeRanges:s,type:l}=t;if(n.sn==="initSegment")return;const u=n.type;if(i){let d=this.activePartLists[u];d||(this.activePartLists[u]=d=[]),d.push(i)}this.timeRanges=s;const h=s[l];this.detectEvictedFragments(l,h,u,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=hi(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let i=n.length;i--;){const s=t[n[i]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,i,s){i&&!this.hasGaps||Object.keys(this.fragments).forEach(l=>{const u=this.fragments[l];if(!u)return;const h=u.body;h.type!==n||i&&!h.gap||h.start<t&&h.end>e&&(u.buffered||s)&&this.removeFragment(h)})}removeFragment(e){const t=hi(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const i=e.sn;this.activePartLists[e.type]=fm(n,s=>s.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(n=>n.clearElementaryStreamInfo())}}function Ka(a){var e,t,n;return a.buffered&&!!(a.body.gap||(e=a.range.video)!=null&&e.partial||(t=a.range.audio)!=null&&t.partial||(n=a.range.audiovideo)!=null&&n.partial)}function hi(a){return`${a.type}_${a.level}_${a.sn}`}function fm(a,e){return a.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var yr={cbc:0,ctr:1};class iS{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case yr.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case yr.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function sS(a){const e=a.byteLength,t=e&&new DataView(a.buffer).getUint8(e-1);return t?a.slice(0,e-t):a}class aS{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let i=0;i<4;i++)n[i]=t.getUint32(i*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,i=n[0],s=n[1],l=n[2],u=n[3],h=this.invSubMix,d=h[0],f=h[1],m=h[2],g=h[3],v=new Uint32Array(256);let x=0,T=0,S=0;for(S=0;S<256;S++)S<128?v[S]=S<<1:v[S]=S<<1^283;for(S=0;S<256;S++){let I=T^T<<1^T<<2^T<<3^T<<4;I=I>>>8^I&255^99,e[x]=I,t[I]=x;const b=v[x],w=v[b],_=v[w];let D=v[I]*257^I*16843008;i[x]=D<<24|D>>>8,s[x]=D<<16|D>>>16,l[x]=D<<8|D>>>24,u[x]=D,D=_*16843009^w*65537^b*257^x*16843008,d[I]=D<<24|D>>>8,f[I]=D<<16|D>>>16,m[I]=D<<8|D>>>24,g[I]=D,x?(x=b^v[v[v[_^b]]],T^=v[v[T]]):x=T=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,i=0;for(;i<t.length&&n;)n=t[i]===this.key[i],i++;if(n)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const l=this.ksRows=(s+6+1)*4;let u,h;const d=this.keySchedule=new Uint32Array(l),f=this.invKeySchedule=new Uint32Array(l),m=this.sBox,g=this.rcon,v=this.invSubMix,x=v[0],T=v[1],S=v[2],I=v[3];let b,w;for(u=0;u<l;u++){if(u<s){b=d[u]=t[u];continue}w=b,u%s===0?(w=w<<8|w>>>24,w=m[w>>>24]<<24|m[w>>>16&255]<<16|m[w>>>8&255]<<8|m[w&255],w^=g[u/s|0]<<24):s>6&&u%s===4&&(w=m[w>>>24]<<24|m[w>>>16&255]<<16|m[w>>>8&255]<<8|m[w&255]),d[u]=b=(d[u-s]^w)>>>0}for(h=0;h<l;h++)u=l-h,h&3?w=d[u]:w=d[u-4],h<4||u<=4?f[h]=w:f[h]=x[m[w>>>24]]^T[m[w>>>16&255]]^S[m[w>>>8&255]]^I[m[w&255]],f[h]=f[h]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const i=this.keySize+6,s=this.invKeySchedule,l=this.invSBox,u=this.invSubMix,h=u[0],d=u[1],f=u[2],m=u[3],g=this.uint8ArrayToUint32Array_(n);let v=g[0],x=g[1],T=g[2],S=g[3];const I=new Int32Array(e),b=new Int32Array(I.length);let w,_,D,j,P,B,U,O,Y,ne,se,ue,oe,ee;const ie=this.networkToHostOrderSwap;for(;t<I.length;){for(Y=ie(I[t]),ne=ie(I[t+1]),se=ie(I[t+2]),ue=ie(I[t+3]),P=Y^s[0],B=ue^s[1],U=se^s[2],O=ne^s[3],oe=4,ee=1;ee<i;ee++)w=h[P>>>24]^d[B>>16&255]^f[U>>8&255]^m[O&255]^s[oe],_=h[B>>>24]^d[U>>16&255]^f[O>>8&255]^m[P&255]^s[oe+1],D=h[U>>>24]^d[O>>16&255]^f[P>>8&255]^m[B&255]^s[oe+2],j=h[O>>>24]^d[P>>16&255]^f[B>>8&255]^m[U&255]^s[oe+3],P=w,B=_,U=D,O=j,oe=oe+4;w=l[P>>>24]<<24^l[B>>16&255]<<16^l[U>>8&255]<<8^l[O&255]^s[oe],_=l[B>>>24]<<24^l[U>>16&255]<<16^l[O>>8&255]<<8^l[P&255]^s[oe+1],D=l[U>>>24]<<24^l[O>>16&255]<<16^l[P>>8&255]<<8^l[B&255]^s[oe+2],j=l[O>>>24]<<24^l[P>>16&255]<<16^l[B>>8&255]<<8^l[U&255]^s[oe+3],b[t]=ie(w^v),b[t+1]=ie(j^x),b[t+2]=ie(D^T),b[t+3]=ie(_^S),v=Y,x=ne,T=se,S=ue,t=t+4}return b.buffer}}class oS{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=lS(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function lS(a){switch(a){case yr.cbc:return"AES-CBC";case yr.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${a}`)}}const uS=16;class Cc{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?sS(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,i){return this.useSoftware?new Promise((s,l)=>{const u=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(u,t,n,i);const h=this.flush();h?s(h.buffer):l(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,i)}softwareDecrypt(e,t,n,i){const{currentIV:s,currentResult:l,remainderData:u}=this;if(i!==yr.cbc||t.byteLength!==16)return Me.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(e=Xt(u,e),this.remainderData=null);const h=this.getValidChunk(e);if(!h.length)return null;s&&(n=s);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new aS),d.expandKey(t);const f=l;return this.currentResult=d.decrypt(h.buffer,0,n),this.currentIV=h.slice(-16).buffer,f||null}webCryptoDecrypt(e,t,n,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,i));this.key=t,this.fastAesKey=new oS(this.subtle,t,i)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new iS(this.subtle,new Uint8Array(n),i).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(Me.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,n,i)))}onWebCryptoError(e,t,n,i){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,i);const l=this.flush();if(l)return l.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%uS;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(Me.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const mm=Math.pow(2,17);class cS{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Bn({type:ve.NETWORK_ERROR,details:G.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,s=i.fLoader,l=i.loader;return new Promise((u,h)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(x=>x[0]==="GAP")){h(gm(e));return}else e.gap=!1;const d=this.loader=s?new s(i):new l(i),f=pm(e);e.loader=d;const m=hm(i.fragLoadPolicy.default),g={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:mm};e.stats=d.stats;const v={onSuccess:(x,T,S,I)=>{this.resetLoader(e,d);let b=x.data;S.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(b.slice(0,16)),b=b.slice(16)),u({frag:e,part:null,payload:b,networkDetails:I})},onError:(x,T,S,I)=>{this.resetLoader(e,d),h(new Bn({type:ve.NETWORK_ERROR,details:G.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Oe({url:n,data:void 0},x),error:new Error(`HTTP Error ${x.code} ${x.text}`),networkDetails:S,stats:I}))},onAbort:(x,T,S)=>{this.resetLoader(e,d),h(new Bn({type:ve.NETWORK_ERROR,details:G.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:S,stats:x}))},onTimeout:(x,T,S)=>{this.resetLoader(e,d),h(new Bn({type:ve.NETWORK_ERROR,details:G.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${g.timeout}ms`),networkDetails:S,stats:x}))}};t&&(v.onProgress=(x,T,S,I)=>t({frag:e,part:null,payload:S,networkDetails:I})),d.load(f,g,v)})}loadPart(e,t,n){this.abort();const i=this.config,s=i.fLoader,l=i.loader;return new Promise((u,h)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){h(gm(e,t));return}const d=this.loader=s?new s(i):new l(i),f=pm(e,t);e.loader=d;const m=hm(i.fragLoadPolicy.default),g={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:mm};t.stats=d.stats,d.load(f,g,{onSuccess:(v,x,T,S)=>{this.resetLoader(e,d),this.updateStatsFromPart(e,t);const I={frag:e,part:t,payload:v.data,networkDetails:S};n(I),u(I)},onError:(v,x,T,S)=>{this.resetLoader(e,d),h(new Bn({type:ve.NETWORK_ERROR,details:G.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Oe({url:f.url,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:T,stats:S}))},onAbort:(v,x,T)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,d),h(new Bn({type:ve.NETWORK_ERROR,details:G.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:T,stats:v}))},onTimeout:(v,x,T)=>{this.resetLoader(e,d),h(new Bn({type:ve.NETWORK_ERROR,details:G.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${g.timeout}ms`),networkDetails:T,stats:v}))}})})}updateStatsFromPart(e,t){const n=e.stats,i=t.stats,s=i.total;if(n.loaded+=i.loaded,s){const h=Math.round(e.duration/t.duration),d=Math.min(Math.round(n.loaded/s),h),m=(h-d)*Math.round(n.loaded/d);n.total=n.loaded+m}else n.total=Math.max(n.loaded,n.total);const l=n.loading,u=i.loading;l.start?l.first+=u.first-u.start:(l.start=u.start,l.first=u.first),l.end=u.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function pm(a,e=null){const t=e||a,n={frag:a,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(le(i)&&le(s)){var l;let u=i,h=s;if(a.sn==="initSegment"&&dS((l=a.decryptdata)==null?void 0:l.method)){const d=s-i;d%16&&(h=s+(16-d%16)),i!==0&&(n.resetIV=!0,u=i-16)}n.rangeStart=u,n.rangeEnd=h}return n}function gm(a,e){const t=new Error(`GAP ${a.gap?"tag":"attribute"} found`),n={type:ve.MEDIA_ERROR,details:G.FRAG_GAP,fatal:!1,frag:a,error:t,networkDetails:null};return e&&(n.part=e),(e||a).stats.aborted=!0,new Bn(n)}function dS(a){return a==="AES-128"||a==="AES-256"}class Bn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class rg extends Zt{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Dc{constructor(e,t,n,i=0,s=-1,l=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Ha(),this.buffering={audio:Ha(),video:Ha(),audiovideo:Ha()},this.level=e,this.sn=t,this.id=n,this.size=i,this.part=s,this.partial=l}}function Ha(){return{start:0,executeStart:0,executeEnd:0,end:0}}const ym={length:0,start:()=>0,end:()=>0};class Ie{static isBuffered(e,t){if(e){const n=Ie.getBuffered(e);for(let i=n.length;i--;)if(t>=n.start(i)&&t<=n.end(i))return!0}return!1}static bufferedRanges(e){if(e){const t=Ie.getBuffered(e);return Ie.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const i=Ie.bufferedRanges(e);if(i.length)return Ie.bufferedInfo(i,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((f,m)=>f.start-m.start||m.end-f.end);let i=-1,s=[];if(n)for(let f=0;f<e.length;f++){t>=e[f].start&&t<=e[f].end&&(i=f);const m=s.length;if(m){const g=s[m-1].end;e[f].start-g<n?e[f].end>g&&(s[m-1].end=e[f].end):s.push(e[f])}else s.push(e[f])}else s=e;let l=0,u,h=t,d=t;for(let f=0;f<s.length;f++){const m=s[f].start,g=s[f].end;if(i===-1&&t>=m&&t<=g&&(i=f),t+n>=m&&t<g)h=m,d=g,l=d-t;else if(t+n<m){u=m;break}}return{len:l,start:h||0,end:d||0,nextStart:u,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||ym}catch(t){return Me.log("failed to get media.buffered",t),ym}}}const ig=/\{\$([a-zA-Z0-9-_]+)\}/g;function vm(a){return ig.test(a)}function sc(a,e){if(a.variableList!==null||a.hasVariableRefs){const t=a.variableList;return e.replace(ig,n=>{const i=n.substring(2,n.length-1),s=t==null?void 0:t[i];return s===void 0?(a.playlistParsingError||(a.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),n):s})}return e}function xm(a,e,t){let n=a.variableList;n||(a.variableList=n={});let i,s;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const l=new self.URL(t).searchParams;if(l.has(i))s=l.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(l){a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${l.message}`))}}else i=e.NAME,s=e.VALUE;i in n?a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):n[i]=s||""}function hS(a,e,t){const n=e.IMPORT;if(t&&n in t){let i=a.variableList;i||(a.variableList=i={}),i[n]=t[n]}else a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const fS=/^(\d+)x(\d+)$/,Em=/(.+?)=(".*?"|.*?)(?:,|$)/g;class ze{constructor(e,t){typeof e=="string"&&(e=ze.parseAttrList(e,t)),Fe(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)n[i]=parseInt(t.slice(i*2,i*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((i,s)=>(i[s.toLowerCase()]=!0,i),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=fS.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const i={};for(Em.lastIndex=0;(n=Em.exec(e))!==null;){const l=n[1].trim();let u=n[2];const h=u.indexOf('"')===0&&u.lastIndexOf('"')===u.length-1;let d=!1;if(h)u=u.slice(1,-1);else switch(l){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(t&&(h||d))u=sc(t,u);else if(!d&&!h)switch(l){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Me.warn(`${e}: attribute ${l} is missing quotes`)}i[l]=u}return i}}const mS="com.apple.hls.interstitial";function pS(a){return a!=="ID"&&a!=="CLASS"&&a!=="CUE"&&a!=="START-DATE"&&a!=="DURATION"&&a!=="END-DATE"&&a!=="END-ON-NEXT"}function gS(a){return a==="SCTE35-OUT"||a==="SCTE35-IN"||a==="SCTE35-CMD"}class sg{constructor(e,t,n=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(i=t==null?void 0:t.tagOrder)!=null?i:n,t){const s=t.attr;for(const l in s)if(Object.prototype.hasOwnProperty.call(e,l)&&e[l]!==s[l]){Me.warn(`DATERANGE tag attribute: "${l}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=l;break}e=Fe(new ze({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);le(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Me.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(le(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===mS}get isValid(){return!!this.id&&!this._badValueForSameId&&le(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const yS=10;class vS{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return this.fragments.length?le(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||yS}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function So(a,e){return a.length===e.length?!a.some((t,n)=>t!==e[n]):!1}function Sm(a,e){return!a&&!e?!0:!a||!e?!1:So(a,e)}function Si(a){return a==="AES-128"||a==="AES-256"||a==="AES-256-CTR"}function Pc(a){switch(a){case"AES-128":case"AES-256":return yr.cbc;case"AES-256-CTR":return yr.ctr;default:throw new Error(`invalid full segment method ${a}`)}}function Nc(a){return Uint8Array.from(atob(a),e=>e.charCodeAt(0))}function ac(a){return Uint8Array.from(unescape(encodeURIComponent(a)),e=>e.charCodeAt(0))}function xS(a){const e=ac(a).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function ag(a){const e=function(n,i,s){const l=n[i];n[i]=n[s],n[s]=l};e(a,0,3),e(a,1,2),e(a,4,5),e(a,6,7)}function og(a){const e=a.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),i=n[n.length-1].split(",");if(i.length===2){const s=i[0]==="base64",l=i[1];s?(n.splice(-1,1),t=Nc(l)):t=xS(l)}}return t}const To=typeof self<"u"?self:void 0;var Ye={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},gt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function oo(a){switch(a){case gt.FAIRPLAY:return Ye.FAIRPLAY;case gt.PLAYREADY:return Ye.PLAYREADY;case gt.WIDEVINE:return Ye.WIDEVINE;case gt.CLEARKEY:return Ye.CLEARKEY}}function Du(a){switch(a){case Ye.FAIRPLAY:return gt.FAIRPLAY;case Ye.PLAYREADY:return gt.PLAYREADY;case Ye.WIDEVINE:return gt.WIDEVINE;case Ye.CLEARKEY:return gt.CLEARKEY}}function gs(a){const{drmSystems:e,widevineLicenseUrl:t}=a,n=e?[Ye.FAIRPLAY,Ye.WIDEVINE,Ye.PLAYREADY,Ye.CLEARKEY].filter(i=>!!e[i]):[];return!n[Ye.WIDEVINE]&&t&&n.push(Ye.WIDEVINE),n}const lg=(function(a){return To!=null&&(a=To.navigator)!=null&&a.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function ES(a,e,t,n){let i;switch(a){case Ye.FAIRPLAY:i=["cenc","sinf"];break;case Ye.WIDEVINE:case Ye.PLAYREADY:i=["cenc"];break;case Ye.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${a}`)}return SS(i,e,t,n)}function SS(a,e,t,n){return[{initDataTypes:a,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function TS(a){var e;return!!a&&(a.sessionType==="persistent-license"||!!((e=a.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function ug(a){const e=new Uint16Array(a.buffer,a.byteOffset,a.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),l=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(l){const u=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");if(u){const h=Nc(u).subarray(0,16);return ag(h),h}}return null}let fi={};class pr{static clearKeyUriToKeyIdMap(){fi={}}static setKeyIdForUri(e,t){fi[e]=t}static addKeyIdForUri(e){const t=Object.keys(fi).length%Number.MAX_SAFE_INTEGER,n=new Uint8Array(16);return new DataView(n.buffer,12,4).setUint32(0,t),fi[e]=n,n}constructor(e,t,n,i=[1],s=null,l){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=i,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Si(e),l!=null&&l.startsWith("0x")&&(this.keyId=new Uint8Array(Fp(l)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&So(e.keyFormatVersions,this.keyFormatVersions)&&Sm(e.iv,this.iv)&&Sm(e.keyId,this.keyId)}isSupported(){if(this.method){if(Si(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case gt.FAIRPLAY:case gt.WIDEVINE:case gt.PLAYREADY:case gt.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Si(this.method)){let s=this.iv;return s||(typeof e!="number"&&(Me.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),s=AS(e)),new pr(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.keyId){const s=fi[this.uri];if(s&&!So(this.keyId,s)&&pr.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=og(this.uri);if(n)switch(this.keyFormat){case gt.WIDEVINE:if(this.pssh=n,!this.keyId){const s=wE(n.buffer);if(s.length){var i;const l=s[0];this.keyId=(i=l.kids)!=null&&i.length?l.kids[0]:null}}this.keyId||(this.keyId=Tm(t));break;case gt.PLAYREADY:{const s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=RE(s,null,n),this.keyId=ug(n);break}default:{let s=n.subarray(0,16);if(s.length!==16){const l=new Uint8Array(16);l.set(s,16-s.length),s=l}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){let s;s=LS(t),s||(s=Tm(t),s||(s=fi[this.uri])),s&&(this.keyId=s,pr.setKeyIdForUri(this.uri,s))}return this}}function LS(a){const e=a==null?void 0:a[gt.WIDEVINE];return e?e.keyId:null}function Tm(a){const e=a==null?void 0:a[gt.PLAYREADY];if(e){const t=og(e.uri);if(t)return ug(t)}return null}function AS(a){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=a>>8*(15-t)&255;return e}const Lm=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Am=/#EXT-X-MEDIA:(.*)/g,IS=/^#EXT(?:INF|-X-TARGETDURATION):/m,Pu=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),RS=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class An{static findGroup(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.id===t)return i}}static resolve(e,t){return Ic.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return IS.test(e)}static parseMasterPlaylist(e,t){const n=vm(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},s=[];if(Lm.lastIndex=0,!e.startsWith("#EXTM3U"))return i.playlistParsingError=new Error("no EXTM3U delimiter"),i;let l;for(;(l=Lm.exec(e))!=null;)if(l[1]){var u;const d=new ze(l[1],i),f=sc(i,l[2]),m={attrs:d,bitrate:d.decimalInteger("BANDWIDTH")||d.decimalInteger("AVERAGE-BANDWIDTH"),name:d.NAME,url:An.resolve(f,t)},g=d.decimalResolution("RESOLUTION");g&&(m.width=g.width,m.height=g.height),wm(d.CODECS,m);const v=d["SUPPLEMENTAL-CODECS"];v&&(m.supplemental={},wm(v,m.supplemental)),(u=m.unknownCodecs)!=null&&u.length||s.push(m),i.levels.push(m)}else if(l[3]){const d=l[3],f=l[4];switch(d){case"SESSION-DATA":{const m=new ze(f,i),g=m["DATA-ID"];g&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[g]=m);break}case"SESSION-KEY":{const m=Im(f,t,i);m.encrypted&&m.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(m)):Me.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${f}"`);break}case"DEFINE":{{const m=new ze(f,i);xm(i,m,t)}break}case"CONTENT-STEERING":{const m=new ze(f,i);i.contentSteering={uri:An.resolve(m["SERVER-URI"],t),pathwayId:m["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=Rm(f);break}}}const h=s.length>0&&s.length<i.levels.length;return i.levels=h?s:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,n){let i;const s={},l=n.levels,u={AUDIO:l.map(d=>({id:d.attrs.AUDIO,audioCodec:d.audioCodec})),SUBTITLES:l.map(d=>({id:d.attrs.SUBTITLES,textCodec:d.textCodec})),"CLOSED-CAPTIONS":[]};let h=0;for(Am.lastIndex=0;(i=Am.exec(e))!==null;){const d=new ze(i[1],n),f=d.TYPE;if(f){const m=u[f],g=s[f]||[];s[f]=g;const v=d.LANGUAGE,x=d["ASSOC-LANGUAGE"],T=d.CHANNELS,S=d.CHARACTERISTICS,I=d["INSTREAM-ID"],b={attrs:d,bitrate:0,id:h++,groupId:d["GROUP-ID"]||"",name:d.NAME||v||"",type:f,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:v,url:d.URI?An.resolve(d.URI,t):""};if(x&&(b.assocLang=x),T&&(b.channels=T),S&&(b.characteristics=S),I&&(b.instreamId=I),m!=null&&m.length){const w=An.findGroup(m,b.groupId)||m[0];bm(b,w,"audioCodec"),bm(b,w,"textCodec")}g.push(b)}}return s}static parseLevelPlaylist(e,t,n,i,s,l){var u;const h={url:t},d=new vS(t),f=d.fragments,m=[];let g=null,v=0,x=0,T=0,S=0,I=0,b=null,w=new _u(i,h),_,D,j,P=-1,B=!1,U=null,O;if(Pu.lastIndex=0,d.m3u8=e,d.hasVariableRefs=vm(e),((u=Pu.exec(e))==null?void 0:u[0])!=="#EXTM3U")return d.playlistParsingError=new Error("Missing format identifier #EXTM3U"),d;for(;(_=Pu.exec(e))!==null;){B&&(B=!1,w=new _u(i,h),w.playlistOffset=T,w.setStart(T),w.sn=v,w.cc=S,I&&(w.bitrate=I),w.level=n,g&&(w.initSegment=g,g.rawProgramDateTime&&(w.rawProgramDateTime=g.rawProgramDateTime,g.rawProgramDateTime=null),U&&(w.setByteRange(U),U=null)));const ue=_[1];if(ue){w.duration=parseFloat(ue);const oe=(" "+_[2]).slice(1);w.title=oe||null,w.tagList.push(oe?["INF",ue,oe]:["INF",ue])}else if(_[3]){if(le(w.duration)){w.playlistOffset=T,w.setStart(T),j&&km(w,j,d),w.sn=v,w.level=n,w.cc=S,f.push(w);const oe=(" "+_[3]).slice(1);w.relurl=sc(d,oe),oc(w,b,m),b=w,T+=w.duration,v++,x=0,B=!0}}else{if(_=_[0].match(RS),!_){Me.warn("No matches on slow regex match for level playlist!");continue}for(D=1;D<_.length&&_[D]===void 0;D++);const oe=(" "+_[D]).slice(1),ee=(" "+_[D+1]).slice(1),ie=_[D+2]?(" "+_[D+2]).slice(1):null;switch(oe){case"BYTERANGE":b?w.setByteRange(ee,b):w.setByteRange(ee);break;case"PROGRAM-DATE-TIME":w.rawProgramDateTime=ee,w.tagList.push(["PROGRAM-DATE-TIME",ee]),P===-1&&(P=f.length);break;case"PLAYLIST-TYPE":d.type&&Mn(d,oe,_),d.type=ee.toUpperCase();break;case"MEDIA-SEQUENCE":d.startSN!==0?Mn(d,oe,_):f.length>0&&Cm(d,oe,_),v=d.startSN=parseInt(ee);break;case"SKIP":{d.skippedSegments&&Mn(d,oe,_);const H=new ze(ee,d),X=H.decimalInteger("SKIPPED-SEGMENTS");if(le(X)){d.skippedSegments+=X;for(let k=X;k--;)f.push(null);v+=X}const Q=H.enumeratedString("RECENTLY-REMOVED-DATERANGES");Q&&(d.recentlyRemovedDateranges=(d.recentlyRemovedDateranges||[]).concat(Q.split("	")));break}case"TARGETDURATION":d.targetduration!==0&&Mn(d,oe,_),d.targetduration=Math.max(parseInt(ee),1);break;case"VERSION":d.version!==null&&Mn(d,oe,_),d.version=parseInt(ee);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":d.live||Mn(d,oe,_),d.live=!1;break;case"#":(ee||ie)&&w.tagList.push(ie?[ee,ie]:[ee]);break;case"DISCONTINUITY":S++,w.tagList.push(["DIS"]);break;case"GAP":w.gap=!0,w.tagList.push([oe]);break;case"BITRATE":w.tagList.push([oe,ee]),I=parseInt(ee)*1e3,le(I)?w.bitrate=I:I=0;break;case"DATERANGE":{const H=new ze(ee,d),X=new sg(H,d.dateRanges[H.ID],d.dateRangeTagCount);d.dateRangeTagCount++,X.isValid||d.skippedSegments?d.dateRanges[X.id]=X:Me.warn(`Ignoring invalid DATERANGE tag: "${ee}"`),w.tagList.push(["EXT-X-DATERANGE",ee]);break}case"DEFINE":{{const H=new ze(ee,d);"IMPORT"in H?hS(d,H,l):xm(d,H,t)}break}case"DISCONTINUITY-SEQUENCE":d.startCC!==0?Mn(d,oe,_):f.length>0&&Cm(d,oe,_),d.startCC=S=parseInt(ee);break;case"KEY":{const H=Im(ee,t,d);if(H.isSupported()){if(H.method==="NONE"){j=void 0;break}j||(j={});const X=j[H.keyFormat];X!=null&&X.matches(H)||(X&&(j=Fe({},j)),j[H.keyFormat]=H)}else Me.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${ee}"`);break}case"START":d.startTimeOffset=Rm(ee);break;case"MAP":{const H=new ze(ee,d);if(w.duration){const X=new _u(i,h);_m(X,H,n,j),g=X,w.initSegment=g,g.rawProgramDateTime&&!w.rawProgramDateTime&&(w.rawProgramDateTime=g.rawProgramDateTime)}else{const X=w.byteRangeEndOffset;if(X){const Q=w.byteRangeStartOffset;U=`${X-Q}@${Q}`}else U=null;_m(w,H,n,j),g=w,B=!0}g.cc=S;break}case"SERVER-CONTROL":{O&&Mn(d,oe,_),O=new ze(ee),d.canBlockReload=O.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=O.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&O.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=O.optionalFloat("PART-HOLD-BACK",0),d.holdBack=O.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{d.partTarget&&Mn(d,oe,_);const H=new ze(ee);d.partTarget=H.decimalFloatingPoint("PART-TARGET");break}case"PART":{let H=d.partList;H||(H=d.partList=[]);const X=x>0?H[H.length-1]:void 0,Q=x++,k=new ze(ee,d),F=new hE(k,w,h,Q,X);H.push(F),w.duration+=F.duration;break}case"PRELOAD-HINT":{const H=new ze(ee,d);d.preloadHint=H;break}case"RENDITION-REPORT":{const H=new ze(ee,d);d.renditionReports=d.renditionReports||[],d.renditionReports.push(H);break}default:Me.warn(`line parsed but not handled: ${_}`);break}}}b&&!b.relurl?(f.pop(),T-=b.duration,d.partList&&(d.fragmentHint=b)):d.partList&&(oc(w,b,m),w.cc=S,d.fragmentHint=w,j&&km(w,j,d)),d.targetduration||(d.playlistParsingError=new Error("Missing Target Duration"));const Y=f.length,ne=f[0],se=f[Y-1];if(T+=d.skippedSegments*d.targetduration,T>0&&Y&&se){d.averagetargetduration=T/Y;const ue=se.sn;d.endSN=ue!=="initSegment"?ue:0,d.live||(se.endList=!0),P>0&&(bS(f,P),ne&&m.unshift(ne))}return d.fragmentHint&&(T+=d.fragmentHint.duration),d.totalduration=T,m.length&&d.dateRangeTagCount&&ne&&cg(m,d),d.endCC=S,d}}function cg(a,e){let t=a.length;if(!t)if(e.hasProgramDateTime){const u=e.fragments[e.fragments.length-1];a.push(u),t++}else return;const n=a[t-1],i=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let u=s.length;u--;){const h=e.dateRanges[s[u]],d=h.startDate.getTime();h.tagAnchor=n.ref;for(let f=t;f--;){var l;if(((l=a[f])==null?void 0:l.sn)<e.startSN)break;const m=wS(e,d,a,f,i);if(m!==-1){h.tagAnchor=e.fragments[m].ref;break}}}}function wS(a,e,t,n,i){const s=t[n];if(s){const u=s.programDateTime;if(e>=u||n===0){var l;const h=(((l=t[n+1])==null?void 0:l.start)||i)-s.start;if(e<=u+h*1e3){const d=t[n].sn-a.startSN;if(d<0)return-1;const f=a.fragments;if(f.length>t.length){const g=(t[n+1]||f[f.length-1]).sn-a.startSN;for(let v=g;v>d;v--){const x=f[v].programDateTime;if(e>=x&&e<x+f[v].duration*1e3)return v}}return d}}}return-1}function Im(a,e,t){var n,i;const s=new ze(a,t),l=(n=s.METHOD)!=null?n:"",u=s.URI,h=s.hexadecimalInteger("IV"),d=s.KEYFORMATVERSIONS,f=(i=s.KEYFORMAT)!=null?i:"identity";u&&s.IV&&!h&&Me.error(`Invalid IV: ${s.IV}`);const m=u?An.resolve(u,e):"",g=(d||"1").split("/").map(Number).filter(Number.isFinite);return new pr(l,m,f,g,h,s.KEYID)}function Rm(a){const t=new ze(a).decimalFloatingPoint("TIME-OFFSET");return le(t)?t:null}function wm(a,e){let t=(a||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const i=t.filter(s=>bc(s,n));i.length&&(e[`${n}Codec`]=i.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>i.indexOf(s)===-1))}),e.unknownCodecs=t}function bm(a,e,t){const n=e[t];n&&(a[t]=n)}function bS(a,e){let t=a[e];for(let n=e;n--;){const i=a[n];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function oc(a,e,t){a.rawProgramDateTime?t.push(a):e!=null&&e.programDateTime&&(a.programDateTime=e.endProgramDateTime)}function _m(a,e,t,n){a.relurl=e.URI,e.BYTERANGE&&a.setByteRange(e.BYTERANGE),a.level=t,a.sn="initSegment",n&&(a.levelkeys=n),a.initSegment=null}function km(a,e,t){a.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&n.push(a)}function Mn(a,e,t){a.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Cm(a,e,t){a.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Nu(a,e){const t=e.startPTS;if(le(t)){let n=0,i;e.sn>a.sn?(n=t-a.start,i=a):(n=a.start-t,i=e),i.duration!==n&&i.setDuration(n)}else e.sn>a.sn?a.cc===e.cc&&a.minEndPTS?e.setStart(a.start+(a.minEndPTS-a.start)):e.setStart(a.start+a.duration):e.setStart(Math.max(a.start-e.duration,0))}function dg(a,e,t,n,i,s,l){n-t<=0&&(l.warn("Fragment should have a positive duration",e),n=t+e.duration,s=i+e.duration);let h=t,d=n;const f=e.startPTS,m=e.endPTS;if(le(f)){const I=Math.abs(f-t);a&&I>a.totalduration?l.warn(`media timestamps and playlist times differ by ${I}s for level ${e.level} ${a.url}`):le(e.deltaPTS)?e.deltaPTS=Math.max(I,e.deltaPTS):e.deltaPTS=I,h=Math.max(t,f),t=Math.min(t,f),i=e.startDTS!==void 0?Math.min(i,e.startDTS):i,d=Math.min(n,m),n=Math.max(n,m),s=e.endDTS!==void 0?Math.max(s,e.endDTS):s}const g=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=h,e.startDTS=i,e.endPTS=n,e.minEndPTS=d,e.endDTS=s;const v=e.sn;if(!a||v<a.startSN||v>a.endSN)return 0;let x;const T=v-a.startSN,S=a.fragments;for(S[T]=e,x=T;x>0;x--)Nu(S[x],S[x-1]);for(x=T;x<S.length-1;x++)Nu(S[x],S[x+1]);return a.fragmentHint&&Nu(S[S.length-1],a.fragmentHint),a.PTSKnown=a.alignedSliding=!0,g}function _S(a,e,t){if(a===e)return;let n=null;const i=a.fragments;for(let f=i.length-1;f>=0;f--){const m=i[f].initSegment;if(m){n=m;break}}a.fragmentHint&&delete a.fragmentHint.endPTS;let s;DS(a,e,(f,m,g,v)=>{if((!e.startCC||e.skippedSegments)&&m.cc!==f.cc){const x=f.cc-m.cc;for(let T=g;T<v.length;T++)v[T].cc+=x;e.endCC=v[v.length-1].cc}le(f.startPTS)&&le(f.endPTS)&&(m.setStart(m.startPTS=f.startPTS),m.startDTS=f.startDTS,m.maxStartPTS=f.maxStartPTS,m.endPTS=f.endPTS,m.endDTS=f.endDTS,m.minEndPTS=f.minEndPTS,m.setDuration(f.endPTS-f.startPTS),m.duration&&(s=m),e.PTSKnown=e.alignedSliding=!0),f.hasStreams&&(m.elementaryStreams=f.elementaryStreams),m.loader=f.loader,f.hasStats&&(m.stats=f.stats),f.initSegment&&(m.initSegment=f.initSegment,n=f.initSegment)});const l=e.fragments,u=e.fragmentHint?l.concat(e.fragmentHint):l;if(n&&u.forEach(f=>{var m;f&&(!f.initSegment||f.initSegment.relurl===((m=n)==null?void 0:m.relurl))&&(f.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=l.some(f=>!f),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let f=e.skippedSegments;f--;)l.shift();e.startSN=l[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=kS(a.dateRanges,e,t));const f=a.fragments.filter(m=>m.rawProgramDateTime);if(a.hasProgramDateTime&&!e.hasProgramDateTime)for(let m=1;m<u.length;m++)u[m].programDateTime===null&&oc(u[m],u[m-1],f);cg(f,e)}e.endCC=l[l.length-1].cc}if(!e.startCC){var h;const f=mg(a,e.startSN-1);e.startCC=(h=f==null?void 0:f.cc)!=null?h:l[0].cc}CS(a.partList,e.partList,(f,m)=>{m.elementaryStreams=f.elementaryStreams,m.stats=f.stats}),s?dg(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,t):hg(a,e),l.length&&(e.totalduration=e.edge-l[0].start),e.driftStartTime=a.driftStartTime,e.driftStart=a.driftStart;const d=e.advancedDateTime;if(e.advanced&&d){const f=e.edge;e.driftStart||(e.driftStartTime=d,e.driftStart=f),e.driftEndTime=d,e.driftEnd=f}else e.driftEndTime=a.driftEndTime,e.driftEnd=a.driftEnd,e.advancedDateTime=a.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=a.requestScheduled)}function kS(a,e,t){const{dateRanges:n,recentlyRemovedDateranges:i}=e,s=Fe({},a);i&&i.forEach(h=>{delete s[h]});const u=Object.keys(s).length;return u?(Object.keys(n).forEach(h=>{const d=s[h],f=new sg(n[h].attr,d);f.isValid?(s[h]=f,d||(f.tagOrder+=u)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Ue(n[h].attr)}"`)}),s):n}function CS(a,e,t){if(a&&e){let n=0;for(let i=0,s=a.length;i<=s;i++){const l=a[i],u=e[i+n];l&&u&&l.index===u.index&&l.fragment.sn===u.fragment.sn?t(l,u):n--}}}function DS(a,e,t){const n=e.skippedSegments,i=Math.max(a.startSN,e.startSN)-e.startSN,s=(a.fragmentHint?1:0)+(n?e.endSN:Math.min(a.endSN,e.endSN))-e.startSN,l=e.startSN-a.startSN,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,h=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments;for(let d=i;d<=s;d++){const f=h[l+d];let m=u[d];if(n&&!m&&f&&(m=e.fragments[d]=f),f&&m){t(f,m,d,u);const g=f.relurl,v=m.relurl;if(g&&PS(g,v)){e.playlistParsingError=Dm(`media sequence mismatch ${m.sn}:`,a,e,f,m);return}else if(f.cc!==m.cc){e.playlistParsingError=Dm(`discontinuity sequence mismatch (${f.cc}!=${m.cc})`,a,e,f,m);return}}}}function Dm(a,e,t,n,i){return new Error(`${a} ${i.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function hg(a,e,t=!0){const n=e.startSN+e.skippedSegments-a.startSN,i=a.fragments,s=n>=0;let l=0;if(s&&n<i.length)l=i[n].start;else if(s&&e.startSN===a.endSN+1)l=a.fragmentEnd;else if(s&&t)l=a.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)l=a.fragmentStart;else return;lc(e,l)}function lc(a,e){if(e){const t=a.fragments;for(let n=a.skippedSegments;n<t.length;n++)t[n].addStart(e);a.fragmentHint&&a.fragmentHint.addStart(e)}}function fg(a,e=1/0){let t=1e3*a.targetduration;if(a.updated){const n=a.fragments;if(n.length&&t*4>e){const s=n[n.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function mg(a,e,t){if(!a)return null;let n=a.fragments[e-a.startSN];return n||(n=a.fragmentHint,n&&n.sn===e)?n:e<a.startSN&&t&&t.sn===e?t:null}function Pm(a,e,t){return a?pg(a.partList,e,t):null}function pg(a,e,t){if(a)for(let n=a.length;n--;){const i=a[n];if(i.index===t&&i.fragment.sn===e)return i}return null}function gg(a){a.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(i=>{i.level=t,i.initSegment&&(i.initSegment.level=t)})})}function PS(a,e){return a!==e&&e?Nm(a)!==Nm(e):!1}function Nm(a){return a.replace(/\?[^?]*$/,"")}function ys(a,e){for(let n=0,i=a.length;n<i;n++){var t;if(((t=a[n])==null?void 0:t.cc)===e)return a[n]}return null}function NS(a,e){return!!(a&&e.startCC<a.endCC&&e.endCC>a.startCC)}function Om(a,e){const t=a.start+e;a.startPTS=t,a.setStart(t),a.endPTS=t+a.duration}function yg(a,e){const t=e.fragments;for(let n=0,i=t.length;n<i;n++)Om(t[n],a);e.fragmentHint&&Om(e.fragmentHint,a),e.alignedSliding=!0}function OS(a,e){a&&(vg(e,a),e.alignedSliding||Lo(e,a),!e.alignedSliding&&!e.skippedSegments&&hg(a,e,!1))}function vg(a,e){if(!NS(e,a))return;const t=Math.min(e.endCC,a.endCC),n=ys(e.fragments,t),i=ys(a.fragments,t);if(!n||!i)return;Me.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=n.start-i.start;yg(s,a)}function Lo(a,e){if(!a.hasProgramDateTime||!e.hasProgramDateTime)return;const t=a.fragments,n=e.fragments;if(!t.length||!n.length)return;let i,s;const l=Math.min(e.endCC,a.endCC);e.startCC<l&&a.startCC<l&&(i=ys(n,l),s=ys(t,l)),(!i||!s)&&(i=n[Math.floor(n.length/2)],s=ys(t,i.cc)||t[Math.floor(t.length/2)]);const u=i.programDateTime,h=s.programDateTime;if(!u||!h)return;const d=(h-u)/1e3-(s.start-i.start);yg(d,a)}function At(a,e,t){Pt(a,e,t),a.addEventListener(e,t)}function Pt(a,e,t){a.removeEventListener(e,t)}const MS={toString:function(a){let e="";const t=a.length;for(let n=0;n<t;n++)e+=`[${a.start(n).toFixed(3)}-${a.end(n).toFixed(3)}]`;return e}},q={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Oc extends rg{constructor(e,t,n,i,s){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=q.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:l,fragCurrent:u,media:h,mediaBuffer:d,state:f}=this,m=h?h.currentTime:0,g=Ie.bufferInfo(d||h,m,l.maxBufferHole),v=!g.len;if(this.log(`Media seeking to ${le(m)?m.toFixed(3):m}, state: ${f}, ${v?"out of":"in"} buffer`),this.state===q.ENDED)this.resetLoadingState();else if(u){const x=l.maxFragLookUpTolerance,T=u.start-x,S=u.start+u.duration+x;if(v||S<g.start||T>g.end){const I=m>S;(m<T||I)&&(I&&u.loader&&(this.log(`Cancelling fragment load for seek (sn: ${u.sn})`),u.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(h){this.fragmentTracker.removeFragmentsInRange(m,1/0,this.playlistType,!0);const x=this.lastCurrentTime;if(m>x&&(this.lastCurrentTime=m),!this.loadingParts){const T=Math.max(g.end,m),S=this.shouldLoadParts(this.getLevelDetails(),T);S&&(this.log(`LL-Part loading ON after seeking to ${m.toFixed(2)} with buffer @${T.toFixed(2)}`),this.loadingParts=S)}}this.hls.hasEnoughToStart||(this.log(`Setting ${v?"startPosition":"nextLoadPosition"} to ${m} for seek without enough to start`),this.nextLoadPosition=m,v&&(this.startPosition=m)),v&&this.state===q.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new cS(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Cc(e.config)}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===q.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=q.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,i=this.config.timelineOffset||0;if(n<=i)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=Ie.bufferedInfo(s,e.start,0));const l=e.nextStart;if(l&&l>i&&l<t.edge||this.media.currentTime<e.start)return!1;const h=t.partList;if(h!=null&&h.length){const f=h[h.length-1];return Ie.isBuffered(this.media,f.start+f.duration/2)}const d=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;At(n,"seeking",this.onMediaSeeking),At(n,"ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===q.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,i=this.media;if(i!==null){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Pt(i,"seeking",this.onMediaSeeking),Pt(i,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=q.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const i=s=>{const l=s.frag;if(this.fragContextChanged(l)){this.warn(`${l.type} sn: ${l.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(l,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(l);return}l.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,n,i).then(s=>{if(!s)return;const l=this.state,u=s.frag;if(this.fragContextChanged(u)){(l===q.FRAG_LOADING||!this.fragCurrent&&l===q.PARSING)&&(this.fragmentTracker.removeFragment(u),this.state=q.IDLE);return}"payload"in s&&(this.log(`Loaded ${u.type} sn: ${u.sn} of ${this.playlistLabel()} ${u.level}`),this.hls.trigger(L.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===q.STOPPED||this.state===q.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===at.APPENDING){const s=e.type,l=this.getFwdBufferInfo(this.mediaBuffer,s),u=Math.max(e.duration,l?l.len:this.config.maxBufferLength),h=this.backtrackFragment;((h?e.sn-h.sn:0)===1||this.reduceMaxBufferLength(u,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===at.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:n};this.hls.trigger(L.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const i=n==null?void 0:n.frag;if(!i||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:i}=this,{frag:s,payload:l}=n,u=s.decryptdata;if(l&&l.byteLength>0&&u!=null&&u.key&&u.iv&&Si(u.method)){const h=self.performance.now();return this.decrypter.decrypt(new Uint8Array(l),u.key.buffer,u.iv.buffer,Pc(u.method)).catch(d=>{throw i.trigger(L.ERROR,{type:ve.MEDIA_ERROR,details:G.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:s}),d}).then(d=>{const f=self.performance.now();return i.trigger(L.FRAG_DECRYPTED,{frag:s,payload:d,stats:{tstart:h,tdecrypt:f}}),n.payload=d,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===q.STOPPED||this.state===q.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==q.STOPPED&&(this.state=q.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,i;const s=e.tracks;if(s&&!t.encrypted&&((n=s.audio)!=null&&n.encrypted||(i=s.video)!=null&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const l=this.media,u=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${l?"attached mediaKeys: "+l.mediaKeys:"detached"})`);return this.warn(u.message),!l||l.mediaKeys?!1:(this.hls.trigger(L.ERROR,{type:ve.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_KEYS,fatal:!1,error:u,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?MS.toString(Ie.getBuffered(n)):"(detached)"})`),et(e)){var i;if(e.type!==me.SUBTITLE){const l=e.elementaryStreams;if(!Object.keys(l).some(u=>!!l[u])){this.state=q.IDLE;return}}const s=(i=this.levels)==null?void 0:i[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=q.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:i,partsLoaded:s}=e,l=!s||s.length===0||s.some(h=>!h),u=new Dc(n.level,n.sn,n.stats.chunkCount+1,0,i?i.index:-1,!l);t.flush(u)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,i){var s;this.fragCurrent=e;const l=t.details;if(!this.levels||!l)throw new Error(`frag load aborted, missing level${l?"":" detail"}s`);let u=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)){if(this.log(`Loading key for ${e.sn} of [${l.startSN}-${l.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=q.KEY_LOADING,this.fragCurrent=e,u=this.keyLoader.load(e).then(g=>{if(!this.fragContextChanged(g.frag))return this.hls.trigger(L.KEY_LOADED,g),this.state===q.KEY_LOADING&&(this.state=q.IDLE),g}),this.hls.trigger(L.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(u=this.keyLoader.loadClear(e,l.encryptedFragments,this.startFragRequested),u&&this.log("[eme] blocking frag load until media-keys acquired"));const h=this.fragPrevious;if(et(e)&&(!h||e.sn!==h.sn)){const g=this.shouldLoadParts(t.details,e.end);g!==this.loadingParts&&(this.log(`LL-Part loading ${g?"ON":"OFF"} loading sn ${h==null?void 0:h.sn}->${e.sn}`),this.loadingParts=g)}if(n=Math.max(e.start,n||0),this.loadingParts&&et(e)){const g=l.partList;if(g&&i){n>l.fragmentEnd&&l.fragmentHint&&(e=l.fragmentHint);const v=this.getNextPart(g,e,n);if(v>-1){const x=g[v];e=this.fragCurrent=x.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${x.index} (${v}/${g.length-1}) of ${this.fragInfo(e,!1,x)}) cc: ${e.cc} [${l.startSN}-${l.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=x.start+x.duration,this.state=q.FRAG_LOADING;let T;return u?T=u.then(S=>!S||this.fragContextChanged(S.frag)?null:this.doFragPartsLoad(e,x,t,i)).catch(S=>this.handleFragLoadError(S)):T=this.doFragPartsLoad(e,x,t,i).catch(S=>this.handleFragLoadError(S)),this.hls.trigger(L.FRAG_LOADING,{frag:e,part:x,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):T}else if(!e.url||this.loadedEndOfParts(g,n))return Promise.resolve(null)}}if(et(e)&&this.loadingParts){var d;this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(d=l.partList)==null?void 0:d.filter(g=>g.loaded).map(g=>`[${g.start}-${g.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+l.startSN+"-"+l.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),le(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=q.FRAG_LOADING;const f=this.config.progressive&&e.type!==me.SUBTITLE;let m;return f&&u?m=u.then(g=>!g||this.fragContextChanged(g.frag)?null:this.fragmentLoader.load(e,i)).catch(g=>this.handleFragLoadError(g)):m=Promise.all([this.fragmentLoader.load(e,f?i:void 0),u]).then(([g])=>(!f&&i&&i(g),g)).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(L.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):m}doFragPartsLoad(e,t,n,i){return new Promise((s,l)=>{var u;const h=[],d=(u=n.details)==null?void 0:u.partList,f=m=>{this.fragmentLoader.loadPart(e,m,i).then(g=>{h[m.index]=g;const v=g.part;this.hls.trigger(L.FRAG_LOADED,g);const x=Pm(n.details,e.sn,m.index+1)||pg(d,e.sn,m.index+1);if(x)f(x);else return s({frag:e,part:v,partsLoaded:h})}).catch(l)};f(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===G.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===ve.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(L.ERROR,t)}else this.hls.trigger(L.ERROR,{type:ve.OTHER_ERROR,details:G.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==q.PARSING){!this.fragCurrent&&this.state!==q.STOPPED&&this.state!==q.ERROR&&(this.state=q.IDLE);return}const{frag:n,part:i,level:s}=t,l=self.performance.now();n.stats.parsing.end=l,i&&(i.stats.parsing.end=l);const u=this.getLevelDetails(),d=u&&n.sn>u.endSN||this.shouldLoadParts(u,n.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=d),this.updateLevelTiming(n,i,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const s=e.partList[0];if(s.fragment.type===me.SUBTITLE)return!1;const l=s.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=l){var i;if((this.hls.hasEnoughToStart?((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:i,sn:s,part:l}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const u=t[i],h=u.details,d=l>-1?Pm(h,s,l):null,f=d?d.fragment:mg(h,s,n);return f?(n&&n!==f&&(f.stats=n.stats),{frag:f,part:d,level:u}):null}bufferFragmentData(e,t,n,i,s){if(this.state!==q.PARSING)return;const{data1:l,data2:u}=e;let h=l;if(u&&(h=Xt(l,u)),!h.length)return;const d=this.initPTS[t.cc],f=d?-d.baseTime/d.timescale:void 0,m={type:e.type,frag:t,part:n,chunkMeta:i,offset:f,parent:t.type,data:h};if(this.hls.trigger(L.BUFFER_APPENDING,m),e.dropped&&e.independent&&!n){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ie.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,i=Ie.bufferInfo(t,n,0),s=e.duration,l=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),u=Math.max(Math.min(e.start-l,i.end-l),n+l);e.start-u>l&&this.flushMainBuffer(u,e.start)}getFwdBufferInfo(e,t){var n;const i=this.getLoadPosition();if(!le(i))return null;const l=this.lastCurrentTime>i||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,l)}getFwdBufferInfoAtPos(e,t,n,i){const s=Ie.bufferInfo(e,t,i);if(s.len===0&&s.nextStart!==void 0){const l=this.fragmentTracker.getBufferedFrag(t,n);if(l&&(s.nextStart<=l.end||l.gap)){const u=Math.max(Math.min(s.nextStart,l.end)-t,i);return Ie.bufferInfo(e,t,u)}}return s}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,i=Math.max(Math.min(e-t,n.maxBufferLength),t),s=Math.max(e-t*3,n.maxMaxBufferLength/2,i);return s>=i?(n.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=me.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,i=n.length;if(!i)return null;const{config:s}=this,l=n[0].start,u=s.lowLatencyMode&&!!t.partList;let h=null;if(t.live){const m=s.initialLiveManifestSize;if(i<m)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${m})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<l){var d;u&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),h=this.getInitialLiveFragment(t);const g=this.hls.startPosition,v=this.hls.liveSyncPosition,x=h?(g!==-1&&g>=l?g:v)||h.start:e;this.log(`Setting startPosition to ${x} to match start frag at live edge. mainStart: ${g} liveSyncPosition: ${v} frag.start: ${(d=h)==null?void 0:d.start}`),this.startPosition=this.nextLoadPosition=x}}else e<=l&&(h=n[0]);if(!h){const m=this.loadingParts?t.partEnd:t.fragmentEnd;h=this.getFragmentAtPosition(e,m,t)}let f=this.filterReplacedPrimary(h,t);if(!f&&h){const m=h.sn-t.startSN;f=this.filterReplacedPrimary(n[m+1]||null,t)}return this.mapToInitFragWhenRequired(f)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===at.OK||n===at.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,i,s){let l=null;if(e.gap&&(l=this.getNextFragment(this.nextLoadPosition,t),l&&!l.gap&&n.nextStart)){const u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,i,0);if(u!==null&&n.len+u.len>=s){const h=l.sn;return this.loopSn!==h&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${h}`),this.loopSn=h),null}}return this.loopSn=void 0,l}get primaryPrefetch(){if(Mm(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Mm(this.config)&&e.type!==me.SUBTITLE){const n=this.hls.interstitialsManager,i=n==null?void 0:n.bufferingItem;if(i){const l=i.event;if(l){if(l.appendInPlace||Math.abs(e.start-i.start)>1||i.start===0)return null}else if(e.end<=i.start&&(t==null?void 0:t.live)===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const s=n==null?void 0:n.playerQueue;if(s)for(let l=s.length;l--;){const u=s[l].interstitial;if(u.appendInPlace&&e.start>=u.startTime&&e.end<=u.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let i=-1,s=!1,l=!0;for(let u=0,h=e.length;u<h;u++){const d=e[u];if(l=l&&!d.independent,i>-1&&n<d.start)break;const f=d.loaded;f?i=-1:(s||(d.independent||l)&&d.fragment===t)&&(d.fragment!==t&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${d.start}`),i=u),s=f}return i}loadedEndOfParts(e,t){let n;for(let i=e.length;i--;){if(n=e[i],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let i=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),i=JE(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const s=n.sn+1;if(s>=e.startSN&&s<=e.endSN){const l=t[s-e.startSN];n.cc===l.cc&&(i=l,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=eg(e,n.cc,n.end),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,n){const{config:i}=this;let{fragPrevious:s}=this,{fragments:l,endSN:u}=n;const{fragmentHint:h}=n,{maxFragLookUpTolerance:d}=i,f=n.partList,m=!!(this.loadingParts&&f!=null&&f.length&&h);m&&!this.bitrateTest&&f[f.length-1].fragment.sn===h.sn&&(l=l.concat(h),u=h.sn);let g;if(e<t){var v;const T=e<this.lastCurrentTime||e>t-d||(v=this.media)!=null&&v.paused||!this.startFragRequested?0:d;g=Fr(s,l,e,T)}else g=l[l.length-1];if(g){const x=g.sn-n.startSN,T=this.fragmentTracker.getState(g);if((T===at.OK||T===at.PARTIAL&&g.gap)&&(s=g),s&&g.sn===s.sn&&(!m||f[0].fragment.sn>g.sn||!n.live)&&g.level===s.level){const I=l[x+1];g.sn<u&&this.fragmentTracker.getState(I)!==at.OK?g=I:g=null}}return g}alignPlaylists(e,t,n){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,l=!t,u=e.alignedSliding&&le(s);if(l||!u&&!s){OS(n,e);const h=e.fragmentStart;return this.log(`Live playlist sliding: ${h.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),h}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const i=this.timelineOffset;if(n===-1){const s=this.startTimeOffset!==null,l=s?this.startTimeOffset:e.startTimeOffset;l!==null&&le(l)?(n=t+l,l<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${l} found in ${s?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+i}this.nextLoadPosition=n+i}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&et(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==q.FRAG_LOADING_WAITING_RETRY)&&(this.state=q.IDLE)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const I=this.getCurrentContext(t.chunkMeta);I&&(t.frag=I.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var s;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const l=t.details===G.FRAG_GAP;l&&this.fragmentTracker.fragBuffered(i,!0);const u=t.errorAction;if(!u){this.state=q.ERROR;return}const{action:h,flags:d,retryCount:f=0,retryConfig:m}=u,g=!!m,v=g&&h===mt.RetryRequest,x=g&&!u.resolved&&d===$t.MoveAllAlternatesMatchingHost,T=(n=this.hls.latestLevelDetails)==null?void 0:n.live;if(!v&&x&&et(i)&&!i.endList&&T&&!ng(t))this.resetFragmentErrors(e),this.treatAsGap(i),u.resolved=!0;else if((v||x)&&f<m.maxNumRetry){var S;const I=ic((S=t.response)==null?void 0:S.code),b=kc(m,f);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+b,this.state=q.FRAG_LOADING_WAITING_RETRY,u.resolved=!0,I){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${f+1}/${m.maxNumRetry} in ${b}ms`)}else if(m)if(this.resetFragmentErrors(e),f<m.maxNumRetry)!l&&h!==mt.RemoveAlternatePermanently&&(u.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${f})`);return}else h===mt.SendAlternateToPenaltyBox?this.state=q.WAITING_LEVEL:this.state=q.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!ic(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=q.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===q.PARSING||this.state===q.PARSED){const t=e.frag,n=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,n),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len,(t==null?void 0:t.duration)||10);const l=!s;return l&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),l}return!1}resetFragmentErrors(e){e===me.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==q.STOPPED&&(this.state=q.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const i=Ie.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,n),this.state===q.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==q.STOPPED&&(this.state=q.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,i){const s=n.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((h,d)=>{const f=e.elementaryStreams[d];if(f){const m=f.endPTS-f.startPTS;if(m<=0)return this.warn(`Could not parse fragment ${e.sn} ${d} duration reliably (${m})`),h||!1;const g=i?0:dg(s,e,f.startPTS,f.endPTS,f.startDTS,f.endDTS,this);return this.hls.trigger(L.LEVEL_PTS_UPDATED,{details:s,level:n,drift:g,type:d,frag:e,start:f.startPTS,end:f.endPTS}),!0}return h},!1)){var u;const h=((u=this.transmuxer)==null?void 0:u.error)===null;if((n.fragmentError===0||h&&(n.fragmentError<2||e.endList))&&this.treatAsGap(e,n),h){const d=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(d.message),this.hls.trigger(L.ERROR,{type:ve.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=q.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(L.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===me.MAIN?"level":"track"}fragInfo(e,t=!0,n){var i,s;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((i=t&&!n?e.startPTS:(n||e).start)!=null?i:NaN).toFixed(3)}-${((s=t&&!n?e.endPTS:(n||e).end)!=null?s:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Mm(a){return!!a.interstitialsController&&a.enableInterstitialPlayback!==!1}class xg{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=FS(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function FS(a,e){const t=new Uint8Array(e);let n=0;for(let i=0;i<a.length;i++){const s=a[i];t.set(s,n),n+=s.length}return t}var Ou={exports:{}},Fm;function BS(){return Fm||(Fm=1,(function(a){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(h,d,f){this.fn=h,this.context=d,this.once=f||!1}function s(h,d,f,m,g){if(typeof f!="function")throw new TypeError("The listener must be a function");var v=new i(f,m||h,g),x=t?t+d:d;return h._events[x]?h._events[x].fn?h._events[x]=[h._events[x],v]:h._events[x].push(v):(h._events[x]=v,h._eventsCount++),h}function l(h,d){--h._eventsCount===0?h._events=new n:delete h._events[d]}function u(){this._events=new n,this._eventsCount=0}u.prototype.eventNames=function(){var d=[],f,m;if(this._eventsCount===0)return d;for(m in f=this._events)e.call(f,m)&&d.push(t?m.slice(1):m);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(f)):d},u.prototype.listeners=function(d){var f=t?t+d:d,m=this._events[f];if(!m)return[];if(m.fn)return[m.fn];for(var g=0,v=m.length,x=new Array(v);g<v;g++)x[g]=m[g].fn;return x},u.prototype.listenerCount=function(d){var f=t?t+d:d,m=this._events[f];return m?m.fn?1:m.length:0},u.prototype.emit=function(d,f,m,g,v,x){var T=t?t+d:d;if(!this._events[T])return!1;var S=this._events[T],I=arguments.length,b,w;if(S.fn){switch(S.once&&this.removeListener(d,S.fn,void 0,!0),I){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,f),!0;case 3:return S.fn.call(S.context,f,m),!0;case 4:return S.fn.call(S.context,f,m,g),!0;case 5:return S.fn.call(S.context,f,m,g,v),!0;case 6:return S.fn.call(S.context,f,m,g,v,x),!0}for(w=1,b=new Array(I-1);w<I;w++)b[w-1]=arguments[w];S.fn.apply(S.context,b)}else{var _=S.length,D;for(w=0;w<_;w++)switch(S[w].once&&this.removeListener(d,S[w].fn,void 0,!0),I){case 1:S[w].fn.call(S[w].context);break;case 2:S[w].fn.call(S[w].context,f);break;case 3:S[w].fn.call(S[w].context,f,m);break;case 4:S[w].fn.call(S[w].context,f,m,g);break;default:if(!b)for(D=1,b=new Array(I-1);D<I;D++)b[D-1]=arguments[D];S[w].fn.apply(S[w].context,b)}}return!0},u.prototype.on=function(d,f,m){return s(this,d,f,m,!1)},u.prototype.once=function(d,f,m){return s(this,d,f,m,!0)},u.prototype.removeListener=function(d,f,m,g){var v=t?t+d:d;if(!this._events[v])return this;if(!f)return l(this,v),this;var x=this._events[v];if(x.fn)x.fn===f&&(!g||x.once)&&(!m||x.context===m)&&l(this,v);else{for(var T=0,S=[],I=x.length;T<I;T++)(x[T].fn!==f||g&&!x[T].once||m&&x[T].context!==m)&&S.push(x[T]);S.length?this._events[v]=S.length===1?S[0]:S:l(this,v)}return this},u.prototype.removeAllListeners=function(d){var f;return d?(f=t?t+d:d,this._events[f]&&l(this,f)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,a.exports=u})(Ou)),Ou.exports}var US=BS(),Mc=cE(US);const As="1.6.15",Ii={};function $S(){return typeof __HLS_WORKER_BUNDLE__=="function"}function jS(){const a=Ii[As];if(a)return a.clientCount++,a;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),i={worker:new self.Worker(t),objectURL:t,clientCount:1};return Ii[As]=i,i}function GS(a){const e=Ii[a];if(e)return e.clientCount++,e;const t=new self.URL(a,self.location.href).href,i={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Ii[a]=i,i}function VS(a){const e=Ii[a||As];if(e&&e.clientCount--===1){const{worker:n,objectURL:i}=e;delete Ii[a||As],i&&self.URL.revokeObjectURL(i),n.terminate()}}function Eg(a,e){return e+10<=a.length&&a[e]===51&&a[e+1]===68&&a[e+2]===73&&a[e+3]<255&&a[e+4]<255&&a[e+6]<128&&a[e+7]<128&&a[e+8]<128&&a[e+9]<128}function Fc(a,e){return e+10<=a.length&&a[e]===73&&a[e+1]===68&&a[e+2]===51&&a[e+3]<255&&a[e+4]<255&&a[e+6]<128&&a[e+7]<128&&a[e+8]<128&&a[e+9]<128}function _o(a,e){let t=0;return t=(a[e]&127)<<21,t|=(a[e+1]&127)<<14,t|=(a[e+2]&127)<<7,t|=a[e+3]&127,t}function Is(a,e){const t=e;let n=0;for(;Fc(a,e);){n+=10;const i=_o(a,e+6);n+=i,Eg(a,e+10)&&(n+=10),e+=n}if(n>0)return a.subarray(t,t+n)}function KS(a,e,t,n){const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],l=s>>2&15;if(l>12){const v=new Error(`invalid ADTS sampling index:${l}`);a.emit(L.ERROR,L.ERROR,{type:ve.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,fatal:!0,error:v,reason:v.message});return}const u=(s>>6&3)+1,h=e[t+3]>>6&3|(s&1)<<2,d="mp4a.40."+u,f=i[l];let m=l;(u===5||u===29)&&(m-=3);const g=[u<<3|(m&14)>>1,(m&1)<<7|h<<3];return Me.log(`manifest codec:${n}, parsed codec:${d}, channels:${h}, rate:${f} (ADTS object type:${u} sampling index:${l})`),{config:g,samplerate:f,channelCount:h,codec:d,parsedCodec:d,manifestCodec:n}}function Sg(a,e){return a[e]===255&&(a[e+1]&246)===240}function Tg(a,e){return a[e+1]&1?7:9}function Bc(a,e){return(a[e+3]&3)<<11|a[e+4]<<3|(a[e+5]&224)>>>5}function HS(a,e){return e+5<a.length}function Ao(a,e){return e+1<a.length&&Sg(a,e)}function WS(a,e){return HS(a,e)&&Sg(a,e)&&Bc(a,e)<=a.length-e}function zS(a,e){if(Ao(a,e)){const t=Tg(a,e);if(e+t>=a.length)return!1;const n=Bc(a,e);if(n<=t)return!1;const i=e+n;return i===a.length||Ao(a,i)}return!1}function Lg(a,e,t,n,i){if(!a.samplerate){const s=KS(e,t,n,i);if(!s)return;Fe(a,s)}}function Ag(a){return 1024*9e4/a}function YS(a,e){const t=Tg(a,e);if(e+t<=a.length){const n=Bc(a,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function Ig(a,e,t,n,i){const s=Ag(a.samplerate),l=n+i*s,u=YS(e,t);let h;if(u){const{frameLength:m,headerLength:g}=u,v=g+m,x=Math.max(0,t+v-e.length);x?(h=new Uint8Array(v-g),h.set(e.subarray(t+g,e.length),0)):h=e.subarray(t+g,t+v);const T={unit:h,pts:l};return x||a.samples.push(T),{sample:T,length:v,missing:x}}const d=e.length-t;return h=new Uint8Array(d),h.set(e.subarray(t,e.length),0),{sample:{unit:h,pts:l},length:d,missing:-1}}function qS(a,e){return Fc(a,e)&&_o(a,e+6)+10<=a.length-e}function QS(a){return a instanceof ArrayBuffer?a:a.byteOffset==0&&a.byteLength==a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer}function Mu(a,e=0,t=1/0){return XS(a,e,t,Uint8Array)}function XS(a,e,t,n){const i=JS(a);let s=1;"BYTES_PER_ELEMENT"in n&&(s=n.BYTES_PER_ELEMENT);const l=ZS(a)?a.byteOffset:0,u=(l+a.byteLength)/s,h=(l+e)/s,d=Math.floor(Math.max(0,Math.min(h,u))),f=Math.floor(Math.min(d+Math.max(t,0),u));return new n(i,d,f-d)}function JS(a){return a instanceof ArrayBuffer?a:a.buffer}function ZS(a){return a&&a.buffer instanceof ArrayBuffer&&a.byteLength!==void 0&&a.byteOffset!==void 0}function eT(a){const e={key:a.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(a.size<2)return;if(a.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=a.data.subarray(1).indexOf(0);if(n===-1)return;const i=Vt(Mu(a.data,1,n)),s=a.data[2+n],l=a.data.subarray(3+n).indexOf(0);if(l===-1)return;const u=Vt(Mu(a.data,3+n,l));let h;return i==="-->"?h=Vt(Mu(a.data,4+n+l)):h=QS(a.data.subarray(4+n+l)),e.mimeType=i,e.pictureType=s,e.description=u,e.data=h,e}function tT(a){if(a.size<2)return;const e=Vt(a.data,!0),t=new Uint8Array(a.data.subarray(e.length+1));return{key:a.type,info:e,data:t.buffer}}function nT(a){if(a.size<2)return;if(a.type==="TXXX"){let t=1;const n=Vt(a.data.subarray(t),!0);t+=n.length+1;const i=Vt(a.data.subarray(t));return{key:a.type,info:n,data:i}}const e=Vt(a.data.subarray(1));return{key:a.type,info:"",data:e}}function rT(a){if(a.type==="WXXX"){if(a.size<2)return;let t=1;const n=Vt(a.data.subarray(t),!0);t+=n.length+1;const i=Vt(a.data.subarray(t));return{key:a.type,info:n,data:i}}const e=Vt(a.data);return{key:a.type,info:"",data:e}}function iT(a){return a.type==="PRIV"?tT(a):a.type[0]==="W"?rT(a):a.type==="APIC"?eT(a):nT(a)}function sT(a){const e=String.fromCharCode(a[0],a[1],a[2],a[3]),t=_o(a,4),n=10;return{type:e,size:t,data:a.subarray(n,n+t)}}const Wa=10,aT=10;function Rg(a){let e=0;const t=[];for(;Fc(a,e);){const n=_o(a,e+6);a[e+5]>>6&1&&(e+=Wa),e+=Wa;const i=e+n;for(;e+aT<i;){const s=sT(a.subarray(e)),l=iT(s);l&&t.push(l),e+=s.size+Wa}Eg(a,e)&&(e+=Wa)}return t}function wg(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"}function oT(a){if(a.data.byteLength===8){const e=new Uint8Array(a.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function Uc(a){const e=Rg(a);for(let t=0;t<e.length;t++){const n=e[t];if(wg(n))return oT(n)}}let Gt=(function(a){return a.audioId3="org.id3",a.dateRange="com.apple.quicktime.HLS",a.emsg="https://aomedia.org/emsg/ID3",a.misbklv="urn:misb:KLV:bin:1910.1",a})({});function Tn(a="",e=9e4){return{type:a,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class $c{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=Xt(this.cachedData,e),this.cachedData=null);let n=Is(e,0),i=n?n.length:0,s;const l=this._audioTrack,u=this._id3Track,h=n?Uc(n):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&le(h))&&(this.basePTS=lT(h,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Gt.audioId3,duration:Number.POSITIVE_INFINITY});i<d;){if(this.canParse(e,i)){const f=this.appendFrame(l,e,i);f?(this.frameIndex++,this.lastPTS=f.sample.pts,i+=f.length,s=i):i=d}else qS(e,i)?(n=Is(e,i),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Gt.audioId3,duration:Number.POSITIVE_INFINITY}),i+=n.length,s=i):i++;if(i===d&&s!==d){const f=e.slice(s);this.cachedData?this.cachedData=Xt(this.cachedData,f):this.cachedData=f}}return{audioTrack:l,videoTrack:Tn(),id3Track:u,textTrack:Tn()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Tn(),id3Track:this._id3Track,textTrack:Tn()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const lT=(a,e,t)=>{if(le(a))return a*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let za=null;const uT=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],cT=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],dT=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],hT=[0,1,1,4];function bg(a,e,t,n,i){if(t+24>e.length)return;const s=_g(e,t);if(s&&t+s.frameLength<=e.length){const l=s.samplesPerFrame*9e4/s.sampleRate,u=n+i*l,h={unit:e.subarray(t,t+s.frameLength),pts:u,dts:u};return a.config=[],a.channelCount=s.channelCount,a.samplerate=s.sampleRate,a.samples.push(h),{sample:h,length:s.frameLength,missing:0}}}function _g(a,e){const t=a[e+1]>>3&3,n=a[e+1]>>1&3,i=a[e+2]>>4&15,s=a[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&s!==3){const l=a[e+2]>>1&1,u=a[e+3]>>6,h=t===3?3-n:n===3?3:4,d=uT[h*14+i-1]*1e3,m=cT[(t===3?0:t===2?1:2)*3+s],g=u===3?1:2,v=dT[t][n],x=hT[n],T=v*8*x,S=Math.floor(v*d/m+l)*x;if(za===null){const w=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);za=w?parseInt(w[1]):0}return!!za&&za<=87&&n===2&&d>=224e3&&u===0&&(a[e+3]=a[e+3]|128),{sampleRate:m,channelCount:g,frameLength:S,samplesPerFrame:T}}}function jc(a,e){return a[e]===255&&(a[e+1]&224)===224&&(a[e+1]&6)!==0}function kg(a,e){return e+1<a.length&&jc(a,e)}function fT(a,e){return jc(a,e)&&4<=a.length-e}function Cg(a,e){if(e+1<a.length&&jc(a,e)){const n=_g(a,e);let i=4;n!=null&&n.frameLength&&(i=n.frameLength);const s=e+i;return s===a.length||kg(a,s)}return!1}class mT extends $c{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=Is(e,0);let i=(n==null?void 0:n.length)||0;if(Cg(e,i))return!1;for(let s=e.length;i<s;i++)if(zS(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return WS(e,t)}appendFrame(e,t,n){Lg(e,this.observer,t,n,e.manifestCodec);const i=Ig(e,t,n,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const Dg=(a,e)=>{let t=0,n=5;e+=n;const i=new Uint32Array(1),s=new Uint32Array(1),l=new Uint8Array(1);for(;n>0;){l[0]=a[e];const u=Math.min(n,8),h=8-u;s[0]=4278190080>>>24+h<<h,i[0]=(l[0]&s[0])>>h,t=t?t<<u|i[0]:i[0],e+=1,n-=u}return t};class pT extends $c{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const i=Pg(e,t,n,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=Is(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&Uc(t)!==void 0&&Dg(e,n)<16}}function Pg(a,e,t,n,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const u=[48e3,44100,32e3][s],h=e[t+4]&63,f=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][h*3+s]*2;if(t+f>e.length)return-1;const m=e[t+6]>>5;let g=0;m===2?g+=2:(m&1&&m!==1&&(g+=2),m&4&&(g+=2));const v=(e[t+6]<<8|e[t+7])>>12-g&1,T=[2,1,2,3,3,4,4,5][m]+v,S=e[t+5]>>3,I=e[t+5]&7,b=new Uint8Array([s<<6|S<<1|I>>2,(I&3)<<6|m<<3|v<<2|h>>4,h<<4&224]),w=1536/u*9e4,_=n+i*w,D=e.subarray(t,t+f);return a.config=b,a.channelCount=T,a.samplerate=u,a.samples.push({unit:D,pts:_}),f}class gT extends $c{resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Is(e,0);let n=(t==null?void 0:t.length)||0;if(t&&e[n]===11&&e[n+1]===119&&Uc(t)!==void 0&&Dg(e,n)<=16)return!1;for(let i=e.length;n<i;n++)if(Cg(e,n))return Me.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return fT(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return bg(e,t,n,this.basePTS,this.frameIndex)}}const yT=/\/emsg[-/]ID3/i;class vT{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,i){const s=this.videoTrack=Tn("video",1),l=this.audioTrack=Tn("audio",1),u=this.txtTrack=Tn("text",1);if(this.id3Track=Tn("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const h=Vp(e);if(h.video){const{id:d,timescale:f,codec:m,supplemental:g}=h.video;s.id=d,s.timescale=u.timescale=f,s.codec=m,s.supplemental=g}if(h.audio){const{id:d,timescale:f,codec:m}=h.audio;l.id=d,l.timescale=f,l.codec=m}u.id=$p.text,s.sampleDuration=0,s.duration=l.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return pE(e)}demux(e,t){this.timeOffset=t;let n=e;const i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=Xt(this.remainderData,e));const u=TE(n);this.remainderData=u.remainder,i.samples=u.valid||new Uint8Array}else i.samples=n;const l=this.extractID3Track(i,t);return s.samples=tm(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return n.samples=tm(e,t),{videoTrack:t,audioTrack:Tn(),id3Track:i,textTrack:Tn()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const i=we(e.samples,["emsg"]);i&&i.forEach(s=>{const l=AE(s);if(yT.test(l.schemeIdUri)){const u=Bm(l,t);let h=l.eventDuration===4294967295?Number.POSITIVE_INFINITY:l.eventDuration/l.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);const d=l.payload;n.samples.push({data:d,len:d.byteLength,dts:u,pts:u,type:Gt.emsg,duration:h})}else if(this.config.enableEmsgKLVMetadata&&l.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const u=Bm(l,t);n.samples.push({data:l.payload,len:l.payload.byteLength,dts:u,pts:u,type:Gt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Bm(a,e){return le(a.presentationTime)?a.presentationTime/a.timeScale:e+a.presentationTimeDelta/a.timeScale}class xT{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Cc(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,yr.cbc)}decryptAacSample(e,t,n){const i=e[t].unit;if(i.length<=16)return;const s=i.subarray(16,i.length-i.length%16),l=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(l).then(u=>{const h=new Uint8Array(u);i.set(h,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)n.set(e.subarray(s,s+16),i);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)e.set(n.subarray(i,i+16),s);return e}decryptAvcSample(e,t,n,i,s){const l=Wp(s.data),u=this.getAvcEncryptedData(l);this.decryptBuffer(u.buffer).then(h=>{s.data=this.getAvcDecryptedUnit(l,h),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,i)}).catch(i)}decryptAvcSamples(e,t,n,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){i();return}const s=e[t].units;for(;!(n>=s.length);n++){const l=s[n];if(!(l.data.length<=48||l.type!==1&&l.type!==5)&&(this.decryptAvcSample(e,t,n,i,l),!this.decrypter.isSync()))return}}}}class Ng{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,i;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const s=n.units;i=s[s.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,i=n.length;if(i){const s=n[i-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const i=t.byteLength;let s=e.naluState||0;const l=s,u=[];let h=0,d,f,m,g=-1,v=0;for(s===-1&&(g=0,v=this.getNALuType(t,0),s=0,h=1);h<i;){if(d=t[h++],!s){s=d?0:1;continue}if(s===1){s=d?0:2;continue}if(!d)s=3;else if(d===1){if(f=h-s-1,g>=0){const x={data:t.subarray(g,f),type:v};u.push(x)}else{const x=this.getLastNalUnit(e.samples);x&&(l&&h<=4-l&&x.state&&(x.data=x.data.subarray(0,x.data.byteLength-l)),f>0&&(x.data=Xt(x.data,t.subarray(0,f)),x.state=0))}h<i?(m=this.getNALuType(t,h),g=h,v=m,s=0):s=-1}else s=0}if(g>=0&&s>=0){const x={data:t.subarray(g,i),type:v,state:s};u.push(x)}if(u.length===0){const x=this.getLastNalUnit(e.samples);x&&(x.data=Xt(x.data,t))}return e.naluState=s,u}}class vs{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");i.set(e.subarray(n,n+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&Me.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class ET extends Ng{parsePES(e,t,n,i){const s=this.parseNALu(e,n.data,i);let l=this.VideoSample,u,h=!1;n.data=null,l&&s.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(d=>{var f,m;switch(d.type){case 1:{let T=!1;u=!0;const S=d.data;if(h&&S.length>4){const I=this.readSliceType(S);(I===2||I===4||I===7||I===9)&&(T=!0)}if(T){var g;(g=l)!=null&&g.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),l.frame=!0,l.key=T;break}case 5:u=!0,(f=l)!=null&&f.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),l.key=!0,l.frame=!0;break;case 6:{u=!0,wc(d.data,1,n.pts,t.samples);break}case 7:{var v,x;u=!0,h=!0;const T=d.data,S=this.readSPS(T);if(!e.sps||e.width!==S.width||e.height!==S.height||((v=e.pixelRatio)==null?void 0:v[0])!==S.pixelRatio[0]||((x=e.pixelRatio)==null?void 0:x[1])!==S.pixelRatio[1]){e.width=S.width,e.height=S.height,e.pixelRatio=S.pixelRatio,e.sps=[T];const I=T.subarray(1,4);let b="avc1.";for(let w=0;w<3;w++){let _=I[w].toString(16);_.length<2&&(_="0"+_),b+=_}e.codec=b}break}case 8:u=!0,e.pps=[d.data];break;case 9:u=!0,e.audFound=!0,(m=l)!=null&&m.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:u=!0;break;default:u=!1;break}l&&u&&l.units.push(d)}),i&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new vs(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,i=8,s;for(let l=0;l<e;l++)i!==0&&(s=t.readEG(),i=(n+s+256)%256),n=i===0?n:i}readSPS(e){const t=new vs(e);let n=0,i=0,s=0,l=0,u,h,d;const f=t.readUByte.bind(t),m=t.readBits.bind(t),g=t.readUEG.bind(t),v=t.readBoolean.bind(t),x=t.skipBits.bind(t),T=t.skipEG.bind(t),S=t.skipUEG.bind(t),I=this.skipScalingList.bind(this);f();const b=f();if(m(5),x(3),f(),S(),b===100||b===110||b===122||b===244||b===44||b===83||b===86||b===118||b===128){const B=g();if(B===3&&x(1),S(),S(),x(1),v())for(h=B!==3?8:12,d=0;d<h;d++)v()&&(d<6?I(16,t):I(64,t))}S();const w=g();if(w===0)g();else if(w===1)for(x(1),T(),T(),u=g(),d=0;d<u;d++)T();S(),x(1);const _=g(),D=g(),j=m(1);j===0&&x(1),x(1),v()&&(n=g(),i=g(),s=g(),l=g());let P=[1,1];if(v()&&v())switch(f()){case 1:P=[1,1];break;case 2:P=[12,11];break;case 3:P=[10,11];break;case 4:P=[16,11];break;case 5:P=[40,33];break;case 6:P=[24,11];break;case 7:P=[20,11];break;case 8:P=[32,11];break;case 9:P=[80,33];break;case 10:P=[18,11];break;case 11:P=[15,11];break;case 12:P=[64,33];break;case 13:P=[160,99];break;case 14:P=[4,3];break;case 15:P=[3,2];break;case 16:P=[2,1];break;case 255:{P=[f()<<8|f(),f()<<8|f()];break}}return{width:Math.ceil((_+1)*16-n*2-i*2),height:(2-j)*(D+1)*16-(j?2:4)*(s+l),pixelRatio:P}}}class ST extends Ng{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,i){const s=this.parseNALu(e,n.data,i);let l=this.VideoSample,u,h=!1;n.data=null,l&&s.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(d=>{var f,m;switch(d.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:l||(l=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),l.frame=!0,u=!0;break;case 16:case 17:case 18:case 21:if(u=!0,h){var g;(g=l)!=null&&g.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),l.key=!0,l.frame=!0;break;case 19:case 20:u=!0,(f=l)!=null&&f.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),l.key=!0,l.frame=!0;break;case 39:u=!0,wc(d.data,2,n.pts,t.samples);break;case 32:u=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Fe(e.params,this.readVPS(d.data)),this.initVPS=d.data),e.vps=[d.data];break;case 33:if(u=!0,h=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],d.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const v=this.readSPS(d.data);e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.codec=v.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const x in v.params)e.params[x]=v.params[x]}this.pushParameterSet(e.sps,d.data,e.vps),l||(l=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),l.key=!0;break;case 34:if(u=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const v=this.readPPS(d.data);for(const x in v)e.params[x]=v[x]}this.pushParameterSet(e.pps,d.data,e.vps)}break;case 35:u=!0,e.audFound=!0,(m=l)!=null&&m.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:u=!1;break}l&&u&&l.units.push(d)}),i&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let i=0;i<e.byteLength;i++)i>=2&&e[i]===3&&e[i-1]===0&&e[i-2]===0||(t[n]=e[i],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new vs(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),i=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:i}}readSPS(e){const t=new vs(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const i=t.readBits(2),s=t.readBoolean(),l=t.readBits(5),u=t.readUByte(),h=t.readUByte(),d=t.readUByte(),f=t.readUByte(),m=t.readUByte(),g=t.readUByte(),v=t.readUByte(),x=t.readUByte(),T=t.readUByte(),S=t.readUByte(),I=t.readUByte(),b=[],w=[];for(let Ce=0;Ce<n;Ce++)b.push(t.readBoolean()),w.push(t.readBoolean());if(n>0)for(let Ce=n;Ce<8;Ce++)t.readBits(2);for(let Ce=0;Ce<n;Ce++)b[Ce]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),w[Ce]&&t.readUByte();t.readUEG();const _=t.readUEG();_==3&&t.skipBits(1);const D=t.readUEG(),j=t.readUEG(),P=t.readBoolean();let B=0,U=0,O=0,Y=0;P&&(B+=t.readUEG(),U+=t.readUEG(),O+=t.readUEG(),Y+=t.readUEG());const ne=t.readUEG(),se=t.readUEG(),ue=t.readUEG(),oe=t.readBoolean();for(let Ce=oe?0:n;Ce<=n;Ce++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let tt=0;tt<4;tt++)for(let St=0;St<(tt===3?2:6);St++)if(!t.readBoolean())t.readUEG();else{const dt=Math.min(64,1<<4+(tt<<1));tt>1&&t.readEG();for(let Nt=0;Nt<dt;Nt++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const H=t.readUEG();let X=0;for(let Ce=0;Ce<H;Ce++){let tt=!1;if(Ce!==0&&(tt=t.readBoolean()),tt){Ce===H&&t.readUEG(),t.readBoolean(),t.readUEG();let St=0;for(let en=0;en<=X;en++){const dt=t.readBoolean();let Nt=!1;dt||(Nt=t.readBoolean()),(dt||Nt)&&St++}X=St}else{const St=t.readUEG(),en=t.readUEG();X=St+en;for(let dt=0;dt<St;dt++)t.readUEG(),t.readBoolean();for(let dt=0;dt<en;dt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ce=t.readUEG();for(let tt=0;tt<Ce;tt++){for(let St=0;St<ue+4;St++)t.readBits(1);t.readBits(1)}}let k=0,F=1,ae=1,he=!0,ce=1,fe=0;t.readBoolean(),t.readBoolean();let Re=!1;if(t.readBoolean()){if(t.readBoolean()){const tn=t.readUByte(),bi=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],xr=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];tn>0&&tn<16?(F=bi[tn-1],ae=xr[tn-1]):tn===255&&(F=t.readBits(16),ae=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Re=t.readBoolean(),Re&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ce=t.readBits(32),fe=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const xr=t.readBoolean(),_i=t.readBoolean();let Kn=!1;(xr||_i)&&(Kn=t.readBoolean(),Kn&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Kn&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Ur=0;Ur<=n;Ur++){he=t.readBoolean();const $r=he||t.readBoolean();let ki=!1;$r?t.readEG():ki=t.readBoolean();const Hn=ki?1:t.readUEG()+1;if(xr)for(let nn=0;nn<Hn;nn++)t.readUEG(),t.readUEG(),Kn&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(_i)for(let nn=0;nn<Hn;nn++)t.readUEG(),t.readUEG(),Kn&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),k=t.readUEG())}let ke=D,Ve=j;if(P){let Ce=1,tt=1;_===1?Ce=tt=2:_==2&&(Ce=2),ke=D-Ce*U-Ce*B,Ve=j-tt*Y-tt*O}const Kt=i?["A","B","C"][i]:"",Ds=u<<24|h<<16|d<<8|f;let Vn=0;for(let Ce=0;Ce<32;Ce++)Vn=(Vn|(Ds>>Ce&1)<<31-Ce)>>>0;let vr=Vn.toString(16);return l===1&&vr==="2"&&(vr="6"),{codecString:`hvc1.${Kt}${l}.${vr}.${s?"H":"L"}${I}.B0`,params:{general_tier_flag:s,general_profile_idc:l,general_profile_space:i,general_profile_compatibility_flags:[u,h,d,f],general_constraint_indicator_flags:[m,g,v,x,T,S],general_level_idc:I,bit_depth:ne+8,bit_depth_luma_minus8:ne,bit_depth_chroma_minus8:se,min_spatial_segmentation_idc:k,chroma_format_idc:_,frame_rate:{fixed:he,fps:fe/ce}},width:ke,height:Ve,pixelRatio:[F,ae]}}readPPS(e){const t=new vs(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const i=t.readBoolean(),s=t.readBoolean();let l=1;return s&&i?l=0:s?l=3:i&&(l=2),{parallelismType:l}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const ct=188;class mr{constructor(e,t,n,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=i,this.videoParser=null}static probe(e,t){const n=mr.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(ct*5,t-ct)+1,i=0;for(;i<n;){let s=!1,l=-1,u=0;for(let h=i;h<t;h+=ct)if(e[h]===71&&(t-h===ct||e[h+ct]===71)){if(u++,l===-1&&(l=h,l!==0&&(n=Math.min(l+ct*99,e.length-ct)+1)),s||(s=uc(e,h)===0),s&&u>1&&(l===0&&u>2||h+ct>n))return l}else{if(u)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:$p[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=mr.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=mr.createTrack("audio",i),this._id3Track=mr.createTrack("id3"),this._txtTrack=mr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,i=!1){n||(this.sampleAes=null);let s;const l=this._videoTrack,u=this._audioTrack,h=this._id3Track,d=this._txtTrack;let f=l.pid,m=l.pesData,g=u.pid,v=h.pid,x=u.pesData,T=h.pesData,S=null,I=this.pmtParsed,b=this._pmtId,w=e.length;if(this.remainderData&&(e=Xt(this.remainderData,e),w=e.length,this.remainderData=null),w<ct&&!i)return this.remainderData=e,{audioTrack:u,videoTrack:l,id3Track:h,textTrack:d};const _=Math.max(0,mr.syncOffset(e));w-=(w-_)%ct,w<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,w,e.buffer.byteLength-w));let D=0;for(let P=_;P<w;P+=ct)if(e[P]===71){const B=!!(e[P+1]&64),U=uc(e,P),O=(e[P+3]&48)>>4;let Y;if(O>1){if(Y=P+5+e[P+4],Y===P+ct)continue}else Y=P+4;switch(U){case f:B&&(m&&(s=mi(m,this.logger))&&(this.readyVideoParser(l.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(l,d,s,!1)),m={data:[],size:0}),m&&(m.data.push(e.subarray(Y,P+ct)),m.size+=P+ct-Y);break;case g:if(B){if(x&&(s=mi(x,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,s);break;case"mp3":this.parseMPEGPES(u,s);break;case"ac3":this.parseAC3PES(u,s);break}x={data:[],size:0}}x&&(x.data.push(e.subarray(Y,P+ct)),x.size+=P+ct-Y);break;case v:B&&(T&&(s=mi(T,this.logger))&&this.parseID3PES(h,s),T={data:[],size:0}),T&&(T.data.push(e.subarray(Y,P+ct)),T.size+=P+ct-Y);break;case 0:B&&(Y+=e[Y]+1),b=this._pmtId=TT(e,Y);break;case b:{B&&(Y+=e[Y]+1);const ne=LT(e,Y,this.typeSupported,n,this.observer,this.logger);f=ne.videoPid,f>0&&(l.pid=f,l.segmentCodec=ne.segmentVideoCodec),g=ne.audioPid,g>0&&(u.pid=g,u.segmentCodec=ne.segmentAudioCodec),v=ne.id3Pid,v>0&&(h.pid=v),S!==null&&!I&&(this.logger.warn(`MPEG-TS PMT found at ${P} after unknown PID '${S}'. Backtracking to sync byte @${_} to parse all TS packets.`),S=null,P=_-188),I=this.pmtParsed=!0;break}case 17:case 8191:break;default:S=U;break}}else D++;D>0&&cc(this.observer,new Error(`Found ${D} TS packet/s that do not start with 0x47`),void 0,this.logger),l.pesData=m,u.pesData=x,h.pesData=T;const j={audioTrack:u,videoTrack:l,id3Track:h,textTrack:d};return i&&this.extractRemainingSamples(j),j}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:i,textTrack:s}=e,l=n.pesData,u=t.pesData,h=i.pesData;let d;if(l&&(d=mi(l,this.logger))?(this.readyVideoParser(n.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(n,s,d,!0),n.pesData=null)):n.pesData=l,u&&(d=mi(u,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,d);break;case"mp3":this.parseMPEGPES(t,d);break;case"ac3":this.parseAC3PES(t,d);break}t.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=u;h&&(d=mi(h,this.logger))?(this.parseID3PES(i,d),i.pesData=null):i.pesData=h}demuxSampleAes(e,t,n){const i=this.demux(e,n,!0,!this.config.progressive),s=this.sampleAes=new xT(this.observer,this.config,t);return this.decrypt(i,s)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new ET:e==="hevc"&&(this.videoParser=new ST))}decrypt(e,t){return new Promise(n=>{const{audioTrack:i,videoTrack:s}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{n(e)}):n(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const i=this.aacOverFlow;let s=t.data;if(i){this.aacOverFlow=null;const m=i.missing,g=i.sample.unit.byteLength;if(m===-1)s=Xt(i.sample.unit,s);else{const v=g-m;i.sample.unit.set(s.subarray(0,m),v),e.samples.push(i.sample),n=i.missing}}let l,u;for(l=n,u=s.length;l<u-1&&!Ao(s,l);l++);if(l!==n){let m;const g=l<u-1;if(g?m=`AAC PES did not start with ADTS header,offset:${l}`:m="No ADTS header found in AAC PES",cc(this.observer,new Error(m),g,this.logger),!g)return}Lg(e,this.observer,s,l,this.audioCodec);let h;if(t.pts!==void 0)h=t.pts;else if(i){const m=Ag(e.samplerate);h=i.sample.pts+m}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0,f;for(;l<u;)if(f=Ig(e,s,l,h,d),l+=f.length,f.missing){this.aacOverFlow=f;break}else for(d++;l<u-1&&!Ao(s,l);l++);}parseMPEGPES(e,t){const n=t.data,i=n.length;let s=0,l=0;const u=t.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;l<i;)if(kg(n,l)){const h=bg(e,n,l,u,s);if(h)l+=h.length,s++;else break}else l++}parseAC3PES(e,t){{const n=t.data,i=t.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=n.length;let l=0,u=0,h;for(;u<s&&(h=Pg(e,n,u,i,l++))>0;)u+=h}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=Fe({},t,{type:this._videoTrack?Gt.emsg:Gt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function uc(a,e){return((a[e+1]&31)<<8)+a[e+2]}function TT(a,e){return(a[e+10]&31)<<8|a[e+11]}function LT(a,e,t,n,i,s){const l={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},u=(a[e+1]&15)<<8|a[e+2],h=e+3+u-4,d=(a[e+10]&15)<<8|a[e+11];for(e+=12+d;e<h;){const f=uc(a,e),m=(a[e+3]&15)<<8|a[e+4];switch(a[e]){case 207:if(!n){Fu("ADTS AAC",s);break}case 15:l.audioPid===-1&&(l.audioPid=f);break;case 21:l.id3Pid===-1&&(l.id3Pid=f);break;case 219:if(!n){Fu("H.264",s);break}case 27:l.videoPid===-1&&(l.videoPid=f);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):l.audioPid===-1&&(l.audioPid=f,l.segmentAudioCodec="mp3");break;case 193:if(!n){Fu("AC-3",s);break}case 129:t.ac3?l.audioPid===-1&&(l.audioPid=f,l.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(l.audioPid===-1&&m>0){let g=e+5,v=m;for(;v>2;){switch(a[g]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(l.audioPid=f,l.segmentAudioCodec="ac3");break}const T=a[g+1]+2;g+=T,v-=T}}break;case 194:case 135:return cc(i,new Error("Unsupported EC-3 in M2TS found"),void 0,s),l;case 36:l.videoPid===-1&&(l.videoPid=f,l.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=m+5}return l}function cc(a,e,t,n){n.warn(`parsing error: ${e.message}`),a.emit(L.ERROR,L.ERROR,{type:ve.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Fu(a,e){e.log(`${a} with AES-128-CBC encryption found in unencrypted stream`)}function mi(a,e){let t=0,n,i,s,l,u;const h=a.data;if(!a||a.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=Xt(h[0],h[1]),h.splice(1,1);if(n=h[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(i=(n[4]<<8)+n[5],i&&i>a.size-6)return null;const f=n[7];f&192&&(l=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,f&64?(u=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,l-u>60*9e4&&(e.warn(`${Math.round((l-u)/9e4)}s delta between PTS and DTS, align them`),l=u)):u=l),s=n[8];let m=s+9;if(a.size<=m)return null;a.size-=m;const g=new Uint8Array(a.size);for(let v=0,x=h.length;v<x;v++){n=h[v];let T=n.byteLength;if(m)if(m>T){m-=T;continue}else n=n.subarray(m),T-=m,m=0;g.set(n,t),t+=T}return i&&(i-=s+3),{data:g,pts:l,dts:u,len:i}}return null}class AT{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const dr=Math.pow(2,32)-1;class ${static init(){$.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in $.types)$.types.hasOwnProperty(e)&&($.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);$.HDLR_TYPES={video:t,audio:n};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);$.STTS=$.STSC=$.STCO=s,$.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),$.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),$.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),$.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const l=new Uint8Array([105,115,111,109]),u=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);$.FTYP=$.box($.types.ftyp,l,h,l,u),$.DINF=$.box($.types.dinf,$.box($.types.dref,i))}static box(e,...t){let n=8,i=t.length;const s=i;for(;i--;)n+=t[i].byteLength;const l=new Uint8Array(n);for(l[0]=n>>24&255,l[1]=n>>16&255,l[2]=n>>8&255,l[3]=n&255,l.set(e,4),i=0,n=8;i<s;i++)l.set(t[i],n),n+=t[i].byteLength;return l}static hdlr(e){return $.box($.types.hdlr,$.HDLR_TYPES[e])}static mdat(e){return $.box($.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(dr+1)),i=Math.floor(t%(dr+1));return $.box($.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return $.box($.types.mdia,$.mdhd(e.timescale||0,e.duration||0),$.hdlr(e.type),$.minf(e))}static mfhd(e){return $.box($.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?$.box($.types.minf,$.box($.types.smhd,$.SMHD),$.DINF,$.stbl(e)):$.box($.types.minf,$.box($.types.vmhd,$.VMHD),$.DINF,$.stbl(e))}static moof(e,t,n){return $.box($.types.moof,$.mfhd(e),$.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=$.trak(e[t]);return $.box.apply(null,[$.types.moov,$.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat($.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=$.trex(e[t]);return $.box.apply(null,[$.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(dr+1)),i=Math.floor(t%(dr+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return $.box($.types.mvhd,s)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let i,s;for(i=0;i<t.length;i++)s=t[i].flags,n[i+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return $.box($.types.sdtp,n)}static stbl(e){return $.box($.types.stbl,$.stsd(e),$.box($.types.stts,$.STTS),$.box($.types.stsc,$.STSC),$.box($.types.stsz,$.STSZ),$.box($.types.stco,$.STCO))}static avc1(e){let t=[],n=[],i,s,l;for(i=0;i<e.sps.length;i++)s=e.sps[i],l=s.byteLength,t.push(l>>>8&255),t.push(l&255),t=t.concat(Array.prototype.slice.call(s));for(i=0;i<e.pps.length;i++)s=e.pps[i],l=s.byteLength,n.push(l>>>8&255),n.push(l&255),n=n.concat(Array.prototype.slice.call(s));const u=$.box($.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),h=e.width,d=e.height,f=e.pixelRatio[0],m=e.pixelRatio[1];return $.box($.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,$.box($.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),$.box($.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,m>>24,m>>16&255,m>>8&255,m&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return $.box($.types.mp4a,$.audioStsd(e),$.box($.types.esds,$.esds(e)))}static mp3(e){return $.box($.types[".mp3"],$.audioStsd(e))}static ac3(e){return $.box($.types["ac-3"],$.audioStsd(e),$.box($.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return $.box($.types.stsd,$.STSD,$.mp4a(e));if(t==="ac3"&&e.config)return $.box($.types.stsd,$.STSD,$.ac3(e));if(t==="mp3"&&e.codec==="mp3")return $.box($.types.stsd,$.STSD,$.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return $.box($.types.stsd,$.STSD,$.avc1(e));if(t==="hevc"&&e.vps)return $.box($.types.stsd,$.STSD,$.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),i=e.width||0,s=e.height||0,l=Math.floor(n/(dr+1)),u=Math.floor(n%(dr+1));return $.box($.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,u>>24,u>>16&255,u>>8&255,u&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const n=$.sdtp(e),i=e.id,s=Math.floor(t/(dr+1)),l=Math.floor(t%(dr+1));return $.box($.types.traf,$.box($.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),$.box($.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,l>>24,l>>16&255,l>>8&255,l&255])),$.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,$.box($.types.trak,$.tkhd(e),$.mdia(e))}static trex(e){const t=e.id;return $.box($.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],i=n.length,s=12+16*i,l=new Uint8Array(s);let u,h,d,f,m,g;for(t+=8+s,l.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),u=0;u<i;u++)h=n[u],d=h.duration,f=h.size,m=h.flags,g=h.cts,l.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,m.degradPrio&61440,m.degradPrio&15,g>>>24&255,g>>>16&255,g>>>8&255,g&255],12+16*u);return $.box($.types.trun,l)}static initSegment(e){$.types||$.init();const t=$.moov(e);return Xt($.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],i=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),i-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let l=s.length;for(let x=0;x<n.length;x+=1){l+=3;for(let T=0;T<n[x].length;T+=1)l+=2+n[x][T].length}const u=new Uint8Array(l);u.set(s,0),l=s.length;const h=n.length-1;for(let x=0;x<n.length;x+=1){u.set(new Uint8Array([32+x|(x===h?128:0),0,n[x].length]),l),l+=3;for(let T=0;T<n[x].length;T+=1)u.set(new Uint8Array([n[x][T].length>>8,n[x][T].length&255]),l),l+=2,u.set(n[x][T],l),l+=n[x][T].length}const d=$.box($.types.hvcC,u),f=e.width,m=e.height,g=e.pixelRatio[0],v=e.pixelRatio[1];return $.box($.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,$.box($.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),$.box($.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,v>>24,v>>16&255,v>>8&255,v&255])))}}$.types=void 0;$.HDLR_TYPES=void 0;$.STTS=void 0;$.STSC=void 0;$.STCO=void 0;$.STSZ=void 0;$.VMHD=void 0;$.SMHD=void 0;$.STSD=void 0;$.FTYP=void 0;$.DINF=void 0;const Og=9e4;function Gc(a,e,t=1,n=!1){const i=a*e*t;return n?Math.round(i):i}function IT(a,e,t=1,n=!1){return Gc(a,e,1/t,n)}function ps(a,e=!1){return Gc(a,1e3,1/Og,e)}function RT(a,e=1){return Gc(a,Og,1/e)}function Um(a){const{baseTime:e,timescale:t,trackId:n}=a;return`${e/t} (${e}/${t}) trackId: ${n}`}const wT=10*1e3,bT=1024,_T=1152,kT=1536;let pi=null,Bu=null;function $m(a,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:a?2:1,isNonSync:a?0:1}}}class lo extends Zt{constructor(e,t,n,i){if(super("mp4-remuxer",i),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,pi===null){const l=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);pi=l?parseInt(l[1]):0}if(Bu===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);Bu=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&Um(t)} > ${e&&Um(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,i=e.reduce((s,l)=>{let u=l.pts,h=u-s;return h<-4294967296&&(t=!0,u=jt(u,n),h=u-s),h>0?s:u},n);return t&&this.debug("PTS rollover detected"),i}remux(e,t,n,i,s,l,u,h){let d,f,m,g,v,x,T=s,S=s;const I=e.pid>-1,b=t.pid>-1,w=t.samples.length,_=e.samples.length>0,D=u&&w>0||w>1;if((!I||_)&&(!b||D)||this.ISGenerated||u){if(this.ISGenerated){var P,B,U,O;const ue=this.videoTrackConfig;(ue&&(t.width!==ue.width||t.height!==ue.height||((P=t.pixelRatio)==null?void 0:P[0])!==((B=ue.pixelRatio)==null?void 0:B[0])||((U=t.pixelRatio)==null?void 0:U[1])!==((O=ue.pixelRatio)==null?void 0:O[1]))||!ue&&D||this.nextAudioTs===null&&_)&&this.resetInitSegment()}this.ISGenerated||(m=this.generateIS(e,t,s,l));const Y=this.isVideoContiguous;let ne=-1,se;if(D&&(ne=CT(t.samples),!Y&&this.config.forceKeyFrameOnDiscontinuity))if(x=!0,ne>0){this.warn(`Dropped ${ne} out of ${w} video samples due to a missing keyframe`);const ue=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(ne),t.dropped+=ne,S+=(t.samples[0].pts-ue)/t.inputTimeScale,se=S}else ne===-1&&(this.warn(`No keyframe found out of ${w} video samples`),x=!1);if(this.ISGenerated){if(_&&D){const ue=this.getVideoStartPts(t.samples),ee=(jt(e.samples[0].pts,ue)-ue)/t.inputTimeScale;T+=Math.max(0,ee),S+=Math.max(0,-ee)}if(_){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),m=this.generateIS(e,t,s,l)),f=this.remuxAudio(e,T,this.isAudioContiguous,l,b||D||h===me.AUDIO?S:void 0),D){const ue=f?f.endPTS-f.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),m=this.generateIS(e,t,s,l)),d=this.remuxVideo(t,S,Y,ue)}}else D&&(d=this.remuxVideo(t,S,Y,0));d&&(d.firstKeyFrame=ne,d.independent=ne!==-1,d.firstKeyFramePTS=se)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(v=Mg(n,s,this._initPTS,this._initDTS)),i.samples.length&&(g=Fg(i,s,this._initPTS))),{audio:f,video:d,initSegment:m,independent:x,text:g,id3:v}}computeInitPts(e,t,n,i){const s=Math.round(n*t);let l=jt(e,s);if(l<s+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(s-l)/t} ${i}`);l<s+t;)l+=8589934592;return l-s}generateIS(e,t,n,i){const s=e.samples,l=t.samples,u=this.typeSupported,h={},d=this._initPTS;let f=!d||i,m="audio/mp4",g,v,x,T=-1;if(f&&(g=v=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(m="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}h.audio={id:"audio",container:m,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):$.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(T=e.id,x=e.inputTimeScale,!d||x!==d.timescale?g=v=this.computeInitPts(s[0].pts,x,n,"audio"):f=!1)}if(t.sps&&t.pps&&l.length){if(t.timescale=t.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:$.initSegment([t]),metadata:{width:t.width,height:t.height}},f)if(T=t.id,x=t.inputTimeScale,!d||x!==d.timescale){const S=this.getVideoStartPts(l),I=jt(l[0].dts,S),b=this.computeInitPts(I,x,n,"video"),w=this.computeInitPts(S,x,n,"video");v=Math.min(v,b),g=Math.min(g,w)}else f=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(h).length)return this.ISGenerated=!0,f?(d&&this.warn(`Timestamps at playlist time: ${i?"":"~"}${n} ${g/x} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${g/x} (${g}/${x}) trackId: ${T}`),this._initPTS={baseTime:g,timescale:x,trackId:T},this._initDTS={baseTime:v,timescale:x,trackId:T}):g=x=void 0,{tracks:h,initPTS:g,timescale:x,trackId:T}}remuxVideo(e,t,n,i){const s=e.inputTimeScale,l=e.samples,u=[],h=l.length,d=this._initPTS,f=d.baseTime*s/d.timescale;let m=this.nextVideoTs,g=8,v=this.videoSampleDuration,x,T,S=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY,b=!1;if(!n||m===null){const k=f+t*s,F=l[0].pts-jt(l[0].dts,l[0].pts);pi&&m!==null&&Math.abs(k-F-(m+f))<15e3?n=!0:m=k-F-f}const w=m+f;for(let k=0;k<h;k++){const F=l[k];F.pts=jt(F.pts,w),F.dts=jt(F.dts,w),F.dts<l[k>0?k-1:k].dts&&(b=!0)}b&&l.sort(function(k,F){const ae=k.dts-F.dts,he=k.pts-F.pts;return ae||he}),x=l[0].dts,T=l[l.length-1].dts;const _=T-x,D=_?Math.round(_/(h-1)):v||e.inputTimeScale/30;if(n){const k=x-w,F=k>D,ae=k<-1;if((F||ae)&&(F?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ps(k,!0)} ms (${k}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ps(-k,!0)} ms (${k}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!ae||w>=l[0].pts||pi)){x=w;const he=l[0].pts-k;if(F)l[0].dts=x,l[0].pts=he;else{let ce=!0;for(let fe=0;fe<l.length&&!(l[fe].dts>he&&ce);fe++){const Re=l[fe].pts;if(l[fe].dts-=k,l[fe].pts-=k,fe<l.length-1){const Te=l[fe+1].pts,ke=l[fe].pts,Ve=Te<=ke,Kt=Te<=Re;ce=Ve==Kt}}}this.log(`Video: Initial PTS/DTS adjusted: ${ps(he,!0)}/${ps(x,!0)}, delta: ${ps(k,!0)} ms`)}}x=Math.max(0,x);let j=0,P=0,B=x;for(let k=0;k<h;k++){const F=l[k],ae=F.units,he=ae.length;let ce=0;for(let fe=0;fe<he;fe++)ce+=ae[fe].data.length;P+=ce,j+=he,F.length=ce,F.dts<B?(F.dts=B,B+=D/4|0||1):B=F.dts,S=Math.min(F.pts,S),I=Math.max(F.pts,I)}T=l[h-1].dts;const U=P+4*j+8;let O;try{O=new Uint8Array(U)}catch(k){this.observer.emit(L.ERROR,L.ERROR,{type:ve.MUX_ERROR,details:G.REMUX_ALLOC_ERROR,fatal:!1,error:k,bytes:U,reason:`fail allocating video mdat ${U}`});return}const Y=new DataView(O.buffer);Y.setUint32(0,U),O.set($.types.mdat,4);let ne=!1,se=Number.POSITIVE_INFINITY,ue=Number.POSITIVE_INFINITY,oe=Number.NEGATIVE_INFINITY,ee=Number.NEGATIVE_INFINITY;for(let k=0;k<h;k++){const F=l[k],ae=F.units;let he=0;for(let Re=0,Te=ae.length;Re<Te;Re++){const ke=ae[Re],Ve=ke.data,Kt=ke.data.byteLength;Y.setUint32(g,Kt),g+=4,O.set(Ve,g),g+=Kt,he+=4+Kt}let ce;if(k<h-1)v=l[k+1].dts-F.dts,ce=l[k+1].pts-F.pts;else{const Re=this.config,Te=k>0?F.dts-l[k-1].dts:D;if(ce=k>0?F.pts-l[k-1].pts:D,Re.stretchShortVideoTrack&&this.nextAudioTs!==null){const ke=Math.floor(Re.maxBufferHole*s),Ve=(i?S+i*s:this.nextAudioTs+f)-F.pts;Ve>ke?(v=Ve-Te,v<0?v=Te:ne=!0,this.log(`It is approximately ${Ve/90} ms to the next segment; using duration ${v/90} ms for the last video frame.`)):v=Te}else v=Te}const fe=Math.round(F.pts-F.dts);se=Math.min(se,v),oe=Math.max(oe,v),ue=Math.min(ue,ce),ee=Math.max(ee,ce),u.push($m(F.key,v,he,fe))}if(u.length){if(pi){if(pi<70){const k=u[0].flags;k.dependsOn=2,k.isNonSync=0}}else if(Bu&&ee-ue<oe-se&&D/oe<.025&&u[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let k=x;for(let F=0,ae=u.length;F<ae;F++){const he=k+u[F].duration,ce=k+u[F].cts;if(F<ae-1){const fe=he+u[F+1].cts;u[F].duration=fe-ce}else u[F].duration=F?u[F-1].duration:D;u[F].cts=0,k=he}}}v=ne||!v?D:v;const ie=T+v;this.nextVideoTs=m=ie-f,this.videoSampleDuration=v,this.isVideoContiguous=!0;const Q={data1:$.moof(e.sequenceNumber++,x,Fe(e,{samples:u})),data2:O,startPTS:(S-f)/s,endPTS:(I+v-f)/s,startDTS:(x-f)/s,endDTS:m/s,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Q}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return _T;case"ac3":return kT;default:return bT}}remuxAudio(e,t,n,i,s){const l=e.inputTimeScale,u=e.samplerate?e.samplerate:l,h=l/u,d=this.getSamplesPerFrame(e),f=d*h,m=this._initPTS,g=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,v=[],x=s!==void 0;let T=e.samples,S=g?0:8,I=this.nextAudioTs||-1;const b=m.baseTime*l/m.timescale,w=b+t*l;if(this.isAudioContiguous=n=n||T.length&&I>0&&(i&&Math.abs(w-(I+b))<9e3||Math.abs(jt(T[0].pts,w)-(I+b))<20*f),T.forEach(function(ee){ee.pts=jt(ee.pts,w)}),!n||I<0){const ee=T.length;if(T=T.filter(ie=>ie.pts>=0),ee!==T.length&&this.warn(`Removed ${T.length-ee} of ${ee} samples (initPTS ${b} / ${l})`),!T.length)return;s===0?I=0:i&&!x?I=Math.max(0,w-b):I=T[0].pts-b}if(e.segmentCodec==="aac"){const ee=this.config.maxAudioFramesDrift;for(let ie=0,H=I+b;ie<T.length;ie++){const X=T[ie],Q=X.pts,k=Q-H,F=Math.abs(1e3*k/l);if(k<=-ee*f&&x)ie===0&&(this.warn(`Audio frame @ ${(Q/l).toFixed(3)}s overlaps marker by ${Math.round(1e3*k/l)} ms.`),this.nextAudioTs=I=Q-b,H=Q);else if(k>=ee*f&&F<wT&&x){let ae=Math.round(k/f);for(H=Q-ae*f;H<0&&ae&&f;)ae--,H+=f;ie===0&&(this.nextAudioTs=I=H-b),this.warn(`Injecting ${ae} audio frames @ ${((H-b)/l).toFixed(3)}s due to ${Math.round(1e3*k/l)} ms gap.`);for(let he=0;he<ae;he++){let ce=AT.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ce||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ce=X.unit.subarray()),T.splice(ie,0,{unit:ce,pts:H}),H+=f,ie++}}X.pts=H,H+=f}}let _=null,D=null,j,P=0,B=T.length;for(;B--;)P+=T[B].unit.byteLength;for(let ee=0,ie=T.length;ee<ie;ee++){const H=T[ee],X=H.unit;let Q=H.pts;if(D!==null){const F=v[ee-1];F.duration=Math.round((Q-D)/h)}else if(n&&e.segmentCodec==="aac"&&(Q=I+b),_=Q,P>0){P+=S;try{j=new Uint8Array(P)}catch(F){this.observer.emit(L.ERROR,L.ERROR,{type:ve.MUX_ERROR,details:G.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:P,reason:`fail allocating audio mdat ${P}`});return}g||(new DataView(j.buffer).setUint32(0,P),j.set($.types.mdat,4))}else return;j.set(X,S);const k=X.byteLength;S+=k,v.push($m(!0,d,k,0)),D=Q}const U=v.length;if(!U)return;const O=v[v.length-1];I=D-b,this.nextAudioTs=I+h*O.duration;const Y=g?new Uint8Array(0):$.moof(e.sequenceNumber++,_/h,Fe({},e,{samples:v}));e.samples=[];const ne=(_-b)/l,se=this.nextAudioTs/l,oe={data1:Y,data2:j,startPTS:ne,endPTS:se,startDTS:ne,endDTS:se,type:"audio",hasAudio:!0,hasVideo:!1,nb:U};return this.isAudioContiguous=!0,oe}}function jt(a,e){let t;if(e===null)return a;for(e<a?t=-8589934592:t=8589934592;Math.abs(a-e)>4294967296;)a+=t;return a}function CT(a){for(let e=0;e<a.length;e++)if(a[e].key)return e;return-1}function Mg(a,e,t,n){const i=a.samples.length;if(!i)return;const s=a.inputTimeScale;for(let u=0;u<i;u++){const h=a.samples[u];h.pts=jt(h.pts-t.baseTime*s/t.timescale,e*s)/s,h.dts=jt(h.dts-n.baseTime*s/n.timescale,e*s)/s}const l=a.samples;return a.samples=[],{samples:l}}function Fg(a,e,t){const n=a.samples.length;if(!n)return;const i=a.inputTimeScale;for(let l=0;l<n;l++){const u=a.samples[l];u.pts=jt(u.pts-t.baseTime*i/t.timescale,e*i)/i}a.samples.sort((l,u)=>l.pts-u.pts);const s=a.samples;return a.samples=[],{samples:s}}class DT extends Zt{constructor(e,t,n,i){super("passthrough-remuxer",i),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,i){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,i),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:s,video:l}=this.initData=Vp(e);if(t)xE(e,t);else{const h=s||l;h!=null&&h.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${h.codec}")!`)}s&&(n=jm(s,Be.AUDIO,this)),l&&(i=jm(l,Be.VIDEO,this));const u={};s&&l?u.audiovideo={container:"video/mp4",codec:n+","+i,supplemental:l.supplemental,encrypted:l.encrypted,initSegment:e,id:"main"}:s?u.audio={container:"audio/mp4",codec:n,encrypted:s.encrypted,initSegment:e,id:"audio"}:l?u.video={container:"video/mp4",codec:i,supplemental:l.supplemental,encrypted:l.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=u}remux(e,t,n,i,s,l){var u,h;let{initPTS:d,lastEndTime:f}=this;const m={audio:void 0,video:void 0,text:i,id3:n,initSegment:void 0};le(f)||(f=this.lastEndTime=s||0);const g=t.samples;if(!g.length)return m;const v={initPTS:void 0,timescale:void 0,trackId:void 0};let x=this.initData;if((u=x)!=null&&u.length||(this.generateInitSegment(g),x=this.initData),!((h=x)!=null&&h.length))return this.warn("Failed to generate initSegment."),m;this.emitInitSegment&&(v.tracks=this.initTracks,this.emitInitSegment=!1);const T=SE(g,x,this),S=x.audio?T[x.audio.id]:null,I=x.video?T[x.video.id]:null,b=Ya(I,1/0),w=Ya(S,1/0),_=Ya(I,0,!0),D=Ya(S,0,!0);let j=s,P=0;const B=S&&(!I||!d&&w<b||d&&d.trackId===x.audio.id),U=B?S:I;if(U){const H=U.timescale,X=U.start-s*H,Q=B?x.audio.id:x.video.id;j=U.start/H,P=B?D-w:_-b,(l||!d)&&(PT(d,j,s,P)||H!==d.timescale)&&(d&&this.warn(`Timestamps at playlist time: ${l?"":"~"}${s} ${X/H} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${j-s} (${X}/${H}) trackId: ${Q}`),d=null,v.initPTS=X,v.timescale=H,v.trackId=Q)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${s}`);d?(v.initPTS=d.baseTime,v.timescale=d.timescale,v.trackId=d.trackId):((!v.timescale||v.trackId===void 0||v.initPTS===void 0)&&(this.warn("Could not set initPTS"),v.initPTS=j,v.timescale=1,v.trackId=-1),this.initPTS=d={baseTime:v.initPTS,timescale:v.timescale,trackId:v.trackId});const O=j-d.baseTime/d.timescale,Y=O+P;P>0?this.lastEndTime=Y:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const ne=!!x.audio,se=!!x.video;let ue="";ne&&(ue+="audio"),se&&(ue+="video");const oe=(x.audio?x.audio.encrypted:!1)||(x.video?x.video.encrypted:!1),ee={data1:g,startPTS:O,startDTS:O,endPTS:Y,endDTS:Y,type:ue,hasAudio:ne,hasVideo:se,nb:1,dropped:0,encrypted:oe};m.audio=ne&&!se?ee:void 0,m.video=se?ee:void 0;const ie=I==null?void 0:I.sampleCount;if(ie){const H=I.keyFrameIndex,X=H!==-1;ee.nb=ie,ee.dropped=H===0||this.isVideoContiguous?0:X?H:ie,ee.independent=X,ee.firstKeyFrame=H,X&&I.keyFrameStart&&(ee.firstKeyFramePTS=(I.keyFrameStart-d.baseTime)/d.timescale),this.isVideoContiguous||(m.independent=X),this.isVideoContiguous||(this.isVideoContiguous=X),ee.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${H}/${ie} dropped: ${ee.dropped} start: ${ee.firstKeyFramePTS||"NA"}`)}return m.initSegment=v,m.id3=Mg(n,s,d,d),i.samples.length&&(m.text=Fg(i,s,d)),m}}function Ya(a,e,t=!1){return(a==null?void 0:a.start)!==void 0?(a.start+(t?a.duration:0))/a.timescale:e}function PT(a,e,t,n){if(a===null)return!0;const i=Math.max(n,1),s=e-a.baseTime/a.timescale;return Math.abs(s-t)>i}function jm(a,e,t){const n=a.codec;return n&&n.length>4?n:e===Be.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?go(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let Un;try{Un=self.performance.now.bind(self.performance)}catch{Un=Date.now}const uo=[{demux:vT,remux:DT},{demux:mr,remux:lo},{demux:mT,remux:lo},{demux:gT,remux:lo}];uo.splice(2,0,{demux:pT,remux:lo});class Gm{constructor(e,t,n,i,s,l){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=s,this.logger=l}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,i){const s=n.transmuxing;s.executeStart=Un();let l=new Uint8Array(e);const{currentTransmuxState:u,transmuxConfig:h}=this;i&&(this.currentTransmuxState=i);const{contiguous:d,discontinuity:f,trackSwitch:m,accurateTimeOffset:g,timeOffset:v,initSegmentChange:x}=i||u,{audioCodec:T,videoCodec:S,defaultInitPts:I,duration:b,initSegmentData:w}=h,_=NT(l,t);if(_&&Si(_.method)){const B=this.getDecrypter(),U=Pc(_.method);if(B.isSync()){let O=B.softwareDecrypt(l,_.key.buffer,_.iv.buffer,U);if(n.part>-1){const ne=B.flush();O=ne&&ne.buffer}if(!O)return s.executeEnd=Un(),Uu(n);l=new Uint8Array(O)}else return this.asyncResult=!0,this.decryptionPromise=B.webCryptoDecrypt(l,_.key.buffer,_.iv.buffer,U).then(O=>{const Y=this.push(O,null,n);return this.decryptionPromise=null,Y}),this.decryptionPromise}const D=this.needsProbing(f,m);if(D){const B=this.configureTransmuxer(l);if(B)return this.logger.warn(`[transmuxer] ${B.message}`),this.observer.emit(L.ERROR,L.ERROR,{type:ve.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,fatal:!1,error:B,reason:B.message}),s.executeEnd=Un(),Uu(n)}(f||m||x||D)&&this.resetInitSegment(w,T,S,b,t),(f||x||D)&&this.resetInitialTimestamp(I),d||this.resetContiguity();const j=this.transmux(l,_,v,g,n);this.asyncResult=Rs(j);const P=this.currentTransmuxState;return P.contiguous=!0,P.discontinuity=!1,P.trackSwitch=!1,s.executeEnd=Un(),j}flush(e){const t=e.transmuxing;t.executeStart=Un();const{decrypter:n,currentTransmuxState:i,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const l=[],{timeOffset:u}=i;if(n){const m=n.flush();m&&l.push(this.push(m.buffer,null,e))}const{demuxer:h,remuxer:d}=this;if(!h||!d){t.executeEnd=Un();const m=[Uu(e)];return this.asyncResult?Promise.resolve(m):m}const f=h.flush(u);return Rs(f)?(this.asyncResult=!0,f.then(m=>(this.flushRemux(l,m,e),l))):(this.flushRemux(l,f,e),this.asyncResult?Promise.resolve(l):l)}flushRemux(e,t,n){const{audioTrack:i,videoTrack:s,id3Track:l,textTrack:u}=t,{accurateTimeOffset:h,timeOffset:d}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===me.MAIN?"level":"track"} ${n.level}`);const f=this.remuxer.remux(i,s,l,u,d,h,!0,this.id);e.push({remuxResult:f,chunkMeta:n}),n.transmuxing.executeEnd=Un()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,i,s){const{demuxer:l,remuxer:u}=this;!l||!u||(l.resetInitSegment(e,t,n,i),u.resetInitSegment(e,t,n,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,i,s){let l;return t&&t.method==="SAMPLE-AES"?l=this.transmuxSampleAes(e,t,n,i,s):l=this.transmuxUnencrypted(e,n,i,s),l}transmuxUnencrypted(e,t,n,i){const{audioTrack:s,videoTrack:l,id3Track:u,textTrack:h}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,l,u,h,t,n,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,n,i,s){return this.demuxer.demuxSampleAes(e,t,n).then(l=>({remuxResult:this.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,n,i,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:i}=this;let s;for(let m=0,g=uo.length;m<g;m++){var l;if((l=uo[m].demux)!=null&&l.probe(e,this.logger)){s=uo[m];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const u=this.demuxer,h=this.remuxer,d=s.remux,f=s.demux;(!h||!(h instanceof d))&&(this.remuxer=new d(n,t,i,this.logger)),(!u||!(u instanceof f))&&(this.demuxer=new f(n,t,i,this.logger),this.probe=f.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Cc(this.config)),e}}function NT(a,e){let t=null;return a.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Uu=a=>({remuxResult:{},chunkMeta:a});function Rs(a){return"then"in a&&a.then instanceof Function}class OT{constructor(e,t,n,i,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=i,this.defaultInitPts=s||null}}class MT{constructor(e,t,n,i,s,l){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=s,this.initSegmentChange=l}}let Vm=0;class Bg{constructor(e,t,n,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Vm++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=h=>{const d=h.data,f=this.hls;if(!(!f||!(d!=null&&d.event)||d.instanceNo!==this.instanceNo))switch(d.event){case"init":{var m;const g=(m=this.workerContext)==null?void 0:m.objectURL;g&&self.URL.revokeObjectURL(g);break}case"transmuxComplete":{this.handleTransmuxComplete(d.data);break}case"flush":{this.onFlush(d.data);break}case"workerLog":{f.logger[d.data.logType]&&f.logger[d.data.logType](d.data.message);break}default:{d.data=d.data||{},d.data.frag=this.frag,d.data.part=this.part,d.data.id=this.id,f.trigger(d.event,d.data);break}}},this.onWorkerError=h=>{if(!this.hls)return;const d=new Error(`${h.message}  (${h.filename}:${h.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(L.ERROR,{type:ve.OTHER_ERROR,details:G.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;const l=(h,d)=>{d=d||{},d.frag=this.frag||void 0,h===L.ERROR&&(d=d,d.parent=this.id,d.part=this.part,this.error=d.error),this.hls.trigger(h,d)};this.observer=new Mc,this.observer.on(L.FRAG_DECRYPTED,l),this.observer.on(L.ERROR,l);const u=im(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const h=this.hls.logger;if(s.workerPath||$S()){try{s.workerPath?(h.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=GS(s.workerPath)):(h.log(`injecting Web Worker for "${t}"`),this.workerContext=jS());const{worker:f}=this.workerContext;f.addEventListener("message",this.onWorkerMessage),f.addEventListener("error",this.onWorkerError),f.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:Ue(s)})}catch(f){h.warn(`Error setting up "${t}" Web Worker, fallback to inline`,f),this.terminateWorker(),this.error=null,this.transmuxer=new Gm(this.observer,u,s,"",t,e.logger)}return}}this.transmuxer=new Gm(this.observer,u,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Vm++;const t=this.hls.config,n=im(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:Ue(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),VS(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,i,s,l,u,h,d,f){var m,g;d.transmuxing.start=self.performance.now();const{instanceNo:v,transmuxer:x}=this,T=l?l.start:s.start,S=s.decryptdata,I=this.frag,b=!(I&&s.cc===I.cc),w=!(I&&d.level===I.level),_=I?d.sn-I.sn:-1,D=this.part?d.part-this.part.index:-1,j=_===0&&d.id>1&&d.id===(I==null?void 0:I.stats.chunkCount),P=!w&&(_===1||_===0&&(D===1||j&&D<=0)),B=self.performance.now();(w||_||s.stats.parsing.start===0)&&(s.stats.parsing.start=B),l&&(D||!P)&&(l.stats.parsing.start=B);const U=!(I&&((m=s.initSegment)==null?void 0:m.url)===((g=I.initSegment)==null?void 0:g.url)),O=new MT(b,P,h,w,T,U);if(!P||b||U){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${d.sn}${d.part>-1?" part: "+d.part:""} ${this.id===me.MAIN?"level":"track"}: ${d.level} id: ${d.id}
        discontinuity: ${b}
        trackSwitch: ${w}
        contiguous: ${P}
        accurateTimeOffset: ${h}
        timeOffset: ${T}
        initSegmentChange: ${U}`);const Y=new OT(n,i,t,u,f);this.configureTransmuxer(Y)}if(this.frag=s,this.part=l,this.workerContext)this.workerContext.worker.postMessage({instanceNo:v,cmd:"demux",data:e,decryptdata:S,chunkMeta:d,state:O},e instanceof ArrayBuffer?[e]:[]);else if(x){const Y=x.push(e,S,d,O);Rs(Y)?Y.then(ne=>{this.handleTransmuxComplete(ne)}).catch(ne=>{this.transmuxerError(ne,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(Y)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const i=n.flush(e);Rs(i)?i.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(i,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(L.ERROR,{type:ve.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Km=100;class FT extends Oc{constructor(e,t,n){super(e,t,n,"audio-stream-controller",me.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:s,trackId:l}){if(n===me.MAIN){const u=t.cc,h=this.fragCurrent;if(this.initPTS[u]={baseTime:i,timescale:s,trackId:l},this.log(`InitPTS for cc: ${u} found from main: ${i/s} (${i}/${s}) trackId: ${l}`),this.mainAnchor=t,this.state===q.WAITING_INIT_PTS){const d=this.waitingData;(!d&&!this.loadingParts||d&&d.frag.cc!==u)&&this.syncWithAnchor(t,d==null?void 0:d.frag)}else!this.hls.hasEnoughToStart&&h&&h.cc!==u?(h.abortRequests(),this.syncWithAnchor(t,h)):this.state===q.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const i=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&(i==null?void 0:i.cc)===t.cc)return;const s=(i||e).cc,l=this.getLevelDetails(),u=this.getLoadPosition(),h=eg(l,s,u);h&&(this.log(`Syncing with main frag at ${h.start} cc ${h.cc}`),this.startFragRequested=!1,this.nextLoadPosition=h.start,this.resetLoadingState(),this.state===q.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=q.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(Km),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=q.IDLE):this.state=q.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case q.IDLE:this.doTickIdle();break;case q.WAITING_TRACK:{const{levels:e,trackId:t}=this,n=e==null?void 0:e[t],i=n==null?void 0:n.details;if(i&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(i))break;this.state=q.WAITING_INIT_PTS}break}case q.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case q.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:i,complete:s}=e,l=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=q.FRAG_LOADING;const u=i.flush().buffer,h={frag:t,part:n,payload:u,networkDetails:null};this._handleFragmentLoadProgress(h),s&&super._handleFragmentLoadComplete(h)}else l&&l.cc!==e.frag.cc&&this.syncWithAnchor(l,e.frag)}else this.state=q.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:i,trackId:s}=this,l=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!l.startFragPrefetch)||!(n!=null&&n[s]))return;const u=n[s],h=u.details;if(!h||this.waitForLive(u)||this.waitForCdnTuneIn(h)){this.state=q.WAITING_TRACK,this.startFragRequested=!1;return}const d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,Be.AUDIO,me.AUDIO));const f=this.getFwdBufferInfo(d,me.AUDIO);if(f===null)return;if(!this.switchingTrack&&this._streamEnded(f,h)){t.trigger(L.BUFFER_EOS,{type:"audio"}),this.state=q.ENDED;return}const m=f.len,g=t.maxBufferLength,v=h.fragments,x=v[0].start,T=this.getLoadPosition(),S=this.flushing?T:f.end;if(this.switchingTrack&&i){const w=T;h.PTSKnown&&w<x&&(f.end>x||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=x+.05)}if(m>=g&&!this.switchingTrack&&S<v[v.length-1].start)return;let I=this.getNextFragment(S,h);if(I&&this.isLoopLoading(I,S)&&(I=this.getNextFragmentLoopLoading(I,h,f,me.MAIN,g)),!I){this.bufferFlushed=!0;return}let b=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&b&&et(I)&&!I.endList&&(!h.live||!this.loadingParts&&S<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(b)===at.OK&&(this.mainFragLoading=b=null),b&&et(b))){if(I.start>b.end){const _=this.fragmentTracker.getFragAtPos(S,me.MAIN);_&&_.end>b.end&&(b=_,this.mainFragLoading={frag:_,targetBufferTime:null})}if(I.start>b.end)return}this.loadFragment(I,u,S)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new Ls(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==q.STOPPED&&(this.setInterval(Km),this.state=q.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(L.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:i}=this,{details:s,id:l,groupId:u,track:h}=t;if(!i){this.warn(`Audio tracks reset while loading track ${l} "${h.name}" of "${u}"`);return}const d=this.mainDetails;if(!d||s.endCC>d.endCC||d.expired){this.cachedTrackLoadedData=t,this.state!==q.STOPPED&&(this.state=q.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${l} "${h.name}" of "${u}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const f=i[l];let m=0;if(s.live||(n=f.details)!=null&&n.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(f.details){var g;m=this.alignPlaylists(s,f.details,(g=this.levelLastLoaded)==null?void 0:g.details)}s.alignedSliding||(vg(s,d),s.alignedSliding||Lo(s,d),m=s.fragmentStart)}f.details=s,this.levelLastLoaded=f,this.startFragRequested||this.setStartPosition(d,m),this.hls.trigger(L.AUDIO_TRACK_UPDATED,{details:s,id:l,groupId:t.groupId}),this.state===q.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=q.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:i,payload:s}=e,{config:l,trackId:u,levels:h}=this;if(!h){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const d=h[u];if(!d){this.warn("Audio track is undefined on fragment load progress");return}const f=d.details;if(!f){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const m=l.defaultAudioCodec||d.audioCodec||"mp4a.40.2";let g=this.transmuxer;g||(g=this.transmuxer=new Bg(this.hls,me.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const v=this.initPTS[n.cc],x=(t=n.initSegment)==null?void 0:t.data;if(v!==void 0){const S=i?i.index:-1,I=S!==-1,b=new Dc(n.level,n.sn,n.stats.chunkCount,s.byteLength,S,I);g.push(s,x,m,"",n,i,f.totalduration,!1,b,v)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${f.startSN} ,${f.endSN}],track ${u}`);const{cache:T}=this.waitingData=this.waitingData||{frag:n,part:i,cache:new xg,complete:!1};T.push(new Uint8Array(s)),this.state!==q.STOPPED&&(this.state=q.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===me.MAIN&&et(t.frag)&&(this.mainFragLoading=t,this.state===q.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:i}=t;if(n.type!==me.AUDIO){!this.audioOnly&&n.type===me.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(et(n)){this.fragPrevious=n;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(L.AUDIO_TRACK_SWITCHED,Oe({},s)))}this.fragBufferedComplete(n,i),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=q.ERROR;return}switch(t.details){case G.FRAG_GAP:case G.FRAG_PARSING_ERROR:case G.FRAG_DECRYPT_ERROR:case G.FRAG_LOAD_ERROR:case G.FRAG_LOAD_TIMEOUT:case G.KEY_LOAD_ERROR:case G.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(me.AUDIO,t);break;case G.AUDIO_TRACK_LOAD_ERROR:case G.AUDIO_TRACK_LOAD_TIMEOUT:case G.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===q.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===_e.AUDIO_TRACK&&(this.state=q.IDLE);break;case G.BUFFER_ADD_CODEC_ERROR:case G.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case G.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case G.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Be.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Be.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===q.ENDED&&(this.state=q.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,me.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:i}=this,{remuxResult:s,chunkMeta:l}=e,u=this.getCurrentContext(l);if(!u){this.resetWhenMissingContext(l);return}const{frag:h,part:d,level:f}=u,{details:m}=f,{audio:g,text:v,id3:x,initSegment:T}=s;if(this.fragContextChanged(h)||!m){this.fragmentTracker.removeFragment(h);return}if(this.state=q.PARSING,this.switchingTrack&&g&&this.completeAudioSwitch(this.switchingTrack),T!=null&&T.tracks){const S=h.initSegment||h;if(this.unhandledEncryptionError(T,h))return;this._bufferInitSegment(f,T.tracks,S,l),i.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:n,tracks:T.tracks})}if(g){const{startPTS:S,endPTS:I,startDTS:b,endDTS:w}=g;d&&(d.elementaryStreams[Be.AUDIO]={startPTS:S,endPTS:I,startDTS:b,endDTS:w}),h.setElementaryStreamInfo(Be.AUDIO,S,I,b,w),this.bufferFragmentData(g,h,d,l)}if(x!=null&&(t=x.samples)!=null&&t.length){const S=Fe({id:n,frag:h,details:m},x);i.trigger(L.FRAG_PARSING_METADATA,S)}if(v){const S=Fe({id:n,frag:h,details:m},v);i.trigger(L.FRAG_PARSING_USERDATA,S)}}_bufferInitSegment(e,t,n,i){if(this.state!==q.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=me.AUDIO;const l=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${l}/${s.codec}]`),l&&l.split(",").length===1&&(s.levelCodec=l),this.hls.trigger(L.BUFFER_CODECS,t);const u=s.initSegment;if(u!=null&&u.byteLength){const h={type:"audio",frag:n,part:null,chunkMeta:i,parent:n.type,data:u};this.hls.trigger(L.BUFFER_APPENDING,h)}this.tickImmediate()}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===at.NOT_LOADED||i===at.PARTIAL){var s;if(!et(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=q.WAITING_INIT_PTS;const l=this.mainDetails;l&&l.fragmentStart!==t.details.fragmentStart&&Lo(t.details,l)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:i,characteristics:s,audioCodec:l,channels:u}=this.bufferedTrack;Mr({name:t,lang:n,assocLang:i,characteristics:s,audioCodec:l,channels:u},e,Or)||(vo(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(L.AUDIO_TRACK_SWITCHED,Oe({},e))}}class Vc extends Zt{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const i=t==null?void 0:t.renditionReports;if(i){let s=-1;for(let l=0;l<i.length;l++){const u=i[l];let h;try{h=new self.URL(u.URI,t.url).href}catch(d){this.warn(`Could not construct new URL for Rendition Report: ${d}`),h=u.URI||""}if(h===e){s=l;break}else h===e.substring(0,h.length)&&(s=l)}if(s!==-1){const l=i[s],u=parseInt(l["LAST-MSN"])||t.lastPartSn;let h=parseInt(l["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const f=Math.min(t.age-t.partTarget,t.targetduration);h>=0&&f>t.partTarget&&(h+=1)}const d=n&&sm(n);return new am(u,h>=0?h:void 0,d)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:i,stats:s}=t,l=self.performance.now(),u=s.loading.first?Math.max(0,l-s.loading.first):0;i.advancedDateTime=Date.now()-u;const h=this.hls.config.timelineOffset;if(h!==i.appliedTimelineOffset){const f=Math.max(h||0,0);i.appliedTimelineOffset=f,i.fragments.forEach(m=>{m.setStart(m.playlistOffset+f)})}if(i.live||n!=null&&n.live){const f="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(n),n&&i.fragments.length>0){_S(n,i,this);const b=i.playlistParsingError;if(b){this.warn(b);const w=this.hls;if(!w.config.ignorePlaylistParsingErrors){var d;const{networkDetails:_}=t;w.trigger(L.ERROR,{type:ve.NETWORK_ERROR,details:G.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:b,reason:b.message,level:t.level||void 0,parent:(d=i.fragments[0])==null?void 0:d.type,networkDetails:_,stats:s});return}i.playlistParsingError=null}}i.requestScheduled===-1&&(i.requestScheduled=s.loading.start);const m=this.hls.mainForwardBufferInfo,g=m?m.end-m.len:0,v=(i.edge-g)*1e3,x=fg(i,v);if(i.requestScheduled+x<l?i.requestScheduled=l:i.requestScheduled+=x,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let T,S,I;if(i.canBlockReload&&i.endSN&&i.advanced){const b=this.hls.config.lowLatencyMode,w=i.lastPartSn,_=i.endSN,D=i.lastPartIndex,j=D!==-1,P=w===_;j?P?(S=_+1,I=b?0:D):(S=w,I=b?D+1:i.maxPartIndex):S=_+1;const B=i.age,U=B+i.ageHeader;let O=Math.min(U-i.partTarget,i.targetduration*1.5);if(O>0){if(U>i.targetduration*3)this.log(`Playlist last advanced ${B.toFixed(2)}s ago. Omitting segment and part directives.`),S=void 0,I=void 0;else if(n!=null&&n.tuneInGoal&&U-i.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${O} with playlist age: ${i.age}`),O=0;else{const Y=Math.floor(O/i.targetduration);if(S+=Y,I!==void 0){const ne=Math.round(O%i.targetduration/i.partTarget);I+=ne}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${B.toFixed(2)}s goal: ${O} skip sn ${Y} to part ${I}`)}i.tuneInGoal=O}if(T=this.getDeliveryDirectives(i,t.deliveryDirectives,S,I),b||!P){i.requestScheduled=l,this.loadingPlaylist(f,T);return}}else(i.canBlockReload||i.canSkipUntil)&&(T=this.getDeliveryDirectives(i,t.deliveryDirectives,S,I));T&&S!==void 0&&i.canBlockReload&&(i.requestScheduled=s.loading.first+Math.max(x-u*2,x/2)),this.scheduleLoading(f,T,i)}else this.clearTimer()}scheduleLoading(e,t,n){const i=n||e.details;if(!i){this.loadingPlaylist(e,t);return}const s=self.performance.now(),l=i.requestScheduled;if(s>=l){this.loadingPlaylist(e,t);return}const u=l-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(u)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),u)}getDeliveryDirectives(e,t,n,i){let s=sm(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,i=t.part,s=ao.No),new am(n,i,s)}checkRetry(e){const t=e.details,n=xo(e),i=e.errorAction,{action:s,retryCount:l=0,retryConfig:u}=i||{},h=!!i&&!!u&&(s===mt.RetryRequest||!i.resolved&&s===mt.SendAlternateToPenaltyBox);if(h){var d;if(l>=u.maxNumRetry)return!1;if(n&&(d=e.context)!=null&&d.deliveryDirectives)this.warn(`Retrying playlist loading ${l+1}/${u.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const f=kc(u,l);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),f),this.warn(`Retrying playlist loading ${l+1}/${u.maxNumRetry} after "${t}" in ${f}ms`)}e.levelRetry=!0,i.resolved=!0}return h}}function Ug(a,e){if(a.length!==e.length)return!1;for(let t=0;t<a.length;t++)if(!ws(a[t].attrs,e[t].attrs))return!1;return!0}function ws(a,e,t){const n=a["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>a[i]!==e[i])}function dc(a,e){return e.label.toLowerCase()===a.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(a.lang||"").toLowerCase())}class BT extends Vc{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:i,details:s}=t,l=this.tracksInGroup[n];if(!l||l.groupId!==i){this.warn(`Audio track with id:${n} and group:${i} not found in active group ${l==null?void 0:l.groupId}`);return}const u=l.details;l.details=t.details,this.log(`Audio track ${n} "${l.name}" lang:${l.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,i=this.groupIds;let s=this.currentTrack;if(!n||(i==null?void 0:i.length)!==(n==null?void 0:n.length)||n!=null&&n.some(u=>(i==null?void 0:i.indexOf(u))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const u=this.tracks.filter(g=>!n||n.indexOf(g.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(g=>g.default)&&(this.selectDefaultTrack=!1),u.forEach((g,v)=>{g.id=v});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=u;const h=this.hls.config.audioPreference;if(!s&&h){const g=Ln(h,u,Or);if(g>-1)s=u[g];else{const v=Ln(h,this.tracks);s=this.tracks[v]}}let d=this.findTrackId(s);d===-1&&s&&(d=this.findTrackId(null));const f={audioTracks:u};this.log(`Updating audio tracks, ${u.length} track(s) found in group(s): ${n==null?void 0:n.join(",")}`),this.hls.trigger(L.AUDIO_TRACKS_UPDATED,f);const m=this.trackId;if(d!==-1&&m===-1)this.setAudioTrack(d);else if(u.length&&m===-1){var l;const g=new Error(`No audio track selected for current audio group-ID(s): ${(l=this.groupIds)==null?void 0:l.join(",")} track count: ${u.length}`);this.warn(g.message),this.hls.trigger(L.ERROR,{type:ve.MEDIA_ERROR,details:G.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:g})}}}onError(e,t){t.fatal||!t.context||t.context.type===_e.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const i=this.currentTrack;if(i&&Mr(e,i,Or))return i;const s=Ln(e,this.tracksInGroup,Or);if(s>-1){const l=this.tracksInGroup[s];return this.setAudioTrack(s),l}else if(i){let l=t.loadLevel;l===-1&&(l=t.firstAutoLevel);const u=QE(e,t.levels,n,l,Or);if(u===-1)return null;t.nextLoadLevel=u}if(e.channels||e.audioCodec){const l=Ln(e,n);if(l>-1)return n[l]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e],s=i.details&&!i.details.live;if(e===this.trackId&&i===n&&s||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(L.AUDIO_TRACK_SWITCHING,Oe({},i)),s))return;const l=this.switchParams(i.url,n==null?void 0:n.details,i.details);this.loadPlaylist(l)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if(!(this.selectDefaultTrack&&!i.default)&&(!e||Mr(e,i,Or)))return n}if(e){const{name:n,lang:i,assocLang:s,characteristics:l,audioCodec:u,channels:h}=e;for(let d=0;d<t.length;d++){const f=t[d];if(Mr({name:n,lang:i,assocLang:s,characteristics:l,audioCodec:u,channels:h},f,Or))return d}for(let d=0;d<t.length;d++){const f=t[d];if(ws(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return d}for(let d=0;d<t.length;d++){const f=t[d];if(ws(e.attrs,f.attrs,["LANGUAGE"]))return d}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&vo(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),l=e.details,u=l==null?void 0:l.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&l.live?" age "+u.toFixed(1)+(l.type&&" "+l.type||""):""} ${s}`),this.hls.trigger(L.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:i,deliveryDirectives:t||null,track:e})}}class UT{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const i=this.queues[t];i.push(e),i.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(s){var n;if(i.onError(s),this.queues===null||this.tracks===null)return;const l=(n=this.tracks[e])==null?void 0:n.buffer;l!=null&&l.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],i=n==null?void 0:n.buffer;return i?`SourceBuffer${i.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const Hm=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,$g="HlsJsTrackRemovedError";class $T extends Error{constructor(e){super(e),this.name=$g}}class jT extends Zt{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var i;this.hls&&((i=this.mediaSource)==null?void 0:i.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:i,mediaSource:s}=this;n&&this.log("Media source opened"),!(!i||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(L.MEDIA_ATTACHED,{media:i,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:i}=this;n!==i&&this.error(`Media element src was set while attaching MediaSource (${i} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=uE(gr(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_APPENDING,this.onBufferAppending,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.BUFFER_EOS,this.onBufferEos,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.FRAG_PARSED,this.onFragParsed,this),e.on(L.FRAG_CHANGED,this.onFragChanged,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_APPENDING,this.onBufferAppending,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_EOS,this.onBufferEos,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.FRAG_PARSED,this.onFragParsed,this),e.off(L.FRAG_CHANGED,this.onFragChanged,this),e.off(L.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const l=this.isQueued();(s||l)&&this.warn(`Transfering MediaSource with${l?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?Fe(n,i.tracks):this.sourceBuffers.forEach(s=>{const[l]=s;l&&(n[l]=Fe({},this.tracks[l]),this.removeBuffer(l)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const i=gr(this.appendSource);if(i){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const l=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(l),s)this._objectUrl=n.src,this.attachTransferred();else{const u=this._objectUrl=self.URL.createObjectURL(l);if(this.appendSource)try{n.removeAttribute("src");const h=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||h&&l instanceof h,Wm(n),GT(n,u),n.load()}catch{n.src=u}else n.src=u}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,i=t.tracks,s=i?Object.keys(i):null,l=s?s.length:0,u=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(i&&s&&l){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Ue(n,(h,d)=>h==="initSegment"?void 0:d)};
transfer tracks: ${Ue(i,(h,d)=>h==="initSegment"?void 0:d)}}`),!Mp(i,n)){t.mediaSource=null,t.tracks=void 0;const h=e.currentTime,d=this.details,f=Math.max(h,(d==null?void 0:d.fragments[0].start)||0);if(f-h>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${h} -> ${f}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(n)}") start time: ${f} currentTime: ${h}`),this.onMediaDetaching(L.MEDIA_DETACHING,{}),this.onMediaAttaching(L.MEDIA_ATTACHING,t),e.currentTime=f;return}this.transferData=void 0,s.forEach(h=>{const d=h,f=i[d];if(f){const m=f.buffer;if(m){const g=this.fragmentTracker,v=f.id;if(g.hasFragments(v)||g.hasParts(v)){const S=Ie.getBuffered(m);g.detectEvictedFragments(d,S,v,null,!0)}const x=$u(d),T=[d,m];this.sourceBuffers[x]=T,m.updating&&this.operationQueue&&this.operationQueue.prependBlocker(d),this.trackSourceBuffer(d,f)}}}),u(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),u()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:s,_objectUrl:l}=this;if(s){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([u])=>{u&&this.removeBuffer(u)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const u=s.readyState==="open";try{const h=s.sourceBuffers;for(let d=h.length;d--;)u&&h[d].abort(),s.removeSourceBuffer(h[d]);u&&s.endOfStream()}catch(h){this.warn(`onMediaDetaching: ${h.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),n||(l&&self.URL.revokeObjectURL(l),this.mediaSrc===l?(i.removeAttribute("src"),this.appendSource&&Wm(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(L.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var i;(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[$u(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new UT(this.tracks)}onBufferCodecs(e,t){var n;const i=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const l="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),u=!l&&this.sourceBufferCount&&this.media&&s.some(h=>!i[h]);if(l||u){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${s}" SourceBuffers`);return}s.forEach(h=>{var d,f;const m=t[h],{id:g,codec:v,levelCodec:x,container:T,metadata:S,supplemental:I}=m;let b=i[h];const w=(d=this.transferData)==null||(d=d.tracks)==null?void 0:d[h],_=w!=null&&w.buffer?w:b,D=(_==null?void 0:_.pendingCodec)||(_==null?void 0:_.codec),j=_==null?void 0:_.levelCodec;b||(b=i[h]={buffer:void 0,listeners:[],codec:v,supplemental:I,container:T,levelCodec:x,metadata:S,id:g});const P=so(D,j),B=P==null?void 0:P.replace(Hm,"$1");let U=so(v,x);const O=(f=U)==null?void 0:f.replace(Hm,"$1");U&&P&&B!==O&&(h.slice(0,5)==="audio"&&(U=go(U,this.appendSource)),this.log(`switching codec ${D} to ${U}`),U!==(b.pendingCodec||b.codec)&&(b.pendingCodec=U),b.container=T,this.appendChangeType(h,T,U))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((n=t.audio)==null?void 0:n.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const i=`${t};codecs=${n}`,s={label:`change-type=${i}`,execute:()=>{const l=this.tracks[e];if(l){const u=l.buffer;u!=null&&u.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),u.changeType(i),l.codec=n,l.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:l=>{this.warn(`Failed to change ${e} SourceBuffer type`,l)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,i=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,me.MAIN))==null?void 0:t.gap)===!0)return;const l={label:"block-audio",execute:()=>{var u;const h=this.tracks.video;(this.lastVideoAppendEnd>i||h!=null&&h.buffer&&Ie.isBuffered(h.buffer,i)||((u=this.fragmentTracker.getAppendedFrag(i,me.MAIN))==null?void 0:u.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:u=>{this.warn("Error executing block-audio operation",u)}};this.blockedAudioAppend={op:l,frag:e},this.append(l,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:i,type:s,parent:l,frag:u,part:h,chunkMeta:d,offset:f}=t,m=d.buffering[s],{sn:g,cc:v}=u,x=self.performance.now();m.start=x;const T=u.stats.buffering,S=h?h.stats.buffering:null;T.start===0&&(T.start=x),S&&S.start===0&&(S.start=x);const I=n.audio;let b=!1;s==="audio"&&(I==null?void 0:I.container)==="audio/mpeg"&&(b=!this.lastMpegAudioChunk||d.id===1||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const w=n.video,_=w==null?void 0:w.buffer;if(_&&g!=="initSegment"){const P=h||u,B=this.blockedAudioAppend;if(s==="audio"&&l!=="main"&&!this.blockedAudioAppend&&!(w.ending||w.ended)){const O=P.start+P.duration*.05,Y=_.buffered,ne=this.currentOp("video");!Y.length&&!ne?this.blockAudio(P):!ne&&!Ie.isBuffered(_,O)&&this.lastVideoAppendEnd<O&&this.blockAudio(P)}else if(s==="video"){const U=P.end;if(B){const O=B.frag.start;(U>O||U<this.lastVideoAppendEnd||Ie.isBuffered(_,O))&&this.unblockAudio()}this.lastVideoAppendEnd=U}}const D=(h||u).start,j={label:`append-${s}`,execute:()=>{var P;m.executeStart=self.performance.now();const B=(P=this.tracks[s])==null?void 0:P.buffer;B&&(b?this.updateTimestampOffset(B,D,.1,s,g,v):f!==void 0&&le(f)&&this.updateTimestampOffset(B,f,1e-6,s,g,v)),this.appendExecutor(i,s)},onStart:()=>{},onComplete:()=>{const P=self.performance.now();m.executeEnd=m.end=P,T.first===0&&(T.first=P),S&&S.first===0&&(S.first=P);const B={};this.sourceBuffers.forEach(([U,O])=>{U&&(B[U]=Ie.getBuffered(O))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(L.BUFFER_APPENDED,{type:s,frag:u,part:h,chunkMeta:d,parent:u.type,timeRanges:B})},onError:P=>{var B;const U={type:ve.MEDIA_ERROR,parent:u.type,details:G.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:u,part:h,chunkMeta:d,error:P,err:P,fatal:!1},O=(B=this.media)==null?void 0:B.error;if(P.code===DOMException.QUOTA_EXCEEDED_ERR||P.name=="QuotaExceededError"||"quota"in P)U.details=G.BUFFER_FULL_ERROR;else if(P.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!O)U.errorAction=Ei(!0);else if(P.name===$g&&this.sourceBufferCount===0)U.errorAction=Ei(!0);else{const Y=++this.appendErrors[s];this.warn(`Failed ${Y}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${O||"no media error"})`),(Y>=this.hls.config.appendErrorMaxRetry||O)&&(U.fatal=!0)}this.hls.trigger(L.ERROR,U)}};this.log(`queuing "${s}" append sn: ${g}${h?" p: "+h.index:""} of ${u.type===me.MAIN?"level":"track"} ${u.level} cc: ${v}`),this.append(j,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(L.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:n,startOffset:i,endOffset:s}=t;n?this.append(this.getFlushOp(n,i,s),n):this.sourceBuffers.forEach(([l])=>{l&&this.append(this.getFlushOp(l,i,s),l)})}onFragParsed(e,t){const{frag:n,part:i}=t,s=[],l=i?i.elementaryStreams:n.elementaryStreams;l[Be.AUDIOVIDEO]?s.push("audiovideo"):(l[Be.AUDIO]&&s.push("audio"),l[Be.VIDEO]&&s.push("video"));const u=()=>{const h=self.performance.now();n.stats.buffering.end=h,i&&(i.stats.buffering.end=h);const d=i?i.stats:n.stats;this.hls.trigger(L.FRAG_BUFFERED,{frag:n,part:i,stats:d,id:n.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(u,s).catch(h=>{this.warn(`Fragment buffered callback ${h}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([l])=>{if(l){const u=this.tracks[l];(!t.type||t.type===l)&&(u.ending=!0,u.ended||(u.ended=!0,this.log(`${l} buffer reached EOS`)))}});const i=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([l])=>{var u;return l&&!((u=this.tracks[l])!=null&&u.ended)})?i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:l}=this;if(!l||l.readyState!=="open"){l&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${l.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),l.endOfStream(),this.hls.trigger(L.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(L.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===G.BUFFER_APPEND_ERROR&&t.frag){var n;const i=(n=t.errorAction)==null?void 0:n.nextAutoLevel;le(i)&&i!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const i=e.config,s=n.currentTime,l=t.levelTargetDuration,u=t.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(le(u)&&u>=0){const d=Math.max(u,l),f=Math.floor(s/l)*l-d;this.flushBackBuffer(s,l,f)}const h=i.frontBufferFlushThreshold;if(le(h)&&h>0){const d=Math.max(i.maxBufferLength,h),f=Math.max(d,l),m=Math.floor(s/l)*l+f;this.flushFrontBuffer(s,l,m)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([i,s])=>{if(s){const u=Ie.getBuffered(s);if(u.length>0&&n>u.start(0)){var l;this.hls.trigger(L.BACK_BUFFER_REACHED,{bufferEnd:n});const h=this.tracks[i];if((l=this.details)!=null&&l.live)this.hls.trigger(L.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(h!=null&&h.ended){this.log(`Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:i})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([i,s])=>{if(s){const l=Ie.getBuffered(s),u=l.length;if(u<2)return;const h=l.start(u-1),d=l.end(u-1);if(n>h||e>=h&&e<=d)return;this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:h,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||(n==null?void 0:n.readyState)!=="open")return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const d=Math.max(0,t.fragmentStart),f=Math.max(d,i);return{duration:1/0,start:d,end:f}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return le(s)?{duration:s}:null;const l=this.media.duration,u=le(n.duration)?n.duration:0;return i>u&&i>l||!le(l)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:n}){const i=this.mediaSource;!this.media||!i||i.readyState!=="open"||(i.duration!==e&&(le(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${n}.`),i.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Ue(n)}`),this.tracksReady){var i;const s=(i=this.transferData)==null?void 0:i.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const i=this.tracks[t];e[t]={buffer:n,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger(L.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(L.ERROR,{type:ve.MEDIA_ERROR,details:G.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const l=s,u=e[l];if(this.isPending(u)){const h=this.getTrackCodec(u,l),d=`${u.container};codecs=${h}`;u.codec=h,this.log(`creating sourceBuffer(${d})${this.currentOp(l)?" Queued":""} ${Ue(u)}`);try{const f=n.addSourceBuffer(d),m=$u(l),g=[l,f];t[m]=g,u.buffer=f}catch(f){var i;this.error(`error while trying to add sourceBuffer: ${f.message}`),this.shiftAndExecuteNext(l),(i=this.operationQueue)==null||i.removeBlockers(),delete this.tracks[l],this.hls.trigger(L.ERROR,{type:ve.MEDIA_ERROR,details:G.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,sourceBufferName:l,mimeType:d,parent:u.id});return}this.trackSourceBuffer(l,u)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let i=e.codec;n&&(t==="video"||t==="audiovideo")&&Ss(n,"video")&&(i=CE(i,n));const s=so(i,e.levelCodec);return s?t.slice(0,5)==="audio"?go(s,this.appendSource):s:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,l)=>{const u=l.removedRanges;u!=null&&u.length&&this.hls.trigger(L.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n==null?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${i}`,t),this.hls.trigger(L.ERROR,{type:ve.MEDIA_ERROR,details:G.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const s=this.currentOp(e);s&&s.onError(i)}updateTimestampOffset(e,t,n,i,s,l){const u=t-e.timestampOffset;Math.abs(u)>=n&&(this.log(`Updating ${i} SourceBuffer timestampOffset to ${t} (sn: ${s} cc: ${l})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:i,mediaSource:s}=this,l=this.tracks[e],u=l==null?void 0:l.buffer;if(!i||!s||!u){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const h=le(i.duration)?i.duration:1/0,d=le(s.duration)?s.duration:1/0,f=Math.max(0,t),m=Math.min(n,h,d);m>f&&(!l.ending||l.ended)?(l.ended=!1,this.log(`Removing [${f},${m}] from the ${e} SourceBuffer`),u.remove(f,m)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],i=n==null?void 0:n.buffer;if(!i)throw new $T(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,i=t.map(l=>this.appendBlocker(l));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(l=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const i=(n=this.tracks[t])==null?void 0:n.buffer;!i||i.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const i=this.tracks[e];if(!i)return;const s=i.buffer;if(!s)return;const l=n.bind(this,e);i.listeners.push({event:t,listener:l}),s.addEventListener(t,l)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(i=>{n.removeEventListener(i.event,i.listener)}),t.listeners.length=0)}}function Wm(a){const e=a.querySelectorAll("source");[].slice.call(e).forEach(t=>{a.removeChild(t)})}function GT(a,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,a.appendChild(t)}function $u(a){return a==="audio"?1:0}class Kc{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&le(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((i,s)=>this.isLevelAllowed(i)&&s<=e);return this.clientRect=null,Kc.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const i=(u,h)=>h?u.width!==h.width||u.height!==h.height:!0;let s=e.length-1;const l=Math.max(t,n);for(let u=0;u<e.length;u+=1){const h=e[u];if((h.width>=l||h.height>=l)&&i(h,e[u+1])){s=u;break}}return s}}const VT={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Ct=VT,KT={HLS:"h"},HT=KT;class Rn{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof Rn?n:new Rn(n))),this.value=e,this.params=t}}const WT="Dict";function zT(a){return Array.isArray(a)?JSON.stringify(a):a instanceof Map?"Map{}":a instanceof Set?"Set{}":typeof a=="object"?JSON.stringify(a):String(a)}function YT(a,e,t,n){return new Error(`failed to ${a} "${zT(e)}" as ${t}`,{cause:n})}function wn(a,e,t){return YT("serialize",a,e,t)}class jg{constructor(e){this.description=e}}const zm="Bare Item",qT="Boolean";function QT(a){if(typeof a!="boolean")throw wn(a,qT);return a?"?1":"?0"}function XT(a){return btoa(String.fromCharCode(...a))}const JT="Byte Sequence";function ZT(a){if(ArrayBuffer.isView(a)===!1)throw wn(a,JT);return`:${XT(a)}:`}const e1="Integer";function t1(a){return a<-999999999999999||999999999999999<a}function Gg(a){if(t1(a))throw wn(a,e1);return a.toString()}function n1(a){return`@${Gg(a.getTime()/1e3)}`}function Vg(a,e){if(a<0)return-Vg(-a,e);const t=Math.pow(10,e);if(Math.abs(a*t%1-.5)<Number.EPSILON){const i=Math.floor(a*t);return(i%2===0?i:i+1)/t}else return Math.round(a*t)/t}const r1="Decimal";function i1(a){const e=Vg(a,3);if(Math.floor(Math.abs(e)).toString().length>12)throw wn(a,r1);const t=e.toString();return t.includes(".")?t:`${t}.0`}const s1="String",a1=/[\x00-\x1f\x7f]+/;function o1(a){if(a1.test(a))throw wn(a,s1);return`"${a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function l1(a){return a.description||a.toString().slice(7,-1)}const u1="Token";function Ym(a){const e=l1(a);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw wn(e,u1);return e}function hc(a){switch(typeof a){case"number":if(!le(a))throw wn(a,zm);return Number.isInteger(a)?Gg(a):i1(a);case"string":return o1(a);case"symbol":return Ym(a);case"boolean":return QT(a);case"object":if(a instanceof Date)return n1(a);if(a instanceof Uint8Array)return ZT(a);if(a instanceof jg)return Ym(a);default:throw wn(a,zm)}}const c1="Key";function fc(a){if(/^[a-z*][a-z0-9\-_.*]*$/.test(a)===!1)throw wn(a,c1);return a}function Hc(a){return a==null?"":Object.entries(a).map(([e,t])=>t===!0?`;${fc(e)}`:`;${fc(e)}=${hc(t)}`).join("")}function Kg(a){return a instanceof Rn?`${hc(a.value)}${Hc(a.params)}`:hc(a)}function d1(a){return`(${a.value.map(Kg).join(" ")})${Hc(a.params)}`}function h1(a,e={whitespace:!0}){if(typeof a!="object"||a==null)throw wn(a,WT);const t=a instanceof Map?a.entries():Object.entries(a),n=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([i,s])=>{s instanceof Rn||(s=new Rn(s));let l=fc(i);return s.value===!0?l+=Hc(s.params):(l+="=",Array.isArray(s.value)?l+=d1(s):l+=Kg(s)),l}).join(`,${n}`)}function Hg(a,e){return h1(a,e)}const En="CMCD-Object",Xe="CMCD-Request",Pr="CMCD-Session",hr="CMCD-Status",f1={br:En,ab:En,d:En,ot:En,tb:En,tpb:En,lb:En,tab:En,lab:En,url:En,pb:Xe,bl:Xe,tbl:Xe,dl:Xe,ltc:Xe,mtp:Xe,nor:Xe,nrr:Xe,rc:Xe,sn:Xe,sta:Xe,su:Xe,ttfb:Xe,ttfbb:Xe,ttlb:Xe,cmsdd:Xe,cmsds:Xe,smrt:Xe,df:Xe,cs:Xe,ts:Xe,cid:Pr,pr:Pr,sf:Pr,sid:Pr,st:Pr,v:Pr,msd:Pr,bs:hr,bsd:hr,cdn:hr,rtp:hr,bg:hr,pt:hr,ec:hr,e:hr},m1={REQUEST:Xe};function p1(a){return Object.keys(a).reduce((e,t)=>{var n;return(n=a[t])===null||n===void 0||n.forEach(i=>e[i]=t),e},{})}function g1(a,e){const t={};if(!a)return t;const n=Object.keys(a),i=e?p1(e):{};return n.reduce((s,l)=>{var u;const h=f1[l]||i[l]||m1.REQUEST,d=(u=s[h])!==null&&u!==void 0?u:s[h]={};return d[l]=a[l],s},t)}function y1(a){return["ot","sf","st","e","sta"].includes(a)}function v1(a){return typeof a=="number"?le(a):a!=null&&a!==""&&a!==!1}const Wg="event";function x1(a,e){const t=new URL(a),n=new URL(e);if(t.origin!==n.origin)return a;const i=t.pathname.split("/").slice(1),s=n.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")+t.search+t.hash}const co=a=>Math.round(a),mc=(a,e)=>Array.isArray(a)?a.map(t=>mc(t,e)):a instanceof Rn&&typeof a.value=="string"?new Rn(mc(a.value,e),a.params):(e.baseUrl&&(a=x1(a,e.baseUrl)),e.version===1?encodeURIComponent(a):a),qa=a=>co(a/100)*100,E1=(a,e)=>{let t=a;return e.version>=2&&(a instanceof Rn&&typeof a.value=="string"?t=new Rn([a]):typeof a=="string"&&(t=[a])),mc(t,e)},S1={br:co,d:co,bl:qa,dl:qa,mtp:qa,nor:E1,rtp:qa,tb:co},zg="request",Yg="response",Wc=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],T1=["e"],L1=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function ko(a){return L1.test(a)}function A1(a){return Wc.includes(a)||T1.includes(a)||ko(a)}const qg=["d","dl","nor","ot","rtp","su"];function I1(a){return Wc.includes(a)||qg.includes(a)||ko(a)}const R1=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function w1(a){return Wc.includes(a)||qg.includes(a)||R1.includes(a)||ko(a)}const b1=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function _1(a){return b1.includes(a)||ko(a)}const k1={[Yg]:w1,[Wg]:A1,[zg]:I1};function Qg(a,e={}){const t={};if(a==null||typeof a!="object")return t;const n=e.version||a.v||1,i=e.reportingMode||zg,s=n===1?_1:k1[i];let l=Object.keys(a).filter(s);const u=e.filter;typeof u=="function"&&(l=l.filter(u));const h=i===Yg||i===Wg;h&&!l.includes("ts")&&l.push("ts"),n>1&&!l.includes("v")&&l.push("v");const d=Fe({},S1,e.formatters),f={version:n,reportingMode:i,baseUrl:e.baseUrl};return l.sort().forEach(m=>{let g=a[m];const v=d[m];if(typeof v=="function"&&(g=v(g,f)),m==="v"){if(n===1)return;g=n}m=="pr"&&g===1||(h&&m==="ts"&&!le(g)&&(g=Date.now()),v1(g)&&(y1(m)&&typeof g=="string"&&(g=new jg(g)),t[m]=g))}),t}function C1(a,e={}){const t={};if(!a)return t;const n=Qg(a,e),i=g1(n,e==null?void 0:e.customHeaderMap);return Object.entries(i).reduce((s,[l,u])=>{const h=Hg(u,{whitespace:!1});return h&&(s[l]=h),s},t)}function D1(a,e,t){return Fe(a,C1(e,t))}const P1="CMCD";function N1(a,e={}){return a?Hg(Qg(a,e),{whitespace:!1}):""}function O1(a,e={}){if(!a)return"";const t=N1(a,e);return encodeURIComponent(t)}function M1(a,e={}){if(!a)return"";const t=O1(a,e);return`${P1}=${t}`}const qm=/CMCD=[^&#]+/;function F1(a,e,t){const n=M1(e,t);if(!n)return a;if(qm.test(a))return a.replace(qm,n);const i=a.includes("?")?"&":"?";return`${a}${i}${n}`}class B1{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:Ct.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=i=>{try{const{frag:s,part:l}=i,u=this.hls.levels[s.level],h=this.getObjectType(s),d={d:(l||s).duration*1e3,ot:h};(h===Ct.VIDEO||h===Ct.AUDIO||h==Ct.MUXED)&&(d.br=u.bitrate/1e3,d.tb=this.getTopBandwidth(h)/1e3,d.bl=this.getBufferLength(h));const f=l?this.getNextPart(l):this.getNextFrag(s);f!=null&&f.url&&f.url!==s.url&&(d.nor=f.url),this.apply(i,d)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHED,this.onMediaDetached,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHED,this.onMediaDetached,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,i;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:HT.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Fe(t,this.createData());const n=t.ot===Ct.INIT||t.ot===Ct.VIDEO||t.ot===Ct.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((l,u)=>(i.includes(u)&&(l[u]=t[u]),l),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),D1(e.headers,t,s)):e.url=F1(e.url,t,s)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const i=e.sn-n.startSN;return n.fragments[i+1]}}getNextPart(e){var t;const{index:n,fragment:i}=e,s=(t=this.hls.levels[i.level])==null||(t=t.details)==null?void 0:t.partList;if(s){const{sn:l}=i;for(let u=s.length-1;u>=0;u--){const h=s[u];if(h.index===n&&h.fragment.sn===l)return s[u+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Ct.TIMED_TEXT;if(e.sn==="initSegment")return Ct.INIT;if(t==="audio")return Ct.AUDIO;if(t==="main")return this.hls.audioTracks.length?Ct.VIDEO:Ct.MUXED}getTopBandwidth(e){let t=0,n;const i=this.hls;if(e===Ct.AUDIO)n=i.audioTracks;else{const s=i.maxAutoLevel,l=s>-1?s+1:i.levels.length;n=i.levels.slice(0,l)}return n.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===Ct.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:Ie.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,l,u){t(s),this.loader.load(s,l,u)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,l,u){t(s),this.loader.load(s,l,u)}}}}const U1=3e5;class $1 extends Zt{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((n==null?void 0:n.action)===mt.SendAlternateToPenaltyBox&&n.flags===$t.MoveAllAlternatesMatchingHost){const i=this.levels;let s=this._pathwayPriority,l=this.pathwayId;if(t.context){const{groupId:u,pathwayId:h,type:d}=t.context;u&&i?l=this.getPathwayForGroupId(u,d,l):h&&(l=h)}l in this.penalizedPathways||(this.penalizedPathways[l]=performance.now()),!s&&i&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),n.resolved=this.pathwayId!==l),t.details===G.BUFFER_APPEND_ERROR&&!t.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${l} levels: ${i&&i.length} priorities: ${Ue(s)} penalized: ${Ue(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,i=performance.now();Object.keys(n).forEach(s=>{i-n[s]>U1&&delete n[s]});for(let s=0;s<e.length;s++){const l=e[s];if(l in n)continue;if(l===this.pathwayId)return;const u=this.hls.nextLoadLevel,h=this.hls.levels[u];if(t=this.getLevelsForPathway(l),t.length>0){this.log(`Setting Pathway to "${l}"`),this.pathwayId=l,gg(t),this.hls.trigger(L.LEVELS_UPDATED,{levels:t});const d=this.hls.levels[u];h&&d&&this.levels&&(d.attrs["STABLE-VARIANT-ID"]!==h.attrs["STABLE-VARIANT-ID"]&&d.bitrate!==h.bitrate&&this.log(`Unstable Pathways change from bitrate ${h.bitrate} to ${d.bitrate}`),this.hls.nextLoadLevel=u);break}}}getPathwayForGroupId(e,t,n){const i=this.getLevelsForPathway(n).concat(this.levels||[]);for(let s=0;s<i.length;s++)if(t===_e.AUDIO_TRACK&&i[s].hasAudioGroup(e)||t===_e.SUBTITLE_TRACK&&i[s].hasSubtitleGroup(e))return i[s].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},i={};e.forEach(s=>{const{ID:l,"BASE-ID":u,"URI-REPLACEMENT":h}=s;if(t.some(f=>f.pathwayId===l))return;const d=this.getLevelsForPathway(u).map(f=>{const m=new ze(f.attrs);m["PATHWAY-ID"]=l;const g=m.AUDIO&&`${m.AUDIO}_clone_${l}`,v=m.SUBTITLES&&`${m.SUBTITLES}_clone_${l}`;g&&(n[m.AUDIO]=g,m.AUDIO=g),v&&(i[m.SUBTITLES]=v,m.SUBTITLES=v);const x=Xg(f.uri,m["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),T=new Ls({attrs:m,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:x,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(let S=1;S<f.audioGroups.length;S++)T.addGroupId("audio",`${f.audioGroups[S]}_clone_${l}`);if(f.subtitleGroups)for(let S=1;S<f.subtitleGroups.length;S++)T.addGroupId("text",`${f.subtitleGroups[S]}_clone_${l}`);return T});t.push(...d),Qm(this.audioTracks,n,h,l),Qm(this.subtitleTracks,i,h,l)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const f=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+f)}const s={responseType:"json",url:i.href},l=t.steeringManifestLoadPolicy.default,u=l.errorRetry||l.timeoutRetry||{},h={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},d={onSuccess:(f,m,g,v)=>{this.log(`Loaded steering manifest: "${i}"`);const x=f.data;if((x==null?void 0:x.VERSION)!==1){this.log(`Steering VERSION ${x.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=x.TTL;const{"RELOAD-URI":T,"PATHWAY-CLONES":S,"PATHWAY-PRIORITY":I}=x;if(T)try{this.uri=new self.URL(T,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${T}`);return}this.scheduleRefresh(this.uri||g.url),S&&this.clonePathways(S);const b={steeringManifest:x,url:i.toString()};this.hls.trigger(L.STEERING_MANIFEST_LOADED,b),I&&this.updatePathwayPriority(I)},onError:(f,m,g,v)=>{if(this.log(`Error loading steering manifest: ${f.code} ${f.text} (${m.url})`),this.stopLoad(),f.code===410){this.enabled=!1,this.log(`Steering manifest ${m.url} no longer available`);return}let x=this.timeToLoad*1e3;if(f.code===429){const T=this.loader;if(typeof(T==null?void 0:T.getResponseHeader)=="function"){const S=T.getResponseHeader("Retry-After");S&&(x=parseFloat(S)*1e3)}this.log(`Steering manifest ${m.url} rate limited`);return}this.scheduleRefresh(this.uri||m.url,x)},onTimeout:(f,m,g)=>{this.log(`Timeout loading steering manifest (${m.url})`),this.scheduleRefresh(this.uri||m.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(s,h,d)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const i=(n=this.hls)==null?void 0:n.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Qm(a,e,t,n){a&&Object.keys(e).forEach(i=>{const s=a.filter(l=>l.groupId===i).map(l=>{const u=Fe({},l);return u.details=void 0,u.attrs=new ze(u.attrs),u.url=u.attrs.URI=Xg(l.url,l.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),u.groupId=u.attrs["GROUP-ID"]=e[i],u.attrs["PATHWAY-ID"]=n,u});a.push(...s)})}function Xg(a,e,t,n){const{HOST:i,PARAMS:s,[t]:l}=n;let u;e&&(u=l==null?void 0:l[e],u&&(a=u));const h=new self.URL(a);return i&&!u&&(h.host=i),s&&Object.keys(s).sort().forEach(d=>{d&&h.searchParams.set(d,s[d])}),h.href}class Ti extends Zt{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Ti.CDMCleanupPromise?[Ti.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:n,initData:i}=t,s=`"${t.type}" event: init data type: "${n}"`;if(this.debug(s),i!==null){if(!this.keyFormatPromise){let l=Object.keys(this.keySystemAccessPromises);l.length||(l=gs(this.config));const u=l.map(Du).filter(h=>!!h);this.keyFormatPromise=this.getKeyFormatPromise(u)}this.keyFormatPromise.then(l=>{const u=oo(l);if(n!=="sinf"||u!==Ye.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${n}" for selected key-system ${u}`);return}let h;try{const v=st(new Uint8Array(i)),x=Nc(JSON.parse(v).sinf),T=Hp(x);if(!T)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");h=new Uint8Array(T.subarray(8,24))}catch(v){this.warn(`${s} Failed to parse sinf: ${v}`);return}const d=pt(h),{keyIdToKeySessionPromise:f,mediaKeySessions:m}=this;let g=f[d];for(let v=0;v<m.length;v++){const x=m[v],T=x.decryptdata;if(!T.keyId)continue;const S=pt(T.keyId);if(So(h,T.keyId)||T.uri.replace(/-/g,"").indexOf(d)!==-1){if(g=f[S],!g)continue;if(T.pssh)break;delete f[S],T.pssh=new Uint8Array(i),T.keyId=h,g=f[d]=g.then(()=>this.generateRequestWithPreferredKeySession(x,n,i,"encrypted-event-key-match")),g.catch(I=>this.handleError(I));break}}g||this.handleError(new Error(`Key ID ${d} not encountered in playlist. Key-system sessions ${m.length}.`))}).catch(l=>this.handleError(l))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(L.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(L.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,i=t==null?void 0:t[e];if(i)return i.licenseUrl;if(e===Ye.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t==null?void 0:t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(l,u,h)=>!!l&&h.indexOf(l)===u,i=t.map(l=>l.audioCodec).filter(n),s=t.map(l=>l.videoCodec).filter(n);return i.length+s.length===0&&s.push("avc1.42e01e"),new Promise((l,u)=>{const h=d=>{const f=d.shift();this.getMediaKeysPromise(f,i,s).then(m=>l({keySystem:f,mediaKeys:m})).catch(m=>{d.length?h(d):m instanceof Ut?u(m):u(new Ut({type:ve.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};h(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${n}`;return lg===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return n(e,t)}getMediaKeysPromise(e,t,n){var i;const s=ES(e,t,n,this.config.drmSystemOptions||{});let l=this.keySystemAccessPromises[e],u=(i=l)==null?void 0:i.keySystemAccess;if(!u){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Ue(s)}`),u=this.requestMediaKeySystemAccess(e,s);const h=l=this.keySystemAccessPromises[e]={keySystemAccess:u};return u.catch(d=>{this.log(`Failed to obtain access to key-system "${e}": ${d}`)}),u.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const f=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const m=h.mediaKeys=d.createMediaKeys().then(g=>(this.log(`Media-keys created for "${e}"`),h.hasMediaKeys=!0,f.then(v=>v?this.setMediaKeysServerCertificate(g,e,v):g)));return m.catch(g=>{this.error(`Failed to create media-keys for "${e}"}: ${g}`)}),m})}return u.then(()=>l.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${pt(e.keyId||[])} keyUri: ${e.uri}`);const i=n.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),i=Qa(t),s="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${pt(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Du(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:i})=>{const s=Du(i);s?t(s):n(new Error(`Unable to find format for key-system "${i}"`))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=gs(this.config),n=e.map(oo).filter(i=>!!i&&t.indexOf(i)!==-1);return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const i=j1(e,t[n]);if(i)return i}}loadKey(e){const t=e.keyInfo.decryptdata,n=Qa(t),i=this.bannedKeyIds[n];if(i||this.getKeyStatus(t)==="internal-error"){const u=Xm(i||"internal-error",t);return this.handleError(u,e.frag),Promise.reject(u)}const s=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);const l=this.keyIdToKeySessionPromise[n];if(!l){const u=this.getKeySystemForKeyPromise(t).then(({keySystem:h,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(h,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:h,mediaKeys:d,decryptdata:t}))))).then(h=>{const d="cenc",f=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(h,d,f,"playlist-key")});return u.catch(h=>this.handleError(h,e.frag)),this.keyIdToKeySessionPromise[n]=u,u}return l.catch(u=>{if(u instanceof Ut){const h=Oe({},u.data);this.getKeyStatus(t)==="internal-error"&&(h.decryptdata=t);const d=new Ut(h,u.message);this.handleError(d,e.frag)}}),l}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Ut){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error(`${e.message}${n?` (${pt(n.keyId||[])})`:""}`),this.hls.trigger(L.ERROR,e.data)}else this.error(e.message),this.hls.trigger(L.ERROR,{type:ve.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Qa(e),n=this.keyIdToKeySessionPromise[t];if(!n){const i=oo(e.keyFormat),s=i?[i]:gs(this.config);return this.attemptKeySystemAccess(s)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=gs(this.config)),e.length===0)throw new Ut({type:ve.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Ue({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(t):new Promise((s,l)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return l(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(s).catch(l)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>n.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,n,i){var s;const l=(s=this.config.drmSystems)==null||(s=s[e.keySystem])==null?void 0:s.generateRequest;if(l)try{const x=l.call(this.hls,t,n,e);if(!x)throw new Error("Invalid response from configured generateRequest filter");t=x.initDataType,n=x.initData?x.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(x){if(this.warn(x.message),this.hls&&this.hls.config.debug)throw x}if(n===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const u=Qa(e.decryptdata),h=e.decryptdata.uri;this.log(`Generating key-session request for "${i}" keyId: ${u} URI: ${h} (init data type: ${t} length: ${n.byteLength})`);const d=new Mc,f=e._onmessage=x=>{const T=e.mediaKeysSession;if(!T){d.emit("error",new Error("invalid state"));return}const{messageType:S,message:I}=x;this.log(`"${S}" message event for session "${T.sessionId}" message size: ${I.byteLength}`),S==="license-request"||S==="license-renewal"?this.renewLicense(e,I).catch(b=>{d.eventNames().length?d.emit("error",b):this.handleError(b)}):S==="license-release"?e.keySystem===Ye.FAIRPLAY&&this.updateKeySession(e,ac("acknowledged")).then(()=>this.removeSession(e)).catch(b=>this.handleError(b)):this.warn(`unhandled media key message type "${S}"`)},m=(x,T)=>{T.keyStatus=x;let S;x.startsWith("usable")?d.emit("resolved"):x==="internal-error"||x==="output-restricted"||x==="output-downscaled"?S=Xm(x,T.decryptdata):x==="expired"?S=new Error(`key expired (keyId: ${u})`):x==="released"?S=new Error("key released"):x==="status-pending"||this.warn(`unhandled key status change "${x}" (keyId: ${u})`),S&&(d.eventNames().length?d.emit("error",S):this.handleError(S))},g=e._onkeystatuseschange=x=>{if(!e.mediaKeysSession){d.emit("error",new Error("invalid state"));return}const S=this.getKeyStatuses(e);if(!Object.keys(S).some(_=>S[_]!=="status-pending"))return;if(S[u]==="expired"){this.log(`Expired key ${Ue(S)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let b=S[u];if(b)m(b,e);else{var w;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(w=e.keyStatusTimeouts)[u]||(w[u]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const D=this.getKeyStatus(e.decryptdata);if(D&&D!=="status-pending")return this.log(`No status for keyId ${u} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${D} from other session.`),m(D,e);this.log(`key status for ${u} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),b="internal-error",m(b,e)},1e3)),this.log(`No status for keyId ${u} (${Ue(S)}).`)}};At(e.mediaKeysSession,"message",f),At(e.mediaKeysSession,"keystatuseschange",g);const v=new Promise((x,T)=>{d.on("error",T),d.on("resolved",x)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${u} URI: ${h}`)}).catch(x=>{throw new Ut({type:ve.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_SESSION,error:x,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${x}`)}).then(()=>v).catch(x=>(d.removeAllListeners(),this.removeSession(e).then(()=>{throw x}))).then(()=>(d.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,i)=>{if(typeof i=="string"&&typeof n=="object"){const u=i;i=n,n=u}const s="buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i);if(e.keySystem===Ye.PLAYREADY&&s.length===16){const u=pt(s);t[u]=n,ag(s)}const l=pt(s);n==="internal-error"&&(this.bannedKeyIds[l]=n),this.log(`key status change "${n}" for keyStatuses keyId: ${l} key-session "${e.mediaKeysSession.sessionId}"`),t[l]=n}),t}fetchServerCertificate(e){const t=this.config,n=t.loader,i=new n(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((l,u)=>{const h={responseType:"arraybuffer",url:s},d=t.certLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(g,v,x,T)=>{l(g.data)},onError:(g,v,x,T)=>{u(new Ut({type:ve.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:x,response:Oe({url:h.url,data:void 0},g)},`"${e}" certificate request failed (${s}). Status: ${g.code} (${g.text})`))},onTimeout:(g,v,x)=>{u(new Ut({type:ve.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:x,response:{url:h.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(g,v,x)=>{u(new Error("aborted"))}};i.load(h,f,m)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((i,s)=>{e.setServerCertificate(n).then(l=>{this.log(`setServerCertificate ${l?"success":"not supported by CDM"} (${n.byteLength}) on "${t}"`),i(e)}).catch(l=>{s(new Ut({type:ve.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:l,fatal:!0},l.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(i=>{throw new Ut({type:ve.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:i,fatal:!1},i.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(n,"application/xml"),s=i.querySelectorAll("HttpHeader");if(s.length>0){let f;for(let m=0,g=s.length;m<g;m++){var l,u;f=s[m];const v=(l=f.querySelector("name"))==null?void 0:l.textContent,x=(u=f.querySelector("value"))==null?void 0:u.textContent;v&&x&&e.setRequestHeader(v,x)}}const h=i.querySelector("Challenge"),d=h==null?void 0:h.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return ac(atob(d))}setupLicenseXHR(e,t,n,i){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,n,i)}).catch(l=>{if(!n.decryptdata)throw l;return e.open("POST",t,!0),s.call(this.hls,e,t,n,i)}).then(l=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:l||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((i,s)=>{const l=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${l}`);const u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(u.readyState===4)if(u.status===200){this._requestLicenseFailureCount=0;let h=u.response;this.log(`License received ${h instanceof ArrayBuffer?h.byteLength:h}`);const d=this.config.licenseResponseCallback;if(d)try{h=d.call(this.hls,u,l,e)}catch(f){this.error(f)}i(h)}else{const h=n.errorRetry,d=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||u.status>=400&&u.status<500)s(new Ut({type:ve.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:u,response:{url:l,data:void 0,code:u.status,text:u.statusText}},`License Request XHR failed (${l}). Status: ${u.status} (${u.statusText})`));else{const f=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${f} attempts left`),this.requestLicense(e,t).then(i,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=u,this.setupLicenseXHR(u,l,e,t).then(({xhr:h,licenseChallenge:d})=>{e.keySystem==Ye.PLAYREADY&&(d=this.unpackPlayReadyKeyMessage(h,d)),h.send(d)}).catch(s)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,At(n,"encrypted",this.onMediaEncrypted),At(n,"waitingforkey",this.onWaitingForKey);const i=this.mediaResolved;i?i():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&(Pt(e,"encrypted",this.onMediaEncrypted),Pt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,pr.clearKeyUriToKeyIdMap();const s=i.length;Ti.CDMCleanupPromise=Promise.all(i.map(l=>this.removeSession(l)).concat((n==null||(e=n.setMediaKeys(null))==null?void 0:e.catch(l=>{this.log(`Could not clear media keys: ${l}`),this.hls&&this.hls.trigger(L.ERROR,{type:ve.OTHER_ERROR,details:G.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${l}`)})}))||Promise.resolve())).catch(l=>{this.log(`Could not close sessions and clear media keys: ${l}`),this.hls&&this.hls.trigger(L.ERROR,{type:ve.OTHER_ERROR,details:G.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${l}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((i,s)=>(i.indexOf(s.keyFormat)===-1&&i.push(s.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:i}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${pt((i==null?void 0:i.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{keyStatusTimeouts:l}=e;l&&Object.keys(l).forEach(d=>self.clearTimeout(l[d]));const{drmSystemOptions:u}=this.config;return(TS(u)?new Promise((d,f)=>{self.setTimeout(()=>f(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(d).catch(f)}):Promise.resolve()).catch(d=>{this.log(`Could not remove session: ${d}`),this.hls&&this.hls.trigger(L.ERROR,{type:ve.OTHER_ERROR,details:G.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>t.close()).catch(d=>{this.log(`Could not close session: ${d}`),this.hls&&this.hls.trigger(L.ERROR,{type:ve.OTHER_ERROR,details:G.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}return Promise.resolve()}}Ti.CDMCleanupPromise=void 0;function Qa(a){if(!a)throw new Error("Could not read keyId of undefined decryptdata");if(a.keyId===null)throw new Error("keyId is null");return pt(a.keyId)}function j1(a,e){if(a.keyId&&e.mediaKeysSession.keyStatuses.has(a.keyId))return e.mediaKeysSession.keyStatuses.get(a.keyId);if(a.matches(e.decryptdata))return e.keyStatus}class Ut extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function Xm(a,e){const t=a==="output-restricted",n=t?G.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:G.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Ut({type:ve.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${a}"`)}class G1{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const i=performance.now();if(t){if(this.lastTime){const s=i-this.lastTime,l=n-this.lastDroppedFrames,u=t-this.lastDecodedFrames,h=1e3*l/s,d=this.hls;if(d.trigger(L.FPS_DROP,{currentDropped:l,currentDecoded:u,totalDroppedFrames:n}),h>0&&l>d.config.fpsDroppedMonitoringThreshold*u){let f=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=f)&&(f=f-1,d.trigger(L.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:d.currentLevel}),d.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function Jg(a,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=a,e.dispatchEvent(t)}function Zg(a,e){const t=a.mode;if(t==="disabled"&&(a.mode="hidden"),a.cues&&!a.cues.getCueById(e.id))try{if(a.addCue(e),!a.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){Me.debug(`[texttrack-utils]: ${n}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,a.addCue(i)}catch(i){Me.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(a.mode=t)}function xi(a,e){const t=a.mode;if(t==="disabled"&&(a.mode="hidden"),a.cues)for(let n=a.cues.length;n--;)e&&a.cues[n].removeEventListener("enter",e),a.removeCue(a.cues[n]);t==="disabled"&&(a.mode=t)}function pc(a,e,t,n){const i=a.mode;if(i==="disabled"&&(a.mode="hidden"),a.cues&&a.cues.length>0){const s=K1(a.cues,e,t);for(let l=0;l<s.length;l++)(!n||n(s[l]))&&a.removeCue(s[l])}i==="disabled"&&(a.mode=i)}function V1(a,e){if(e<=a[0].startTime)return 0;const t=a.length-1;if(e>a[t].endTime)return-1;let n=0,i=t,s;for(;n<=i;)if(s=Math.floor((i+n)/2),e<a[s].startTime)i=s-1;else if(e>a[s].startTime&&n<t)n=s+1;else return s;return a[n].startTime-e<e-a[i].startTime?n:i}function K1(a,e,t){const n=[],i=V1(a,e);if(i>-1)for(let s=i,l=a.length;s<l;s++){const u=a[s];if(u.startTime>=e&&u.endTime<=t)n.push(u);else if(u.startTime>t)return n}return n}function ho(a){const e=[];for(let t=0;t<a.length;t++){const n=a[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(a[t])}return e}class H1 extends Vc{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=ho(this.media.textTracks);for(let s=0;s<n.length;s++)if(n[s].mode==="hidden")t=n[s];else if(n[s].mode==="showing"){t=n[s];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;ho(n.textTracks).forEach(l=>{xi(l)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:i,details:s}=t,l=this.tracksInGroup[n];if(!l||l.groupId!==i){this.warn(`Subtitle track with id:${n} and group:${i} not found in active group ${l==null?void 0:l.groupId}`);return}const u=l.details;l.details=t.details,this.log(`Subtitle track ${n} "${l.name}" lang:${l.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,i=this.groupIds;let s=this.currentTrack;if(!n||(i==null?void 0:i.length)!==(n==null?void 0:n.length)||n!=null&&n.some(l=>(i==null?void 0:i.indexOf(l))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const l=this.tracks.filter(f=>!n||n.indexOf(f.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(f=>f.default)&&(this.selectDefaultTrack=!1),l.forEach((f,m)=>{f.id=m});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=l;const u=this.hls.config.subtitlePreference;if(!s&&u){this.selectDefaultTrack=!1;const f=Ln(u,l);if(f>-1)s=l[f];else{const m=Ln(u,this.tracks);s=this.tracks[m]}}let h=this.findTrackId(s);h===-1&&s&&(h=this.findTrackId(null));const d={subtitleTracks:l};this.log(`Updating subtitle tracks, ${l.length} track(s) found in "${n==null?void 0:n.join(",")}" group-id`),this.hls.trigger(L.SUBTITLE_TRACKS_UPDATED,d),h!==-1&&this.trackId===-1&&this.setSubtitleTrack(h)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const s=t[i];if(!(n&&!s.default||!n&&!e)&&(!e||Mr(s,e)))return i}if(e){for(let i=0;i<t.length;i++){const s=t[i];if(ws(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const s=t[i];if(ws(e.attrs,s.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if(dc(i,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===_e.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&Mr(e,n))return n;const i=Ln(e,this.tracksInGroup);if(i>-1){const s=this.tracksInGroup[i];return this.setSubtitleTrack(i),s}else{if(n)return null;{const s=Ln(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),l=e.details,u=l==null?void 0:l.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&l.live?" age "+u.toFixed(1)+(l.type&&" "+l.type||""):""} ${s}`),this.hls.trigger(L.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=ho(e.textTracks),n=this.currentTrack;let i;if(n&&(i=t.filter(s=>dc(n,s))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==i&&(s.mode="disabled")}),i){const s=this.subtitleDisplay?"showing":"hidden";i.mode!==s&&(i.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!le(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!i.details&&!i.details.live;if(e===this.trackId&&i===n&&s)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:l,groupId:u="",name:h,type:d,url:f}=i;this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:l,groupId:u,name:h,type:d,url:f});const m=this.switchParams(i.url,n==null?void 0:n.details,i.details);this.loadPlaylist(m)}}function W1(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?s:s&3|8).toString(16)})}}}function xs(a){let e=5381,t=a.length;for(;t;)e=e*33^a.charCodeAt(--t);return(e>>>0).toString()}const Li=.025;let Io=(function(a){return a[a.Point=0]="Point",a[a.Range=1]="Range",a})({});function z1(a,e,t){return`${a.identifier}-${t+1}-${xs(e)}`}class Y1{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return ju(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=ju(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=le(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return ju(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Li))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Io.Range:Io.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return q1(this)}}function ju(a,e){return a-e.start<e.duration/2&&!(Math.abs(a-(e.start+e.duration))<Li)?e.start:e.start+e.duration}function e0(a,e,t){const n=new self.URL(a,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function Gu(a,e){for(;(t=a.assetList[++e])!=null&&t.error;)var t;return e}function q1(a){return`["${a.identifier}" ${a.cue.pre?"<pre>":a.cue.post?"<post>":""}${a.timelineStart.toFixed(2)}-${a.resumeTime.toFixed(2)}]`}function vi(a){const e=a.timelineStart,t=a.duration||0;return`["${a.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class Q1{constructor(e,t,n,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(L.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=n,this.assetItem=i;const l=()=>{this.hasDetails=!0};s.once(L.LEVEL_LOADED,l),s.once(L.AUDIO_TRACK_LOADED,l),s.once(L.SUBTITLE_TRACK_LOADED,l),s.on(L.MEDIA_ATTACHING,(u,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(L.BUFFER_APPENDED,()=>{const f=this.bufferedEnd;this.reachedPlayout(f)&&(this._bufferedEosTime=f,s.trigger(L.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=e0(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,s=Ie.bufferInfo(e,i,0);return this.getAssetTime(s.end)>=n-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Ie.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var i;(i=this.hls)==null||i.on(e,t)}once(e,t,n){var i;(i=this.hls)==null||i.once(e,t)}off(e,t,n){var i;(i=this.hls)==null||i.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${vi(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Jm=.033;class X1 extends Zt{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(s=i[n])!=null&&s.event;){var s;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let i=0;i<n.length;i++){let s=n[i];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return i}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let i=e;i<=t&&n[i];i++){const s=n[i].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var n;if(((n=t[i].event)==null?void 0:n.identifier)===e)return i}return-1}findAssetIndex(e,t){const n=e.assetList,i=n.length;if(i>1)for(let s=0;s<i;s++){const l=n[s];if(!l.error){const u=l.timelineStart;if(t===u||t>u&&(t<u+(l.duration||0)||s===i-1))return s}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const n=t.assetList,i=n[n.length-1];if(i)return i.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:i}=n,s=this.events,l=this.parseDateRanges(i,{url:n.url},t),u=Object.keys(i),h=s?s.filter(d=>!u.includes(d.identifier)):[];l.length&&l.sort((d,f)=>{const m=d.cue.pre,g=d.cue.post,v=f.cue.pre,x=f.cue.post;if(m&&!v)return-1;if(v&&!m||g&&!x)return 1;if(x&&!g)return-1;if(!m&&!v&&!g&&!x){const T=d.startTime,S=f.startTime;if(T!==S)return T-S}return d.dateRange.tagOrder-f.dateRange.tagOrder}),this.events=l,h.forEach(d=>{this.removeEvent(d)}),this.updateSchedule(e,h)}updateSchedule(e,t=[],n=!1){const i=this.events||[];if(i.length||t.length||this.length<2){const s=this.items,l=this.parseSchedule(i,e);(n||t.length||(s==null?void 0:s.length)!==l.length||l.some((h,d)=>Math.abs(h.playout.start-s[d].playout.start)>.005||Math.abs(h.playout.end-s[d].playout.end)>.005))&&(this.items=l,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,n){const i=[],s=Object.keys(e);for(let l=0;l<s.length;l++){const u=s[l],h=e[u];if(h.isInterstitial){let d=this.eventMap[u];d?d.setDateRange(h):(d=new Y1(h,t),this.eventMap[u]=d,n===!1&&(d.appendInPlace=n)),i.push(d)}}return i}parseSchedule(e,t){const n=[],i=t.main.details,s=i.live?1/0:i.edge;let l=0;if(e=e.filter(h=>!h.error&&!(h.cue.once&&h.hasPlayed)),e.length){this.resolveOffsets(e,t);let h=0,d=0;if(e.forEach((f,m)=>{const g=f.cue.pre,v=f.cue.post,x=e[m-1]||null,T=f.appendInPlace,S=v?s:f.startOffset,I=f.duration,b=f.timelineOccupancy===Io.Range?I:0,w=f.resumptionOffset,_=(x==null?void 0:x.startTime)===S,D=S+f.cumulativeDuration;let j=T?D+I:S+w;if(g||!v&&S<=0){const B=d;d+=b,f.timelineStart=D;const U=l;l+=I,n.push({event:f,start:D,end:j,playout:{start:U,end:l},integrated:{start:B,end:d}})}else if(S<=s){if(!_){const O=S-h;if(O>Jm){const Y=h,ne=d;d+=O;const se=l;l+=O;const ue={previousEvent:e[m-1]||null,nextEvent:f,start:Y,end:Y+O,playout:{start:se,end:l},integrated:{start:ne,end:d}};n.push(ue)}else O>0&&x&&(x.cumulativeDuration+=O,n[n.length-1].end=S)}v&&(j=D),f.timelineStart=D;const B=d;d+=b;const U=l;l+=I,n.push({event:f,start:D,end:j,playout:{start:U,end:l},integrated:{start:B,end:d}})}else return;const P=f.resumeTime;v||P>s?h=s:h=P}),h<s){var u;const f=h,m=d,g=s-h;d+=g;const v=l;l+=g,n.push({previousEvent:((u=n[n.length-1])==null?void 0:u.event)||null,nextEvent:null,start:h,end:f+g,playout:{start:v,end:l},integrated:{start:m,end:d}})}this.setDurations(s,l,d)}else n.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,i=n.live?1/0:n.edge;let s=0,l=-1;e.forEach((u,h)=>{const d=u.cue.pre,f=u.cue.post,m=d?0:f?i:u.startTime;this.updateAssetDurations(u),l===m?u.cumulativeDuration=s:(s=0,l=m),!f&&u.snapOptions.in&&(u.resumeAnchor=Fr(null,n.fragments,u.startOffset+u.resumptionOffset,0,0)||void 0),u.appendInPlace&&!u.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(u,t)||(u.appendInPlace=!1)),!u.appendInPlace&&h+1<e.length&&e[h+1].startTime-e[h].resumeTime<Jm&&(e[h+1].appendInPlace=!1,e[h+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${u}`));const v=le(u.resumeOffset)?u.resumeOffset:u.duration;s+=v})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(n-i)>Li?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${i}`),!1):!Object.keys(t).some(l=>{const u=t[l].details,h=u.edge;if(n>=h)return this.log(`"${e.identifier}" resumption ${n} past ${l} playlist end ${h}`),!1;const d=Fr(null,u.fragments,n);if(!d)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${l} playlist (${u.fragStart}-${u.fragmentEnd})`),!0;const f=l==="audio"?.175:0;return Math.abs(d.start-n)<Li+f||Math.abs(d.end-n)<Li+f?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${l} fragment bounds (${d.start}-${d.end} sn: ${d.sn} cc: ${d.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,i=!1,s=!1;for(let l=0;l<e.assetList.length;l++){const u=e.assetList[l],h=t+n;u.startOffset=n,u.timelineStart=h,i||(i=u.duration===null),s||(s=!!u.error);const d=u.error?0:u.duration||0;n+=d}i&&!s?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function dn(a){return`[${a.event?'"'+a.event.identifier+'"':"primary"}: ${a.start.toFixed(2)}-${a.end.toFixed(2)}]`}class J1{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let i;try{i=e0(n,this.hls.sessionId,e.baseUrl)}catch(g){const v=this.assignAssetListError(e,G.ASSET_LIST_LOAD_ERROR,g,n);this.hls.trigger(L.ERROR,v);return}t&&i.protocol!=="data:"&&i.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,l=s.loader,u=new l(s),h={responseType:"json",url:i.href},d=s.interstitialAssetListLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(g,v,x,T)=>{const S=g.data,I=S==null?void 0:S.ASSETS;if(!Array.isArray(I)){const b=this.assignAssetListError(e,G.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),x.url,v,T);this.hls.trigger(L.ERROR,b);return}e.assetListResponse=S,this.hls.trigger(L.ASSET_LIST_LOADED,{event:e,assetListResponse:S,networkDetails:T})},onError:(g,v,x,T)=>{const S=this.assignAssetListError(e,G.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${g.code} ${g.text} (${v.url})`),v.url,T,x);this.hls.trigger(L.ERROR,S)},onTimeout:(g,v,x)=>{const T=this.assignAssetListError(e,G.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${v.url})`),v.url,g,x);this.hls.trigger(L.ERROR,T)}};return u.load(h,f,m),this.hls.trigger(L.ASSET_LIST_LOADING,{event:e}),u}assignAssetListError(e,t,n,i,s,l){return e.error=n,{type:ve.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:n,networkDetails:l,stats:s}}}function Zm(a){var e;a==null||(e=a.play())==null||e.catch(()=>{})}function Xa(a,e){return`[${a}] Advancing timeline position to ${e}`}class Z1 extends Zt{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled||!this.schedule)return;const i=n-this.timelinePos;if(Math.abs(i)<1/7056e5)return;const l=i<=-.01;this.timelinePos=n,this.bufferedPos=n;const u=this.playingItem;if(!u){this.checkBuffer();return}if(l&&this.schedule.resetErrorsInRange(n,n-i)&&this.updateSchedule(!0),this.checkBuffer(),l&&n<u.start||n>=u.end){var h;const v=this.findItemIndex(u);let x=this.schedule.findItemIndexAtTime(n);if(x===-1&&(x=v+(l?-1:1),this.log(`seeked ${l?"back ":""}to position not covered by schedule ${n} (resolving from ${v} to ${x})`)),!this.isInterstitial(u)&&(h=this.media)!=null&&h.paused&&(this.shouldPlay=!1),!l&&x>v){const T=this.schedule.findJumpRestrictedIndex(v+1,x);if(T>v){this.setSchedulePosition(T);return}}this.setSchedulePosition(x);return}const d=this.playingAsset;if(!d){if(this.playingLastItem&&this.isInterstitial(u)){const v=u.event.assetList[0];v&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,v))}return}const f=d.timelineStart,m=d.duration||0;if(l&&n<f||n>=f+m){var g;(g=u.event)!=null&&g.appendInPlace&&(this.clearAssetPlayers(u.event,u),this.flushFrontBuffer(n)),this.setScheduleToAssetAtTime(n,d)}},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const i=this.playingItem;if(!i||this.playingLastItem)return;if(n>=i.end){this.timelinePos=i.end;const u=this.findItemIndex(i);this.setSchedulePosition(u+1)}const s=this.playingAsset;if(!s)return;const l=s.timelineStart+(s.duration||0);n>=l&&this.setScheduleToAssetAtTime(n,s)},this.onScheduleUpdate=(n,i)=>{const s=this.schedule;if(!s)return;const l=this.playingItem,u=s.events||[],h=s.items||[],d=s.durations,f=n.map(T=>T.identifier),m=!!(u.length||f.length);(m||i)&&this.log(`INTERSTITIALS_UPDATED (${u.length}): ${u}
Schedule: ${h.map(T=>dn(T))} pos: ${this.timelinePos}`),f.length&&this.log(`Removed events ${f}`);let g=null,v=null;l&&(g=this.updateItem(l,this.timelinePos),this.itemsMatch(l,g)?this.playingItem=g:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const x=this.bufferingItem;if(x&&(v=this.updateItem(x,this.bufferedPos),this.itemsMatch(x,v)?this.bufferingItem=v:x.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(x.event,null))),n.forEach(T=>{T.assetList.forEach(S=>{this.clearAssetPlayer(S.identifier,null)})}),this.playerQueue.forEach(T=>{if(T.interstitial.appendInPlace){const S=T.assetItem.timelineStart,I=T.timelineOffset-S;if(I)try{T.timelineOffset=S}catch(b){Math.abs(I)>Li&&this.warn(`${b} ("${T.assetId}" ${T.timelineOffset}->${S})`)}}}),m||i){if(this.hls.trigger(L.INTERSTITIALS_UPDATED,{events:u.slice(0),schedule:h.slice(0),durations:d,removedIds:f}),this.isInterstitial(l)&&f.includes(l.event.identifier)){this.warn(`Interstitial "${l.event.identifier}" removed while playing`),this.primaryFallback(l.event);return}l&&this.trimInPlace(g,l),x&&v!==g&&this.trimInPlace(v,x),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new J1(e),this.schedule=new X1(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(L.MEDIA_ENDED,this.onMediaEnded,this),e.on(L.ERROR,this.onError,this),e.on(L.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(L.MEDIA_ENDED,this.onMediaEnded,this),e.off(L.ERROR,this.onError,this),e.off(L.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Pt(e,"play",this.onPlay),Pt(e,"pause",this.onPause),Pt(e,"seeking",this.onSeeking),Pt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;At(n,"seeking",this.onSeeking),At(n,"timeupdate",this.onTimeupdate),At(n,"play",this.onPlay),At(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!i){this.clearScheduleState();const s=this.findItemIndex(n);this.setSchedulePosition(s)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,i=this.media;if(this.media=null,!n&&(i&&this.removeMediaListeners(i),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.log(`Removing schedule state for detachedData and ${s}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=m=>m&&e.getAssetPlayer(m.identifier),i=(m,g,v,x,T)=>{if(m){let S=m[g].start;const I=m.event;if(I){if(g==="playout"||I.timelineOccupancy!==Io.Point){const b=n(v);(b==null?void 0:b.interstitial)===I&&(S+=b.assetItem.startOffset+b[T])}}else{const b=x==="bufferedPos"?l():e[x];S+=b-m.start}return S}return 0},s=(m,g)=>{var v;if(m!==0&&g!=="primary"&&(v=e.schedule)!=null&&v.length){var x;const T=e.schedule.findItemIndexAtTime(m),S=(x=e.schedule.items)==null?void 0:x[T];if(S){const I=S[g].start-S.start;return m+I}}return m},l=()=>{const m=e.bufferedPos;return m===Number.MAX_VALUE?u("primary"):Math.max(m,0)},u=m=>{var g,v;return(g=e.primaryDetails)!=null&&g.live?e.primaryDetails.edge:((v=e.schedule)==null?void 0:v.durations[m])||0},h=(m,g)=>{var v,x;const T=e.effectivePlayingItem;if(T!=null&&(v=T.event)!=null&&v.restrictions.skip||!e.schedule)return;e.log(`seek to ${m} "${g}"`);const S=e.effectivePlayingItem,I=e.schedule.findItemIndexAtTime(m,g),b=(x=e.schedule.items)==null?void 0:x[I],w=e.getBufferingPlayer(),_=w==null?void 0:w.interstitial,D=_==null?void 0:_.appendInPlace,j=S&&e.itemsMatch(S,b);if(S&&(D||j)){const P=n(e.playingAsset),B=(P==null?void 0:P.media)||e.primaryMedia;if(B){const U=g==="primary"?B.currentTime:i(S,g,e.playingAsset,"timelinePos","currentTime"),O=m-U,Y=(D?U:B.currentTime)+O;if(Y>=0&&(!P||D||Y<=P.duration)){B.currentTime=Y;return}}}if(b){let P=m;if(g!=="primary"){const U=b[g].start,O=m-U;P=b.start+O}const B=!e.isInterstitial(b);if((!e.isInterstitial(S)||S.event.appendInPlace)&&(B||b.event.appendInPlace)){const U=e.media||(D?w==null?void 0:w.media:null);U&&(U.currentTime=P)}else if(S){const U=e.findItemIndex(S);if(I>U){const Y=e.schedule.findJumpRestrictedIndex(U+1,I);if(Y>U){e.setSchedulePosition(Y);return}}let O=0;if(B)e.timelinePos=P,e.checkBuffer();else{const Y=b.event.assetList,ne=m-(b[g]||b).start;for(let se=Y.length;se--;){const ue=Y[se];if(ue.duration&&ne>=ue.startOffset&&ne<ue.startOffset+ue.duration){O=se;break}}}e.setSchedulePosition(I,O)}}},d=()=>{const m=e.effectivePlayingItem;if(e.isInterstitial(m))return m;const g=t();return e.isInterstitial(g)?g:null},f={get bufferedEnd(){const m=t(),g=e.bufferingItem;if(g&&g===m){var v;return i(g,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-g.playout.start||((v=e.bufferingAsset)==null?void 0:v.startOffset)||0}return 0},get currentTime(){const m=d(),g=e.effectivePlayingItem;return g&&g===m?i(g,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-g.playout.start:0},set currentTime(m){const g=d(),v=e.effectivePlayingItem;v&&v===g&&h(m+v.playout.start,"playout")},get duration(){const m=d();return m?m.playout.end-m.playout.start:0},get assetPlayers(){var m;const g=(m=d())==null?void 0:m.event.assetList;return g?g.map(v=>e.getAssetPlayer(v.identifier)):[]},get playingIndex(){var m;const g=(m=d())==null?void 0:m.event;return g&&e.effectivePlayingAsset?g.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return d()}};return this.manager={get events(){var m;return((m=e.schedule)==null||(m=m.events)==null?void 0:m.slice(0))||[]},get schedule(){var m;return((m=e.schedule)==null||(m=m.items)==null?void 0:m.slice(0))||[]},get interstitialPlayer(){return d()?f:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const m=t();return e.findItemIndex(m)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const m=e.effectivePlayingItem;return e.findItemIndex(m)},primary:{get bufferedEnd(){return l()},get currentTime(){const m=e.timelinePos;return m>0?m:0},set currentTime(m){h(m,"primary")},get duration(){return u("primary")},get seekableStart(){var m;return((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(m){h(m,"integrated")},get duration(){return u("integrated")},get seekableStart(){var m;return s(((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0,"integrated")}},skip:()=>{const m=e.effectivePlayingItem,g=m==null?void 0:m.event;if(g&&!g.restrictions.skip){const v=e.findItemIndex(m);if(g.appendInPlace){const x=m.playout.start+m.event.duration;h(x+.001,"playout")}else e.advanceAfterAssetEnded(g,v,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let i=this.media;!i&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(i=this.primaryMedia);const s=(t=i)==null?void 0:t.currentTime;if(!(s===void 0||!le(s)))return s}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,i=e.media;if(n&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Ue(s)}`),this.detachedData=s}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var n,i;if(e.media===t)return;let s=null;const l=this.hls,u=e!==l,h=u&&e.interstitial.appendInPlace,d=(n=this.detachedData)==null?void 0:n.mediaSource;let f;if(l.media)h&&(s=l.transferMedia(),this.detachedData=s),f="Primary";else if(d){const x=this.getBufferingPlayer();x?(s=x.transferMedia(),f=`${x}`):f="detached MediaSource"}else f="detached media";if(!s){if(d)s=this.detachedData,this.log(`using detachedData: MediaSource ${Ue(s)}`);else if(!this.detachedData||l.media===t){const x=this.playerQueue;x.length>1&&x.forEach(T=>{if(u&&T.interstitial.appendInPlace!==h){const S=T.interstitial;this.clearInterstitial(T.interstitial,null),S.appendInPlace=!1,S.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${S}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const m=s&&"mediaSource"in s&&((i=s.mediaSource)==null?void 0:i.readyState)!=="closed",g=m&&s?s:t;this.log(`${m?"transfering MediaSource":"attaching media"} to ${u?e:"Primary"} from ${f} (media.currentTime: ${t.currentTime})`);const v=this.schedule;if(g===s&&v){const x=u&&e.assetId===v.assetIdAtEnd;g.overrides={duration:v.duration,endOfStream:!u||x,cueRemoval:!u}}e.attachMedia(g)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,i=this.effectivePlayingItem;if(n===-1){const s=this.hls.startPosition;if(this.log(Xa("checkStart",s)),this.timelinePos=s,t.length&&t[0].cue.pre){const l=e.findEventIndex(t[0].identifier);this.setSchedulePosition(l)}else if(s>=0||!this.primaryLive){const l=this.timelinePos=s>0?s:0,u=e.findItemIndexAtTime(l);this.setSchedulePosition(u)}}else if(i&&!this.playingItem){const s=e.findItemIndex(i);this.setSchedulePosition(s)}}advanceAssetBuffering(e,t){const n=e.event,i=n.findAssetIndex(t),s=Gu(n,i);if(!n.isAssetPastPlayoutLimit(s))this.bufferedToEvent(e,s);else if(this.schedule){var l;const u=(l=this.schedule.items)==null?void 0:l[this.findItemIndex(e)+1];u&&this.bufferedToItem(u)}}advanceAfterAssetEnded(e,t,n){const i=Gu(e,n);if(e.isAssetPastPlayoutLimit(i)){if(this.schedule){const s=this.schedule.items;if(s){const l=t+1,u=s.length;if(l>=u){this.setSchedulePosition(-1);return}const h=e.resumeTime;this.timelinePos<h&&(this.log(Xa("advanceAfterAssetEnded",h)),this.timelinePos=h,e.appendInPlace&&this.advanceInPlace(h),this.checkBuffer(this.bufferedPos<h)),this.setSchedulePosition(l)}}}else{if(e.appendInPlace){const s=e.assetList[i];s&&this.advanceInPlace(s.timelineStart)}this.setSchedulePosition(t,i)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const i=t.parentIdentifier,s=n.getEvent(i);if(s){const l=n.findEventIndex(i),u=n.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,l,u-1)}}setSchedulePosition(e,t){var n;const i=(n=this.schedule)==null?void 0:n.items;if(!i||this.playbackDisabled)return;const s=e>=0?i[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${s&&dn(s)}) pos: ${this.timelinePos}`);const l=this.waitingItem||this.playingItem,u=this.playingLastItem;if(this.isInterstitial(l)){const f=l.event,m=this.playingAsset,g=m==null?void 0:m.identifier,v=g?this.getAssetPlayer(g):null;if(v&&g&&(!this.eventItemsMatch(l,s)||t!==void 0&&g!==f.assetList[t].identifier)){var h;const x=f.findAssetIndex(m);if(this.log(`INTERSTITIAL_ASSET_ENDED ${x+1}/${f.assetList.length} ${vi(m)}`),this.endedAsset=m,this.playingAsset=null,this.hls.trigger(L.INTERSTITIAL_ASSET_ENDED,{asset:m,assetListIndex:x,event:f,schedule:i.slice(0),scheduleIndex:e,player:v}),l!==this.playingItem){this.itemsMatch(l,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(f,this.findItemIndex(this.playingItem),x);return}this.retreiveMediaSource(g,s),v.media&&!((h=this.detachedData)!=null&&h.mediaSource)&&v.detachMedia()}if(!this.eventItemsMatch(l,s)&&(this.endedItem=l,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${f} ${dn(l)}`),f.hasPlayed=!0,this.hls.trigger(L.INTERSTITIAL_ENDED,{event:f,schedule:i.slice(0),scheduleIndex:e}),f.cue.once)){var d;this.updateSchedule();const x=(d=this.schedule)==null?void 0:d.items;if(s&&x){const T=this.findItemIndex(s);this.advanceSchedule(T,x,t,l,u)}return}}this.advanceSchedule(e,i,t,l,u)}advanceSchedule(e,t,n,i,s){const l=this.schedule;if(!l)return;const u=t[e]||null,h=this.primaryMedia,d=this.playerQueue;if(d.length&&d.forEach(f=>{const m=f.interstitial,g=l.findEventIndex(m.identifier);(g<e||g>e+1)&&this.clearInterstitial(m,u)}),this.isInterstitial(u)){this.timelinePos=Math.min(Math.max(this.timelinePos,u.start),u.end);const f=u.event;if(n===void 0){n=l.findAssetIndex(f,this.timelinePos);const x=Gu(f,n-1);if(f.isAssetPastPlayoutLimit(x)||f.appendInPlace&&this.timelinePos===u.end){this.advanceAfterAssetEnded(f,e,n);return}n=x}const m=this.waitingItem;this.assetsBuffered(u,h)||this.setBufferingItem(u);let g=this.preloadAssets(f,n);if(this.eventItemsMatch(u,m||i)||(this.waitingItem=u,this.log(`INTERSTITIAL_STARTED ${dn(u)} ${f.appendInPlace?"append in place":""}`),this.hls.trigger(L.INTERSTITIAL_STARTED,{event:f,schedule:t.slice(0),scheduleIndex:e})),!f.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${f}`);return}if(f.assetListLoader&&(f.assetListLoader.destroy(),f.assetListLoader=void 0),!h){this.log(`Waiting for attachMedia to start Interstitial ${f}`);return}this.waitingItem=this.endedItem=null,this.playingItem=u;const v=f.assetList[n];if(!v){this.advanceAfterAssetEnded(f,e,n||0);return}if(g||(g=this.getAssetPlayer(v.identifier)),g===null||g.destroyed){const x=f.assetList.length;this.warn(`asset ${n+1}/${x} player destroyed ${f}`),g=this.createAssetPlayer(f,v,n),g.loadSource()}if(!this.eventItemsMatch(u,this.bufferingItem)&&f.appendInPlace&&this.isAssetBuffered(v))return;this.startAssetPlayer(g,n,t,e,h),this.shouldPlay&&Zm(g.media)}else u?(this.resumePrimary(u,e,i),this.shouldPlay&&Zm(this.hls.media)):s&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(l.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var i,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${dn(e)}`),!((i=this.detachedData)!=null&&i.mediaSource)){let u=this.timelinePos;(u<e.start||u>=e.end)&&(u=this.getPrimaryResumption(e,t),this.log(Xa("resumePrimary",u)),this.timelinePos=u),this.attachPrimary(u,e)}if(!n)return;const l=(s=this.schedule)==null?void 0:s.items;l&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${dn(e)}`),this.hls.trigger(L.INTERSTITIALS_PRIMARY_RESUMED,{schedule:l.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const i=this.primaryDetails;if(t===0)return this.hls.startPosition;if(i&&(n<i.fragmentStart||n>i.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Ie.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,i),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(Xa("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs((((n=i.mainForwardBufferInfo)==null?void 0:n.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(L.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(L.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const i=Oe(Oe({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Oe(Oe({},this.altSelection),{},{audio:n});return}const s=Oe(Oe({},i),{},{audio:n});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Oe(Oe({},this.altSelection),{},{subtitles:n});return}const s=Oe(Oe({},i),{},{subtitles:n});this.mediaSelection=s}onAudioTrackSwitching(e,t){const n=lm(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setAudioOption(t)||i.setAudioOption(n)))}onSubtitleTrackSwitch(e,t){const n=lm(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setSubtitleOption(t)||t.id!==-1&&i.setSubtitleOption(n)))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let i=0;i<t.length;i++){const s=t[i];if(s.cue.post){var n;const l=this.schedule.findEventIndex(s.identifier),u=(n=this.schedule.items)==null?void 0:n[l];this.isInterstitial(u)&&this.eventItemsMatch(u,this.bufferingItem)&&this.bufferedToItem(u,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const i=(n=this.schedule)==null?void 0:n.items;if(e&&i){const s=this.findItemIndex(e,t);return i[s]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,l)=>{e.event.isAssetPastPlayoutLimit(l)&&this.clearAssetPlayer(s.identifier,null)});const n=e.end+.25,i=Ie.bufferInfo(this.primaryMedia,n,0);(i.end>n||(i.nextStart||0)>n)&&(this.log(`trim buffered interstitial ${dn(e)} (was ${dn(t)})`),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const n=this.mediaSelection;n&&((t=this.schedule)==null||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=(t=this.schedule)==null?void 0:t.items;if(!n)return;const i=Ie.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,n,e)}updateBufferedPos(e,t,n){const i=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!i)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const l=this.playingItem,u=this.findItemIndex(l);let h=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var d;const f=this.findItemIndex(s),m=Math.min(f+1,t.length-1),g=t[m];if((h===-1&&s&&e>=s.end||(d=g.event)!=null&&d.appendInPlace&&e+.01>=g.start)&&(h=m),this.isInterstitial(s)){const v=s.event;if(m-u>1&&v.appendInPlace===!1||v.assetList.length===0&&v.assetListLoader)return}if(this.bufferedPos=e,h>f&&h>u)this.bufferedToItem(g);else{const v=this.primaryDetails;this.primaryLive&&v&&e>v.edge-v.targetduration&&g.start<v.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(g)&&this.preloadAssets(g.event,0)}}else n&&l&&!this.itemsMatch(l,s)&&(h===u?this.bufferedToItem(l):h===u+1&&this.bufferedToItem(t[h]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(i=>{const s=this.getAssetPlayer(i.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:i,events:s}=n;if(!i||!s)return t;const l=this.isInterstitial(e),u=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const h=u?u.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${dn(e)}`+(t?` (${h.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(l){const d=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((f,m)=>{const g=this.getAssetPlayer(f.identifier);g&&(m===d&&g.loadSource(),g.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(d=>d.pauseBuffering());this.hls.trigger(L.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const i=this.detachedData;i?i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,i=n.assetList.length===0&&!n.assetListLoader,s=n.cue.once;if(i||!s){const l=this.preloadAssets(n,t);if(l!=null&&l.interstitial.appendInPlace){const u=this.primaryMedia;u&&this.bufferAssetPlayer(l,u)}}}preloadAssets(e,t){const n=e.assetUrl,i=e.assetList.length,s=i===0&&!e.assetListLoader,l=e.cue.once;if(s){const h=e.timelineStart;if(e.appendInPlace){var u;const g=this.playingItem;!this.isInterstitial(g)&&(g==null||(u=g.nextEvent)==null?void 0:u.identifier)===e.identifier&&this.flushFrontBuffer(h+.25)}let d,f=0;if(!this.playingItem&&this.primaryLive&&(f=this.hls.startPosition,f===-1&&(f=this.hls.liveSyncPosition||0)),f&&!(e.cue.pre||e.cue.post)){const g=f-h;g>0&&(d=Math.round(g*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:i} ${e}${d?` live-start: ${f} start-offset: ${d}`:""}`),n)return this.createAsset(e,0,0,h,e.duration,n);const m=this.assetListLoader.loadAssetList(e,d);m&&(e.assetListLoader=m)}else if(!l&&i){for(let d=t;d<i;d++){const f=e.assetList[d],m=this.getAssetPlayerQueueIndex(f.identifier);(m===-1||this.playerQueue[m].destroyed)&&!f.error&&this.createAssetPlayer(e,f,d)}const h=e.assetList[t];if(h){const d=this.getAssetPlayer(h.identifier);return d&&d.loadSource(),d}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(i=>{this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:i})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,i,s,l){const u={parentIdentifier:e.identifier,identifier:z1(e,l,t),duration:s,startOffset:n,timelineStart:i,uri:l};return this.createAssetPlayer(e,u,t)}createAssetPlayer(e,t,n){const i=this.hls,s=i.userConfig;let l=s.videoPreference;const u=i.loadLevelObj||i.levels[i.currentLevel];(l||u)&&(l=Fe({},l),u.videoCodec&&(l.videoCodec=u.videoCodec),u.videoRange&&(l.allowedVideoRanges=[u.videoRange]));const h=i.audioTracks[i.audioTrack],d=i.subtitleTracks[i.subtitleTrack];let f=0;if(this.primaryLive||e.appendInPlace){const _=this.timelinePos-t.timelineStart;if(_>1){const D=t.duration;D&&_<D&&(f=_)}}const m=t.identifier,g=Oe(Oe({},s),{},{maxMaxBufferLength:Math.min(180,i.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:m,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:f,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:l,audioPreference:h||s.audioPreference,subtitlePreference:d||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(g.timelineOffset=t.timelineStart));const v=g.cmcd;v!=null&&v.sessionId&&v.contentId&&(g.cmcd=Fe({},v,{contentId:xs(t.uri)})),this.getAssetPlayer(m)&&this.warn(`Duplicate date range identifier ${e} and asset ${m}`);const x=new Q1(this.HlsPlayerClass,g,e,t);this.playerQueue.push(x),e.assetList[n]=t;let T=!0;const S=_=>{if(_.live){var D;const B=new Error(`Interstitials MUST be VOD assets ${e}`),U={fatal:!0,type:ve.OTHER_ERROR,details:G.INTERSTITIAL_ASSET_ITEM_ERROR,error:B},O=((D=this.schedule)==null?void 0:D.findEventIndex(e.identifier))||-1;this.handleAssetItemError(U,e,O,n,B.message);return}const j=_.edge-_.fragmentStart,P=t.duration;(T||P===null||j>P)&&(T=!1,this.log(`Interstitial asset "${m}" duration change ${P} > ${j}`),t.duration=j,this.updateSchedule())};x.on(L.LEVEL_UPDATED,(_,{details:D})=>S(D)),x.on(L.LEVEL_PTS_UPDATED,(_,{details:D})=>S(D)),x.on(L.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const I=(_,D)=>{const j=this.getAssetPlayer(m);if(j&&D.tracks){j.off(L.BUFFER_CODECS,I),j.tracks=D.tracks;const P=this.primaryMedia;this.bufferingAsset===j.assetItem&&P&&!j.media&&this.bufferAssetPlayer(j,P)}};x.on(L.BUFFER_CODECS,I);const b=()=>{var _;const D=this.getAssetPlayer(m);if(this.log(`buffered to end of asset ${D}`),!D||!this.schedule)return;const j=this.schedule.findEventIndex(e.identifier),P=(_=this.schedule.items)==null?void 0:_[j];this.isInterstitial(P)&&this.advanceAssetBuffering(P,t)};x.on(L.BUFFERED_TO_END,b);const w=_=>()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;this.shouldPlay=!0;const j=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,j,_)};return x.once(L.MEDIA_ENDED,w(n)),x.once(L.PLAYOUT_LIMIT_REACHED,w(1/0)),x.on(L.ERROR,(_,D)=>{if(!this.schedule)return;const j=this.getAssetPlayer(m);if(D.details===G.BUFFER_STALLED_ERROR){if(j!=null&&j.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(D,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${D.error} ${e}`)}),x.on(L.DESTROYING,()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;const D=new Error(`Asset player destroyed unexpectedly ${m}`),j={fatal:!0,type:ve.OTHER_ERROR,details:G.INTERSTITIAL_ASSET_ITEM_ERROR,error:D};this.handleAssetItemError(j,e,this.schedule.findEventIndex(e.identifier),n,D.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${vi(t)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:x}),x}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){const i=this.playerQueue[n];this.log(`clear ${i} toSegment: ${t&&dn(t)}`),this.transferMediaFromPlayer(i,t),this.playerQueue.splice(n,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,i,s){const{interstitial:l,assetItem:u,assetId:h}=e,d=l.assetList.length,f=this.playingAsset;this.endedAsset=null,this.playingAsset=u,(!f||f.identifier!==h)&&(f&&(this.clearAssetPlayer(f.identifier,n[i]),delete f.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${d} ${vi(u)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_STARTED,{asset:u,assetListIndex:t,event:l,schedule:n.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var n,i;if(!this.schedule)return;const{interstitial:s,assetItem:l}=e,u=this.schedule.findEventIndex(s.identifier),h=(n=this.schedule.items)==null?void 0:n[u];if(!h)return;e.loadSource(),this.setBufferingItem(h),this.bufferingAsset=l;const d=this.getBufferingPlayer();if(d===e)return;const f=s.appendInPlace;if(f&&(d==null?void 0:d.interstitial.appendInPlace)===!1)return;const m=(d==null?void 0:d.tracks)||((i=this.detachedData)==null?void 0:i.tracks)||this.requiredTracks;if(f&&l!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(m&&!Mp(m,e.tracks)){const g=new Error(`Asset ${vi(l)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(m)}')`),v={fatal:!0,type:ve.OTHER_ERROR,details:G.INTERSTITIAL_ASSET_ITEM_ERROR,error:g},x=s.findAssetIndex(l);this.handleAssetItemError(v,s,u,x,g.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const i=n.currentTime,s=t.findAssetIndex(e,i),l=e.assetList[s];if(l){const u=this.getAssetPlayer(l.identifier);if(u){const h=u.currentTime||i-l.timelineStart,d=u.duration-h;if(this.warn(`Stalled at ${h} of ${h+d} in ${u} ${e} (media.currentTime: ${i})`),h&&(d/n.playbackRate<.5||u.bufferedInPlaceToEnd(n))&&u.hls){const f=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,f,s)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,i,s){if(e.details===G.BUFFER_STALLED_ERROR)return;const l=t.assetList[i]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${l&&vi(l)} ${e.error}`),!this.schedule)return;const u=(l==null?void 0:l.identifier)||"",h=this.getAssetPlayerQueueIndex(u),d=this.playerQueue[h]||null,f=this.schedule.items,m=Fe({},e,{fatal:!1,errorAction:Ei(!0),asset:l,assetListIndex:i,event:t,schedule:f,scheduleIndex:n,player:d});if(this.hls.trigger(L.INTERSTITIAL_ASSET_ERROR,m),!e.fatal)return;const g=this.playingAsset,v=this.bufferingAsset,x=new Error(s);if(l&&(this.clearAssetPlayer(u,null),l.error=x),!t.assetList.some(T=>!T.error))t.error=x;else for(let T=i;T<t.assetList.length;T++)this.resetAssetPlayer(t.assetList[T].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):g&&g.identifier===u?this.advanceAfterAssetEnded(t,n,i):v&&v.identifier===u&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,v)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;let i=this.timelinePos;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${i} playing: ${dn(n)} error: ${e.error}`),i===-1&&(i=this.hls.startPosition);const l=this.updateItem(n,i);this.itemsMatch(n,l)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(i===-1){this.checkStart();return}if(!this.schedule)return;const s=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(s)}onAssetListLoaded(e,t){var n,i;const s=t.event,l=s.identifier,u=t.assetListResponse.ASSETS;if(!((n=this.schedule)!=null&&n.hasEvent(l)))return;const h=s.timelineStart,d=s.duration;let f=0;u.forEach((T,S)=>{const I=parseFloat(T.DURATION);this.createAsset(s,S,f,h+f,I,T.URI),f+=I}),s.duration=f,this.log(`Loaded asset-list with duration: ${f} (was: ${d}) ${s}`);const m=this.waitingItem,g=(m==null?void 0:m.event.identifier)===l;this.updateSchedule();const v=(i=this.bufferingItem)==null?void 0:i.event;if(g){var x;const T=this.schedule.findEventIndex(l),S=(x=this.schedule.items)==null?void 0:x[T];if(S){if(!this.playingItem&&this.timelinePos>S.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==T){s.error=new Error(`Interstitial ${u.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${s}`),this.log(s.error.message),this.updateSchedule(!0),this.primaryFallback(s);return}this.setBufferingItem(S)}this.setSchedulePosition(T)}else if((v==null?void 0:v.identifier)===l){const T=s.assetList[0];if(T){const S=this.getAssetPlayer(T.identifier);if(v.appendInPlace){const I=this.primaryMedia;S&&I&&this.bufferAssetPlayer(S,I)}else S&&S.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case G.ASSET_LIST_PARSING_ERROR:case G.ASSET_LIST_LOAD_ERROR:case G.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break}case G.BUFFER_STALLED_ERROR:{const n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace){this.handleInPlaceStall(n.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const ep=500;class eL extends Oc{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",me.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=q.IDLE,this.setInterval(ep),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:i}=t;if(this.fragContextChanged(n)||(et(n)&&(this.fragPrevious=n),this.state=q.IDLE),!i)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let l;const u=n.start;for(let d=0;d<s.length;d++)if(u>=s[d].start&&u<=s[d].end){l=s[d];break}const h=n.start+n.duration;l?l.end=h:(l={start:u,end:h},s.push(l)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:i}=t;if(n===0&&i!==Number.POSITIVE_INFINITY){const s=i-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(l=>{for(let u=0;u<l.length;){if(l[u].end<=s){l.shift();continue}else if(l[u].start<s)l[u].start=s;else break;u++}}),this.fragmentTracker.removeFragmentsInRange(n,s,me.SUBTITLE)}}onError(e,t){const n=t.frag;(n==null?void 0:n.type)===me.SUBTITLE&&(t.details===G.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==q.STOPPED&&(this.state=q.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Ug(this.levels,t)){this.levels=t.map(n=>new Ls(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const i=new Ls(n);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,me.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==q.STOPPED&&this.setInterval(ep)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:i,levels:s}=this,{details:l,id:u}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${u}`);return}const h=s[u];if(u>=s.length||!h)return;this.log(`Subtitle track ${u} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(l.live||(n=h.details)!=null&&n.live){if(l.deltaUpdateFailed)return;const m=this.mainDetails;if(!m){this.startFragRequested=!1;return}const g=m.fragments[0];if(!h.details)l.hasProgramDateTime&&m.hasProgramDateTime?(Lo(l,m),d=l.fragmentStart):g&&(d=g.start,lc(l,d));else{var f;d=this.alignPlaylists(l,h.details,(f=this.levelLastLoaded)==null?void 0:f.details),d===0&&g&&(d=g.start,lc(l,d))}m&&!this.startFragRequested&&this.setStartPosition(m,d)}h.details=l,this.levelLastLoaded=h,u===i&&(this.hls.trigger(L.SUBTITLE_TRACK_UPDATED,{details:l,id:u,groupId:t.groupId}),this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===q.IDLE&&(Fr(null,l.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,i=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&i!=null&&i.key&&i.iv&&Si(i.method)){const l=performance.now();this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer,Pc(i.method)).catch(u=>{throw s.trigger(L.ERROR,{type:ve.MEDIA_ERROR,details:G.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:t}),u}).then(u=>{const h=performance.now();s.trigger(L.FRAG_DECRYPTED,{frag:t,payload:u,stats:{tstart:l,tdecrypt:h}})}).catch(u=>{this.warn(`${u.name}: ${u.message}`),this.state=q.IDLE})}}doTick(){if(!this.media){this.state=q.IDLE;return}if(this.state===q.IDLE){const{currentTrackId:e,levels:t}=this,n=t==null?void 0:t[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:i}=this,s=this.getLoadPosition(),l=Ie.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,i.maxBufferHole),{end:u,len:h}=l,d=n.details,f=this.hls.maxBufferLength+d.levelTargetDuration;if(h>f)return;const m=d.fragments,g=m.length,v=d.edge;let x=null;const T=this.fragPrevious;if(u<v){const b=i.maxFragLookUpTolerance,w=u>v-b?0:b;x=Fr(T,m,Math.max(m[0].start,u),w),!x&&T&&T.start<m[0].start&&(x=m[0])}else x=m[g-1];if(x=this.filterReplacedPrimary(x,n.details),!x)return;const S=x.sn-d.startSN,I=m[S-1];if(I&&I.cc===x.cc&&this.fragmentTracker.getState(I)===at.NOT_LOADED&&(x=I),this.fragmentTracker.getState(x)===at.NOT_LOADED){const b=this.mapToInitFragWhenRequired(x);b&&this.loadFragment(b,n,u)}}}loadFragment(e,t,n){et(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new tL(this.tracksBuffered[this.currentTrackId]||[])}}class tL{constructor(e){this.buffered=void 0;const t=(n,i,s)=>{if(i=i>>>0,i>s-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const nL={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},t0=a=>String.fromCharCode(nL[a]||a),hn=15,Fn=100,rL={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},iL={17:2,18:4,21:6,22:8,23:10,19:13,20:15},sL={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},aL={25:2,26:4,29:6,30:8,31:10,27:13,28:15},oL=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class lL{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;Me.log(`${this.time} [${e}] ${n}`)}}}const Nr=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class n0{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const i=t[n];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class uL{constructor(){this.uchar=" ",this.penState=new n0}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class cL{constructor(e){this.chars=[],this.pos=0,this.currPenState=new n0,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Fn;t++)this.chars.push(new uL);this.logger=e}equals(e){for(let t=0;t<Fn;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Fn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Fn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Fn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Fn)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=t0(e);if(this.pos>=Fn){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Fn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<Fn;n++){const i=this.chars[n].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Vu{constructor(e){this.rows=[],this.currRow=hn-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<hn;t++)this.rows.push(new cL(e));this.logger=e}reset(){for(let e=0;e<hn;e++)this.rows[e].clear();this.currRow=hn-1}equals(e){let t=!0;for(let n=0;n<hn;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<hn;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<hn;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Ue(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let u=0;u<hn;u++)this.rows[u].clear();const s=this.currRow+1-this.nrRollUpRows,l=this.lastOutputScreen;if(l){const u=l.rows[s].cueStartTime,h=this.logger.time;if(u!==null&&h!==null&&u<h)for(let d=0;d<this.nrRollUpRows;d++)this.rows[t-this.nrRollUpRows+d+1].copy(l.rows[s+d])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,l=Math.max(s-1,0);n.setCursor(e.indent),e.color=n.chars[l].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Ue(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",i=-1;for(let s=0;s<hn;s++){const l=this.rows[s].getTextString();l&&(i=s+1,e?t.push("Row "+i+": '"+l+"'"):t.push(l.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class tp{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Vu(n),this.nonDisplayedMemory=new Vu(n),this.lastOutputScreen=new Vu(n),this.currRollUpRow=this.displayedMemory.rows[hn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[hn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[n]}this.logger.log(2,"MIDROW: "+Ue(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class np{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=hL(),this.logger=void 0;const i=this.logger=new lL;this.channels=[null,new tp(e,t,i),new tp(e+1,n,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const i=t[n]&127,s=t[n+1]&127;let l=!1,u=null;if(i===0&&s===0)continue;this.logger.log(3,()=>"["+Nr([t[n],t[n+1]])+"] -> ("+Nr([i,s])+")");const h=this.cmdHistory;if(i>=16&&i<=31){if(dL(i,s,h)){Ja(null,null,h),this.logger.log(3,()=>"Repeated command ("+Nr([i,s])+") is dropped");continue}Ja(i,s,this.cmdHistory),l=this.parseCmd(i,s),l||(l=this.parseMidrow(i,s)),l||(l=this.parsePAC(i,s)),l||(l=this.parseBackgroundAttributes(i,s))}else Ja(null,null,h);if(!l&&(u=this.parseChars(i,s),u)){const f=this.currentChannel;f&&f>0?this.channels[f].insertChars(u):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!l&&!u&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Nr([i,s])+" orig: "+Nr([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(n||i))return!1;const s=e===20||e===21||e===23?1:2,l=this.channels[s];return e===20||e===21||e===28||e===29?t===32?l.ccRCL():t===33?l.ccBS():t===34?l.ccAOF():t===35?l.ccAON():t===36?l.ccDER():t===37?l.ccRU(2):t===38?l.ccRU(3):t===39?l.ccRU(4):t===40?l.ccFON():t===41?l.ccRDC():t===42?l.ccTR():t===43?l.ccRTD():t===44?l.ccEDM():t===45?l.ccCR():t===46?l.ccENM():t===47&&l.ccEOC():l.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[n];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Nr([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(i||s))return!1;const l=e<=23?1:2;t>=64&&t<=95?n=l===1?rL[e]:sL[e]:n=l===1?iL[e]:aL[e];const u=this.channels[l];return u?(u.setPAC(this.interpretPAC(n,t)),this.currentChannel=l,!0):!1}interpretPAC(e,t){let n;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,i.underline=(n&1)===1,n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((n-16)/2)*4,i}parseChars(e,t){let n,i=null,s=null;if(e>=25?(n=2,s=e-8):(n=1,s=e),s>=17&&s<=19){let l;s===17?l=t+80:s===18?l=t+112:l=t+144,this.logger.log(2,()=>"Special char '"+t0(l)+"' in channel "+n),i=[l]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+Nr(i).join(",")),i}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(n||i))return!1;let s;const l={};e===16||e===24?(s=Math.floor((t-32)/2),l.background=oL[s],t%2===1&&(l.background=l.background+"_semi")):t===45?l.background="transparent":(l.foreground="black",t===47&&(l.underline=!0));const u=e<=23?1:2;return this.channels[u].setBkgData(l),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Ja(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function Ja(a,e,t){t.a=a,t.b=e}function dL(a,e,t){return t.a===a&&t.b===e}function hL(){return{a:null,b:null}}var zc=(function(){if(To!=null&&To.VTTCue)return self.VTTCue;const a=["","lr","rl"],e=["start","middle","end","left","right"];function t(u,h){if(typeof h!="string"||!Array.isArray(u))return!1;const d=h.toLowerCase();return~u.indexOf(d)?d:!1}function n(u){return t(a,u)}function i(u){return t(e,u)}function s(u,...h){let d=1;for(;d<arguments.length;d++){const f=arguments[d];for(const m in f)u[m]=f[m]}return u}function l(u,h,d){const f=this,m={enumerable:!0};f.hasBeenReset=!1;let g="",v=!1,x=u,T=h,S=d,I=null,b="",w=!0,_="auto",D="start",j=50,P="middle",B=50,U="middle";Object.defineProperty(f,"id",s({},m,{get:function(){return g},set:function(O){g=""+O}})),Object.defineProperty(f,"pauseOnExit",s({},m,{get:function(){return v},set:function(O){v=!!O}})),Object.defineProperty(f,"startTime",s({},m,{get:function(){return x},set:function(O){if(typeof O!="number")throw new TypeError("Start time must be set to a number.");x=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",s({},m,{get:function(){return T},set:function(O){if(typeof O!="number")throw new TypeError("End time must be set to a number.");T=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",s({},m,{get:function(){return S},set:function(O){S=""+O,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",s({},m,{get:function(){return I},set:function(O){I=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",s({},m,{get:function(){return b},set:function(O){const Y=n(O);if(Y===!1)throw new SyntaxError("An invalid or illegal string was specified.");b=Y,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",s({},m,{get:function(){return w},set:function(O){w=!!O,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",s({},m,{get:function(){return _},set:function(O){if(typeof O!="number"&&O!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");_=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",s({},m,{get:function(){return D},set:function(O){const Y=i(O);if(!Y)throw new SyntaxError("An invalid or illegal string was specified.");D=Y,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",s({},m,{get:function(){return j},set:function(O){if(O<0||O>100)throw new Error("Position must be between 0 and 100.");j=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",s({},m,{get:function(){return P},set:function(O){const Y=i(O);if(!Y)throw new SyntaxError("An invalid or illegal string was specified.");P=Y,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",s({},m,{get:function(){return B},set:function(O){if(O<0||O>100)throw new Error("Size must be between 0 and 100.");B=O,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",s({},m,{get:function(){return U},set:function(O){const Y=i(O);if(!Y)throw new SyntaxError("An invalid or illegal string was specified.");U=Y,this.hasBeenReset=!0}})),f.displayState=void 0}return l.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},l})();class fL{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function r0(a){function e(n,i,s,l){return(n|0)*3600+(i|0)*60+(s|0)+parseFloat(l||0)}const t=a.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class mL{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function i0(a,e,t,n){const i=n?a.split(n):[a];for(const s in i){if(typeof i[s]!="string")continue;const l=i[s].split(t);if(l.length!==2)continue;const u=l[0],h=l[1];e(u,h)}}const gc=new zc(0,0,""),Za=gc.align==="middle"?"middle":"center";function pL(a,e,t){const n=a;function i(){const u=r0(a);if(u===null)throw new Error("Malformed timestamp: "+n);return a=a.replace(/^[^\sa-zA-Z-]+/,""),u}function s(u,h){const d=new mL;i0(u,function(g,v){let x;switch(g){case"region":for(let T=t.length-1;T>=0;T--)if(t[T].id===v){d.set(g,t[T].region);break}break;case"vertical":d.alt(g,v,["rl","lr"]);break;case"line":x=v.split(","),d.integer(g,x[0]),d.percent(g,x[0])&&d.set("snapToLines",!1),d.alt(g,x[0],["auto"]),x.length===2&&d.alt("lineAlign",x[1],["start",Za,"end"]);break;case"position":x=v.split(","),d.percent(g,x[0]),x.length===2&&d.alt("positionAlign",x[1],["start",Za,"end","line-left","line-right","auto"]);break;case"size":d.percent(g,v);break;case"align":d.alt(g,v,["start",Za,"end","left","right"]);break}},/:/,/\s/),h.region=d.get("region",null),h.vertical=d.get("vertical","");let f=d.get("line","auto");f==="auto"&&gc.line===-1&&(f=-1),h.line=f,h.lineAlign=d.get("lineAlign","start"),h.snapToLines=d.get("snapToLines",!0),h.size=d.get("size",100),h.align=d.get("align",Za);let m=d.get("position","auto");m==="auto"&&gc.position===50&&(m=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=m}function l(){a=a.replace(/^\s+/,"")}if(l(),e.startTime=i(),l(),a.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);a=a.slice(3),l(),e.endTime=i(),l(),s(a,e)}function s0(a){return a.replace(/<br(?: \/)?>/gi,`
`)}class gL{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new fL,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let s=t.buffer,l=0;for(s=s0(s);l<s.length&&s[l]!=="\r"&&s[l]!==`
`;)++l;const u=s.slice(0,l);return s[l]==="\r"&&++l,s[l]===`
`&&++l,t.buffer=s.slice(l),u}function i(s){i0(s,function(l,u){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=n();const u=s.match(/^()?WEBVTT([ \t].*)?$/);if(!(u!=null&&u[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let l=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(l?l=!1:s=n(),t.state){case"HEADER":/:/.test(s)?i(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new zc(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{pL(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const u=s.indexOf("-->")!==-1;if(!s||u&&(l=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const yL=/\r\n|\n\r|\n|\r/g,Ku=function(e,t,n=0){return e.slice(n,n+t.length)===t},vL=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!le(t)||!le(n)||!le(i)||!le(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*i,t+=3600*1e3*s,t};function Yc(a,e,t){return xs(a.toString())+xs(e.toString())+xs(t)}const xL=function(e,t,n){let i=e[t],s=e[i.prevCC];if(!s||!s.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(l=s)!=null&&l.new;){var l;e.ccOffset+=i.start-s.start,i.new=!1,i=s,s=e[i.prevCC]}e.presentationOffset=n};function EL(a,e,t,n,i,s,l){const u=new gL,h=Vt(new Uint8Array(a)).trim().replace(yL,`
`).split(`
`),d=[],f=e?RT(e.baseTime,e.timescale):0;let m="00:00.000",g=0,v=0,x,T=!0;u.oncue=function(S){const I=t[n];let b=t.ccOffset;const w=(g-f)/9e4;if(I!=null&&I.new&&(v!==void 0?b=t.ccOffset=I.start:xL(t,n,w)),w){if(!e){x=new Error("Missing initPTS for VTT MPEGTS");return}b=w-t.presentationOffset}const _=S.endTime-S.startTime,D=jt((S.startTime+b-v)*9e4,i*9e4)/9e4;S.startTime=Math.max(D,0),S.endTime=Math.max(D+_,0);const j=S.text.trim();S.text=decodeURIComponent(encodeURIComponent(j)),S.id||(S.id=Yc(S.startTime,S.endTime,j)),S.endTime>0&&d.push(S)},u.onparsingerror=function(S){x=S},u.onflush=function(){if(x){l(x);return}s(d)},h.forEach(S=>{if(T)if(Ku(S,"X-TIMESTAMP-MAP=")){T=!1,S.slice(16).split(",").forEach(I=>{Ku(I,"LOCAL:")?m=I.slice(6):Ku(I,"MPEGTS:")&&(g=parseInt(I.slice(7)))});try{v=vL(m)/1e3}catch(I){x=I}return}else S===""&&(T=!1);u.parse(S+`
`)}),u.flush()}const Hu="stpp.ttml.im1t",a0=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,o0=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,SL={left:"start",center:"center",right:"end",start:"start",end:"end"};function rp(a,e,t,n){const i=we(new Uint8Array(a),["mdat"]);if(i.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const s=i.map(u=>Vt(u)),l=IT(e.baseTime,1,e.timescale);try{s.forEach(u=>t(TL(u,l)))}catch(u){n(u)}}function TL(a,e){const i=new DOMParser().parseFromString(a,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},l=Object.keys(s).reduce((m,g)=>(m[g]=i.getAttribute(`ttp:${g}`)||s[g],m),{}),u=i.getAttribute("xml:space")!=="preserve",h=ip(Wu(i,"styling","style")),d=ip(Wu(i,"layout","region")),f=Wu(i,"body","[begin]");return[].map.call(f,m=>{const g=l0(m,u);if(!g||!m.hasAttribute("begin"))return null;const v=Yu(m.getAttribute("begin"),l),x=Yu(m.getAttribute("dur"),l);let T=Yu(m.getAttribute("end"),l);if(v===null)throw sp(m);if(T===null){if(x===null)throw sp(m);T=v+x}const S=new zc(v-e,T-e,g);S.id=Yc(S.startTime,S.endTime,S.text);const I=d[m.getAttribute("region")],b=h[m.getAttribute("style")],w=LL(I,b,h),{textAlign:_}=w;if(_){const D=SL[_];D&&(S.lineAlign=D),S.align=_}return Fe(S,w),S}).filter(m=>m!==null)}function Wu(a,e,t){const n=a.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function ip(a){return a.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function l0(a,e){return[].slice.call(a.childNodes).reduce((t,n,i)=>{var s;return n.nodeName==="br"&&i?t+`
`:(s=n.childNodes)!=null&&s.length?l0(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function LL(a,e,t){const n="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],l=a!=null&&a.hasAttribute("style")?a.getAttribute("style"):null;return l&&t.hasOwnProperty(l)&&(i=t[l]),s.reduce((u,h)=>{const d=zu(e,n,h)||zu(a,n,h)||zu(i,n,h);return d&&(u[h]=d),u},{})}function zu(a,e,t){return a&&a.hasAttributeNS(e,t)?a.getAttributeNS(e,t):null}function sp(a){return new Error(`Could not parse ttml timestamp ${a}`)}function Yu(a,e){if(!a)return null;let t=r0(a);return t===null&&(a0.test(a)?t=AL(a,e):o0.test(a)&&(t=IL(a,e))),t}function AL(a,e){const t=a0.exec(a),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function IL(a,e){const t=o0.exec(a),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class eo{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class RL{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=op(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new eo(this,"textTrack1"),t=new eo(this,"textTrack2"),n=new eo(this,"textTrack3"),i=new eo(this,"textTrack4");this.cea608Parser1=new np(1,e,t),this.cea608Parser2=new np(3,n,i)}addCues(e,t,n,i,s){let l=!1;for(let u=s.length;u--;){const h=s[u],d=wL(h[0],h[1],t,n);if(d>=0&&(h[0]=Math.min(h[0],t),h[1]=Math.max(h[1],n),l=!0,d/(n-t)>.5))return}if(l||s.push([t,n]),this.config.renderTextTracksNatively){const u=this.captionsTracks[e];this.Cues.newCue(u,t,n,i)}else{const u=this.Cues.newCue(null,t,n,i);this.hls.trigger(L.CUES_PARSED,{type:"captions",cues:u,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:s,trackId:l}){const{unparsedVttFrags:u}=this;n===me.MAIN&&(this.initPTS[t.cc]={baseTime:i,timescale:s,trackId:l}),u.length&&(this.unparsedVttFrags=[],u.forEach(h=>{this.initPTS[h.frag.cc]?this.onFragLoaded(L.FRAG_LOADED,h):this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let i=0;i<n.textTracks.length;i++){const s=n.textTracks[i];if(ap(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:i}=this,{label:s,languageCode:l}=t[e],u=this.getExistingTrack(s,l);if(u)n[e]=u,xi(n[e]),Jg(n[e],i);else{const h=this.createTextTrack("captions",s,l);h&&(h[e]=!0,n[e]=h)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,i={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,n){const i=this.media;if(i)return i.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:i}=this;Object.keys(i).forEach(s=>{xi(i[s]),delete i[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=op(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)xi(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],i=n.some(s=>s.textCodec===Hu);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(Ug(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const l=this.media,u=l?ho(l.textTracks):null;if(this.tracks.forEach((h,d)=>{let f;if(u){let m=null;for(let g=0;g<u.length;g++)if(u[g]&&ap(u[g],h)){m=u[g],u[g]=null;break}m&&(f=m)}if(f)xi(f);else{const m=u0(h);f=this.createTextTrack(m,h.name,h.lang),f&&(f.mode="disabled")}f&&this.textTracks.push(f)}),u!=null&&u.length){const h=u.filter(d=>d!==null).map(d=>d.label);h.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${h.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const l=this.tracks.map(u=>({label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}));this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const i=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!i)return;const s=`textTrack${i[1]}`,l=this.captionsProperties[s];l&&(l.label=n.name,n.lang&&(l.languageCode=n.lang),l.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===me.MAIN){var n,i;const{cea608Parser1:s,cea608Parser2:l,lastSn:u}=this,{cc:h,sn:d}=t.frag,f=(n=(i=t.part)==null?void 0:i.index)!=null?n:-1;s&&l&&(d!==u+1||d===u&&f!==this.lastPartIndex+1||h!==this.lastCc)&&(s.reset(),l.reset()),this.lastCc=h,this.lastSn=d,this.lastPartIndex=f}}onFragLoaded(e,t){const{frag:n,payload:i}=t;if(n.type===me.SUBTITLE)if(i.byteLength){const s=n.decryptdata,l="stats"in t;if(s==null||!s.encrypted||l){const u=this.tracks[n.level],h=this.vttCCs;h[n.cc]||(h[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),u&&u.textCodec===Hu?this._parseIMSC1(n,i):this._parseVTTs(t)}}else this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;rp(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),n.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{n.logger.log(`Failed to parse IMSC1: ${i}`),n.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:n,payload:i}=e,{initPTS:s,unparsedVttFrags:l}=this,u=s.length-1;if(!s[n.cc]&&u===-1){l.push(e);return}const h=this.hls,d=(t=n.initSegment)!=null&&t.data?Xt(n.initSegment.data,new Uint8Array(i)).buffer:i;EL(d,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,f=>{this._appendCues(f,n.level),h.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},f=>{const m=f.message==="Missing initPTS for VTT MPEGTS";m?l.push(e):this._fallbackToIMSC1(n,i),h.logger.log(`Failed to parse VTT cue: ${f}`),!(m&&u>n.cc)&&h.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:f})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||rp(t,this.initPTS[e.cc],()=>{n.textCodec=Hu,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(s=>Zg(i,s))}else{const i=this.tracks[t];if(!i)return;const s=i.default?"default":"subtitles"+t;n.trigger(L.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===me.SUBTITLE&&this.onFragLoaded(L.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:i}=t;if(!(n.type===me.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let s=0;s<i.length;s++){const l=i[s].bytes;if(l){this.cea608Parser1||this.initCea608Parsers();const u=this.extractCea608Data(l);this.cea608Parser1.addData(i[s].pts,u[0]),this.cea608Parser2.addData(i[s].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:i,type:s}){const{media:l}=this;if(!(!l||l.currentTime<n)){if(!s||s==="video"){const{captionsTracks:u}=this;Object.keys(u).forEach(h=>pc(u[h],t,n))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:u}=this;Object.keys(u).forEach(h=>pc(u[h],t,i))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let i=2;for(let s=0;s<n;s++){const l=e[i++],u=127&e[i++],h=127&e[i++];if(u===0&&h===0)continue;if((4&l)!==0){const f=3&l;(f===0||f===1)&&(t[f].push(u),t[f].push(h))}}return t}}function u0(a){return a.characteristics&&/transcribes-spoken-dialog/gi.test(a.characteristics)&&/describes-music-and-sound/gi.test(a.characteristics)?"captions":"subtitles"}function ap(a,e){return!!a&&a.kind===u0(e)&&dc(e,a)}function wL(a,e,t,n){return Math.min(e,n)-Math.max(a,t)}function op(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const bL=/\s/,_L={newCue(a,e,t,n){const i=[];let s,l,u,h,d;const f=self.VTTCue||self.TextTrackCue;for(let g=0;g<n.rows.length;g++)if(s=n.rows[g],u=!0,h=0,d="",!s.isEmpty()){var m;for(let T=0;T<s.chars.length;T++)bL.test(s.chars[T].uchar)&&u?h++:(d+=s.chars[T].uchar,u=!1);s.cueStartTime=e,e===t&&(t+=1e-4),h>=16?h--:h++;const v=s0(d.trim()),x=Yc(e,t,v);a!=null&&(m=a.cues)!=null&&m.getCueById(x)||(l=new f(e,t,v),l.id=x,l.line=g+1,l.align="left",l.position=10+Math.min(80,Math.floor(h*8/32)*10),i.push(l))}return a&&i.length&&(i.sort((g,v)=>g.line==="auto"||v.line==="auto"?0:g.line>8&&v.line>8?v.line-g.line:g.line-v.line),i.forEach(g=>Zg(a,g))),i}};function kL(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const CL=/(\d+)-(\d+)\/(\d+)/;class lp{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||OL,this.controller=new self.AbortController,this.stats=new Rc}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const s=DL(e,this.controller.signal),l=e.responseType==="arraybuffer",u=l?"byteLength":"length",{maxTimeToFirstByteMs:h,maxLoadTimeMs:d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=h&&le(h)?h:d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(Rs(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(m=>{var g;this.response=this.loader=m;const v=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},d-(v-i.loading.start)),!m.ok){const{status:T,statusText:S}=m;throw new ML(S||"fetch, bad network response",T,m)}i.loading.first=v,i.total=NL(m.headers)||i.total;const x=(g=this.callbacks)==null?void 0:g.onProgress;return x&&le(t.highWaterMark)?this.loadProgressively(m,i,e,t.highWaterMark,x):l?m.arrayBuffer():e.responseType==="json"?m.json():m.text()}).then(m=>{var g,v;const x=this.response;if(!x)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const T=m[u];T&&(i.loaded=i.total=T);const S={url:x.url,data:m,code:x.status},I=(g=this.callbacks)==null?void 0:g.onProgress;I&&!le(t.highWaterMark)&&I(i,e,m,x),(v=this.callbacks)==null||v.onSuccess(S,i,e,x)}).catch(m=>{var g;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const v=m&&m.code||0,x=m?m.message:null;(g=this.callbacks)==null||g.onError({code:v,text:x},e,m?m.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,i=0,s){const l=new xg,u=e.body.getReader(),h=()=>u.read().then(d=>{if(d.done)return l.dataLength&&s(t,n,l.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const f=d.value,m=f.length;return t.loaded+=m,m<i||l.dataLength?(l.push(f),l.dataLength>=i&&s(t,n,l.flush().buffer,e)):s(t,n,f.buffer,e),h()}).catch(()=>Promise.reject());return h()}}function DL(a,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Fe({},a.headers))};return a.rangeEnd&&t.headers.set("Range","bytes="+a.rangeStart+"-"+String(a.rangeEnd-1)),t}function PL(a){const e=CL.exec(a);if(e)return parseInt(e[2])-parseInt(e[1])+1}function NL(a){const e=a.get("Content-Range");if(e){const n=PL(e);if(le(n))return n}const t=a.get("Content-Length");if(t)return parseInt(t)}function OL(a,e){return new self.Request(a.url,e)}class ML extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const FL=/^age:\s*[\d.]+\s*$/im;class c0{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Rc,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return s(n,t.url)}).catch(l=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),s(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(l=>{var u;(u=this.callbacks)==null||u.onError({code:n.status,text:l.message},t,n,i)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:l}=n.loadPolicy;if(i)for(const u in i)e.setRequestHeader(u,i[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=s&&le(s)?s:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const i=t.readyState,s=this.config;if(!n.aborted&&i>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const d=t.status,f=t.responseType==="text"?t.responseText:null;if(d>=200&&d<300){const x=f??t.response;if(x!=null){var l,u;n.loading.end=Math.max(self.performance.now(),n.loading.first);const T=t.responseType==="arraybuffer"?x.byteLength:x.length;n.loaded=n.total=T,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const S=(l=this.callbacks)==null?void 0:l.onProgress;S&&S(n,e,x,t);const I={url:t.responseURL,data:x,code:d};(u=this.callbacks)==null||u.onSuccess(I,n,e,t);return}}const m=s.loadPolicy.errorRetry,g=n.retry,v={url:e.url,data:void 0,code:d};if(Eo(m,g,!1,v))this.retry(m);else{var h;Me.error(`${d} while loading ${e.url}`),(h=this.callbacks)==null||h.onError({code:d,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Eo(e,t,!0))this.retry(e);else{var n;Me.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=kc(e,n.retry),n.retry++,Me.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&FL.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const BL={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},UL=Oe(Oe({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:c0,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:XE,bufferController:jT,capLevelController:Kc,errorController:nS,fpsController:G1,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:lg,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:BL},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},$L()),{},{subtitleStreamController:eL,subtitleTrackController:H1,timelineController:RL,audioStreamController:FT,audioTrackController:BT,emeController:Ti,cmcdController:B1,contentSteeringController:$1,interstitialsController:Z1});function $L(){return{cueHandler:_L,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function jL(a,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=yc(a),i=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(l=>{const u=`${l==="level"?"playlist":l}LoadPolicy`,h=e[u]===void 0,d=[];s.forEach(f=>{const m=`${l}Loading${f}`,g=e[m];if(g!==void 0&&h){d.push(m);const v=n[u].default;switch(e[u]={default:v},f){case"TimeOut":v.maxLoadTimeMs=g,v.maxTimeToFirstByteMs=g;break;case"MaxRetry":v.errorRetry.maxNumRetry=g,v.timeoutRetry.maxNumRetry=g;break;case"RetryDelay":v.errorRetry.retryDelayMs=g,v.timeoutRetry.retryDelayMs=g;break;case"MaxRetryTimeout":v.errorRetry.maxRetryDelayMs=g,v.timeoutRetry.maxRetryDelayMs=g;break}}}),d.length&&t.warn(`hls.js config: "${d.join('", "')}" setting(s) are deprecated, use "${u}": ${Ue(e[u])}`)}),Oe(Oe({},n),e)}function yc(a){return a&&typeof a=="object"?Array.isArray(a)?a.map(yc):Object.keys(a).reduce((e,t)=>(e[t]=yc(a[t]),e),{}):a}function GL(a,e){const t=a.loader;t!==lp&&t!==c0?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1):kL()&&(a.loader=lp,a.progressive=!0,a.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const fo=2,VL=.1,KL=.05,HL=100;class WL extends rg{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(HL),this.mediaSource=t.mediaSource;const n=this.media=t.media;At(n,"playing",this.onMediaPlaying),At(n,"waiting",this.onMediaWaiting),At(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(Pt(n,"playing",this.onMediaPlaying),Pt(n,"waiting",this.onMediaWaiting),Pt(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,i;const s=(n=this.hls)==null?void 0:n.config;if(!s)return;const l=this.media;if(!l)return;const{seeking:u}=l,h=this.seeking&&!u,d=!this.seeking&&u,f=l.paused&&!u||l.ended||l.playbackRate===0;if(this.seeking=u,e!==t){t&&(this.ended=0),this.moved=!0,u||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!f&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(d||h){h&&this.stallResolved(e);return}if(f){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&l.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1}));return}if(!Ie.getBuffered(l).length){this.nudgeRetry=0;return}const m=Ie.bufferInfo(l,e,0),g=m.nextStart||0,v=this.fragmentTracker;if(u&&v&&this.hls){const j=up(this.hls.inFlightFragments,e),P=m.len>fo,B=!g||j||g-e>fo&&!v.getPartialFragment(e);if(P||B)return;this.moved=!1}const x=(i=this.hls)==null?void 0:i.latestLevelDetails;if(!this.moved&&this.stalled!==null&&v){if(!(m.len>0)&&!g)return;const P=Math.max(g,m.start||0)-e,U=!!(x!=null&&x.live)?x.targetduration*2:fo,O=to(e,v);if(P>0&&(P<=U||O)){l.paused||this._trySkipBufferHole(O);return}}const T=s.detectStallWithCurrentTimeMs,S=self.performance.now(),I=this.waiting;let b=this.stalled;if(b===null)if(I>0&&S-I<T)b=this.stalled=I;else{this.stalled=S;return}const w=S-b;if(!u&&(w>=T||I)&&this.hls){var _;if(((_=this.mediaSource)==null?void 0:_.readyState)==="ended"&&!(x!=null&&x.live)&&Math.abs(e-((x==null?void 0:x.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(m),!this.media||!this.hls)return}const D=Ie.bufferInfo(l,e,s.maxBufferHole);this._tryFixBufferStall(D,w,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(L.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&i&&i.length>1&&e>i.end(0)){const s=Ie.bufferedInfo(Ie.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const l=Ie.timeRangesToArray(i),u=Ie.bufferedInfo(l,t,0).bufferedIndex;if(u>-1&&u<l.length-1){const h=Ie.bufferedInfo(l,e,0).bufferedIndex,d=l[u].end,f=l[u+1].start;if((h===-1||h>u)&&f-d<1&&e-d<2){const m=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${d} -> ${f} buffered index: ${h}`);this.warn(m.message),this.media.currentTime+=1e-6;let g=to(e,this.fragmentTracker);g&&"fragment"in g?g=g.fragment:g||(g=void 0);const v=Ie.bufferInfo(this.media,e,0);this.hls.trigger(L.ERROR,{type:ve.MEDIA_ERROR,details:G.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,frag:g,buffer:v.len,bufferInfo:v})}}}}}_tryFixBufferStall(e,t,n){var i,s;const{fragmentTracker:l,media:u}=this,h=(i=this.hls)==null?void 0:i.config;if(!u||!l||!h)return;const d=(s=this.hls)==null?void 0:s.latestLevelDetails,f=to(n,l);if((f||d!=null&&d.live&&n<d.fragmentStart)&&(this._trySkipBufferHole(f)||!this.media))return;const m=e.buffered,g=this.adjacentTraversal(e,n);(m&&m.length>1&&e.len>h.maxBufferHole||e.nextStart&&(e.nextStart-n<h.maxBufferHole||g))&&(t>h.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,i=e.nextStart;if(n&&i){const s=n.getFragAtPos(t,me.MAIN),l=n.getFragAtPos(i,me.MAIN);if(s&&l)return l.sn-s.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:i,stalled:s}=this;if(!i&&s!==null&&n&&t){this.stallReported=!0;const l=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${Ue(e)})`);this.warn(l.message),t.trigger(L.ERROR,{type:ve.MEDIA_ERROR,details:G.BUFFER_STALLED_ERROR,fatal:!1,error:l,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:i}=this,s=(t=this.hls)==null?void 0:t.config;if(!i||!n||!s)return 0;const l=i.currentTime,u=Ie.bufferInfo(i,l,0),h=l<u.start?u.start:u.nextStart;if(h&&this.hls){const f=u.len<=s.maxBufferHole,m=u.len>0&&u.len<1&&i.readyState<3,g=h-l;if(g>0&&(f||m)){if(g>s.maxBufferHole){let x=!1;if(l===0){const T=n.getAppendedFrag(0,me.MAIN);T&&h<T.end&&(x=!0)}if(!x&&e){var d;if(!((d=this.hls.loadLevelObj)!=null&&d.details)||up(this.hls.inFlightFragments,h))return 0;let S=!1,I=e.end;for(;I<h;){const b=to(I,n);if(b)I+=b.duration;else{S=!0;break}}if(S)return 0}}const v=Math.max(h+KL,l+VL);if(this.warn(`skipping hole, adjusting currentTime from ${l} to ${v}`),this.moved=!0,i.currentTime=v,!(e!=null&&e.gap)){const x=new Error(`fragment loaded with buffer holes, seeking from ${l} to ${v}`),T={type:ve.MEDIA_ERROR,details:G.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:x,reason:x.message,buffer:u.len,bufferInfo:u};e&&("fragment"in e?T.part=e:T.frag=e),this.hls.trigger(L.ERROR,T)}return v}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:i}=this,s=t==null?void 0:t.config;if(!n||!s)return 0;const l=n.currentTime;if(this.nudgeRetry++,i<s.nudgeMaxRetry){const u=l+(i+1)*s.nudgeOffset,h=new Error(`Nudging 'currentTime' from ${l} to ${u}`);this.warn(h.message),n.currentTime=u,t.trigger(L.ERROR,{type:ve.MEDIA_ERROR,details:G.BUFFER_NUDGE_ON_STALL,error:h,fatal:!1,buffer:e.len,bufferInfo:e})}else{const u=new Error(`Playhead still not moving while enough data buffered @${l} after ${s.nudgeMaxRetry} nudges`);this.error(u.message),t.trigger(L.ERROR,{type:ve.MEDIA_ERROR,details:G.BUFFER_STALLED_ERROR,error:u,fatal:!0,buffer:e.len,bufferInfo:e})}}}function up(a,e){const t=cp(a.main);if(t&&t.start<=e)return t;const n=cp(a.audio);return n&&n.start<=e?n:null}function cp(a){if(!a)return null;switch(a.state){case q.IDLE:case q.STOPPED:case q.ENDED:case q.ERROR:return null}return a.frag}function to(a,e){return e.getAppendedFrag(a,me.MAIN)||e.getPartialFragment(a)}const zL=.25;function vc(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function qu(a,e,t,n,i){let s=new a(e,t,"");try{s.value=n,i&&(s.type=i)}catch{s=new a(e,t,Ue(i?Oe({type:i},n):n))}return s}const no=(()=>{const a=vc();try{a&&new a(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class YL{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(L.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&xi(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return Jg(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:i}=this.hls.config;if(!n&&!i)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=vc();if(l)for(let u=0;u<s.length;u++){const h=s[u].type;if(h===Gt.emsg&&!n||!i)continue;const d=Rg(s[u].data),f=s[u].pts;let m=f+s[u].duration;m>no&&(m=no),m-f<=0&&(m=f+zL);for(let v=0;v<d.length;v++){const x=d[v];if(!wg(x)){this.updateId3CueEnds(f,h);const T=qu(l,f,m,x,h);T&&this.id3Track.addCue(T)}}}}updateId3CueEnds(e,t){var n;const i=(n=this.id3Track)==null?void 0:n.cues;if(i)for(let s=i.length;s--;){const l=i[s];l.type===t&&l.startTime<e&&l.endTime===no&&(l.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:i}){const{id3Track:s,hls:l}=this;if(!l)return;const{config:{enableEmsgMetadataCues:u,enableID3MetadataCues:h}}=l;if(s&&(u||h)){let d;i==="audio"?d=f=>f.type===Gt.audioId3&&h:i==="video"?d=f=>f.type===Gt.emsg&&u:d=f=>f.type===Gt.audioId3&&h||f.type===Gt.emsg&&u,pc(s,t,n,d)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:i,enableDateRangeMetadataCues:s,interstitialsController:l}=this.hls.config;if(!s)return;const u=vc();if(n&&i&&!l){const{fragmentStart:T,fragmentEnd:S}=e;let I=this.assetCue;I?(I.startTime=T,I.endTime=S):u&&(I=this.assetCue=qu(u,T,S,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),I&&(I.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(I),I.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:h}=this,{dateRanges:d}=e,f=Object.keys(d);let m=this.dateRangeCuesAppended;if(h&&t){var g;if((g=h.cues)!=null&&g.length){const T=Object.keys(m).filter(S=>!f.includes(S));for(let S=T.length;S--;){var v;const I=T[S],b=(v=m[I])==null?void 0:v.cues;delete m[I],b&&Object.keys(b).forEach(w=>{const _=b[w];if(_){_.removeEventListener("enter",this.onEventCueEnter);try{h.removeCue(_)}catch{}}})}}else m=this.dateRangeCuesAppended={}}const x=e.fragments[e.fragments.length-1];if(!(f.length===0||!le(x==null?void 0:x.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let T=0;T<f.length;T++){const S=f[T],I=d[S],b=I.startTime,w=m[S],_=(w==null?void 0:w.cues)||{};let D=(w==null?void 0:w.durationKnown)||!1,j=no;const{duration:P,endDate:B}=I;if(B&&P!==null)j=b+P,D=!0;else if(I.endOnNext&&!D){const O=f.reduce((Y,ne)=>{if(ne!==I.id){const se=d[ne];if(se.class===I.class&&se.startDate>I.startDate&&(!Y||I.startDate<Y.startDate))return se}return Y},null);O&&(j=O.startTime,D=!0)}const U=Object.keys(I.attr);for(let O=0;O<U.length;O++){const Y=U[O];if(!pS(Y))continue;const ne=_[Y];if(ne)D&&!(w!=null&&w.durationKnown)?ne.endTime=j:Math.abs(ne.startTime-b)>.01&&(ne.startTime=b,ne.endTime=j);else if(u){let se=I.attr[Y];gS(Y)&&(se=Fp(se));const oe=qu(u,b,j,{key:Y,data:se},Gt.dateRange);oe&&(oe.id=S,this.id3Track.addCue(oe),_[Y]=oe,l&&(Y==="X-ASSET-LIST"||Y==="X-ASSET-URL")&&oe.addEventListener("enter",this.onEventCueEnter))}}m[S]={cues:_,dateRange:I,durationKnown:D}}}}}class qL{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:l}=this.config;if(!s||l===1||!n.live)return;const u=this.targetLatency;if(u===null)return;const h=i-u,d=Math.min(this.maxLatency,u+n.targetduration);if(h<d&&h>.05&&this.forwardBufferLength>1){const m=Math.min(2,Math.max(1,l)),g=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20,v=Math.min(m,Math.max(1,g));this.changeMediaPlaybackRate(t,v)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:i}=e,{liveSyncDuration:s,liveSyncDurationCount:l,lowLatencyMode:u}=this.config,h=this.hls.userConfig;let d=u&&n||t;(this._targetLatencyUpdated||h.liveSyncDuration||h.liveSyncDurationCount||d===0)&&(d=s!==void 0?s:l*i);const f=i;return d+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,f)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const i=n.edge,s=e-t-this.edgeStalled,l=i-n.totalduration,u=i-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(l,s),u)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===G.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,i;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(i=this.targetLatency)==null?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class QL extends Vc{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,i=[],s={},l={};let u=!1,h=!1,d=!1;t.levels.forEach(f=>{const m=f.attrs;let{audioCodec:g,videoCodec:v}=f;g&&(f.audioCodec=g=go(g,n)||void 0),v&&(v=f.videoCodec=DE(v));const{width:x,height:T,unknownCodecs:S}=f,I=(S==null?void 0:S.length)||0;if(u||(u=!!(x&&T)),h||(h=!!v),d||(d=!!g),I||g&&!this.isAudioSupported(g)||v&&!this.isVideoSupported(v)){this.log(`Some or all CODECS not supported "${m.CODECS}"`);return}const{CODECS:b,"FRAME-RATE":w,"HDCP-LEVEL":_,"PATHWAY-ID":D,RESOLUTION:j,"VIDEO-RANGE":P}=m,U=`${`${D||"."}-`}${f.bitrate}-${j}-${w}-${b}-${P}-${_}`;if(s[U])if(s[U].uri!==f.url&&!f.attrs["PATHWAY-ID"]){const O=l[U]+=1;f.attrs["PATHWAY-ID"]=new Array(O+1).join(".");const Y=this.createLevel(f);s[U]=Y,i.push(Y)}else s[U].addGroupId("audio",m.AUDIO),s[U].addGroupId("text",m.SUBTITLES);else{const O=this.createLevel(f);s[U]=O,l[U]=1,i.push(O)}}),this.filterAndSortMediaOptions(i,t,u,h,d)}createLevel(e){const t=new Ls(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const i=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(i.message),t.supportedResult=qp(i,[])}return t}isAudioSupported(e){return Ss(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Ss(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,i,s){var l;let u=[],h=[],d=e;const f=((l=t.stats)==null?void 0:l.parsing)||{};if((n||i)&&s&&(d=d.filter(({videoCodec:b,videoRange:w,width:_,height:D})=>(!!b||!!(_&&D))&&GE(w))),d.length===0){Promise.resolve().then(()=>{if(this.hls){let b="no level with compatible codecs found in manifest",w=b;t.levels.length&&(w=`one or more CODECS in variant not supported: ${Ue(t.levels.map(D=>D.attrs.CODECS).filter((D,j,P)=>P.indexOf(D)===j))}`,this.warn(w),b+=` (${w})`);const _=new Error(b);this.hls.trigger(L.ERROR,{type:ve.MEDIA_ERROR,details:G.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:_,reason:w})}}),f.end=performance.now();return}t.audioTracks&&(u=t.audioTracks.filter(b=>!b.audioCodec||this.isAudioSupported(b.audioCodec)),dp(u)),t.subtitles&&(h=t.subtitles,dp(h));const m=d.slice(0);d.sort((b,w)=>{if(b.attrs["HDCP-LEVEL"]!==w.attrs["HDCP-LEVEL"])return(b.attrs["HDCP-LEVEL"]||"")>(w.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&b.height!==w.height)return b.height-w.height;if(b.frameRate!==w.frameRate)return b.frameRate-w.frameRate;if(b.videoRange!==w.videoRange)return yo.indexOf(b.videoRange)-yo.indexOf(w.videoRange);if(b.videoCodec!==w.videoCodec){const _=nm(b.videoCodec),D=nm(w.videoCodec);if(_!==D)return D-_}if(b.uri===w.uri&&b.codecSet!==w.codecSet){const _=po(b.codecSet),D=po(w.codecSet);if(_!==D)return D-_}return b.averageBitrate!==w.averageBitrate?b.averageBitrate-w.averageBitrate:0});let g=m[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==m.length)){for(let b=0;b<m.length;b++)if(m[b].pathwayId===d[0].pathwayId){g=m[b];break}}this._levels=d;for(let b=0;b<d.length;b++)if(d[b]===g){var v;this._firstLevel=b;const w=g.bitrate,_=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${w}`),((v=this.hls.userConfig)==null?void 0:v.abrEwmaDefaultEstimate)===void 0){const D=Math.min(w,this.hls.config.abrEwmaDefaultEstimateMax);D>_&&_===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=D)}break}const x=s&&!i,T=this.hls.config,S=!!(T.audioStreamController&&T.audioTrackController),I={levels:d,audioTracks:u,subtitleTracks:h,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:i,altAudio:S&&!x&&u.some(b=>!!b.url)};f.end=performance.now(),this.hls.trigger(L.MANIFEST_PARSED,I)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const f=new Error("invalid level idx"),m=e<0;if(this.hls.trigger(L.ERROR,{type:ve.OTHER_ERROR,details:G.LEVEL_SWITCH_ERROR,level:e,fatal:m,error:f,reason:f.message}),m)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,i=this.currentLevel,s=i?i.attrs["PATHWAY-ID"]:void 0,l=t[e],u=l.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=l,n===e&&i&&s===u)return;this.log(`Switching to level ${e} (${l.height?l.height+"p ":""}${l.videoRange?l.videoRange+" ":""}${l.codecSet?l.codecSet+" ":""}@${l.bitrate})${u?" with Pathway "+u:""} from level ${n}${s?" with Pathway "+s:""}`);const h={level:e,attrs:l.attrs,details:l.details,bitrate:l.bitrate,averageBitrate:l.averageBitrate,maxBitrate:l.maxBitrate,realBitrate:l.realBitrate,width:l.width,height:l.height,codecSet:l.codecSet,audioCodec:l.audioCodec,videoCodec:l.videoCodec,audioGroups:l.audioGroups,subtitleGroups:l.subtitleGroups,loaded:l.loaded,loadError:l.loadError,fragmentError:l.fragmentError,name:l.name,id:l.id,uri:l.uri,url:l.url,urlId:0,audioGroupIds:l.audioGroupIds,textGroupIds:l.textGroupIds};this.hls.trigger(L.LEVEL_SWITCHING,h);const d=l.details;if(!d||d.live){const f=this.switchParams(l.uri,i==null?void 0:i.details,d);this.loadPlaylist(f)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(i=>t.indexOf(i)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===_e.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===me.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(s=>!!n[s]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var n;const{level:i,details:s}=t,l=t.levelInfo;if(!l){var u;this.warn(`Invalid level index ${i}`),(u=t.deliveryDirectives)!=null&&u.skip&&(s.deltaUpdateFailed=!0);return}if(l===this.currentLevel||t.withoutMultiVariant){l.fragmentError===0&&(l.loadError=0);let h=l.details;h===t.details&&h.advanced&&(h=void 0),this.playlistLoaded(i,t,h)}else(n=t.deliveryDirectives)!=null&&n.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],l=e.details,u=l==null?void 0:l.age;this.log(`Loading level index ${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${u&&l.live?" age "+u.toFixed(1)+(l.type&&" "+l.type||""):""} ${n}`),this.hls.trigger(L.LEVEL_LOADING,{url:n,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((s,l)=>l!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(u=>u.level=-1)),!1));gg(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=n.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(L.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(L.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function dp(a){const e={};a.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function d0(){return self.SourceBuffer||self.WebKitSourceBuffer}function h0(){if(!gr())return!1;const e=d0();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function XL(){if(!h0())return!1;const a=gr();return typeof(a==null?void 0:a.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>a.isTypeSupported(Ts(e,"video")))||["mp4a.40.2","fLaC"].some(e=>a.isTypeSupported(Ts(e,"audio"))))}function JL(){var a;const e=d0();return typeof(e==null||(a=e.prototype)==null?void 0:a.changeType)=="function"}const ZL=100;class eA extends Oc{constructor(e,t,n){super(e,t,n,"stream-controller",me.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const i=this.media,s=i?i.currentTime:null;if(s===null||!le(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const l=this.getFwdBufferInfoAtPos(i,s,me.MAIN,0);if(l===null||l.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${l?l.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:i}=this;if(this.stopLoad(),this.setInterval(ZL),this.level=-1,!this.startFragRequested){let s=i.startLevel;s===-1&&(i.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=i.firstAutoLevel),i.nextLoadLevel=s,this.level=i.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=q.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=q.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case q.WAITING_LEVEL:{const{levels:e,level:t}=this,n=e==null?void 0:e[t],i=n==null?void 0:n.details;if(i&&(!i.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(i))break;this.state=q.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=q.IDLE;break}break}case q.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===q.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:i}=this;if(t===null||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[s]))return;const l=n[s],u=this.getMainFwdBufferInfo();if(u===null)return;const h=this.getLevelDetails();if(h&&this._streamEnded(u,h)){const T={};this.altAudio===2&&(T.type="video"),this.hls.trigger(L.BUFFER_EOS,T),this.state=q.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const d=l.details;if(!d||this.state===q.WAITING_LEVEL||this.waitForLive(l)){this.level=s,this.state=q.WAITING_LEVEL,this.startFragRequested=!1;return}const f=u.len,m=this.getMaxBufferLength(l.maxBitrate);if(f>=m)return;this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);const g=this.backtrackFragment?this.backtrackFragment.start:u.end;let v=this.getNextFragment(g,d);if(this.couldBacktrack&&!this.fragPrevious&&v&&et(v)&&this.fragmentTracker.getState(v)!==at.OK){var x;const S=((x=this.backtrackFragment)!=null?x:v).sn-d.startSN,I=d.fragments[S-1];I&&v.cc===I.cc&&(v=I,this.fragmentTracker.removeFragment(I))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(v&&this.isLoopLoading(v,g)){if(!v.gap){const S=this.audioOnly&&!this.altAudio?Be.AUDIO:Be.VIDEO,I=(S===Be.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;I&&this.afterBufferFlushed(I,S,me.MAIN)}v=this.getNextFragmentLoopLoading(v,d,u,me.MAIN,m)}v&&(v.initSegment&&!v.initSegment.data&&!this.bitrateTest&&(v=v.initSegment),this.loadFragment(v,l,g))}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);i===at.NOT_LOADED||i===at.PARTIAL?et(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,me.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const u=this.getMainFwdBufferInfo();if(!u||u.len<s.targetduration*2)return}if(!t.paused&&e){const u=this.hls.nextLoadLevel,h=e[u],d=this.fragLastKbps;d&&this.fragCurrent?n=this.fragCurrent.duration*h.maxBitrate/(1e3*d)+1:n=0}else n=0;const l=this.getBufferedFrag(t.currentTime+n);if(l){const u=this.followingBufferedFrag(l);if(u){this.abortCurrentFrag();const h=u.maxStartPTS?u.maxStartPTS:u.start,d=u.duration,f=Math.max(l.end,h+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,d*(this.couldBacktrack?.5:.125)),d*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case q.KEY_LOADING:case q.FRAG_LOADING:case q.FRAG_LOADING_WAITING_RETRY:case q.PARSING:case q.PARSED:this.state=q.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;At(n,"playing",this.onMediaPlaying),At(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(Pt(n,"playing",this.onMediaPlaying),Pt(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(L.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,i=!1;for(let s=0;s<t.levels.length;s++){const l=t.levels[s].audioCodec;l&&(n=n||l.indexOf("mp4a.40.2")!==-1,i=i||l.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=n&&i&&!JL(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==q.IDLE)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=q.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:i,startFragRequested:s}=this,l=t.level,u=t.details,h=u.totalduration;if(!i){this.warn(`Levels were reset while loading level ${l}`);return}this.log(`Level ${l} loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""}, cc [${u.startCC}, ${u.endCC}] duration:${h}`);const d=t.levelInfo,f=this.fragCurrent;f&&(this.state===q.FRAG_LOADING||this.state===q.FRAG_LOADING_WAITING_RETRY)&&f.level!==t.level&&f.loader&&this.abortCurrentFrag();let m=0;if(u.live||(n=d.details)!=null&&n.live){var g;if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;m=this.alignPlaylists(u,d.details,(g=this.levelLastLoaded)==null?void 0:g.details)}if(d.details=u,this.levelLastLoaded=d,s||this.setStartPosition(u,m),this.hls.trigger(L.LEVEL_UPDATED,{details:u,level:l}),this.state===q.WAITING_LEVEL){if(this.waitForCdnTuneIn(u))return;this.state=q.IDLE}s&&u.live&&this.synchronizeToLiveEdge(u),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const i=this.hls.liveSyncPosition,s=this.getLoadPosition(),l=e.fragmentStart,u=e.edge,h=s>=l-t.maxFragLookUpTolerance&&s<=u;if(i!==null&&n.duration>i&&(s<i||!h)){const f=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!h&&n.readyState<4||s<u-f)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),n.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${u}, reset currentTime to : ${i.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var d;const m=Ie.bufferInfo(n,i,0);if(!((d=m.buffered)!=null&&d.length)){n.currentTime=i;return}if(m.start<=s){n.currentTime=i;return}const{nextStart:v}=Ie.bufferedInfo(m.buffered,s,0);v&&(n.currentTime=v)}else n.currentTime=i}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:i,payload:s}=e,{levels:l}=this;if(!l){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const u=l[n.level];if(!u){this.warn(`Level ${n.level} not found on progress`);return}const h=u.details;if(!h){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const d=u.videoCodec,f=h.PTSKnown||!h.live,m=(t=n.initSegment)==null?void 0:t.data,g=this._getAudioCodec(u),v=this.transmuxer=this.transmuxer||new Bg(this.hls,me.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),x=i?i.index:-1,T=x!==-1,S=new Dc(n.level,n.sn,n.stats.chunkCount,s.byteLength,x,T),I=this.initPTS[n.cc];v.push(s,m,g,d,n,i,h.totalduration,f,S,I)}onAudioTrackSwitching(e,t){const n=this.hls,i=this.altAudio!==0;if(vo(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const l=this.fragCurrent;l&&(this.log("Switching to main audio track, cancel main fragment load"),l.abortRequests(),this.fragmentTracker.removeFragment(l)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.altAudio=0,this.fragmentTracker.removeAllFragments(),n.once(L.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(L.AUDIO_TRACK_SWITCHED,t)}),n.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(L.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=vo(t.url,this.hls);if(n){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let i,s,l=!1;for(const u in n){const h=n[u];if(h.id==="main"){if(s=u,i=h,u==="video"){const d=n[u];d&&(this.videoBuffer=d.buffer)}}else l=!0}l&&i?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:i}=t,s=n.type===me.MAIN;if(s){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===q.PARSED&&(this.state=q.IDLE);return}const u=i?i.stats:n.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),et(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,i)}const l=this.media;l&&(!this._hasEnoughToStart&&Ie.getBuffered(l).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=q.ERROR;return}switch(t.details){case G.FRAG_GAP:case G.FRAG_PARSING_ERROR:case G.FRAG_DECRYPT_ERROR:case G.FRAG_LOAD_ERROR:case G.FRAG_LOAD_TIMEOUT:case G.KEY_LOAD_ERROR:case G.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(me.MAIN,t);break;case G.LEVEL_LOAD_ERROR:case G.LEVEL_LOAD_TIMEOUT:case G.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===q.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===_e.LEVEL&&(this.state=q.IDLE);break;case G.BUFFER_ADD_CODEC_ERROR:case G.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case G.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case G.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=q.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Be.AUDIO||!this.altAudio){const n=(t===Be.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,me.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const i=this.timelineOffset;i&&n&&(n+=i);const s=this.getLevelDetails(),l=Ie.getBuffered(e),u=l.length?l.start(0):0,h=u-n,d=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||h>0&&(h<d||this.loadingParts&&h<2*((s==null?void 0:s.partTarget)||0)))&&(this.log(`adjusting start position by ${h} to match buffer start`),n+=h,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${u}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:i}=this,s=n==null?void 0:n.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=q.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const l=s.stats;l.parsing.start=l.parsing.end=l.buffering.start=l.buffering.end=self.performance.now(),i.trigger(L.FRAG_LOADED,n),s.bitrateTest=!1}).catch(n=>{this.state===q.STOPPED||this.state===q.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:i,chunkMeta:s}=e,l=this.getCurrentContext(s);if(!l){this.resetWhenMissingContext(s);return}const{frag:u,part:h,level:d}=l,{video:f,text:m,id3:g,initSegment:v}=i,{details:x}=d,T=this.altAudio?void 0:i.audio;if(this.fragContextChanged(u)){this.fragmentTracker.removeFragment(u);return}if(this.state=q.PARSING,v){const S=v.tracks;if(S){const _=u.initSegment||u;if(this.unhandledEncryptionError(v,u))return;this._bufferInitSegment(d,S,_,s),n.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:_,id:t,tracks:S})}const I=v.initPTS,b=v.timescale,w=this.initPTS[u.cc];if(le(I)&&(!w||w.baseTime!==I||w.timescale!==b)){const _=v.trackId;this.initPTS[u.cc]={baseTime:I,timescale:b,trackId:_},n.trigger(L.INIT_PTS_FOUND,{frag:u,id:t,initPTS:I,timescale:b,trackId:_})}}if(f&&x){T&&f.type==="audiovideo"&&this.logMuxedErr(u);const S=x.fragments[u.sn-1-x.startSN],I=u.sn===x.startSN,b=!S||u.cc>S.cc;if(i.independent!==!1){const{startPTS:w,endPTS:_,startDTS:D,endDTS:j}=f;if(h)h.elementaryStreams[f.type]={startPTS:w,endPTS:_,startDTS:D,endDTS:j};else if(f.firstKeyFrame&&f.independent&&s.id===1&&!b&&(this.couldBacktrack=!0),f.dropped&&f.independent){const P=this.getMainFwdBufferInfo(),B=(P?P.end:this.getLoadPosition())+this.config.maxBufferHole,U=f.firstKeyFramePTS?f.firstKeyFramePTS:w;if(!I&&B<U-this.config.maxBufferHole&&!b){this.backtrack(u);return}else b&&(u.gap=!0);u.setElementaryStreamInfo(f.type,u.start,_,u.start,j,!0)}else I&&w-(x.appliedTimelineOffset||0)>fo&&(u.gap=!0);u.setElementaryStreamInfo(f.type,w,_,D,j),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(f,u,h,s,I||b)}else if(I||b)u.gap=!0;else{this.backtrack(u);return}}if(T){const{startPTS:S,endPTS:I,startDTS:b,endDTS:w}=T;h&&(h.elementaryStreams[Be.AUDIO]={startPTS:S,endPTS:I,startDTS:b,endDTS:w}),u.setElementaryStreamInfo(Be.AUDIO,S,I,b,w),this.bufferFragmentData(T,u,h,s)}if(x&&g!=null&&g.samples.length){const S={id:t,frag:u,details:x,samples:g.samples};n.trigger(L.FRAG_PARSING_METADATA,S)}if(x&&m){const S={id:t,frag:u,details:x,samples:m.samples};n.trigger(L.FRAG_PARSING_USERDATA,S)}}logMuxedErr(e){this.warn(`${et(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,i){if(this.state!==q.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:s,video:l,audiovideo:u}=t;if(s){const d=e.audioCodec;let f=so(s.codec,d);f==="mp4a"&&(f="mp4a.40.5");const m=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");const g=s.metadata;g&&"channelCount"in g&&(g.channelCount||1)!==1&&m.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&m.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),d&&d!==f&&this.log(`Swapping manifest audio codec "${d}" for "${f}"`),s.levelCodec=f,s.id=me.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${f||""}/${d||""}/${s.codec}]`),delete t.audiovideo}if(l){l.levelCodec=e.videoCodec,l.id=me.MAIN;const d=l.codec;if((d==null?void 0:d.length)===4)switch(d){case"hvc1":case"hev1":l.codec="hvc1.1.6.L120.90";break;case"av01":l.codec="av01.0.04M.08";break;case"avc1":l.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${l.container}, codecs[level/parsed]=[${e.videoCodec||""}/${d}]${l.codec!==d?" parsed-corrected="+l.codec:""}${l.supplemental?" supplemental="+l.supplemental:""}`),delete t.audiovideo}u&&(this.log(`Init audiovideo buffer, container:${u.container}, codecs[level/parsed]=[${e.codecs}/${u.codec}]`),delete t.video,delete t.audio);const h=Object.keys(t);if(h.length){if(this.hls.trigger(L.BUFFER_CODECS,t),!this.hls)return;h.forEach(d=>{const m=t[d].initSegment;m!=null&&m.byteLength&&this.hls.trigger(L.BUFFER_APPENDING,{type:d,data:m,frag:n,part:null,chunkMeta:i,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,me.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e==null?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=q.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(Ie.isBuffered(e,n)?t=this.getAppendedFrag(n):Ie.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,s=t.level;(!i||t.sn!==i.sn||i.level!==s)&&(this.fragPlaying=t,this.hls.trigger(L.FRAG_CHANGED,{frag:t}),(!i||i.level!==s)&&this.hls.trigger(L.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return le(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(le(t)){const n=this.getLevelDetails(),i=this.currentFrag||(n?Fr(null,n.fragments,t):null);if(i){const s=i.programDateTime;if(s!==null){const l=s+(t-i.start)*1e3;return new Date(l)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class tA extends Zt{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const i=this.keyIdToKeyInfo[n].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=G.KEY_LOAD_ERROR,n,i,s){return new Bn({type:ve.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:n,networkDetails:i})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let i=0,s=t.length;i<s;i++){const l=t[i];if(e.cc<=l.cc&&(!et(e)||!et(l)||e.sn<l.sn)||!n&&i==s-1)return this.emeController.selectKeySystemFormat(l).then(u=>{if(!this.emeController)return;l.setKeyFormat(u);const h=oo(u);if(h)return this.emeController.getKeySystemAccess([h])})}if(this.config.requireKeySystemAccessOnStart){const i=gs(this.config);if(i.length)return this.emeController.getKeySystemAccess(i)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,i;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const d=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,G.KEY_LOAD_ERROR,d))}const l=s.uri;if(!l)return Promise.reject(this.createKeyLoadError(e,G.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${l}"`)));const u=Qu(s);let h=this.keyIdToKeyInfo[u];if((n=h)!=null&&n.decryptdata.key)return s.key=h.decryptdata.key,Promise.resolve({frag:e,keyInfo:h});if(this.emeController&&(i=h)!=null&&i.keyLoadPromise)switch(this.emeController.getKeyStatus(h.decryptdata)){case"usable":case"usable-in-future":return h.keyLoadPromise.then(f=>{const{keyInfo:m}=f;return s.key=m.decryptdata.key,{frag:e,keyInfo:m}})}switch(this.log(`${this.keyIdToKeyInfo[u]?"Rel":"L"}oading${s.keyId?" keyId: "+pt(s.keyId):""} URI: ${s.uri} from ${e.type} ${e.level}`),h=this.keyIdToKeyInfo[u]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(h,e):this.loadKeyEME(h,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(h,e);default:return Promise.reject(this.createKeyLoadError(e,G.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i;if(!e.decryptdata.keyId&&(i=t.initSegment)!=null&&i.data){const l=EE(t.initSegment.data);if(l.length){let u=l[0];u.some(h=>h!==0)?(this.log(`Using keyId found in init segment ${pt(u)}`),pr.setKeyIdForUri(e.decryptdata.uri,u)):(u=pr.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${pt(u)}`)),e.decryptdata.keyId=u}}if(!e.decryptdata.keyId&&!et(t))return Promise.resolve(n);const s=this.emeController.loadKey(n);return(e.keyLoadPromise=s.then(l=>(e.mediaKeySessionContext=l,n))).catch(l=>{throw e.keyLoadPromise=null,"data"in l&&(l.data.frag=t),l})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,i=n.loader,s=new i(n);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((l,u)=>{const h={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=n.keyLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(g,v,x,T)=>{const{frag:S,keyInfo:I}=x,b=Qu(I.decryptdata);if(!S.decryptdata||I!==this.keyIdToKeyInfo[b])return u(this.createKeyLoadError(S,G.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),T));I.decryptdata.key=S.decryptdata.key=new Uint8Array(g.data),S.keyLoader=null,I.loader=null,l({frag:S,keyInfo:I})},onError:(g,v,x,T)=>{this.resetLoader(v),u(this.createKeyLoadError(t,G.KEY_LOAD_ERROR,new Error(`HTTP Error ${g.code} loading key ${g.text}`),x,Oe({url:h.url,data:void 0},g)))},onTimeout:(g,v,x)=>{this.resetLoader(v),u(this.createKeyLoadError(t,G.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),x))},onAbort:(g,v,x)=>{this.resetLoader(v),u(this.createKeyLoadError(t,G.INTERNAL_ABORTED,new Error("key loading aborted"),x))}};s.load(h,f,m)})}resetLoader(e){const{frag:t,keyInfo:n,url:i}=e,s=n.loader;t.keyLoader===s&&(t.keyLoader=null,n.loader=null);const l=Qu(n.decryptdata)||i;delete this.keyIdToKeyInfo[l],s&&s.destroy()}}function Qu(a){if(a.keyFormat!==gt.FAIRPLAY){const e=a.keyId;if(e)return pt(e)}return a.uri}function hp(a){const{type:e}=a;switch(e){case _e.AUDIO_TRACK:return me.AUDIO;case _e.SUBTITLE_TRACK:return me.SUBTITLE;default:return me.MAIN}}function Xu(a,e){let t=a.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class nA{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,i=t.loader,s=n||i,l=new s(t);return this.loaders[e.type]=l,l}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:_e.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:i,pathwayId:s,url:l,deliveryDirectives:u,levelInfo:h}=t;this.load({id:n,level:i,pathwayId:s,responseType:"text",type:_e.LEVEL,url:l,deliveryDirectives:u,levelOrTrack:h})}onAudioTrackLoading(e,t){const{id:n,groupId:i,url:s,deliveryDirectives:l,track:u}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:_e.AUDIO_TRACK,url:s,deliveryDirectives:l,levelOrTrack:u})}onSubtitleTrackLoading(e,t){const{id:n,groupId:i,url:s,deliveryDirectives:l,track:u}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:_e.SUBTITLE_TRACK,url:s,deliveryDirectives:l,levelOrTrack:u})}onLevelsUpdated(e,t){const n=this.loaders[_e.LEVEL];if(n){const i=n.context;i&&!t.levels.some(s=>s===i.levelOrTrack)&&(n.abort(),delete this.loaders[_e.LEVEL])}}load(e){var t;const n=this.hls.config;let i=this.getInternalLoader(e);if(i){const d=this.hls.logger,f=i.context;if(f&&f.levelOrTrack===e.levelOrTrack&&(f.url===e.url||f.deliveryDirectives&&!e.deliveryDirectives)){f.url===e.url?d.log(`[playlist-loader]: ignore ${e.url} ongoing request`):d.log(`[playlist-loader]: ignore ${e.url} in favor of ${f.url}`);return}d.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let s;if(e.type===_e.MANIFEST?s=n.manifestLoadPolicy.default:s=Fe({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),le((t=e.deliveryDirectives)==null?void 0:t.part)){let d;if(e.type===_e.LEVEL&&e.level!==null?d=this.hls.levels[e.level].details:e.type===_e.AUDIO_TRACK&&e.id!==null?d=this.hls.audioTracks[e.id].details:e.type===_e.SUBTITLE_TRACK&&e.id!==null&&(d=this.hls.subtitleTracks[e.id].details),d){const f=d.partTarget,m=d.targetduration;if(f&&m){const g=Math.max(f*3,m*.8)*1e3;s=Fe({},s,{maxTimeToFirstByteMs:Math.min(g,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(g,s.maxTimeToFirstByteMs)})}}}const l=s.errorRetry||s.timeoutRetry||{},u={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},h={onSuccess:(d,f,m,g)=>{const v=this.getInternalLoader(m);this.resetInternalLoader(m.type);const x=d.data;f.parsing.start=performance.now(),An.isMediaPlaylist(x)||m.type!==_e.MANIFEST?this.handleTrackOrLevelPlaylist(d,f,m,g||null,v):this.handleMasterPlaylist(d,f,m,g)},onError:(d,f,m,g)=>{this.handleNetworkError(f,m,!1,d,g)},onTimeout:(d,f,m)=>{this.handleNetworkError(f,m,!0,void 0,d)}};i.load(e,u,h)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,i){const s=this.hls,l=e.data,u=Xu(e,n),h=An.parseMasterPlaylist(l,u);if(h.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,n,h.playlistParsingError,i,t);return}const{contentSteering:d,levels:f,sessionData:m,sessionKeys:g,startTimeOffset:v,variableList:x}=h;this.variableList=x,f.forEach(b=>{const{unknownCodecs:w}=b;if(w){const{preferManagedMediaSource:_}=this.hls.config;let{audioCodec:D,videoCodec:j}=b;for(let P=w.length;P--;){const B=w[P];Ss(B,"audio",_)?(b.audioCodec=D=D?`${D},${B}`:B,Ai.audio[D.substring(0,4)]=2,w.splice(P,1)):Ss(B,"video",_)&&(b.videoCodec=j=j?`${j},${B}`:B,Ai.video[j.substring(0,4)]=2,w.splice(P,1))}}});const{AUDIO:T=[],SUBTITLES:S,"CLOSED-CAPTIONS":I}=An.parseMasterPlaylistMedia(l,u,h);T.length&&!T.some(w=>!w.url)&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),T.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new ze({}),bitrate:0,url:""})),s.trigger(L.MANIFEST_LOADED,{levels:f,audioTracks:T,subtitles:S,captions:I,contentSteering:d,url:u,stats:t,networkDetails:i,sessionData:m,sessionKeys:g,startTimeOffset:v,variableList:x})}handleTrackOrLevelPlaylist(e,t,n,i,s){const l=this.hls,{id:u,level:h,type:d}=n,f=Xu(e,n),m=le(h)?h:le(u)?u:0,g=hp(n),v=An.parseLevelPlaylist(e.data,f,m,g,0,this.variableList);if(d===_e.MANIFEST){const x={attrs:new ze({}),bitrate:0,details:v,name:"",url:f};v.requestScheduled=t.loading.start+fg(v,0),l.trigger(L.MANIFEST_LOADED,{levels:[x],audioTracks:[],url:f,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=v,this.handlePlaylistLoaded(v,e,t,n,i,s)}handleManifestParsingError(e,t,n,i,s){this.hls.trigger(L.ERROR,{type:ve.NETWORK_ERROR,details:G.MANIFEST_PARSING_ERROR,fatal:t.type===_e.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:i,stats:s})}handleNetworkError(e,t,n=!1,i,s){let l=`A network ${n?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===_e.LEVEL?l+=`: ${e.level} id: ${e.id}`:(e.type===_e.AUDIO_TRACK||e.type===_e.SUBTITLE_TRACK)&&(l+=` id: ${e.id} group-id: "${e.groupId}"`);const u=new Error(l);this.hls.logger.warn(`[playlist-loader]: ${l}`);let h=G.UNKNOWN,d=!1;const f=this.getInternalLoader(e);switch(e.type){case _e.MANIFEST:h=n?G.MANIFEST_LOAD_TIMEOUT:G.MANIFEST_LOAD_ERROR,d=!0;break;case _e.LEVEL:h=n?G.LEVEL_LOAD_TIMEOUT:G.LEVEL_LOAD_ERROR,d=!1;break;case _e.AUDIO_TRACK:h=n?G.AUDIO_TRACK_LOAD_TIMEOUT:G.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case _e.SUBTITLE_TRACK:h=n?G.SUBTITLE_TRACK_LOAD_TIMEOUT:G.SUBTITLE_LOAD_ERROR,d=!1;break}f&&this.resetInternalLoader(e.type);const m={type:ve.NETWORK_ERROR,details:h,fatal:d,url:e.url,loader:f,context:e,error:u,networkDetails:t,stats:s};if(i){const g=(t==null?void 0:t.url)||e.url;m.response=Oe({url:g,data:void 0},i)}this.hls.trigger(L.ERROR,m)}handlePlaylistLoaded(e,t,n,i,s,l){const u=this.hls,{type:h,level:d,levelOrTrack:f,id:m,groupId:g,deliveryDirectives:v}=i,x=Xu(t,i),T=hp(i);let S=typeof i.level=="number"&&T===me.MAIN?d:void 0;const I=e.playlistParsingError;if(I){if(this.hls.logger.warn(`${I} ${e.url}`),!u.config.ignorePlaylistParsingErrors){u.trigger(L.ERROR,{type:ve.NETWORK_ERROR,details:G.LEVEL_PARSING_ERROR,fatal:!1,url:x,error:I,reason:I.message,response:t,context:i,level:S,parent:T,networkDetails:s,stats:n});return}e.playlistParsingError=null}if(!e.fragments.length){const b=e.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(L.ERROR,{type:ve.NETWORK_ERROR,details:G.LEVEL_EMPTY_ERROR,fatal:!1,url:x,error:b,reason:b.message,response:t,context:i,level:S,parent:T,networkDetails:s,stats:n});return}switch(e.live&&l&&(l.getCacheAge&&(e.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),h){case _e.MANIFEST:case _e.LEVEL:if(S){if(!f)S=0;else if(f!==u.levels[S]){const b=u.levels.indexOf(f);b>-1&&(S=b)}}u.trigger(L.LEVEL_LOADED,{details:e,levelInfo:f||u.levels[0],level:S||0,id:m||0,stats:n,networkDetails:s,deliveryDirectives:v,withoutMultiVariant:h===_e.MANIFEST});break;case _e.AUDIO_TRACK:u.trigger(L.AUDIO_TRACK_LOADED,{details:e,track:f,id:m||0,groupId:g||"",stats:n,networkDetails:s,deliveryDirectives:v});break;case _e.SUBTITLE_TRACK:u.trigger(L.SUBTITLE_TRACK_LOADED,{details:e,track:f,id:m||0,groupId:g||"",stats:n,networkDetails:s,deliveryDirectives:v});break}}}class fn{static get version(){return As}static isMSESupported(){return h0()}static isSupported(){return XL()}static getMediaSource(){return gr()}static get Events(){return L}static get MetadataSchema(){return Gt}static get ErrorTypes(){return ve}static get ErrorDetails(){return G}static get DefaultConfig(){return fn.defaultConfig?fn.defaultConfig:UL}static set DefaultConfig(e){fn.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Mc,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=lE(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=jL(fn.DefaultConfig,e,t);this.userConfig=e,n.progressive&&GL(n,t);const{abrController:i,bufferController:s,capLevelController:l,errorController:u,fpsController:h}=n,d=new u(this),f=this.abrController=new i(this),m=new rS(this),g=n.interstitialsController,v=g?this.interstitialsController=new g(this,fn):null,x=this.bufferController=new s(this,m),T=this.capLevelController=new l(this),S=new h(this),I=new nA(this),b=n.contentSteeringController,w=b?new b(this):null,_=this.levelController=new QL(this,w),D=new YL(this),j=new tA(this.config,this.logger),P=this.streamController=new eA(this,m,j),B=this.gapController=new WL(this,m);T.setStreamController(P),S.setStreamController(P);const U=[I,_,P];v&&U.splice(1,0,v),w&&U.splice(1,0,w),this.networkControllers=U;const O=[f,x,B,T,S,D,m];this.audioTrackController=this.createController(n.audioTrackController,U);const Y=n.audioStreamController;Y&&U.push(this.audioStreamController=new Y(this,m,j)),this.subtitleTrackController=this.createController(n.subtitleTrackController,U);const ne=n.subtitleStreamController;ne&&U.push(this.subtititleStreamController=new ne(this,m,j)),this.createController(n.timelineController,O),j.emeController=this.emeController=this.createController(n.emeController,O),this.cmcdController=this.createController(n.cmcdController,O),this.latencyController=this.createController(qL,O),this.coreComponents=O,U.push(d);const se=d.onErrorOut;typeof se=="function"&&this.on(L.ERROR,se,d),this.on(L.MANIFEST_LOADED,I.onManifestLoaded,I)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,i){this._emitter.off(e,t,n,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const i=e===L.ERROR;this.trigger(L.ERROR,{type:ve.OTHER_ERROR,details:G.INTERNAL_EXCEPTION,fatal:i,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(L.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(L.ERROR,{type:ve.OTHER_ERROR,details:G.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,i=t?e:{media:n};this._media=n,this.trigger(L.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(L.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(L.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,i=this._url=Ic.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&n&&(n!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(L.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[me.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[me.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[me.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=W1()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){jE(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let i=0;i<n;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,n)for(let s=i;s--;){const l=e[s].attrs["HDCP-LEVEL"];if(l&&l<=n)return s}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=Jp(t);return Qp(e,n,navigator.mediaCapabilities)}}fn.defaultConfig=void 0;const rA=()=>{const a=z.useRef(null),e="https://customer-cbeadsgr09pnsezs.cloudflarestream.com/74cb72d57c6a6d6d7807693d02e6707b/manifest/video.m3u8";return z.useEffect(()=>{let t;if(a.current){const n=a.current;n.canPlayType("application/vnd.apple.mpegurl")?n.src=e:fn.isSupported()&&(t=new fn,t.loadSource(e),t.attachMedia(n))}return()=>{t&&t.destroy()}},[e]),A.jsxs("section",{className:"relative min-h-[90vh] md:min-h-screen flex flex-col items-center justify-center pt-32 pb-20 overflow-hidden",children:[A.jsxs("div",{className:"absolute inset-0 z-0",children:[A.jsx("video",{ref:a,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,className:"w-full h-full object-cover opacity-100"}),A.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#050505] via-transparent to-[#050505]/40"})]}),A.jsxs("div",{className:"relative z-10 text-center px-6 max-w-5xl mx-auto",children:[A.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-1.5 rounded-full border border-white/5 bg-white/5 backdrop-blur-md mb-8 md:mb-10",children:[A.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),A.jsx("span",{className:"text-[10px] md:text-[11px] font-bold uppercase tracking-widest text-white/50",children:"Our Services are Now Live"})]}),A.jsxs("h1",{className:"display-text font-semibold text-white mb-6 md:mb-8 font-aura-header",children:["Design your ",A.jsx("span",{className:"font-newsreader italic font-normal text-red-500",children:"vision"})," with ",A.jsx("br",{className:"hidden md:block"})," creative excellence"]}),A.jsx("p",{className:"body-large text-white/40 mb-10 md:mb-14 max-w-2xl mx-auto leading-relaxed",children:"Get an intuitive experience for shipping and monitoring your products, helping you build faster than ever before."}),A.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-6 md:gap-8",children:[A.jsx(Cs,{className:"w-full sm:w-auto",children:"Start Building"}),A.jsxs("button",{className:"text-white/60 font-bold hover:text-white transition-colors flex items-center gap-2 group",children:["View Live Demo",A.jsx("svg",{className:"w-4 h-4 group-hover:translate-x-1 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]})]})},fp=["Aura","Figma","Spotify","Netflix","Slack","Adobe","Disney","Tesla","Apple"],iA=()=>A.jsx("section",{className:"py-12 bg-transparent overflow-hidden",children:A.jsx("div",{className:"marquee-container opacity-20",children:A.jsx("div",{className:"marquee-content py-4",children:[...fp,...fp].map((a,e)=>A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("div",{className:"w-6 h-6 rounded bg-white/20 flex items-center justify-center",children:A.jsx("div",{className:"w-3 h-3 border border-white/50 rounded-sm"})}),A.jsx("span",{className:"text-xl font-bold text-white tracking-widest uppercase",children:a})]},e))})})}),sA="/assets/founder-C40a-vX8.png",f0=()=>A.jsx("section",{className:"py-20 md:py-32 relative overflow-hidden",children:A.jsx("div",{className:"container mx-auto px-6 max-w-7xl",children:A.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16 items-center",children:[A.jsxs("div",{className:"relative group animate-on-scroll order-2 lg:order-1",children:[A.jsx("div",{className:"absolute -inset-4 bg-gradient-to-tr from-red-500/20 to-transparent blur-2xl opacity-50 group-hover:opacity-100 transition-opacity"}),A.jsx("div",{className:"relative rounded-[32px] md:rounded-[48px] overflow-hidden border border-white/5 bg-white/5 aspect-square",children:A.jsx("img",{src:sA,alt:"Founder of Webvoss",className:"w-full h-full object-cover object-top grayscale hover:grayscale-0 transition-all duration-700 scale-105 group-hover:scale-100"})})]}),A.jsxs("div",{className:"animate-on-scroll order-1 lg:order-2",children:[A.jsx("span",{className:"text-red-500 font-bold uppercase tracking-[0.3em] text-[10px] md:text-xs mb-4 md:mb-6 block",children:"Leadership"}),A.jsxs("h2",{className:"font-semibold text-white mb-6 md:mb-8 font-aura-header",children:["Meet the founder and ",A.jsx("span",{className:"text-red-500 font-newsreader italic font-normal",children:"CEO"})," of Webvoss"]}),A.jsxs("div",{className:"space-y-6 text-white/50 leading-relaxed mb-10",children:[A.jsx("p",{children:"Driven by a passion for creative excellence and technological innovation, our founder envisioned Webvoss as a bridge between complex code and intuitive design."}),A.jsx("p",{className:"hidden md:block",children:"With years of experience in the industry, he leads our team with a clear mission: to empower builders and creators with the most sophisticated yet accessible AI-powered tools in the market."})]}),A.jsxs("div",{className:"flex items-center gap-6",children:[A.jsxs("div",{className:"flex flex-col",children:[A.jsx("span",{className:"text-white font-bold text-lg md:text-xl",children:"Ikram Hossen"}),A.jsx("span",{className:"text-white/30 text-[10px] md:text-xs uppercase tracking-[0.2em]",children:"Founder & CEO"})]}),A.jsx("div",{className:"h-12 w-[1px] bg-white/10"}),A.jsxs("div",{className:"flex gap-4",children:[A.jsx("a",{href:"#",className:"w-10 h-10 rounded-full border border-white/5 bg-white/5 flex items-center justify-center hover:bg-white/10 transition-colors",children:A.jsx("svg",{className:"w-5 h-5 fill-white",viewBox:"0 0 24 24",children:A.jsx("path",{d:"M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"})})}),A.jsx("a",{href:"#",className:"w-10 h-10 rounded-full border border-white/5 bg-white/5 flex items-center justify-center hover:bg-white/10 transition-colors",children:A.jsx("svg",{className:"w-5 h-5 fill-white",viewBox:"0 0 24 24",children:A.jsx("path",{d:"M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.84 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"})})})]})]})]})]})})}),aA=[{title:"AI-based Web Design",description:"Experience the next generation of web design where artificial intelligence meets artistic intuition to create high-converting, intelligent digital experiences.",icon:A.jsx("svg",{className:"w-6 h-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z"})})},{title:"Mobile Application Development",description:"Develop seamless, cross-platform mobile applications that offer native performance and immersive user interfaces for both iOS and Android platforms.",icon:A.jsx("svg",{className:"w-6 h-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75a2.25 2.25 0 00-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3"})})},{title:"Full-stack and SAAS Application",description:"Scale your business with robust, end-to-end SaaS solutions built with modern tech stacks, ensuring high availability and seamless user management.",icon:A.jsxs("svg",{className:"w-6 h-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M2.25 7.125C2.25 6.504 2.754 6 3.375 6h17.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125H3.375a1.125 1.125 0 01-1.125-1.125V7.125z"}),A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 6V4.5A1.5 1.5 0 019.5 3h5A1.5 1.5 0 0116 4.5V6"}),A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 10h18M7 15h1m4 0h1m4 0h1"})]})},{title:"Wordpress Membership Website",description:"Transform your WordPress site into a powerful membership hub with sophisticated access control, recurring payments, and community features.",icon:A.jsxs("svg",{className:"w-6 h-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.998 5.998 0 00-12.03-.224m12 0a5.998 5.998 0 00-12.03-.224m12 0a5.998 5.998 0 00-12.03-.224M12 13c-3.315 0-6 2.685-6 6 0 .34.028.673.082 1M12 13c3.315 0 6 2.685 6 6 0 .34-.028.673-.082 1m-11.836 0A12.067 12.067 0 0112 21c2.17 0 4.207-.576 5.963-1.584A6.062 6.062 0 0118 18.72m-12 0a5.998 5.998 0 0012.03-.224m-12 0a5.998 5.998 0 0012.03-.224"}),A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-13.5 0a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"})]})},{title:"Wordpress Theme And Plugin",description:"Bespoke WordPress engineering delivering high-performance themes and complex custom plugins tailored precisely to your unique business logic.",icon:A.jsx("svg",{className:"w-6 h-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5"})})},{title:"Programatic and AI Powerd SEO",description:"Outrank the competition with automated content engines and AI-driven SEO strategies that dynamically adapt to algorithm changes in real-time.",icon:A.jsx("svg",{className:"w-6 h-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"})})}],oA=()=>A.jsxs("section",{id:"features",className:"py-20 md:py-32 relative overflow-hidden",children:[A.jsx("div",{className:"absolute top-0 right-0 w-[500px] h-[500px] bg-red-500/5 blur-[120px] rounded-full -mr-64 -mt-64"}),A.jsx("div",{className:"absolute bottom-0 left-0 w-[500px] h-[500px] bg-red-500/5 blur-[120px] rounded-full -ml-64 -mb-64"}),A.jsxs("div",{className:"container mx-auto px-6 text-center mb-16 md:mb-24 animate-on-scroll",children:[A.jsx("h2",{className:"font-semibold text-white mb-4 md:mb-6",children:"Our Services"}),A.jsx("p",{className:"text-white/40 max-w-2xl mx-auto leading-relaxed",children:"Empowering your digital presence with industry-leading technology and creative excellence."})]}),A.jsx("div",{className:"container mx-auto px-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8",children:aA.map((a,e)=>A.jsxs("div",{className:"glass-card group p-6 md:p-8 rounded-[32px] border border-red-500/20 hover:border-red-500/40 transition-all duration-500 relative overflow-hidden animate-on-scroll hover:-translate-y-2",style:{transitionDelay:`${e*100}ms`},children:[A.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-500/[0.03] to-transparent transition-all duration-500"}),A.jsxs("div",{className:"relative z-10",children:[A.jsx("div",{className:"w-14 h-14 rounded-2xl bg-red-500/10 border border-red-500/20 flex items-center justify-center mb-8 scale-110 transition-all duration-500 shadow-xl shadow-red-500/5",children:a.icon}),A.jsx("h3",{className:"text-xl md:text-2xl font-semibold text-white mb-4 tracking-tight transition-colors duration-300 group-hover:text-red-500",children:a.title}),A.jsx("p",{className:"text-white/60 leading-relaxed transition-colors duration-300",children:a.description}),A.jsxs("div",{className:"mt-8 pt-8 border-t border-white/5 flex items-center gap-2 text-red-500 transition-all duration-500 text-sm font-bold uppercase tracking-widest overflow-hidden",children:[A.jsx("span",{className:"transform translate-x-0 transition-transform duration-500",children:"Explore Solution"}),A.jsx("svg",{className:"w-4 h-4 transform translate-x-0 transition-transform duration-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 8l4 4m0 0l-4 4m4-4H3"})})]})]}),A.jsx("div",{className:"absolute bottom-0 left-0 h-[2px] w-full bg-gradient-to-r from-transparent via-red-500 to-transparent transition-all duration-700"})]},e))})]}),lA=[{title:"Aura AI Dashboard",category:"AI SaaS",image:"https://images.unsplash.com/photo-1614850523296-d8c1af93d400?auto=format&fit=crop&q=80&w=1000",link:"#"},{title:"Nexus NFT Marketplace",category:"Web3 / Crypto",image:"https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?auto=format&fit=crop&q=80&w=1000",link:"#"},{title:"Voss E-commerce Hub",category:"E-commerce",image:"https://images.unsplash.com/photo-1460925895917-afdab827c52f?auto=format&fit=crop&q=80&w=1000",link:"#"},{title:"Creative Portfolio 3.0",category:"Creative Agency",image:"https://images.unsplash.com/photo-1547658719-da2b51169166?auto=format&fit=crop&q=80&w=1000",link:"#"},{title:"Fintech Mobile App",category:"Finance",image:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?auto=format&fit=crop&q=80&w=1000",link:"#"},{title:"Social Insight Tool",category:"Analytics",image:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?auto=format&fit=crop&q=80&w=1000",link:"#"}],uA=()=>A.jsx("section",{id:"projects",className:"py-20 md:py-32 relative bg-[#050505]",children:A.jsxs("div",{className:"container mx-auto px-6",children:[A.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end mb-16 md:mb-24 gap-8 animate-on-scroll",children:[A.jsxs("div",{className:"max-w-2xl",children:[A.jsx("h2",{className:"font-semibold text-white mb-6",children:"Latest Projects"}),A.jsx("p",{className:"text-white/40 leading-relaxed",children:"Discover our latest work where innovation meets execution. We craft digital experiences that redefine industry standards."})]}),A.jsx("div",{className:"hidden md:block",children:A.jsx("button",{className:"px-8 py-4 rounded-full border border-white/10 text-white font-semibold hover:bg-white/5 transition-all duration-300",children:"View All Projects"})})]}),A.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:lA.map((a,e)=>A.jsxs("div",{className:"group relative rounded-[32px] overflow-hidden bg-white/5 border border-white/5 hover:border-red-500/30 transition-all duration-500 animate-on-scroll",style:{transitionDelay:`${e*100}ms`},children:[A.jsxs("div",{className:"aspect-[4/3] overflow-hidden",children:[A.jsx("img",{src:a.image,alt:a.title,className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700"}),A.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/20 to-transparent opacity-60 group-hover:opacity-80 transition-opacity duration-500"})]}),A.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-8 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-500",children:[A.jsx("span",{className:"text-red-500 text-sm font-bold uppercase tracking-widest mb-3 block",children:a.category}),A.jsx("h3",{className:"text-2xl font-semibold text-white mb-4",children:a.title}),A.jsxs("div",{className:"flex items-center gap-2 text-white/40 group-hover:text-white transition-colors duration-300 font-bold text-sm",children:["View Project",A.jsx("svg",{className:"w-5 h-5 transform group-hover:translate-x-1 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 8l4 4m0 0l-4 4m4-4H3"})})]})]}),A.jsx("div",{className:"absolute top-6 right-6 w-12 h-12 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-500 border border-white/10",children:A.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})})]},e))}),A.jsx("div",{className:"mt-12 md:hidden text-center",children:A.jsx("button",{className:"px-8 py-4 rounded-full border border-white/10 text-white font-semibold hover:bg-white/5 transition-all duration-300 w-full",children:"View All Projects"})})]})}),gi=[{text:"Aura has transformed how we monitor our deployments. The visibility is simply unparalleled.",name:"Alex Rivera",role:"CTO at Nexus",avatar:"A"},{text:"The most intuitive platform I've used in years. It just works.",name:"Sarah Chen",role:"Lead Engineer",avatar:"S"},{text:"Finally a tool that understands the developer workflow.",name:"Jordan Lee",role:"Senior Developer",avatar:"J"},{text:"Beautiful design and even better functionality. A must-have.",name:"Elena Rossi",role:"Design Lead",avatar:"E"},{text:"The support team is incredible. They really care about your success.",name:"Mark Wilson",role:"Founder",avatar:"M"},{text:"Shipping faster than ever thanks to Aura.",name:"David Kim",role:"Product Manager",avatar:"D"}],mp=({t:a})=>A.jsxs("div",{className:"w-[350px] md:w-[400px] flex-shrink-0 glass-card p-6 md:p-8 rounded-[24px] md:rounded-[32px] hover:border-red-500/30 transition-colors duration-300",children:[A.jsxs("p",{className:"text-white/80 mb-6 md:mb-8 leading-relaxed text-sm md:text-base",children:['"',a.text,'"']}),A.jsxs("div",{className:"flex items-center gap-4",children:[A.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-red-500/20 to-red-500/10 border border-white/10 flex items-center justify-center text-white text-xs font-bold",children:a.avatar}),A.jsxs("div",{children:[A.jsx("h4",{className:"text-white font-bold text-sm tracking-tight",children:a.name}),A.jsx("p",{className:"text-white/40 text-xs font-bold uppercase tracking-widest",children:a.role})]})]})]}),cA=()=>{const a=[...gi,...gi],e=[...gi.slice(3),...gi.slice(0,3),...gi.slice(3),...gi.slice(0,3)];return A.jsxs("section",{id:"testimonials",className:"py-20 md:py-32 relative overflow-hidden",children:[A.jsx("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0",children:A.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-red-500/5 rounded-full blur-[100px]"})}),A.jsxs("div",{className:"container mx-auto px-6 text-center mb-16 md:mb-24 relative z-10",children:[A.jsxs("h2",{className:"text-3xl md:text-5xl font-bold text-white mb-4 md:mb-6",children:["Loved by ",A.jsx("span",{className:"font-newsreader italic font-normal text-red-500",children:"passionate"})," builders"]}),A.jsx("p",{className:"text-white/40 max-w-2xl mx-auto leading-relaxed text-sm md:text-base",children:"Choose the plan that fits your growth and creative excellence."})]}),A.jsxs("div",{className:"relative z-10 flex flex-col gap-8 md:gap-12",children:[A.jsx("div",{className:"marquee-container",children:A.jsx("div",{className:"marquee-content",style:{animation:"marquee-scroll-reverse 40s linear infinite"},children:a.map((t,n)=>A.jsx(mp,{t},`row1-${n}`))})}),A.jsx("div",{className:"marquee-container",children:A.jsx("div",{className:"marquee-content",style:{animation:"marquee-scroll 40s linear infinite"},children:e.map((t,n)=>A.jsx(mp,{t},`row2-${n}`))})})]}),A.jsx("div",{className:"relative z-10 flex justify-center mt-12 md:mt-16",children:A.jsx(Cs,{className:"uppercase tracking-widest text-xs md:text-sm",children:"View All Feedback"})})]})},dA=[{name:"Growth",price:"7,500",period:"/ mo",features:["Up to 10 projects","Real-time monitoring","24/7 Support"]},{name:"Scale",price:"15,000",period:"/ mo",features:["Unlimited projects","Custom integrations","Dedicated Support","Advanced Analytics"],popular:!0},{name:"Custom",price:"10k",period:"+",features:["Enterprise Security","Unlimited Users","SLA Guarantee","Custom Onboarding"]}],hA=()=>A.jsxs("section",{id:"pricing",className:"py-20 md:py-32 relative",children:[A.jsxs("div",{className:"container mx-auto px-6 text-center mb-16 md:mb-24 animate-on-scroll",children:[A.jsx("span",{className:"text-red-500 font-bold uppercase tracking-[0.3em] text-[10px] md:text-xs mb-4 md:mb-6 block",children:"Pricing"}),A.jsxs("h2",{className:"font-semibold text-white mb-4 md:mb-6",children:["Simple, transparent ",A.jsx("span",{className:"text-red-500 font-newsreader italic font-normal",children:"pricing"})]}),A.jsx("p",{className:"text-white/40 max-w-2xl mx-auto leading-relaxed",children:"Choose the plan that fits your growth and creative excellence."})]}),A.jsx("div",{className:"container mx-auto px-6 grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8 max-w-6xl",children:dA.map((a,e)=>A.jsxs("div",{className:`relative p-8 md:p-12 rounded-[32px] md:rounded-[48px] border ${a.popular?"border-red-500/50 bg-white/[0.03]":"border-white/5 bg-white/[0.02]"} backdrop-blur-xl animate-on-scroll`,children:[a.popular&&A.jsx("span",{className:"absolute top-0 right-12 -translate-y-1/2 px-4 py-1.5 bg-red-500 rounded-full text-[10px] font-bold text-white tracking-widest uppercase shadow-xl shadow-red-500/20",children:"Popular"}),A.jsx("h3",{className:"text-2xl font-semibold text-white mb-2",children:a.name}),A.jsx("p",{className:"text-white/40 text-sm mb-10",children:"Best for growing teams and startups."}),A.jsxs("div",{className:"flex items-baseline gap-1 mb-10",children:[A.jsxs("h1",{className:"font-bold text-white tracking-tighter",children:["$",a.price]}),A.jsx("span",{className:"text-white/40 font-bold text-lg",children:a.period})]}),A.jsx("button",{className:`w-full py-4 rounded-2xl font-bold transition-all mb-10 ${a.popular?"bg-white text-black hover:bg-white/90":"bg-white/5 text-white hover:bg-white/10 border border-white/5"}`,children:"Select Plan"}),A.jsx("div",{className:"space-y-4",children:a.features.map((t,n)=>A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),A.jsx("span",{className:"text-white/60 text-sm font-bold",children:t})]},n))})]},e))})]}),fA=()=>{const a=z.useRef(null),e="https://customer-cbeadsgr09pnsezs.cloudflarestream.com/b17f76a1270818e8cdc55e8719b9ace8/manifest/video.m3u8";return z.useEffect(()=>{let t;if(a.current){const n=a.current;n.canPlayType("application/vnd.apple.mpegurl")?n.src=e:fn.isSupported()&&(t=new fn,t.loadSource(e),t.attachMedia(n))}return()=>{t&&t.destroy()}},[e]),A.jsx("section",{className:"py-20 md:py-24 px-4 overflow-hidden relative",children:A.jsxs("div",{className:"max-w-6xl mx-auto glass-card p-10 md:p-32 rounded-[48px] md:rounded-[64px] text-center relative overflow-hidden animate-on-scroll",children:[A.jsx("div",{className:"absolute inset-0 z-0",children:A.jsx("video",{ref:a,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,className:"w-full h-full object-cover opacity-100"})}),A.jsx("div",{className:"absolute top-0 right-0 w-80 h-80 bg-red-600/10 blur-[100px] z-[1]"}),A.jsx("div",{className:"absolute bottom-0 left-0 w-80 h-80 bg-red-600/5 blur-[100px] z-[1]"}),A.jsxs("h2",{className:"display-text font-semibold text-white mb-10 tracking-tighter leading-tight relative z-10 font-aura-header",children:["Ready to launch ",A.jsx("br",{})," your ",A.jsx("span",{className:"text-red-500 font-newsreader italic font-normal",children:"vision?"})]}),A.jsx("p",{className:"body-large text-white/40 mb-14 max-w-2xl mx-auto relative z-10 capitalize",children:"Join the list of manufacturers and designers shipping with Aura today."}),A.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-6 md:gap-8 relative z-10",children:[A.jsx(Cs,{className:"w-full sm:w-auto !px-16 !py-5 md:!text-lg",children:"Get Started Now"}),A.jsxs("a",{href:"#",className:"text-white/60 font-bold hover:text-white transition-colors group",children:["Talk to an expert ",A.jsx("span",{className:"group-hover:translate-x-1 inline-block transition-transform",children:""})]})]})]})})},mA=()=>A.jsxs("main",{children:[A.jsx(rA,{}),A.jsx(iA,{}),A.jsx(f0,{}),A.jsx(oA,{}),A.jsx(uA,{}),A.jsx(cA,{}),A.jsx(hA,{}),A.jsx(fA,{})]}),pA=[{name:"Sarah Chen",role:"Head of Design",image:"https://images.unsplash.com/photo-1494790108377-be9c29b29330?q=80&w=1000&auto=format&fit=crop"},{name:"Michael Ross",role:"Lead Developer",image:"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?q=80&w=1000&auto=format&fit=crop"},{name:"Jessica Wong",role:"Product Manager",image:"https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?q=80&w=1000&auto=format&fit=crop"},{name:"David Kim",role:"Marketing Director",image:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?q=80&w=1000&auto=format&fit=crop"}],gA=()=>A.jsx("section",{className:"py-20 md:py-24 px-4 overflow-hidden relative",children:A.jsxs("div",{className:"max-w-6xl mx-auto glass-card p-10 md:p-32 rounded-[48px] md:rounded-[64px] text-center relative overflow-hidden animate-on-scroll",children:[A.jsx("div",{className:"absolute top-0 right-0 w-80 h-80 bg-red-600/10 blur-[100px] z-[1]"}),A.jsx("div",{className:"absolute bottom-0 left-0 w-80 h-80 bg-red-600/5 blur-[100px] z-[1]"}),A.jsxs("h2",{className:"display-text font-semibold text-white mb-10 tracking-tighter leading-tight relative z-10 font-aura-header",children:["Ready to join ",A.jsx("br",{})," our ",A.jsx("span",{className:"text-red-500 font-newsreader italic font-normal",children:"journey?"})]}),A.jsx("p",{className:"body-large text-white/40 mb-14 max-w-2xl mx-auto relative z-10 capitalize",children:"Be part of a team that's redefining the digital landscape."}),A.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-6 md:gap-8 relative z-10",children:[A.jsx(Cs,{className:"w-full sm:w-auto !px-16 !py-5 md:!text-lg",children:"View Openings"}),A.jsxs("a",{href:"#",className:"text-white/60 font-bold hover:text-white transition-colors group",children:["Contact Us ",A.jsx("span",{className:"group-hover:translate-x-1 inline-block transition-transform",children:""})]})]})]})}),yA=()=>(z.useEffect(()=>{const a={threshold:.1,rootMargin:"0px 0px -50px 0px"},e=new IntersectionObserver(t=>{t.forEach(n=>{n.isIntersecting&&(n.target.classList.add("animate"),e.unobserve(n.target))})},a);return setTimeout(()=>{document.querySelectorAll(".animate-on-scroll").forEach(n=>e.observe(n))},100),()=>e.disconnect()},[]),A.jsxs("div",{className:"bg-[#050505] min-h-screen text-white",children:[A.jsxs("section",{className:"relative pt-32 pb-20 md:pt-48 md:pb-32 overflow-hidden items-center justify-center flex flex-col bg-grid-white",children:[A.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 md:w-96 h-64 md:h-96 bg-red-600/20 rounded-full blur-[80px] md:blur-[100px] animate-float pointer-events-none"}),A.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-[300px] md:w-[500px] h-[300px] md:h-[500px] bg-red-600/10 rounded-full blur-[80px] md:blur-[120px] animate-float-delayed pointer-events-none"}),A.jsxs("div",{className:"container mx-auto px-6 text-center relative z-10",children:[A.jsxs("h1",{className:"display-text font-bold mb-6 tracking-tighter",children:["We Are ",A.jsx("span",{className:"text-red-500 italic font-medium font-newsreader",children:"Aura"})]}),A.jsx("p",{className:"body-large text-white/60 max-w-2xl mx-auto leading-relaxed",children:"Redefining digital experiences through innovation, design, and cutting-edge technology."})]}),A.jsx("div",{className:"absolute bottom-0 left-0 w-full h-24 bg-gradient-to-t from-[#050505] to-transparent pointer-events-none"})]}),A.jsx(f0,{}),A.jsxs("section",{className:"py-20 px-6 container mx-auto",children:[A.jsxs("div",{className:"flex flex-col md:flex-row gap-16 md:gap-24 items-start max-w-6xl mx-auto mb-32 animate-on-scroll",children:[A.jsxs("div",{className:"w-full md:w-1/2",children:[A.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-6 font-aura-header",children:"Crafting the Future of Web"}),A.jsx("div",{className:"w-20 h-1 bg-red-500 mb-8"}),A.jsx("p",{className:"text-white/60 leading-relaxed mb-6 text-lg",children:"At Aura, we believe that a website is more than just a collection of pagesit's a digital ecosystem that breathes life into your brand. Founded in 2024, our mission has been clear: to eradicate mediocre design."}),A.jsx("p",{className:"text-white/60 leading-relaxed text-lg",children:"We combine aesthetic excellence with robust engineering to build platforms that scale. Our philosophy is rooted in the belief that beauty and function are not mutually exclusive; they are the twin pillars of a great user experience."})]}),A.jsxs("div",{className:"w-full md:w-1/2 relative",children:[A.jsxs("div",{className:"aspect-[4/5] rounded-2xl overflow-hidden relative z-10 border border-white/10",children:[A.jsx("img",{src:"https://images.unsplash.com/photo-1522071820081-009f0129c71c?q=80&w=1000&auto=format&fit=crop",alt:"Team collaboration",className:"w-full h-full object-cover"}),A.jsx("div",{className:"absolute inset-0 bg-red-500/10 mix-blend-overlay"})]}),A.jsx("div",{className:"absolute -top-6 -right-6 w-full h-full border border-red-500/20 rounded-2xl z-0 hidden md:block"})]})]}),A.jsxs("div",{className:"max-w-6xl mx-auto",children:[A.jsxs("div",{className:"text-center mb-16 animate-on-scroll",children:[A.jsx("span",{className:"text-red-500 text-sm font-bold uppercase tracking-widest mb-3 block",children:"The Minds Behind Aura"}),A.jsx("h2",{className:"text-3xl md:text-4xl font-bold font-aura-header",children:"Meet Our Team"})]}),A.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:pA.map((a,e)=>A.jsxs("div",{className:"group relative animate-on-scroll",style:{transitionDelay:`${e*100}ms`},children:[A.jsxs("div",{className:"aspect-[3/4] overflow-hidden rounded-2xl mb-6 relative",children:[A.jsx("img",{src:a.image,alt:a.name,className:"w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-500 transform group-hover:scale-105"}),A.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-6",children:A.jsx("div",{className:"transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300"})})]}),A.jsx("h3",{className:"text-xl font-bold text-white mb-1 group-hover:text-red-500 transition-colors",children:a.name}),A.jsx("p",{className:"text-white/40 text-sm font-medium uppercase tracking-wide",children:a.role})]},e))})]})]}),A.jsx(gA,{})]})),vA=["All","AI Website","Mobile App","Dashboard","Wordpress Membership","SAAS Application","Products","Wordpress Website"],pp=[{id:1,title:"Aura AI Generator",category:"AI Website",image:"https://images.unsplash.com/photo-1620712943543-bcc4688e7485?q=80&w=1000&auto=format&fit=crop"},{id:2,title:"FinTrack Mobile",category:"Mobile App",image:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80&w=1000&auto=format&fit=crop"},{id:3,title:"Analytix Dash",category:"Dashboard",image:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80&w=1000&auto=format&fit=crop"},{id:4,title:"MemberPress Elite",category:"Wordpress Membership",image:"https://images.unsplash.com/photo-1460925895917-afdab827c52f?q=80&w=1000&auto=format&fit=crop"},{id:5,title:"TaskFlow SAAS",category:"SAAS Application",image:"https://images.unsplash.com/photo-1531403009284-440f080d1e12?q=80&w=1000&auto=format&fit=crop"},{id:6,title:"Neon Headphones",category:"Products",image:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=1000&auto=format&fit=crop"},{id:7,title:"Zenith Portfolio",category:"Wordpress Website",image:"https://images.unsplash.com/photo-1507238691740-187a5b1d37b8?q=80&w=1000&auto=format&fit=crop"}],xA=()=>A.jsx("section",{className:"py-20 md:py-24 px-4 overflow-hidden relative",children:A.jsxs("div",{className:"max-w-6xl mx-auto glass-card p-10 md:p-32 rounded-[48px] md:rounded-[64px] text-center relative overflow-hidden animate-on-scroll",children:[A.jsx("div",{className:"absolute top-0 right-0 w-80 h-80 bg-red-600/10 blur-[100px] z-[1]"}),A.jsx("div",{className:"absolute bottom-0 left-0 w-80 h-80 bg-red-600/5 blur-[100px] z-[1]"}),A.jsxs("h2",{className:"display-text font-semibold text-white mb-10 tracking-tighter leading-tight relative z-10 font-aura-header",children:["Ready to launch ",A.jsx("br",{})," your ",A.jsx("span",{className:"text-red-500 font-newsreader italic font-normal",children:"vision?"})]}),A.jsx("p",{className:"body-large text-white/40 mb-14 max-w-2xl mx-auto relative z-10 capitalize",children:"Join the list of manufacturers and designers shipping with Aura today."}),A.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-6 md:gap-8 relative z-10",children:[A.jsx(Cs,{className:"w-full sm:w-auto !px-16 !py-5 md:!text-lg",children:"Get Started Now"}),A.jsxs("a",{href:"#",className:"text-white/60 font-bold hover:text-white transition-colors group",children:["Talk to an expert ",A.jsx("span",{className:"group-hover:translate-x-1 inline-block transition-transform",children:""})]})]})]})}),EA=()=>{const[a,e]=z.useState("All"),t=a==="All"?pp:pp.filter(n=>n.category===a);return z.useEffect(()=>{const n={threshold:.1,rootMargin:"0px 0px -50px 0px"},i=new IntersectionObserver(s=>{s.forEach(l=>{l.isIntersecting&&(l.target.classList.add("animate"),i.unobserve(l.target))})},n);return setTimeout(()=>{document.querySelectorAll(".animate-on-scroll").forEach(l=>i.observe(l))},100),()=>i.disconnect()},[t]),A.jsxs("div",{className:"bg-[#050505] min-h-screen text-white",children:[A.jsxs("section",{className:"relative pt-32 pb-20 md:pt-48 md:pb-32 overflow-hidden items-center justify-center flex flex-col bg-grid-white",children:[A.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 md:w-96 h-64 md:h-96 bg-red-600/20 rounded-full blur-[80px] md:blur-[100px] animate-float pointer-events-none"}),A.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-[300px] md:w-[500px] h-[300px] md:h-[500px] bg-red-600/10 rounded-full blur-[80px] md:blur-[120px] animate-float-delayed pointer-events-none"}),A.jsxs("div",{className:"container mx-auto px-6 text-center relative z-10",children:[A.jsxs("h1",{className:"display-text font-bold mb-6 tracking-tighter",children:["Our ",A.jsx("span",{className:"text-red-500 italic font-medium font-newsreader",children:"Masterpieces"})]}),A.jsx("p",{className:"body-large text-white/60 max-w-2xl mx-auto leading-relaxed",children:"A curated selection of our finest work, ranging from AI systems to immersive web experiences."})]}),A.jsx("div",{className:"absolute bottom-0 left-0 w-full h-24 bg-gradient-to-t from-[#050505] to-transparent pointer-events-none"})]}),A.jsxs("section",{className:"py-20 px-6 container mx-auto",children:[A.jsx("div",{className:"flex flex-wrap justify-center gap-3 md:gap-4 mb-16 px-2",children:vA.map(n=>A.jsx("button",{onClick:()=>e(n),className:`px-4 md:px-5 py-2 md:py-2.5 rounded-full text-xs md:text-sm font-medium transition-all duration-300 border backdrop-blur-sm ${a===n?"bg-red-600/10 border-red-600/50 text-red-500 shadow-[0_0_20px_rgba(220,38,38,0.2)] scale-105":"bg-white/5 border-white/10 text-white/60 hover:bg-white/10 hover:border-white/20 hover:text-white"}`,children:n},n))}),A.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8",children:t.map((n,i)=>A.jsxs("div",{className:"group relative rounded-3xl overflow-hidden bg-white/5 border border-white/5 hover:border-red-500/30 transition-all duration-500 animate-on-scroll",style:{animationDelay:`${i*100}ms`},children:[A.jsxs("div",{className:"aspect-[4/3] overflow-hidden relative",children:[A.jsx("img",{src:n.image,alt:n.title,className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700"}),A.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/20 to-transparent opacity-60 group-hover:opacity-80 transition-opacity duration-300"})]}),A.jsxs("div",{className:"absolute bottom-0 left-0 p-6 md:p-8 w-full transform translate-y-2 group-hover:translate-y-0 transition-transform duration-500",children:[A.jsx("span",{className:"text-red-400 text-xs font-bold uppercase tracking-widest mb-2 block",children:n.category}),A.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:n.title}),A.jsx("div",{className:"w-full h-[1px] bg-gradient-to-r from-red-500/50 to-transparent mb-4 transform scale-x-0 group-hover:scale-x-100 origin-left transition-transform duration-500"}),A.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-white/60 group-hover:text-white transition-colors",children:["View Details ",A.jsx("span",{className:"transform group-hover:translate-x-1 transition-transform",children:""})]})]})]},n.id))}),t.length===0&&A.jsx("div",{className:"text-center py-20 text-white/40",children:A.jsx("p",{className:"text-lg",children:"No projects found in this category."})})]}),A.jsx(xA,{})]})},SA=()=>A.jsxs("div",{className:"pt-32 pb-20 px-6 text-center",children:[A.jsx("h1",{className:"display-text text-white mb-8",children:"User Feedback"}),A.jsx("p",{className:"body-large text-white/40 max-w-2xl mx-auto",children:"Hear what our clients have to say about their experience with Webvoss."})]}),TA=[{question:"What services does Webvoss offer?",answer:"We specialize in high-impact web design, AI-powered web applications, custom SaaS development, and digital branding solutions tailored for modern businesses."},{question:"How much does a typical project cost?",answer:"Our project rates vary based on complexity and scope. We offer tailored packages starting from MVP builds to full-scale enterprise solutions. Contact us for a detailed quote."},{question:"Do you provide ongoing support?",answer:"Yes, we offer comprehensive maintenance and support packages to ensure your digital products remain secure, up-to-date, and optimized for performance."},{question:"What is your typical timeline?",answer:"Timelines depend on the project size. A standard high-end website typically takes 2-4 weeks, while complex web applications may take 8-12 weeks."},{question:"Can you help with rebranding?",answer:"Absolutely. We love breathing new life into existing brands with modern aesthetics, clearer messaging, and a revamped digital presence."}],LA=({question:a,answer:e,isOpen:t,onClick:n})=>A.jsxs("div",{className:"border-b border-white/10 last:border-0",children:[A.jsxs("button",{onClick:n,className:"w-full py-6 flex items-center justify-between text-left group focus:outline-none",children:[A.jsx("span",{className:`text-lg font-medium transition-colors duration-300 ${t?"text-white":"text-white/60 group-hover:text-white"}`,children:a}),A.jsx("span",{className:`ml-4 flex-shrink-0 w-8 h-8 rounded-full border border-white/10 flex items-center justify-center transition-all duration-300 ${t?"bg-red-500 border-red-500 rotate-45":"bg-white/5 group-hover:bg-white/10"}`,children:A.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),A.jsx("div",{className:`overflow-hidden transition-all duration-500 ease-in-out ${t?"max-h-48 opacity-100 mb-6":"max-h-0 opacity-0"}`,children:A.jsx("p",{className:"text-white/40 leading-relaxed pr-8",children:e})})]}),AA=()=>{const[a,e]=z.useState(0),[t,n]=z.useState(!1),i="ellitbd24@gmail.com",s="https://wa.me/+8801641231411",l=()=>{navigator.clipboard.writeText(i),n(!0),setTimeout(()=>n(!1),2e3)};return A.jsxs("div",{className:"bg-[#050505] min-h-screen text-white",children:[A.jsxs("section",{className:"relative pt-32 pb-20 md:pt-48 md:pb-32 overflow-hidden items-center justify-center flex flex-col bg-grid-white",children:[A.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 md:w-96 h-64 md:h-96 bg-red-600/20 rounded-full blur-[80px] md:blur-[100px] animate-float pointer-events-none"}),A.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-[300px] md:w-[500px] h-[300px] md:h-[500px] bg-red-600/10 rounded-full blur-[80px] md:blur-[120px] animate-float-delayed pointer-events-none"}),A.jsxs("div",{className:"container mx-auto px-6 text-center relative z-10",children:[A.jsxs("h1",{className:"display-text font-bold mb-6 tracking-tighter",children:["Contact ",A.jsx("span",{className:"text-red-500 italic font-medium font-newsreader",children:"Us"})]}),A.jsx("p",{className:"body-large text-white/60 max-w-2xl mx-auto leading-relaxed",children:"Reach out to Webvoss to discover how our high-quality services can significantly boost your digital presence."}),A.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 mt-12 w-full max-w-md mx-auto",children:[A.jsxs("a",{href:`mailto:${i}`,className:"bg-white hover:bg-neutral-200 text-[#050505] border border-white px-6 py-3 rounded-lg font-bold transition-all duration-300 flex items-center justify-center gap-2 w-full sm:w-1/2 shadow-lg hover:shadow-xl group",children:[A.jsx("svg",{className:"w-5 h-5 text-red-600 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"Email Us"]}),A.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"bg-red-600 hover:bg-red-700 border border-red-600 text-white px-6 py-3 rounded-lg font-bold transition-all duration-300 flex items-center justify-center gap-2 w-full sm:w-1/2 shadow-lg hover:shadow-xl group",children:[A.jsx("svg",{className:"w-5 h-5 fill-white",viewBox:"0 0 24 24",fill:"currentColor",children:A.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"})}),"WhatsApp"]})]})]}),A.jsx("div",{className:"absolute bottom-0 left-0 w-full h-24 bg-gradient-to-t from-[#050505] to-transparent pointer-events-none"})]}),A.jsx("section",{className:"py-20 px-6 container mx-auto",children:A.jsxs("div",{className:"flex flex-col lg:flex-row gap-16 lg:gap-24 items-start max-w-6xl mx-auto",children:[A.jsxs("div",{className:"w-full lg:w-1/3 lg:sticky lg:top-32",children:[A.jsxs("h2",{className:"text-3xl md:text-4xl font-bold mb-10 font-aura-header",children:["Frequently Asked ",A.jsx("br",{})," ",A.jsx("span",{className:"text-red-500 font-newsreader italic font-normal",children:"Questions"})]}),A.jsxs("div",{className:"glass-card p-8 rounded-3xl border border-white/5 bg-white/[0.02]",children:[A.jsx("div",{className:"w-12 h-12 rounded-full bg-white/5 flex items-center justify-center mb-6",children:A.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),A.jsx("p",{className:"text-white/80 mb-6 leading-relaxed",children:"If you have any other questions, feel free to reach out to us directly via email."}),A.jsx("button",{onClick:l,className:"w-full py-4 rounded-xl bg-red-600 hover:bg-red-700 text-white font-semibold transition-all duration-300 flex items-center justify-center gap-2 mb-8",children:t?A.jsxs(A.Fragment,{children:[A.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:A.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Copied!"]}):"Copy Email"}),A.jsxs("div",{className:"flex items-center justify-start gap-6 pt-6 border-t border-white/10",children:[A.jsxs("a",{href:"#",className:"text-white/40 hover:text-white transition-colors",children:[A.jsx("span",{className:"sr-only",children:"LinkedIn"}),A.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:A.jsx("path",{d:"M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"})})]}),A.jsxs("a",{href:"#",className:"text-white/40 hover:text-white transition-colors",children:[A.jsx("span",{className:"sr-only",children:"X (Twitter)"}),A.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:A.jsx("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})})]}),A.jsxs("a",{href:"#",className:"text-white/40 hover:text-white transition-colors",children:[A.jsx("span",{className:"sr-only",children:"Instagram"}),A.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:A.jsx("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"})})]}),A.jsxs("a",{href:"#",className:"text-white/40 hover:text-white transition-colors",children:[A.jsx("span",{className:"sr-only",children:"Facebook"}),A.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:A.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})})]})]})]})]}),A.jsx("div",{className:"w-full lg:w-2/3",children:A.jsx("div",{className:"space-y-2",children:TA.map((u,h)=>A.jsx(LA,{question:u.question,answer:u.answer,isOpen:h===a,onClick:()=>e(h===a?-1:h)},h))})})]})})]})};function IA(){return z.useEffect(()=>{const a={threshold:.1,rootMargin:"0px 0px -50px 0px"},e=new IntersectionObserver(n=>{n.forEach(i=>{i.isIntersecting&&(i.target.classList.add("animate"),e.unobserve(i.target))})},a);return document.querySelectorAll(".animate-on-scroll").forEach(n=>e.observe(n)),()=>e.disconnect()},[]),A.jsx(Gx,{children:A.jsxs("div",{className:"min-h-screen bg-[#050505] text-white font-montserrat selection:bg-red-500/30",children:[A.jsx(Jx,{}),A.jsxs(vx,{children:[A.jsx(yi,{path:"/",element:A.jsx(mA,{})}),A.jsx(yi,{path:"/about",element:A.jsx(yA,{})}),A.jsx(yi,{path:"/projects",element:A.jsx(EA,{})}),A.jsx(yi,{path:"/feedback",element:A.jsx(SA,{})}),A.jsx(yi,{path:"/contact",element:A.jsx(AA,{})})]}),A.jsx(Zx,{})]})})}Ev.createRoot(document.getElementById("root")).render(A.jsx(fv.StrictMode,{children:A.jsx(IA,{})}));
