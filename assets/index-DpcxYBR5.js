(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();function kg(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Ql={exports:{}},tr={},Xl={exports:{}},_e={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ef;function iy(){if(ef)return _e;ef=1;var l=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),o=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),m=Symbol.iterator;function p(k){return k===null||typeof k!="object"?null:(k=m&&k[m]||k["@@iterator"],typeof k=="function"?k:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,A={};function T(k,F,re){this.props=k,this.context=F,this.refs=A,this.updater=re||v}T.prototype.isReactComponent={},T.prototype.setState=function(k,F){if(typeof k!="object"&&typeof k!="function"&&k!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,k,F,"setState")},T.prototype.forceUpdate=function(k){this.updater.enqueueForceUpdate(this,k,"forceUpdate")};function I(){}I.prototype=T.prototype;function R(k,F,re){this.props=k,this.context=F,this.refs=A,this.updater=re||v}var _=R.prototype=new I;_.constructor=R,E(_,T.prototype),_.isPureReactComponent=!0;var C=Array.isArray,b=Object.prototype.hasOwnProperty,K={current:null},O={key:!0,ref:!0,__self:!0,__source:!0};function B(k,F,re){var de,ue={},he=null,Ie=null;if(F!=null)for(de in F.ref!==void 0&&(Ie=F.ref),F.key!==void 0&&(he=""+F.key),F)b.call(F,de)&&!O.hasOwnProperty(de)&&(ue[de]=F[de]);var Se=arguments.length-2;if(Se===1)ue.children=re;else if(1<Se){for(var we=Array(Se),je=0;je<Se;je++)we[je]=arguments[je+2];ue.children=we}if(k&&k.defaultProps)for(de in Se=k.defaultProps,Se)ue[de]===void 0&&(ue[de]=Se[de]);return{$$typeof:l,type:k,key:he,ref:Ie,props:ue,_owner:K.current}}function U(k,F){return{$$typeof:l,type:k.type,key:F,ref:k.ref,props:k.props,_owner:k._owner}}function M(k){return typeof k=="object"&&k!==null&&k.$$typeof===l}function z(k){var F={"=":"=0",":":"=2"};return"$"+k.replace(/[=:]/g,function(re){return F[re]})}var te=/\/+/g;function se(k,F){return typeof k=="object"&&k!==null&&k.key!=null?z(""+k.key):F.toString(36)}function le(k,F,re,de,ue){var he=typeof k;(he==="undefined"||he==="boolean")&&(k=null);var Ie=!1;if(k===null)Ie=!0;else switch(he){case"string":case"number":Ie=!0;break;case"object":switch(k.$$typeof){case l:case e:Ie=!0}}if(Ie)return Ie=k,ue=ue(Ie),k=de===""?"."+se(Ie,0):de,C(ue)?(re="",k!=null&&(re=k.replace(te,"$&/")+"/"),le(ue,F,re,"",function(je){return je})):ue!=null&&(M(ue)&&(ue=U(ue,re+(!ue.key||Ie&&Ie.key===ue.key?"":(""+ue.key).replace(te,"$&/")+"/")+k)),F.push(ue)),1;if(Ie=0,de=de===""?".":de+":",C(k))for(var Se=0;Se<k.length;Se++){he=k[Se];var we=de+se(he,Se);Ie+=le(he,F,re,we,ue)}else if(we=p(k),typeof we=="function")for(k=we.call(k),Se=0;!(he=k.next()).done;)he=he.value,we=de+se(he,Se++),Ie+=le(he,F,re,we,ue);else if(he==="object")throw F=String(k),Error("Objects are not valid as a React child (found: "+(F==="[object Object]"?"object with keys {"+Object.keys(k).join(", ")+"}":F)+"). If you meant to render a collection of children, use an array instead.");return Ie}function ae(k,F,re){if(k==null)return k;var de=[],ue=0;return le(k,de,"","",function(he){return F.call(re,he,ue++)}),de}function J(k){if(k._status===-1){var F=k._result;F=F(),F.then(function(re){(k._status===0||k._status===-1)&&(k._status=1,k._result=re)},function(re){(k._status===0||k._status===-1)&&(k._status=2,k._result=re)}),k._status===-1&&(k._status=0,k._result=F)}if(k._status===1)return k._result.default;throw k._result}var ne={current:null},H={transition:null},Q={ReactCurrentDispatcher:ne,ReactCurrentBatchConfig:H,ReactCurrentOwner:K};function q(){throw Error("act(...) is not supported in production builds of React.")}return _e.Children={map:ae,forEach:function(k,F,re){ae(k,function(){F.apply(this,arguments)},re)},count:function(k){var F=0;return ae(k,function(){F++}),F},toArray:function(k){return ae(k,function(F){return F})||[]},only:function(k){if(!M(k))throw Error("React.Children.only expected to receive a single React element child.");return k}},_e.Component=T,_e.Fragment=t,_e.Profiler=s,_e.PureComponent=R,_e.StrictMode=i,_e.Suspense=h,_e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Q,_e.act=q,_e.cloneElement=function(k,F,re){if(k==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+k+".");var de=E({},k.props),ue=k.key,he=k.ref,Ie=k._owner;if(F!=null){if(F.ref!==void 0&&(he=F.ref,Ie=K.current),F.key!==void 0&&(ue=""+F.key),k.type&&k.type.defaultProps)var Se=k.type.defaultProps;for(we in F)b.call(F,we)&&!O.hasOwnProperty(we)&&(de[we]=F[we]===void 0&&Se!==void 0?Se[we]:F[we])}var we=arguments.length-2;if(we===1)de.children=re;else if(1<we){Se=Array(we);for(var je=0;je<we;je++)Se[je]=arguments[je+2];de.children=Se}return{$$typeof:l,type:k.type,key:ue,ref:he,props:de,_owner:Ie}},_e.createContext=function(k){return k={$$typeof:o,_currentValue:k,_currentValue2:k,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},k.Provider={$$typeof:a,_context:k},k.Consumer=k},_e.createElement=B,_e.createFactory=function(k){var F=B.bind(null,k);return F.type=k,F},_e.createRef=function(){return{current:null}},_e.forwardRef=function(k){return{$$typeof:u,render:k}},_e.isValidElement=M,_e.lazy=function(k){return{$$typeof:f,_payload:{_status:-1,_result:k},_init:J}},_e.memo=function(k,F){return{$$typeof:d,type:k,compare:F===void 0?null:F}},_e.startTransition=function(k){var F=H.transition;H.transition={};try{k()}finally{H.transition=F}},_e.unstable_act=q,_e.useCallback=function(k,F){return ne.current.useCallback(k,F)},_e.useContext=function(k){return ne.current.useContext(k)},_e.useDebugValue=function(){},_e.useDeferredValue=function(k){return ne.current.useDeferredValue(k)},_e.useEffect=function(k,F){return ne.current.useEffect(k,F)},_e.useId=function(){return ne.current.useId()},_e.useImperativeHandle=function(k,F,re){return ne.current.useImperativeHandle(k,F,re)},_e.useInsertionEffect=function(k,F){return ne.current.useInsertionEffect(k,F)},_e.useLayoutEffect=function(k,F){return ne.current.useLayoutEffect(k,F)},_e.useMemo=function(k,F){return ne.current.useMemo(k,F)},_e.useReducer=function(k,F,re){return ne.current.useReducer(k,F,re)},_e.useRef=function(k){return ne.current.useRef(k)},_e.useState=function(k){return ne.current.useState(k)},_e.useSyncExternalStore=function(k,F,re){return ne.current.useSyncExternalStore(k,F,re)},_e.useTransition=function(){return ne.current.useTransition()},_e.version="18.3.1",_e}var tf;function Vu(){return tf||(tf=1,Xl.exports=iy()),Xl.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nf;function ny(){if(nf)return tr;nf=1;var l=Vu(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function o(u,h,d){var f,m={},p=null,v=null;d!==void 0&&(p=""+d),h.key!==void 0&&(p=""+h.key),h.ref!==void 0&&(v=h.ref);for(f in h)i.call(h,f)&&!a.hasOwnProperty(f)&&(m[f]=h[f]);if(u&&u.defaultProps)for(f in h=u.defaultProps,h)m[f]===void 0&&(m[f]=h[f]);return{$$typeof:e,type:u,key:p,ref:v,props:m,_owner:s.current}}return tr.Fragment=t,tr.jsx=o,tr.jsxs=o,tr}var sf;function sy(){return sf||(sf=1,Ql.exports=ny()),Ql.exports}var D=sy(),wn=Vu();const ry=kg(wn);var Ta={},Zl={exports:{}},kt={},Jl={exports:{}},eu={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rf;function ay(){return rf||(rf=1,(function(l){function e(H,Q){var q=H.length;H.push(Q);e:for(;0<q;){var k=q-1>>>1,F=H[k];if(0<s(F,Q))H[k]=Q,H[q]=F,q=k;else break e}}function t(H){return H.length===0?null:H[0]}function i(H){if(H.length===0)return null;var Q=H[0],q=H.pop();if(q!==Q){H[0]=q;e:for(var k=0,F=H.length,re=F>>>1;k<re;){var de=2*(k+1)-1,ue=H[de],he=de+1,Ie=H[he];if(0>s(ue,q))he<F&&0>s(Ie,ue)?(H[k]=Ie,H[he]=q,k=he):(H[k]=ue,H[de]=q,k=de);else if(he<F&&0>s(Ie,q))H[k]=Ie,H[he]=q,k=he;else break e}}return Q}function s(H,Q){var q=H.sortIndex-Q.sortIndex;return q!==0?q:H.id-Q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;l.unstable_now=function(){return a.now()}}else{var o=Date,u=o.now();l.unstable_now=function(){return o.now()-u}}var h=[],d=[],f=1,m=null,p=3,v=!1,E=!1,A=!1,T=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(H){for(var Q=t(d);Q!==null;){if(Q.callback===null)i(d);else if(Q.startTime<=H)i(d),Q.sortIndex=Q.expirationTime,e(h,Q);else break;Q=t(d)}}function C(H){if(A=!1,_(H),!E)if(t(h)!==null)E=!0,J(b);else{var Q=t(d);Q!==null&&ne(C,Q.startTime-H)}}function b(H,Q){E=!1,A&&(A=!1,I(B),B=-1),v=!0;var q=p;try{for(_(Q),m=t(h);m!==null&&(!(m.expirationTime>Q)||H&&!z());){var k=m.callback;if(typeof k=="function"){m.callback=null,p=m.priorityLevel;var F=k(m.expirationTime<=Q);Q=l.unstable_now(),typeof F=="function"?m.callback=F:m===t(h)&&i(h),_(Q)}else i(h);m=t(h)}if(m!==null)var re=!0;else{var de=t(d);de!==null&&ne(C,de.startTime-Q),re=!1}return re}finally{m=null,p=q,v=!1}}var K=!1,O=null,B=-1,U=5,M=-1;function z(){return!(l.unstable_now()-M<U)}function te(){if(O!==null){var H=l.unstable_now();M=H;var Q=!0;try{Q=O(!0,H)}finally{Q?se():(K=!1,O=null)}}else K=!1}var se;if(typeof R=="function")se=function(){R(te)};else if(typeof MessageChannel<"u"){var le=new MessageChannel,ae=le.port2;le.port1.onmessage=te,se=function(){ae.postMessage(null)}}else se=function(){T(te,0)};function J(H){O=H,K||(K=!0,se())}function ne(H,Q){B=T(function(){H(l.unstable_now())},Q)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(H){H.callback=null},l.unstable_continueExecution=function(){E||v||(E=!0,J(b))},l.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):U=0<H?Math.floor(1e3/H):5},l.unstable_getCurrentPriorityLevel=function(){return p},l.unstable_getFirstCallbackNode=function(){return t(h)},l.unstable_next=function(H){switch(p){case 1:case 2:case 3:var Q=3;break;default:Q=p}var q=p;p=Q;try{return H()}finally{p=q}},l.unstable_pauseExecution=function(){},l.unstable_requestPaint=function(){},l.unstable_runWithPriority=function(H,Q){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var q=p;p=H;try{return Q()}finally{p=q}},l.unstable_scheduleCallback=function(H,Q,q){var k=l.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?k+q:k):q=k,H){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=q+F,H={id:f++,callback:Q,priorityLevel:H,startTime:q,expirationTime:F,sortIndex:-1},q>k?(H.sortIndex=q,e(d,H),t(h)===null&&H===t(d)&&(A?(I(B),B=-1):A=!0,ne(C,q-k))):(H.sortIndex=F,e(h,H),E||v||(E=!0,J(b))),H},l.unstable_shouldYield=z,l.unstable_wrapCallback=function(H){var Q=p;return function(){var q=p;p=Q;try{return H.apply(this,arguments)}finally{p=q}}}})(eu)),eu}var af;function oy(){return af||(af=1,Jl.exports=ay()),Jl.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var of;function ly(){if(of)return kt;of=1;var l=Vu(),e=oy();function t(n){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+n,c=1;c<arguments.length;c++)r+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+n+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,s={};function a(n,r){o(n,r),o(n+"Capture",r)}function o(n,r){for(s[n]=r,n=0;n<r.length;n++)i.add(r[n])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},m={};function p(n){return h.call(m,n)?!0:h.call(f,n)?!1:d.test(n)?m[n]=!0:(f[n]=!0,!1)}function v(n,r,c,g){if(c!==null&&c.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return g?!1:c!==null?!c.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function E(n,r,c,g){if(r===null||typeof r>"u"||v(n,r,c,g))return!0;if(g)return!1;if(c!==null)switch(c.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function A(n,r,c,g,y,x,L){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=g,this.attributeNamespace=y,this.mustUseProperty=c,this.propertyName=n,this.type=r,this.sanitizeURL=x,this.removeEmptyString=L}var T={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){T[n]=new A(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var r=n[0];T[r]=new A(r,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){T[n]=new A(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){T[n]=new A(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){T[n]=new A(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){T[n]=new A(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){T[n]=new A(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){T[n]=new A(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){T[n]=new A(n,5,!1,n.toLowerCase(),null,!1,!1)});var I=/[\-:]([a-z])/g;function R(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var r=n.replace(I,R);T[r]=new A(r,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var r=n.replace(I,R);T[r]=new A(r,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var r=n.replace(I,R);T[r]=new A(r,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){T[n]=new A(n,1,!1,n.toLowerCase(),null,!1,!1)}),T.xlinkHref=new A("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){T[n]=new A(n,1,!1,n.toLowerCase(),null,!0,!0)});function _(n,r,c,g){var y=T.hasOwnProperty(r)?T[r]:null;(y!==null?y.type!==0:g||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(E(r,c,y,g)&&(c=null),g||y===null?p(r)&&(c===null?n.removeAttribute(r):n.setAttribute(r,""+c)):y.mustUseProperty?n[y.propertyName]=c===null?y.type===3?!1:"":c:(r=y.attributeName,g=y.attributeNamespace,c===null?n.removeAttribute(r):(y=y.type,c=y===3||y===4&&c===!0?"":""+c,g?n.setAttributeNS(g,r,c):n.setAttribute(r,c))))}var C=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),K=Symbol.for("react.portal"),O=Symbol.for("react.fragment"),B=Symbol.for("react.strict_mode"),U=Symbol.for("react.profiler"),M=Symbol.for("react.provider"),z=Symbol.for("react.context"),te=Symbol.for("react.forward_ref"),se=Symbol.for("react.suspense"),le=Symbol.for("react.suspense_list"),ae=Symbol.for("react.memo"),J=Symbol.for("react.lazy"),ne=Symbol.for("react.offscreen"),H=Symbol.iterator;function Q(n){return n===null||typeof n!="object"?null:(n=H&&n[H]||n["@@iterator"],typeof n=="function"?n:null)}var q=Object.assign,k;function F(n){if(k===void 0)try{throw Error()}catch(c){var r=c.stack.trim().match(/\n( *(at )?)/);k=r&&r[1]||""}return`
`+k+n}var re=!1;function de(n,r){if(!n||re)return"";re=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(W){var g=W}Reflect.construct(n,[],r)}else{try{r.call()}catch(W){g=W}n.call(r.prototype)}else{try{throw Error()}catch(W){g=W}n()}}catch(W){if(W&&g&&typeof W.stack=="string"){for(var y=W.stack.split(`
`),x=g.stack.split(`
`),L=y.length-1,w=x.length-1;1<=L&&0<=w&&y[L]!==x[w];)w--;for(;1<=L&&0<=w;L--,w--)if(y[L]!==x[w]){if(L!==1||w!==1)do if(L--,w--,0>w||y[L]!==x[w]){var P=`
`+y[L].replace(" at new "," at ");return n.displayName&&P.includes("<anonymous>")&&(P=P.replace("<anonymous>",n.displayName)),P}while(1<=L&&0<=w);break}}}finally{re=!1,Error.prepareStackTrace=c}return(n=n?n.displayName||n.name:"")?F(n):""}function ue(n){switch(n.tag){case 5:return F(n.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return n=de(n.type,!1),n;case 11:return n=de(n.type.render,!1),n;case 1:return n=de(n.type,!0),n;default:return""}}function he(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case O:return"Fragment";case K:return"Portal";case U:return"Profiler";case B:return"StrictMode";case se:return"Suspense";case le:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case z:return(n.displayName||"Context")+".Consumer";case M:return(n._context.displayName||"Context")+".Provider";case te:var r=n.render;return n=n.displayName,n||(n=r.displayName||r.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case ae:return r=n.displayName||null,r!==null?r:he(n.type)||"Memo";case J:r=n._payload,n=n._init;try{return he(n(r))}catch{}}return null}function Ie(n){var r=n.type;switch(n.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=r.render,n=n.displayName||n.name||"",r.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return he(r);case 8:return r===B?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function Se(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function we(n){var r=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function je(n){var r=we(n)?"checked":"value",c=Object.getOwnPropertyDescriptor(n.constructor.prototype,r),g=""+n[r];if(!n.hasOwnProperty(r)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var y=c.get,x=c.set;return Object.defineProperty(n,r,{configurable:!0,get:function(){return y.call(this)},set:function(L){g=""+L,x.call(this,L)}}),Object.defineProperty(n,r,{enumerable:c.enumerable}),{getValue:function(){return g},setValue:function(L){g=""+L},stopTracking:function(){n._valueTracker=null,delete n[r]}}}}function Gt(n){n._valueTracker||(n._valueTracker=je(n))}function gr(n){if(!n)return!1;var r=n._valueTracker;if(!r)return!0;var c=r.getValue(),g="";return n&&(g=we(n)?n.checked?"true":"false":n.value),n=g,n!==c?(r.setValue(n),!0):!1}function Oi(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function cn(n,r){var c=r.checked;return q({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??n._wrapperState.initialChecked})}function ao(n,r){var c=r.defaultValue==null?"":r.defaultValue,g=r.checked!=null?r.checked:r.defaultChecked;c=Se(r.value!=null?r.value:c),n._wrapperState={initialChecked:g,initialValue:c,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function Ce(n,r){r=r.checked,r!=null&&_(n,"checked",r,!1)}function Je(n,r){Ce(n,r);var c=Se(r.value),g=r.type;if(c!=null)g==="number"?(c===0&&n.value===""||n.value!=c)&&(n.value=""+c):n.value!==""+c&&(n.value=""+c);else if(g==="submit"||g==="reset"){n.removeAttribute("value");return}r.hasOwnProperty("value")?Qt(n,r.type,c):r.hasOwnProperty("defaultValue")&&Qt(n,r.type,Se(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(n.defaultChecked=!!r.defaultChecked)}function Et(n,r,c){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var g=r.type;if(!(g!=="submit"&&g!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+n._wrapperState.initialValue,c||r===n.value||(n.value=r),n.defaultValue=r}c=n.name,c!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,c!==""&&(n.name=c)}function Qt(n,r,c){(r!=="number"||Oi(n.ownerDocument)!==n)&&(c==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+c&&(n.defaultValue=""+c))}var ut=Array.isArray;function Dt(n,r,c,g){if(n=n.options,r){r={};for(var y=0;y<c.length;y++)r["$"+c[y]]=!0;for(c=0;c<n.length;c++)y=r.hasOwnProperty("$"+n[c].value),n[c].selected!==y&&(n[c].selected=y),y&&g&&(n[c].defaultSelected=!0)}else{for(c=""+Se(c),r=null,y=0;y<n.length;y++){if(n[y].value===c){n[y].selected=!0,g&&(n[y].defaultSelected=!0);return}r!==null||n[y].disabled||(r=n[y])}r!==null&&(r.selected=!0)}}function Xt(n,r){if(r.dangerouslySetInnerHTML!=null)throw Error(t(91));return q({},r,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function ps(n,r){var c=r.value;if(c==null){if(c=r.children,r=r.defaultValue,c!=null){if(r!=null)throw Error(t(92));if(ut(c)){if(1<c.length)throw Error(t(93));c=c[0]}r=c}r==null&&(r=""),c=r}n._wrapperState={initialValue:Se(c)}}function dn(n,r){var c=Se(r.value),g=Se(r.defaultValue);c!=null&&(c=""+c,c!==n.value&&(n.value=c),r.defaultValue==null&&n.defaultValue!==c&&(n.defaultValue=c)),g!=null&&(n.defaultValue=""+g)}function ys(n){var r=n.textContent;r===n._wrapperState.initialValue&&r!==""&&r!==null&&(n.value=r)}function Ni(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Dn(n,r){return n==null||n==="http://www.w3.org/1999/xhtml"?Ni(r):n==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var bn,vs=(function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,c,g,y){MSApp.execUnsafeLocalFunction(function(){return n(r,c,g,y)})}:n})(function(n,r){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=r;else{for(bn=bn||document.createElement("div"),bn.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=bn.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;r.firstChild;)n.appendChild(r.firstChild)}});function Mi(n,r){if(r){var c=n.firstChild;if(c&&c===n.lastChild&&c.nodeType===3){c.nodeValue=r;return}}n.textContent=r}var Zt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ap=["Webkit","ms","Moz","O"];Object.keys(Zt).forEach(function(n){ap.forEach(function(r){r=r+n.charAt(0).toUpperCase()+n.substring(1),Zt[r]=Zt[n]})});function mc(n,r,c){return r==null||typeof r=="boolean"||r===""?"":c||typeof r!="number"||r===0||Zt.hasOwnProperty(n)&&Zt[n]?(""+r).trim():r+"px"}function pc(n,r){n=n.style;for(var c in r)if(r.hasOwnProperty(c)){var g=c.indexOf("--")===0,y=mc(c,r[c],g);c==="float"&&(c="cssFloat"),g?n.setProperty(c,y):n[c]=y}}var op=q({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function oo(n,r){if(r){if(op[n]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(t(137,n));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(t(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(t(61))}if(r.style!=null&&typeof r.style!="object")throw Error(t(62))}}function lo(n,r){if(n.indexOf("-")===-1)return typeof r.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var uo=null;function co(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var ho=null,Pn=null,On=null;function yc(n){if(n=$s(n)){if(typeof ho!="function")throw Error(t(280));var r=n.stateNode;r&&(r=Fr(r),ho(n.stateNode,n.type,r))}}function vc(n){Pn?On?On.push(n):On=[n]:Pn=n}function Ec(){if(Pn){var n=Pn,r=On;if(On=Pn=null,yc(n),r)for(n=0;n<r.length;n++)yc(r[n])}}function xc(n,r){return n(r)}function Sc(){}var fo=!1;function Tc(n,r,c){if(fo)return n(r,c);fo=!0;try{return xc(n,r,c)}finally{fo=!1,(Pn!==null||On!==null)&&(Sc(),Ec())}}function Es(n,r){var c=n.stateNode;if(c===null)return null;var g=Fr(c);if(g===null)return null;c=g[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(n=n.type,g=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!g;break e;default:n=!1}if(n)return null;if(c&&typeof c!="function")throw Error(t(231,r,typeof c));return c}var go=!1;if(u)try{var xs={};Object.defineProperty(xs,"passive",{get:function(){go=!0}}),window.addEventListener("test",xs,xs),window.removeEventListener("test",xs,xs)}catch{go=!1}function lp(n,r,c,g,y,x,L,w,P){var W=Array.prototype.slice.call(arguments,3);try{r.apply(c,W)}catch(Z){this.onError(Z)}}var Ss=!1,mr=null,pr=!1,mo=null,up={onError:function(n){Ss=!0,mr=n}};function cp(n,r,c,g,y,x,L,w,P){Ss=!1,mr=null,lp.apply(up,arguments)}function dp(n,r,c,g,y,x,L,w,P){if(cp.apply(this,arguments),Ss){if(Ss){var W=mr;Ss=!1,mr=null}else throw Error(t(198));pr||(pr=!0,mo=W)}}function hn(n){var r=n,c=n;if(n.alternate)for(;r.return;)r=r.return;else{n=r;do r=n,(r.flags&4098)!==0&&(c=r.return),n=r.return;while(n)}return r.tag===3?c:null}function Ac(n){if(n.tag===13){var r=n.memoizedState;if(r===null&&(n=n.alternate,n!==null&&(r=n.memoizedState)),r!==null)return r.dehydrated}return null}function Lc(n){if(hn(n)!==n)throw Error(t(188))}function hp(n){var r=n.alternate;if(!r){if(r=hn(n),r===null)throw Error(t(188));return r!==n?null:n}for(var c=n,g=r;;){var y=c.return;if(y===null)break;var x=y.alternate;if(x===null){if(g=y.return,g!==null){c=g;continue}break}if(y.child===x.child){for(x=y.child;x;){if(x===c)return Lc(y),n;if(x===g)return Lc(y),r;x=x.sibling}throw Error(t(188))}if(c.return!==g.return)c=y,g=x;else{for(var L=!1,w=y.child;w;){if(w===c){L=!0,c=y,g=x;break}if(w===g){L=!0,g=y,c=x;break}w=w.sibling}if(!L){for(w=x.child;w;){if(w===c){L=!0,c=x,g=y;break}if(w===g){L=!0,g=x,c=y;break}w=w.sibling}if(!L)throw Error(t(189))}}if(c.alternate!==g)throw Error(t(190))}if(c.tag!==3)throw Error(t(188));return c.stateNode.current===c?n:r}function Ic(n){return n=hp(n),n!==null?Rc(n):null}function Rc(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var r=Rc(n);if(r!==null)return r;n=n.sibling}return null}var _c=e.unstable_scheduleCallback,kc=e.unstable_cancelCallback,fp=e.unstable_shouldYield,gp=e.unstable_requestPaint,Qe=e.unstable_now,mp=e.unstable_getCurrentPriorityLevel,po=e.unstable_ImmediatePriority,wc=e.unstable_UserBlockingPriority,yr=e.unstable_NormalPriority,pp=e.unstable_LowPriority,Cc=e.unstable_IdlePriority,vr=null,ui=null;function yp(n){if(ui&&typeof ui.onCommitFiberRoot=="function")try{ui.onCommitFiberRoot(vr,n,void 0,(n.current.flags&128)===128)}catch{}}var Jt=Math.clz32?Math.clz32:xp,vp=Math.log,Ep=Math.LN2;function xp(n){return n>>>=0,n===0?32:31-(vp(n)/Ep|0)|0}var Er=64,xr=4194304;function Ts(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Sr(n,r){var c=n.pendingLanes;if(c===0)return 0;var g=0,y=n.suspendedLanes,x=n.pingedLanes,L=c&268435455;if(L!==0){var w=L&~y;w!==0?g=Ts(w):(x&=L,x!==0&&(g=Ts(x)))}else L=c&~y,L!==0?g=Ts(L):x!==0&&(g=Ts(x));if(g===0)return 0;if(r!==0&&r!==g&&(r&y)===0&&(y=g&-g,x=r&-r,y>=x||y===16&&(x&4194240)!==0))return r;if((g&4)!==0&&(g|=c&16),r=n.entangledLanes,r!==0)for(n=n.entanglements,r&=g;0<r;)c=31-Jt(r),y=1<<c,g|=n[c],r&=~y;return g}function Sp(n,r){switch(n){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Tp(n,r){for(var c=n.suspendedLanes,g=n.pingedLanes,y=n.expirationTimes,x=n.pendingLanes;0<x;){var L=31-Jt(x),w=1<<L,P=y[L];P===-1?((w&c)===0||(w&g)!==0)&&(y[L]=Sp(w,r)):P<=r&&(n.expiredLanes|=w),x&=~w}}function yo(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Dc(){var n=Er;return Er<<=1,(Er&4194240)===0&&(Er=64),n}function vo(n){for(var r=[],c=0;31>c;c++)r.push(n);return r}function As(n,r,c){n.pendingLanes|=r,r!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,r=31-Jt(r),n[r]=c}function Ap(n,r){var c=n.pendingLanes&~r;n.pendingLanes=r,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=r,n.mutableReadLanes&=r,n.entangledLanes&=r,r=n.entanglements;var g=n.eventTimes;for(n=n.expirationTimes;0<c;){var y=31-Jt(c),x=1<<y;r[y]=0,g[y]=-1,n[y]=-1,c&=~x}}function Eo(n,r){var c=n.entangledLanes|=r;for(n=n.entanglements;c;){var g=31-Jt(c),y=1<<g;y&r|n[g]&r&&(n[g]|=r),c&=~y}}var Pe=0;function bc(n){return n&=-n,1<n?4<n?(n&268435455)!==0?16:536870912:4:1}var Pc,xo,Oc,Nc,Mc,So=!1,Tr=[],Fi=null,Bi=null,Ui=null,Ls=new Map,Is=new Map,$i=[],Lp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Fc(n,r){switch(n){case"focusin":case"focusout":Fi=null;break;case"dragenter":case"dragleave":Bi=null;break;case"mouseover":case"mouseout":Ui=null;break;case"pointerover":case"pointerout":Ls.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Is.delete(r.pointerId)}}function Rs(n,r,c,g,y,x){return n===null||n.nativeEvent!==x?(n={blockedOn:r,domEventName:c,eventSystemFlags:g,nativeEvent:x,targetContainers:[y]},r!==null&&(r=$s(r),r!==null&&xo(r)),n):(n.eventSystemFlags|=g,r=n.targetContainers,y!==null&&r.indexOf(y)===-1&&r.push(y),n)}function Ip(n,r,c,g,y){switch(r){case"focusin":return Fi=Rs(Fi,n,r,c,g,y),!0;case"dragenter":return Bi=Rs(Bi,n,r,c,g,y),!0;case"mouseover":return Ui=Rs(Ui,n,r,c,g,y),!0;case"pointerover":var x=y.pointerId;return Ls.set(x,Rs(Ls.get(x)||null,n,r,c,g,y)),!0;case"gotpointercapture":return x=y.pointerId,Is.set(x,Rs(Is.get(x)||null,n,r,c,g,y)),!0}return!1}function Bc(n){var r=fn(n.target);if(r!==null){var c=hn(r);if(c!==null){if(r=c.tag,r===13){if(r=Ac(c),r!==null){n.blockedOn=r,Mc(n.priority,function(){Oc(c)});return}}else if(r===3&&c.stateNode.current.memoizedState.isDehydrated){n.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Ar(n){if(n.blockedOn!==null)return!1;for(var r=n.targetContainers;0<r.length;){var c=Ao(n.domEventName,n.eventSystemFlags,r[0],n.nativeEvent);if(c===null){c=n.nativeEvent;var g=new c.constructor(c.type,c);uo=g,c.target.dispatchEvent(g),uo=null}else return r=$s(c),r!==null&&xo(r),n.blockedOn=c,!1;r.shift()}return!0}function Uc(n,r,c){Ar(n)&&c.delete(r)}function Rp(){So=!1,Fi!==null&&Ar(Fi)&&(Fi=null),Bi!==null&&Ar(Bi)&&(Bi=null),Ui!==null&&Ar(Ui)&&(Ui=null),Ls.forEach(Uc),Is.forEach(Uc)}function _s(n,r){n.blockedOn===r&&(n.blockedOn=null,So||(So=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Rp)))}function ks(n){function r(y){return _s(y,n)}if(0<Tr.length){_s(Tr[0],n);for(var c=1;c<Tr.length;c++){var g=Tr[c];g.blockedOn===n&&(g.blockedOn=null)}}for(Fi!==null&&_s(Fi,n),Bi!==null&&_s(Bi,n),Ui!==null&&_s(Ui,n),Ls.forEach(r),Is.forEach(r),c=0;c<$i.length;c++)g=$i[c],g.blockedOn===n&&(g.blockedOn=null);for(;0<$i.length&&(c=$i[0],c.blockedOn===null);)Bc(c),c.blockedOn===null&&$i.shift()}var Nn=C.ReactCurrentBatchConfig,Lr=!0;function _p(n,r,c,g){var y=Pe,x=Nn.transition;Nn.transition=null;try{Pe=1,To(n,r,c,g)}finally{Pe=y,Nn.transition=x}}function kp(n,r,c,g){var y=Pe,x=Nn.transition;Nn.transition=null;try{Pe=4,To(n,r,c,g)}finally{Pe=y,Nn.transition=x}}function To(n,r,c,g){if(Lr){var y=Ao(n,r,c,g);if(y===null)$o(n,r,g,Ir,c),Fc(n,g);else if(Ip(y,n,r,c,g))g.stopPropagation();else if(Fc(n,g),r&4&&-1<Lp.indexOf(n)){for(;y!==null;){var x=$s(y);if(x!==null&&Pc(x),x=Ao(n,r,c,g),x===null&&$o(n,r,g,Ir,c),x===y)break;y=x}y!==null&&g.stopPropagation()}else $o(n,r,g,null,c)}}var Ir=null;function Ao(n,r,c,g){if(Ir=null,n=co(g),n=fn(n),n!==null)if(r=hn(n),r===null)n=null;else if(c=r.tag,c===13){if(n=Ac(r),n!==null)return n;n=null}else if(c===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;n=null}else r!==n&&(n=null);return Ir=n,null}function $c(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(mp()){case po:return 1;case wc:return 4;case yr:case pp:return 16;case Cc:return 536870912;default:return 16}default:return 16}}var Gi=null,Lo=null,Rr=null;function Gc(){if(Rr)return Rr;var n,r=Lo,c=r.length,g,y="value"in Gi?Gi.value:Gi.textContent,x=y.length;for(n=0;n<c&&r[n]===y[n];n++);var L=c-n;for(g=1;g<=L&&r[c-g]===y[x-g];g++);return Rr=y.slice(n,1<g?1-g:void 0)}function _r(n){var r=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&r===13&&(n=13)):n=r,n===10&&(n=13),32<=n||n===13?n:0}function kr(){return!0}function jc(){return!1}function bt(n){function r(c,g,y,x,L){this._reactName=c,this._targetInst=y,this.type=g,this.nativeEvent=x,this.target=L,this.currentTarget=null;for(var w in n)n.hasOwnProperty(w)&&(c=n[w],this[w]=c?c(x):x[w]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?kr:jc,this.isPropagationStopped=jc,this}return q(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=kr)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=kr)},persist:function(){},isPersistent:kr}),r}var Mn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Io=bt(Mn),ws=q({},Mn,{view:0,detail:0}),wp=bt(ws),Ro,_o,Cs,wr=q({},ws,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wo,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Cs&&(Cs&&n.type==="mousemove"?(Ro=n.screenX-Cs.screenX,_o=n.screenY-Cs.screenY):_o=Ro=0,Cs=n),Ro)},movementY:function(n){return"movementY"in n?n.movementY:_o}}),Kc=bt(wr),Cp=q({},wr,{dataTransfer:0}),Dp=bt(Cp),bp=q({},ws,{relatedTarget:0}),ko=bt(bp),Pp=q({},Mn,{animationName:0,elapsedTime:0,pseudoElement:0}),Op=bt(Pp),Np=q({},Mn,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Mp=bt(Np),Fp=q({},Mn,{data:0}),Vc=bt(Fp),Bp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Up={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$p={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Gp(n){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(n):(n=$p[n])?!!r[n]:!1}function wo(){return Gp}var jp=q({},ws,{key:function(n){if(n.key){var r=Bp[n.key]||n.key;if(r!=="Unidentified")return r}return n.type==="keypress"?(n=_r(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Up[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wo,charCode:function(n){return n.type==="keypress"?_r(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?_r(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Kp=bt(jp),Vp=q({},wr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Hc=bt(Vp),Hp=q({},ws,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wo}),Wp=bt(Hp),zp=q({},Mn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yp=bt(zp),qp=q({},wr,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Qp=bt(qp),Xp=[9,13,27,32],Co=u&&"CompositionEvent"in window,Ds=null;u&&"documentMode"in document&&(Ds=document.documentMode);var Zp=u&&"TextEvent"in window&&!Ds,Wc=u&&(!Co||Ds&&8<Ds&&11>=Ds),zc=" ",Yc=!1;function qc(n,r){switch(n){case"keyup":return Xp.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Qc(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Fn=!1;function Jp(n,r){switch(n){case"compositionend":return Qc(r);case"keypress":return r.which!==32?null:(Yc=!0,zc);case"textInput":return n=r.data,n===zc&&Yc?null:n;default:return null}}function e0(n,r){if(Fn)return n==="compositionend"||!Co&&qc(n,r)?(n=Gc(),Rr=Lo=Gi=null,Fn=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Wc&&r.locale!=="ko"?null:r.data;default:return null}}var t0={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xc(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r==="input"?!!t0[n.type]:r==="textarea"}function Zc(n,r,c,g){vc(g),r=Or(r,"onChange"),0<r.length&&(c=new Io("onChange","change",null,c,g),n.push({event:c,listeners:r}))}var bs=null,Ps=null;function i0(n){pd(n,0)}function Cr(n){var r=jn(n);if(gr(r))return n}function n0(n,r){if(n==="change")return r}var Jc=!1;if(u){var Do;if(u){var bo="oninput"in document;if(!bo){var ed=document.createElement("div");ed.setAttribute("oninput","return;"),bo=typeof ed.oninput=="function"}Do=bo}else Do=!1;Jc=Do&&(!document.documentMode||9<document.documentMode)}function td(){bs&&(bs.detachEvent("onpropertychange",id),Ps=bs=null)}function id(n){if(n.propertyName==="value"&&Cr(Ps)){var r=[];Zc(r,Ps,n,co(n)),Tc(i0,r)}}function s0(n,r,c){n==="focusin"?(td(),bs=r,Ps=c,bs.attachEvent("onpropertychange",id)):n==="focusout"&&td()}function r0(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Cr(Ps)}function a0(n,r){if(n==="click")return Cr(r)}function o0(n,r){if(n==="input"||n==="change")return Cr(r)}function l0(n,r){return n===r&&(n!==0||1/n===1/r)||n!==n&&r!==r}var ei=typeof Object.is=="function"?Object.is:l0;function Os(n,r){if(ei(n,r))return!0;if(typeof n!="object"||n===null||typeof r!="object"||r===null)return!1;var c=Object.keys(n),g=Object.keys(r);if(c.length!==g.length)return!1;for(g=0;g<c.length;g++){var y=c[g];if(!h.call(r,y)||!ei(n[y],r[y]))return!1}return!0}function nd(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function sd(n,r){var c=nd(n);n=0;for(var g;c;){if(c.nodeType===3){if(g=n+c.textContent.length,n<=r&&g>=r)return{node:c,offset:r-n};n=g}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=nd(c)}}function rd(n,r){return n&&r?n===r?!0:n&&n.nodeType===3?!1:r&&r.nodeType===3?rd(n,r.parentNode):"contains"in n?n.contains(r):n.compareDocumentPosition?!!(n.compareDocumentPosition(r)&16):!1:!1}function ad(){for(var n=window,r=Oi();r instanceof n.HTMLIFrameElement;){try{var c=typeof r.contentWindow.location.href=="string"}catch{c=!1}if(c)n=r.contentWindow;else break;r=Oi(n.document)}return r}function Po(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r&&(r==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||r==="textarea"||n.contentEditable==="true")}function u0(n){var r=ad(),c=n.focusedElem,g=n.selectionRange;if(r!==c&&c&&c.ownerDocument&&rd(c.ownerDocument.documentElement,c)){if(g!==null&&Po(c)){if(r=g.start,n=g.end,n===void 0&&(n=r),"selectionStart"in c)c.selectionStart=r,c.selectionEnd=Math.min(n,c.value.length);else if(n=(r=c.ownerDocument||document)&&r.defaultView||window,n.getSelection){n=n.getSelection();var y=c.textContent.length,x=Math.min(g.start,y);g=g.end===void 0?x:Math.min(g.end,y),!n.extend&&x>g&&(y=g,g=x,x=y),y=sd(c,x);var L=sd(c,g);y&&L&&(n.rangeCount!==1||n.anchorNode!==y.node||n.anchorOffset!==y.offset||n.focusNode!==L.node||n.focusOffset!==L.offset)&&(r=r.createRange(),r.setStart(y.node,y.offset),n.removeAllRanges(),x>g?(n.addRange(r),n.extend(L.node,L.offset)):(r.setEnd(L.node,L.offset),n.addRange(r)))}}for(r=[],n=c;n=n.parentNode;)n.nodeType===1&&r.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<r.length;c++)n=r[c],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var c0=u&&"documentMode"in document&&11>=document.documentMode,Bn=null,Oo=null,Ns=null,No=!1;function od(n,r,c){var g=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;No||Bn==null||Bn!==Oi(g)||(g=Bn,"selectionStart"in g&&Po(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),Ns&&Os(Ns,g)||(Ns=g,g=Or(Oo,"onSelect"),0<g.length&&(r=new Io("onSelect","select",null,r,c),n.push({event:r,listeners:g}),r.target=Bn)))}function Dr(n,r){var c={};return c[n.toLowerCase()]=r.toLowerCase(),c["Webkit"+n]="webkit"+r,c["Moz"+n]="moz"+r,c}var Un={animationend:Dr("Animation","AnimationEnd"),animationiteration:Dr("Animation","AnimationIteration"),animationstart:Dr("Animation","AnimationStart"),transitionend:Dr("Transition","TransitionEnd")},Mo={},ld={};u&&(ld=document.createElement("div").style,"AnimationEvent"in window||(delete Un.animationend.animation,delete Un.animationiteration.animation,delete Un.animationstart.animation),"TransitionEvent"in window||delete Un.transitionend.transition);function br(n){if(Mo[n])return Mo[n];if(!Un[n])return n;var r=Un[n],c;for(c in r)if(r.hasOwnProperty(c)&&c in ld)return Mo[n]=r[c];return n}var ud=br("animationend"),cd=br("animationiteration"),dd=br("animationstart"),hd=br("transitionend"),fd=new Map,gd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ji(n,r){fd.set(n,r),a(r,[n])}for(var Fo=0;Fo<gd.length;Fo++){var Bo=gd[Fo],d0=Bo.toLowerCase(),h0=Bo[0].toUpperCase()+Bo.slice(1);ji(d0,"on"+h0)}ji(ud,"onAnimationEnd"),ji(cd,"onAnimationIteration"),ji(dd,"onAnimationStart"),ji("dblclick","onDoubleClick"),ji("focusin","onFocus"),ji("focusout","onBlur"),ji(hd,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ms="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),f0=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ms));function md(n,r,c){var g=n.type||"unknown-event";n.currentTarget=c,dp(g,r,void 0,n),n.currentTarget=null}function pd(n,r){r=(r&4)!==0;for(var c=0;c<n.length;c++){var g=n[c],y=g.event;g=g.listeners;e:{var x=void 0;if(r)for(var L=g.length-1;0<=L;L--){var w=g[L],P=w.instance,W=w.currentTarget;if(w=w.listener,P!==x&&y.isPropagationStopped())break e;md(y,w,W),x=P}else for(L=0;L<g.length;L++){if(w=g[L],P=w.instance,W=w.currentTarget,w=w.listener,P!==x&&y.isPropagationStopped())break e;md(y,w,W),x=P}}}if(pr)throw n=mo,pr=!1,mo=null,n}function $e(n,r){var c=r[Wo];c===void 0&&(c=r[Wo]=new Set);var g=n+"__bubble";c.has(g)||(yd(r,n,2,!1),c.add(g))}function Uo(n,r,c){var g=0;r&&(g|=4),yd(c,n,g,r)}var Pr="_reactListening"+Math.random().toString(36).slice(2);function Fs(n){if(!n[Pr]){n[Pr]=!0,i.forEach(function(c){c!=="selectionchange"&&(f0.has(c)||Uo(c,!1,n),Uo(c,!0,n))});var r=n.nodeType===9?n:n.ownerDocument;r===null||r[Pr]||(r[Pr]=!0,Uo("selectionchange",!1,r))}}function yd(n,r,c,g){switch($c(r)){case 1:var y=_p;break;case 4:y=kp;break;default:y=To}c=y.bind(null,r,c,n),y=void 0,!go||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(y=!0),g?y!==void 0?n.addEventListener(r,c,{capture:!0,passive:y}):n.addEventListener(r,c,!0):y!==void 0?n.addEventListener(r,c,{passive:y}):n.addEventListener(r,c,!1)}function $o(n,r,c,g,y){var x=g;if((r&1)===0&&(r&2)===0&&g!==null)e:for(;;){if(g===null)return;var L=g.tag;if(L===3||L===4){var w=g.stateNode.containerInfo;if(w===y||w.nodeType===8&&w.parentNode===y)break;if(L===4)for(L=g.return;L!==null;){var P=L.tag;if((P===3||P===4)&&(P=L.stateNode.containerInfo,P===y||P.nodeType===8&&P.parentNode===y))return;L=L.return}for(;w!==null;){if(L=fn(w),L===null)return;if(P=L.tag,P===5||P===6){g=x=L;continue e}w=w.parentNode}}g=g.return}Tc(function(){var W=x,Z=co(c),ee=[];e:{var X=fd.get(n);if(X!==void 0){var ce=Io,me=n;switch(n){case"keypress":if(_r(c)===0)break e;case"keydown":case"keyup":ce=Kp;break;case"focusin":me="focus",ce=ko;break;case"focusout":me="blur",ce=ko;break;case"beforeblur":case"afterblur":ce=ko;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ce=Kc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ce=Dp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ce=Wp;break;case ud:case cd:case dd:ce=Op;break;case hd:ce=Yp;break;case"scroll":ce=wp;break;case"wheel":ce=Qp;break;case"copy":case"cut":case"paste":ce=Mp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ce=Hc}var pe=(r&4)!==0,Xe=!pe&&n==="scroll",j=pe?X!==null?X+"Capture":null:X;pe=[];for(var N=W,V;N!==null;){V=N;var ie=V.stateNode;if(V.tag===5&&ie!==null&&(V=ie,j!==null&&(ie=Es(N,j),ie!=null&&pe.push(Bs(N,ie,V)))),Xe)break;N=N.return}0<pe.length&&(X=new ce(X,me,null,c,Z),ee.push({event:X,listeners:pe}))}}if((r&7)===0){e:{if(X=n==="mouseover"||n==="pointerover",ce=n==="mouseout"||n==="pointerout",X&&c!==uo&&(me=c.relatedTarget||c.fromElement)&&(fn(me)||me[Ti]))break e;if((ce||X)&&(X=Z.window===Z?Z:(X=Z.ownerDocument)?X.defaultView||X.parentWindow:window,ce?(me=c.relatedTarget||c.toElement,ce=W,me=me?fn(me):null,me!==null&&(Xe=hn(me),me!==Xe||me.tag!==5&&me.tag!==6)&&(me=null)):(ce=null,me=W),ce!==me)){if(pe=Kc,ie="onMouseLeave",j="onMouseEnter",N="mouse",(n==="pointerout"||n==="pointerover")&&(pe=Hc,ie="onPointerLeave",j="onPointerEnter",N="pointer"),Xe=ce==null?X:jn(ce),V=me==null?X:jn(me),X=new pe(ie,N+"leave",ce,c,Z),X.target=Xe,X.relatedTarget=V,ie=null,fn(Z)===W&&(pe=new pe(j,N+"enter",me,c,Z),pe.target=V,pe.relatedTarget=Xe,ie=pe),Xe=ie,ce&&me)t:{for(pe=ce,j=me,N=0,V=pe;V;V=$n(V))N++;for(V=0,ie=j;ie;ie=$n(ie))V++;for(;0<N-V;)pe=$n(pe),N--;for(;0<V-N;)j=$n(j),V--;for(;N--;){if(pe===j||j!==null&&pe===j.alternate)break t;pe=$n(pe),j=$n(j)}pe=null}else pe=null;ce!==null&&vd(ee,X,ce,pe,!1),me!==null&&Xe!==null&&vd(ee,Xe,me,pe,!0)}}e:{if(X=W?jn(W):window,ce=X.nodeName&&X.nodeName.toLowerCase(),ce==="select"||ce==="input"&&X.type==="file")var ve=n0;else if(Xc(X))if(Jc)ve=o0;else{ve=r0;var Ee=s0}else(ce=X.nodeName)&&ce.toLowerCase()==="input"&&(X.type==="checkbox"||X.type==="radio")&&(ve=a0);if(ve&&(ve=ve(n,W))){Zc(ee,ve,c,Z);break e}Ee&&Ee(n,X,W),n==="focusout"&&(Ee=X._wrapperState)&&Ee.controlled&&X.type==="number"&&Qt(X,"number",X.value)}switch(Ee=W?jn(W):window,n){case"focusin":(Xc(Ee)||Ee.contentEditable==="true")&&(Bn=Ee,Oo=W,Ns=null);break;case"focusout":Ns=Oo=Bn=null;break;case"mousedown":No=!0;break;case"contextmenu":case"mouseup":case"dragend":No=!1,od(ee,c,Z);break;case"selectionchange":if(c0)break;case"keydown":case"keyup":od(ee,c,Z)}var xe;if(Co)e:{switch(n){case"compositionstart":var Te="onCompositionStart";break e;case"compositionend":Te="onCompositionEnd";break e;case"compositionupdate":Te="onCompositionUpdate";break e}Te=void 0}else Fn?qc(n,c)&&(Te="onCompositionEnd"):n==="keydown"&&c.keyCode===229&&(Te="onCompositionStart");Te&&(Wc&&c.locale!=="ko"&&(Fn||Te!=="onCompositionStart"?Te==="onCompositionEnd"&&Fn&&(xe=Gc()):(Gi=Z,Lo="value"in Gi?Gi.value:Gi.textContent,Fn=!0)),Ee=Or(W,Te),0<Ee.length&&(Te=new Vc(Te,n,null,c,Z),ee.push({event:Te,listeners:Ee}),xe?Te.data=xe:(xe=Qc(c),xe!==null&&(Te.data=xe)))),(xe=Zp?Jp(n,c):e0(n,c))&&(W=Or(W,"onBeforeInput"),0<W.length&&(Z=new Vc("onBeforeInput","beforeinput",null,c,Z),ee.push({event:Z,listeners:W}),Z.data=xe))}pd(ee,r)})}function Bs(n,r,c){return{instance:n,listener:r,currentTarget:c}}function Or(n,r){for(var c=r+"Capture",g=[];n!==null;){var y=n,x=y.stateNode;y.tag===5&&x!==null&&(y=x,x=Es(n,c),x!=null&&g.unshift(Bs(n,x,y)),x=Es(n,r),x!=null&&g.push(Bs(n,x,y))),n=n.return}return g}function $n(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function vd(n,r,c,g,y){for(var x=r._reactName,L=[];c!==null&&c!==g;){var w=c,P=w.alternate,W=w.stateNode;if(P!==null&&P===g)break;w.tag===5&&W!==null&&(w=W,y?(P=Es(c,x),P!=null&&L.unshift(Bs(c,P,w))):y||(P=Es(c,x),P!=null&&L.push(Bs(c,P,w)))),c=c.return}L.length!==0&&n.push({event:r,listeners:L})}var g0=/\r\n?/g,m0=/\u0000|\uFFFD/g;function Ed(n){return(typeof n=="string"?n:""+n).replace(g0,`
`).replace(m0,"")}function Nr(n,r,c){if(r=Ed(r),Ed(n)!==r&&c)throw Error(t(425))}function Mr(){}var Go=null,jo=null;function Ko(n,r){return n==="textarea"||n==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Vo=typeof setTimeout=="function"?setTimeout:void 0,p0=typeof clearTimeout=="function"?clearTimeout:void 0,xd=typeof Promise=="function"?Promise:void 0,y0=typeof queueMicrotask=="function"?queueMicrotask:typeof xd<"u"?function(n){return xd.resolve(null).then(n).catch(v0)}:Vo;function v0(n){setTimeout(function(){throw n})}function Ho(n,r){var c=r,g=0;do{var y=c.nextSibling;if(n.removeChild(c),y&&y.nodeType===8)if(c=y.data,c==="/$"){if(g===0){n.removeChild(y),ks(r);return}g--}else c!=="$"&&c!=="$?"&&c!=="$!"||g++;c=y}while(c);ks(r)}function Ki(n){for(;n!=null;n=n.nextSibling){var r=n.nodeType;if(r===1||r===3)break;if(r===8){if(r=n.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return n}function Sd(n){n=n.previousSibling;for(var r=0;n;){if(n.nodeType===8){var c=n.data;if(c==="$"||c==="$!"||c==="$?"){if(r===0)return n;r--}else c==="/$"&&r++}n=n.previousSibling}return null}var Gn=Math.random().toString(36).slice(2),ci="__reactFiber$"+Gn,Us="__reactProps$"+Gn,Ti="__reactContainer$"+Gn,Wo="__reactEvents$"+Gn,E0="__reactListeners$"+Gn,x0="__reactHandles$"+Gn;function fn(n){var r=n[ci];if(r)return r;for(var c=n.parentNode;c;){if(r=c[Ti]||c[ci]){if(c=r.alternate,r.child!==null||c!==null&&c.child!==null)for(n=Sd(n);n!==null;){if(c=n[ci])return c;n=Sd(n)}return r}n=c,c=n.parentNode}return null}function $s(n){return n=n[ci]||n[Ti],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function jn(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(t(33))}function Fr(n){return n[Us]||null}var zo=[],Kn=-1;function Vi(n){return{current:n}}function Ge(n){0>Kn||(n.current=zo[Kn],zo[Kn]=null,Kn--)}function Ue(n,r){Kn++,zo[Kn]=n.current,n.current=r}var Hi={},mt=Vi(Hi),At=Vi(!1),gn=Hi;function Vn(n,r){var c=n.type.contextTypes;if(!c)return Hi;var g=n.stateNode;if(g&&g.__reactInternalMemoizedUnmaskedChildContext===r)return g.__reactInternalMemoizedMaskedChildContext;var y={},x;for(x in c)y[x]=r[x];return g&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=y),y}function Lt(n){return n=n.childContextTypes,n!=null}function Br(){Ge(At),Ge(mt)}function Td(n,r,c){if(mt.current!==Hi)throw Error(t(168));Ue(mt,r),Ue(At,c)}function Ad(n,r,c){var g=n.stateNode;if(r=r.childContextTypes,typeof g.getChildContext!="function")return c;g=g.getChildContext();for(var y in g)if(!(y in r))throw Error(t(108,Ie(n)||"Unknown",y));return q({},c,g)}function Ur(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Hi,gn=mt.current,Ue(mt,n),Ue(At,At.current),!0}function Ld(n,r,c){var g=n.stateNode;if(!g)throw Error(t(169));c?(n=Ad(n,r,gn),g.__reactInternalMemoizedMergedChildContext=n,Ge(At),Ge(mt),Ue(mt,n)):Ge(At),Ue(At,c)}var Ai=null,$r=!1,Yo=!1;function Id(n){Ai===null?Ai=[n]:Ai.push(n)}function S0(n){$r=!0,Id(n)}function Wi(){if(!Yo&&Ai!==null){Yo=!0;var n=0,r=Pe;try{var c=Ai;for(Pe=1;n<c.length;n++){var g=c[n];do g=g(!0);while(g!==null)}Ai=null,$r=!1}catch(y){throw Ai!==null&&(Ai=Ai.slice(n+1)),_c(po,Wi),y}finally{Pe=r,Yo=!1}}return null}var Hn=[],Wn=0,Gr=null,jr=0,jt=[],Kt=0,mn=null,Li=1,Ii="";function pn(n,r){Hn[Wn++]=jr,Hn[Wn++]=Gr,Gr=n,jr=r}function Rd(n,r,c){jt[Kt++]=Li,jt[Kt++]=Ii,jt[Kt++]=mn,mn=n;var g=Li;n=Ii;var y=32-Jt(g)-1;g&=~(1<<y),c+=1;var x=32-Jt(r)+y;if(30<x){var L=y-y%5;x=(g&(1<<L)-1).toString(32),g>>=L,y-=L,Li=1<<32-Jt(r)+y|c<<y|g,Ii=x+n}else Li=1<<x|c<<y|g,Ii=n}function qo(n){n.return!==null&&(pn(n,1),Rd(n,1,0))}function Qo(n){for(;n===Gr;)Gr=Hn[--Wn],Hn[Wn]=null,jr=Hn[--Wn],Hn[Wn]=null;for(;n===mn;)mn=jt[--Kt],jt[Kt]=null,Ii=jt[--Kt],jt[Kt]=null,Li=jt[--Kt],jt[Kt]=null}var Pt=null,Ot=null,Ke=!1,ti=null;function _d(n,r){var c=zt(5,null,null,0);c.elementType="DELETED",c.stateNode=r,c.return=n,r=n.deletions,r===null?(n.deletions=[c],n.flags|=16):r.push(c)}function kd(n,r){switch(n.tag){case 5:var c=n.type;return r=r.nodeType!==1||c.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(n.stateNode=r,Pt=n,Ot=Ki(r.firstChild),!0):!1;case 6:return r=n.pendingProps===""||r.nodeType!==3?null:r,r!==null?(n.stateNode=r,Pt=n,Ot=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(c=mn!==null?{id:Li,overflow:Ii}:null,n.memoizedState={dehydrated:r,treeContext:c,retryLane:1073741824},c=zt(18,null,null,0),c.stateNode=r,c.return=n,n.child=c,Pt=n,Ot=null,!0):!1;default:return!1}}function Xo(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Zo(n){if(Ke){var r=Ot;if(r){var c=r;if(!kd(n,r)){if(Xo(n))throw Error(t(418));r=Ki(c.nextSibling);var g=Pt;r&&kd(n,r)?_d(g,c):(n.flags=n.flags&-4097|2,Ke=!1,Pt=n)}}else{if(Xo(n))throw Error(t(418));n.flags=n.flags&-4097|2,Ke=!1,Pt=n}}}function wd(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Pt=n}function Kr(n){if(n!==Pt)return!1;if(!Ke)return wd(n),Ke=!0,!1;var r;if((r=n.tag!==3)&&!(r=n.tag!==5)&&(r=n.type,r=r!=="head"&&r!=="body"&&!Ko(n.type,n.memoizedProps)),r&&(r=Ot)){if(Xo(n))throw Cd(),Error(t(418));for(;r;)_d(n,r),r=Ki(r.nextSibling)}if(wd(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(t(317));e:{for(n=n.nextSibling,r=0;n;){if(n.nodeType===8){var c=n.data;if(c==="/$"){if(r===0){Ot=Ki(n.nextSibling);break e}r--}else c!=="$"&&c!=="$!"&&c!=="$?"||r++}n=n.nextSibling}Ot=null}}else Ot=Pt?Ki(n.stateNode.nextSibling):null;return!0}function Cd(){for(var n=Ot;n;)n=Ki(n.nextSibling)}function zn(){Ot=Pt=null,Ke=!1}function Jo(n){ti===null?ti=[n]:ti.push(n)}var T0=C.ReactCurrentBatchConfig;function Gs(n,r,c){if(n=c.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(t(309));var g=c.stateNode}if(!g)throw Error(t(147,n));var y=g,x=""+n;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===x?r.ref:(r=function(L){var w=y.refs;L===null?delete w[x]:w[x]=L},r._stringRef=x,r)}if(typeof n!="string")throw Error(t(284));if(!c._owner)throw Error(t(290,n))}return n}function Vr(n,r){throw n=Object.prototype.toString.call(r),Error(t(31,n==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":n))}function Dd(n){var r=n._init;return r(n._payload)}function bd(n){function r(j,N){if(n){var V=j.deletions;V===null?(j.deletions=[N],j.flags|=16):V.push(N)}}function c(j,N){if(!n)return null;for(;N!==null;)r(j,N),N=N.sibling;return null}function g(j,N){for(j=new Map;N!==null;)N.key!==null?j.set(N.key,N):j.set(N.index,N),N=N.sibling;return j}function y(j,N){return j=en(j,N),j.index=0,j.sibling=null,j}function x(j,N,V){return j.index=V,n?(V=j.alternate,V!==null?(V=V.index,V<N?(j.flags|=2,N):V):(j.flags|=2,N)):(j.flags|=1048576,N)}function L(j){return n&&j.alternate===null&&(j.flags|=2),j}function w(j,N,V,ie){return N===null||N.tag!==6?(N=Vl(V,j.mode,ie),N.return=j,N):(N=y(N,V),N.return=j,N)}function P(j,N,V,ie){var ve=V.type;return ve===O?Z(j,N,V.props.children,ie,V.key):N!==null&&(N.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===J&&Dd(ve)===N.type)?(ie=y(N,V.props),ie.ref=Gs(j,N,V),ie.return=j,ie):(ie=ga(V.type,V.key,V.props,null,j.mode,ie),ie.ref=Gs(j,N,V),ie.return=j,ie)}function W(j,N,V,ie){return N===null||N.tag!==4||N.stateNode.containerInfo!==V.containerInfo||N.stateNode.implementation!==V.implementation?(N=Hl(V,j.mode,ie),N.return=j,N):(N=y(N,V.children||[]),N.return=j,N)}function Z(j,N,V,ie,ve){return N===null||N.tag!==7?(N=Ln(V,j.mode,ie,ve),N.return=j,N):(N=y(N,V),N.return=j,N)}function ee(j,N,V){if(typeof N=="string"&&N!==""||typeof N=="number")return N=Vl(""+N,j.mode,V),N.return=j,N;if(typeof N=="object"&&N!==null){switch(N.$$typeof){case b:return V=ga(N.type,N.key,N.props,null,j.mode,V),V.ref=Gs(j,null,N),V.return=j,V;case K:return N=Hl(N,j.mode,V),N.return=j,N;case J:var ie=N._init;return ee(j,ie(N._payload),V)}if(ut(N)||Q(N))return N=Ln(N,j.mode,V,null),N.return=j,N;Vr(j,N)}return null}function X(j,N,V,ie){var ve=N!==null?N.key:null;if(typeof V=="string"&&V!==""||typeof V=="number")return ve!==null?null:w(j,N,""+V,ie);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case b:return V.key===ve?P(j,N,V,ie):null;case K:return V.key===ve?W(j,N,V,ie):null;case J:return ve=V._init,X(j,N,ve(V._payload),ie)}if(ut(V)||Q(V))return ve!==null?null:Z(j,N,V,ie,null);Vr(j,V)}return null}function ce(j,N,V,ie,ve){if(typeof ie=="string"&&ie!==""||typeof ie=="number")return j=j.get(V)||null,w(N,j,""+ie,ve);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case b:return j=j.get(ie.key===null?V:ie.key)||null,P(N,j,ie,ve);case K:return j=j.get(ie.key===null?V:ie.key)||null,W(N,j,ie,ve);case J:var Ee=ie._init;return ce(j,N,V,Ee(ie._payload),ve)}if(ut(ie)||Q(ie))return j=j.get(V)||null,Z(N,j,ie,ve,null);Vr(N,ie)}return null}function me(j,N,V,ie){for(var ve=null,Ee=null,xe=N,Te=N=0,ot=null;xe!==null&&Te<V.length;Te++){xe.index>Te?(ot=xe,xe=null):ot=xe.sibling;var be=X(j,xe,V[Te],ie);if(be===null){xe===null&&(xe=ot);break}n&&xe&&be.alternate===null&&r(j,xe),N=x(be,N,Te),Ee===null?ve=be:Ee.sibling=be,Ee=be,xe=ot}if(Te===V.length)return c(j,xe),Ke&&pn(j,Te),ve;if(xe===null){for(;Te<V.length;Te++)xe=ee(j,V[Te],ie),xe!==null&&(N=x(xe,N,Te),Ee===null?ve=xe:Ee.sibling=xe,Ee=xe);return Ke&&pn(j,Te),ve}for(xe=g(j,xe);Te<V.length;Te++)ot=ce(xe,j,Te,V[Te],ie),ot!==null&&(n&&ot.alternate!==null&&xe.delete(ot.key===null?Te:ot.key),N=x(ot,N,Te),Ee===null?ve=ot:Ee.sibling=ot,Ee=ot);return n&&xe.forEach(function(tn){return r(j,tn)}),Ke&&pn(j,Te),ve}function pe(j,N,V,ie){var ve=Q(V);if(typeof ve!="function")throw Error(t(150));if(V=ve.call(V),V==null)throw Error(t(151));for(var Ee=ve=null,xe=N,Te=N=0,ot=null,be=V.next();xe!==null&&!be.done;Te++,be=V.next()){xe.index>Te?(ot=xe,xe=null):ot=xe.sibling;var tn=X(j,xe,be.value,ie);if(tn===null){xe===null&&(xe=ot);break}n&&xe&&tn.alternate===null&&r(j,xe),N=x(tn,N,Te),Ee===null?ve=tn:Ee.sibling=tn,Ee=tn,xe=ot}if(be.done)return c(j,xe),Ke&&pn(j,Te),ve;if(xe===null){for(;!be.done;Te++,be=V.next())be=ee(j,be.value,ie),be!==null&&(N=x(be,N,Te),Ee===null?ve=be:Ee.sibling=be,Ee=be);return Ke&&pn(j,Te),ve}for(xe=g(j,xe);!be.done;Te++,be=V.next())be=ce(xe,j,Te,be.value,ie),be!==null&&(n&&be.alternate!==null&&xe.delete(be.key===null?Te:be.key),N=x(be,N,Te),Ee===null?ve=be:Ee.sibling=be,Ee=be);return n&&xe.forEach(function(ty){return r(j,ty)}),Ke&&pn(j,Te),ve}function Xe(j,N,V,ie){if(typeof V=="object"&&V!==null&&V.type===O&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case b:e:{for(var ve=V.key,Ee=N;Ee!==null;){if(Ee.key===ve){if(ve=V.type,ve===O){if(Ee.tag===7){c(j,Ee.sibling),N=y(Ee,V.props.children),N.return=j,j=N;break e}}else if(Ee.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===J&&Dd(ve)===Ee.type){c(j,Ee.sibling),N=y(Ee,V.props),N.ref=Gs(j,Ee,V),N.return=j,j=N;break e}c(j,Ee);break}else r(j,Ee);Ee=Ee.sibling}V.type===O?(N=Ln(V.props.children,j.mode,ie,V.key),N.return=j,j=N):(ie=ga(V.type,V.key,V.props,null,j.mode,ie),ie.ref=Gs(j,N,V),ie.return=j,j=ie)}return L(j);case K:e:{for(Ee=V.key;N!==null;){if(N.key===Ee)if(N.tag===4&&N.stateNode.containerInfo===V.containerInfo&&N.stateNode.implementation===V.implementation){c(j,N.sibling),N=y(N,V.children||[]),N.return=j,j=N;break e}else{c(j,N);break}else r(j,N);N=N.sibling}N=Hl(V,j.mode,ie),N.return=j,j=N}return L(j);case J:return Ee=V._init,Xe(j,N,Ee(V._payload),ie)}if(ut(V))return me(j,N,V,ie);if(Q(V))return pe(j,N,V,ie);Vr(j,V)}return typeof V=="string"&&V!==""||typeof V=="number"?(V=""+V,N!==null&&N.tag===6?(c(j,N.sibling),N=y(N,V),N.return=j,j=N):(c(j,N),N=Vl(V,j.mode,ie),N.return=j,j=N),L(j)):c(j,N)}return Xe}var Yn=bd(!0),Pd=bd(!1),Hr=Vi(null),Wr=null,qn=null,el=null;function tl(){el=qn=Wr=null}function il(n){var r=Hr.current;Ge(Hr),n._currentValue=r}function nl(n,r,c){for(;n!==null;){var g=n.alternate;if((n.childLanes&r)!==r?(n.childLanes|=r,g!==null&&(g.childLanes|=r)):g!==null&&(g.childLanes&r)!==r&&(g.childLanes|=r),n===c)break;n=n.return}}function Qn(n,r){Wr=n,el=qn=null,n=n.dependencies,n!==null&&n.firstContext!==null&&((n.lanes&r)!==0&&(It=!0),n.firstContext=null)}function Vt(n){var r=n._currentValue;if(el!==n)if(n={context:n,memoizedValue:r,next:null},qn===null){if(Wr===null)throw Error(t(308));qn=n,Wr.dependencies={lanes:0,firstContext:n}}else qn=qn.next=n;return r}var yn=null;function sl(n){yn===null?yn=[n]:yn.push(n)}function Od(n,r,c,g){var y=r.interleaved;return y===null?(c.next=c,sl(r)):(c.next=y.next,y.next=c),r.interleaved=c,Ri(n,g)}function Ri(n,r){n.lanes|=r;var c=n.alternate;for(c!==null&&(c.lanes|=r),c=n,n=n.return;n!==null;)n.childLanes|=r,c=n.alternate,c!==null&&(c.childLanes|=r),c=n,n=n.return;return c.tag===3?c.stateNode:null}var zi=!1;function rl(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Nd(n,r){n=n.updateQueue,r.updateQueue===n&&(r.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function _i(n,r){return{eventTime:n,lane:r,tag:0,payload:null,callback:null,next:null}}function Yi(n,r,c){var g=n.updateQueue;if(g===null)return null;if(g=g.shared,(De&2)!==0){var y=g.pending;return y===null?r.next=r:(r.next=y.next,y.next=r),g.pending=r,Ri(n,c)}return y=g.interleaved,y===null?(r.next=r,sl(g)):(r.next=y.next,y.next=r),g.interleaved=r,Ri(n,c)}function zr(n,r,c){if(r=r.updateQueue,r!==null&&(r=r.shared,(c&4194240)!==0)){var g=r.lanes;g&=n.pendingLanes,c|=g,r.lanes=c,Eo(n,c)}}function Md(n,r){var c=n.updateQueue,g=n.alternate;if(g!==null&&(g=g.updateQueue,c===g)){var y=null,x=null;if(c=c.firstBaseUpdate,c!==null){do{var L={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};x===null?y=x=L:x=x.next=L,c=c.next}while(c!==null);x===null?y=x=r:x=x.next=r}else y=x=r;c={baseState:g.baseState,firstBaseUpdate:y,lastBaseUpdate:x,shared:g.shared,effects:g.effects},n.updateQueue=c;return}n=c.lastBaseUpdate,n===null?c.firstBaseUpdate=r:n.next=r,c.lastBaseUpdate=r}function Yr(n,r,c,g){var y=n.updateQueue;zi=!1;var x=y.firstBaseUpdate,L=y.lastBaseUpdate,w=y.shared.pending;if(w!==null){y.shared.pending=null;var P=w,W=P.next;P.next=null,L===null?x=W:L.next=W,L=P;var Z=n.alternate;Z!==null&&(Z=Z.updateQueue,w=Z.lastBaseUpdate,w!==L&&(w===null?Z.firstBaseUpdate=W:w.next=W,Z.lastBaseUpdate=P))}if(x!==null){var ee=y.baseState;L=0,Z=W=P=null,w=x;do{var X=w.lane,ce=w.eventTime;if((g&X)===X){Z!==null&&(Z=Z.next={eventTime:ce,lane:0,tag:w.tag,payload:w.payload,callback:w.callback,next:null});e:{var me=n,pe=w;switch(X=r,ce=c,pe.tag){case 1:if(me=pe.payload,typeof me=="function"){ee=me.call(ce,ee,X);break e}ee=me;break e;case 3:me.flags=me.flags&-65537|128;case 0:if(me=pe.payload,X=typeof me=="function"?me.call(ce,ee,X):me,X==null)break e;ee=q({},ee,X);break e;case 2:zi=!0}}w.callback!==null&&w.lane!==0&&(n.flags|=64,X=y.effects,X===null?y.effects=[w]:X.push(w))}else ce={eventTime:ce,lane:X,tag:w.tag,payload:w.payload,callback:w.callback,next:null},Z===null?(W=Z=ce,P=ee):Z=Z.next=ce,L|=X;if(w=w.next,w===null){if(w=y.shared.pending,w===null)break;X=w,w=X.next,X.next=null,y.lastBaseUpdate=X,y.shared.pending=null}}while(!0);if(Z===null&&(P=ee),y.baseState=P,y.firstBaseUpdate=W,y.lastBaseUpdate=Z,r=y.shared.interleaved,r!==null){y=r;do L|=y.lane,y=y.next;while(y!==r)}else x===null&&(y.shared.lanes=0);xn|=L,n.lanes=L,n.memoizedState=ee}}function Fd(n,r,c){if(n=r.effects,r.effects=null,n!==null)for(r=0;r<n.length;r++){var g=n[r],y=g.callback;if(y!==null){if(g.callback=null,g=c,typeof y!="function")throw Error(t(191,y));y.call(g)}}}var js={},di=Vi(js),Ks=Vi(js),Vs=Vi(js);function vn(n){if(n===js)throw Error(t(174));return n}function al(n,r){switch(Ue(Vs,r),Ue(Ks,n),Ue(di,js),n=r.nodeType,n){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:Dn(null,"");break;default:n=n===8?r.parentNode:r,r=n.namespaceURI||null,n=n.tagName,r=Dn(r,n)}Ge(di),Ue(di,r)}function Xn(){Ge(di),Ge(Ks),Ge(Vs)}function Bd(n){vn(Vs.current);var r=vn(di.current),c=Dn(r,n.type);r!==c&&(Ue(Ks,n),Ue(di,c))}function ol(n){Ks.current===n&&(Ge(di),Ge(Ks))}var Ve=Vi(0);function qr(n){for(var r=n;r!==null;){if(r.tag===13){var c=r.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var ll=[];function ul(){for(var n=0;n<ll.length;n++)ll[n]._workInProgressVersionPrimary=null;ll.length=0}var Qr=C.ReactCurrentDispatcher,cl=C.ReactCurrentBatchConfig,En=0,He=null,tt=null,rt=null,Xr=!1,Hs=!1,Ws=0,A0=0;function pt(){throw Error(t(321))}function dl(n,r){if(r===null)return!1;for(var c=0;c<r.length&&c<n.length;c++)if(!ei(n[c],r[c]))return!1;return!0}function hl(n,r,c,g,y,x){if(En=x,He=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,Qr.current=n===null||n.memoizedState===null?_0:k0,n=c(g,y),Hs){x=0;do{if(Hs=!1,Ws=0,25<=x)throw Error(t(301));x+=1,rt=tt=null,r.updateQueue=null,Qr.current=w0,n=c(g,y)}while(Hs)}if(Qr.current=ea,r=tt!==null&&tt.next!==null,En=0,rt=tt=He=null,Xr=!1,r)throw Error(t(300));return n}function fl(){var n=Ws!==0;return Ws=0,n}function hi(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rt===null?He.memoizedState=rt=n:rt=rt.next=n,rt}function Ht(){if(tt===null){var n=He.alternate;n=n!==null?n.memoizedState:null}else n=tt.next;var r=rt===null?He.memoizedState:rt.next;if(r!==null)rt=r,tt=n;else{if(n===null)throw Error(t(310));tt=n,n={memoizedState:tt.memoizedState,baseState:tt.baseState,baseQueue:tt.baseQueue,queue:tt.queue,next:null},rt===null?He.memoizedState=rt=n:rt=rt.next=n}return rt}function zs(n,r){return typeof r=="function"?r(n):r}function gl(n){var r=Ht(),c=r.queue;if(c===null)throw Error(t(311));c.lastRenderedReducer=n;var g=tt,y=g.baseQueue,x=c.pending;if(x!==null){if(y!==null){var L=y.next;y.next=x.next,x.next=L}g.baseQueue=y=x,c.pending=null}if(y!==null){x=y.next,g=g.baseState;var w=L=null,P=null,W=x;do{var Z=W.lane;if((En&Z)===Z)P!==null&&(P=P.next={lane:0,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null}),g=W.hasEagerState?W.eagerState:n(g,W.action);else{var ee={lane:Z,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null};P===null?(w=P=ee,L=g):P=P.next=ee,He.lanes|=Z,xn|=Z}W=W.next}while(W!==null&&W!==x);P===null?L=g:P.next=w,ei(g,r.memoizedState)||(It=!0),r.memoizedState=g,r.baseState=L,r.baseQueue=P,c.lastRenderedState=g}if(n=c.interleaved,n!==null){y=n;do x=y.lane,He.lanes|=x,xn|=x,y=y.next;while(y!==n)}else y===null&&(c.lanes=0);return[r.memoizedState,c.dispatch]}function ml(n){var r=Ht(),c=r.queue;if(c===null)throw Error(t(311));c.lastRenderedReducer=n;var g=c.dispatch,y=c.pending,x=r.memoizedState;if(y!==null){c.pending=null;var L=y=y.next;do x=n(x,L.action),L=L.next;while(L!==y);ei(x,r.memoizedState)||(It=!0),r.memoizedState=x,r.baseQueue===null&&(r.baseState=x),c.lastRenderedState=x}return[x,g]}function Ud(){}function $d(n,r){var c=He,g=Ht(),y=r(),x=!ei(g.memoizedState,y);if(x&&(g.memoizedState=y,It=!0),g=g.queue,pl(Kd.bind(null,c,g,n),[n]),g.getSnapshot!==r||x||rt!==null&&rt.memoizedState.tag&1){if(c.flags|=2048,Ys(9,jd.bind(null,c,g,y,r),void 0,null),at===null)throw Error(t(349));(En&30)!==0||Gd(c,r,y)}return y}function Gd(n,r,c){n.flags|=16384,n={getSnapshot:r,value:c},r=He.updateQueue,r===null?(r={lastEffect:null,stores:null},He.updateQueue=r,r.stores=[n]):(c=r.stores,c===null?r.stores=[n]:c.push(n))}function jd(n,r,c,g){r.value=c,r.getSnapshot=g,Vd(r)&&Hd(n)}function Kd(n,r,c){return c(function(){Vd(r)&&Hd(n)})}function Vd(n){var r=n.getSnapshot;n=n.value;try{var c=r();return!ei(n,c)}catch{return!0}}function Hd(n){var r=Ri(n,1);r!==null&&ri(r,n,1,-1)}function Wd(n){var r=hi();return typeof n=="function"&&(n=n()),r.memoizedState=r.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:zs,lastRenderedState:n},r.queue=n,n=n.dispatch=R0.bind(null,He,n),[r.memoizedState,n]}function Ys(n,r,c,g){return n={tag:n,create:r,destroy:c,deps:g,next:null},r=He.updateQueue,r===null?(r={lastEffect:null,stores:null},He.updateQueue=r,r.lastEffect=n.next=n):(c=r.lastEffect,c===null?r.lastEffect=n.next=n:(g=c.next,c.next=n,n.next=g,r.lastEffect=n)),n}function zd(){return Ht().memoizedState}function Zr(n,r,c,g){var y=hi();He.flags|=n,y.memoizedState=Ys(1|r,c,void 0,g===void 0?null:g)}function Jr(n,r,c,g){var y=Ht();g=g===void 0?null:g;var x=void 0;if(tt!==null){var L=tt.memoizedState;if(x=L.destroy,g!==null&&dl(g,L.deps)){y.memoizedState=Ys(r,c,x,g);return}}He.flags|=n,y.memoizedState=Ys(1|r,c,x,g)}function Yd(n,r){return Zr(8390656,8,n,r)}function pl(n,r){return Jr(2048,8,n,r)}function qd(n,r){return Jr(4,2,n,r)}function Qd(n,r){return Jr(4,4,n,r)}function Xd(n,r){if(typeof r=="function")return n=n(),r(n),function(){r(null)};if(r!=null)return n=n(),r.current=n,function(){r.current=null}}function Zd(n,r,c){return c=c!=null?c.concat([n]):null,Jr(4,4,Xd.bind(null,r,n),c)}function yl(){}function Jd(n,r){var c=Ht();r=r===void 0?null:r;var g=c.memoizedState;return g!==null&&r!==null&&dl(r,g[1])?g[0]:(c.memoizedState=[n,r],n)}function eh(n,r){var c=Ht();r=r===void 0?null:r;var g=c.memoizedState;return g!==null&&r!==null&&dl(r,g[1])?g[0]:(n=n(),c.memoizedState=[n,r],n)}function th(n,r,c){return(En&21)===0?(n.baseState&&(n.baseState=!1,It=!0),n.memoizedState=c):(ei(c,r)||(c=Dc(),He.lanes|=c,xn|=c,n.baseState=!0),r)}function L0(n,r){var c=Pe;Pe=c!==0&&4>c?c:4,n(!0);var g=cl.transition;cl.transition={};try{n(!1),r()}finally{Pe=c,cl.transition=g}}function ih(){return Ht().memoizedState}function I0(n,r,c){var g=Zi(n);if(c={lane:g,action:c,hasEagerState:!1,eagerState:null,next:null},nh(n))sh(r,c);else if(c=Od(n,r,c,g),c!==null){var y=St();ri(c,n,g,y),rh(c,r,g)}}function R0(n,r,c){var g=Zi(n),y={lane:g,action:c,hasEagerState:!1,eagerState:null,next:null};if(nh(n))sh(r,y);else{var x=n.alternate;if(n.lanes===0&&(x===null||x.lanes===0)&&(x=r.lastRenderedReducer,x!==null))try{var L=r.lastRenderedState,w=x(L,c);if(y.hasEagerState=!0,y.eagerState=w,ei(w,L)){var P=r.interleaved;P===null?(y.next=y,sl(r)):(y.next=P.next,P.next=y),r.interleaved=y;return}}catch{}finally{}c=Od(n,r,y,g),c!==null&&(y=St(),ri(c,n,g,y),rh(c,r,g))}}function nh(n){var r=n.alternate;return n===He||r!==null&&r===He}function sh(n,r){Hs=Xr=!0;var c=n.pending;c===null?r.next=r:(r.next=c.next,c.next=r),n.pending=r}function rh(n,r,c){if((c&4194240)!==0){var g=r.lanes;g&=n.pendingLanes,c|=g,r.lanes=c,Eo(n,c)}}var ea={readContext:Vt,useCallback:pt,useContext:pt,useEffect:pt,useImperativeHandle:pt,useInsertionEffect:pt,useLayoutEffect:pt,useMemo:pt,useReducer:pt,useRef:pt,useState:pt,useDebugValue:pt,useDeferredValue:pt,useTransition:pt,useMutableSource:pt,useSyncExternalStore:pt,useId:pt,unstable_isNewReconciler:!1},_0={readContext:Vt,useCallback:function(n,r){return hi().memoizedState=[n,r===void 0?null:r],n},useContext:Vt,useEffect:Yd,useImperativeHandle:function(n,r,c){return c=c!=null?c.concat([n]):null,Zr(4194308,4,Xd.bind(null,r,n),c)},useLayoutEffect:function(n,r){return Zr(4194308,4,n,r)},useInsertionEffect:function(n,r){return Zr(4,2,n,r)},useMemo:function(n,r){var c=hi();return r=r===void 0?null:r,n=n(),c.memoizedState=[n,r],n},useReducer:function(n,r,c){var g=hi();return r=c!==void 0?c(r):r,g.memoizedState=g.baseState=r,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:r},g.queue=n,n=n.dispatch=I0.bind(null,He,n),[g.memoizedState,n]},useRef:function(n){var r=hi();return n={current:n},r.memoizedState=n},useState:Wd,useDebugValue:yl,useDeferredValue:function(n){return hi().memoizedState=n},useTransition:function(){var n=Wd(!1),r=n[0];return n=L0.bind(null,n[1]),hi().memoizedState=n,[r,n]},useMutableSource:function(){},useSyncExternalStore:function(n,r,c){var g=He,y=hi();if(Ke){if(c===void 0)throw Error(t(407));c=c()}else{if(c=r(),at===null)throw Error(t(349));(En&30)!==0||Gd(g,r,c)}y.memoizedState=c;var x={value:c,getSnapshot:r};return y.queue=x,Yd(Kd.bind(null,g,x,n),[n]),g.flags|=2048,Ys(9,jd.bind(null,g,x,c,r),void 0,null),c},useId:function(){var n=hi(),r=at.identifierPrefix;if(Ke){var c=Ii,g=Li;c=(g&~(1<<32-Jt(g)-1)).toString(32)+c,r=":"+r+"R"+c,c=Ws++,0<c&&(r+="H"+c.toString(32)),r+=":"}else c=A0++,r=":"+r+"r"+c.toString(32)+":";return n.memoizedState=r},unstable_isNewReconciler:!1},k0={readContext:Vt,useCallback:Jd,useContext:Vt,useEffect:pl,useImperativeHandle:Zd,useInsertionEffect:qd,useLayoutEffect:Qd,useMemo:eh,useReducer:gl,useRef:zd,useState:function(){return gl(zs)},useDebugValue:yl,useDeferredValue:function(n){var r=Ht();return th(r,tt.memoizedState,n)},useTransition:function(){var n=gl(zs)[0],r=Ht().memoizedState;return[n,r]},useMutableSource:Ud,useSyncExternalStore:$d,useId:ih,unstable_isNewReconciler:!1},w0={readContext:Vt,useCallback:Jd,useContext:Vt,useEffect:pl,useImperativeHandle:Zd,useInsertionEffect:qd,useLayoutEffect:Qd,useMemo:eh,useReducer:ml,useRef:zd,useState:function(){return ml(zs)},useDebugValue:yl,useDeferredValue:function(n){var r=Ht();return tt===null?r.memoizedState=n:th(r,tt.memoizedState,n)},useTransition:function(){var n=ml(zs)[0],r=Ht().memoizedState;return[n,r]},useMutableSource:Ud,useSyncExternalStore:$d,useId:ih,unstable_isNewReconciler:!1};function ii(n,r){if(n&&n.defaultProps){r=q({},r),n=n.defaultProps;for(var c in n)r[c]===void 0&&(r[c]=n[c]);return r}return r}function vl(n,r,c,g){r=n.memoizedState,c=c(g,r),c=c==null?r:q({},r,c),n.memoizedState=c,n.lanes===0&&(n.updateQueue.baseState=c)}var ta={isMounted:function(n){return(n=n._reactInternals)?hn(n)===n:!1},enqueueSetState:function(n,r,c){n=n._reactInternals;var g=St(),y=Zi(n),x=_i(g,y);x.payload=r,c!=null&&(x.callback=c),r=Yi(n,x,y),r!==null&&(ri(r,n,y,g),zr(r,n,y))},enqueueReplaceState:function(n,r,c){n=n._reactInternals;var g=St(),y=Zi(n),x=_i(g,y);x.tag=1,x.payload=r,c!=null&&(x.callback=c),r=Yi(n,x,y),r!==null&&(ri(r,n,y,g),zr(r,n,y))},enqueueForceUpdate:function(n,r){n=n._reactInternals;var c=St(),g=Zi(n),y=_i(c,g);y.tag=2,r!=null&&(y.callback=r),r=Yi(n,y,g),r!==null&&(ri(r,n,g,c),zr(r,n,g))}};function ah(n,r,c,g,y,x,L){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(g,x,L):r.prototype&&r.prototype.isPureReactComponent?!Os(c,g)||!Os(y,x):!0}function oh(n,r,c){var g=!1,y=Hi,x=r.contextType;return typeof x=="object"&&x!==null?x=Vt(x):(y=Lt(r)?gn:mt.current,g=r.contextTypes,x=(g=g!=null)?Vn(n,y):Hi),r=new r(c,x),n.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=ta,n.stateNode=r,r._reactInternals=n,g&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=y,n.__reactInternalMemoizedMaskedChildContext=x),r}function lh(n,r,c,g){n=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(c,g),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(c,g),r.state!==n&&ta.enqueueReplaceState(r,r.state,null)}function El(n,r,c,g){var y=n.stateNode;y.props=c,y.state=n.memoizedState,y.refs={},rl(n);var x=r.contextType;typeof x=="object"&&x!==null?y.context=Vt(x):(x=Lt(r)?gn:mt.current,y.context=Vn(n,x)),y.state=n.memoizedState,x=r.getDerivedStateFromProps,typeof x=="function"&&(vl(n,r,x,c),y.state=n.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(r=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),r!==y.state&&ta.enqueueReplaceState(y,y.state,null),Yr(n,c,y,g),y.state=n.memoizedState),typeof y.componentDidMount=="function"&&(n.flags|=4194308)}function Zn(n,r){try{var c="",g=r;do c+=ue(g),g=g.return;while(g);var y=c}catch(x){y=`
Error generating stack: `+x.message+`
`+x.stack}return{value:n,source:r,stack:y,digest:null}}function xl(n,r,c){return{value:n,source:null,stack:c??null,digest:r??null}}function Sl(n,r){try{console.error(r.value)}catch(c){setTimeout(function(){throw c})}}var C0=typeof WeakMap=="function"?WeakMap:Map;function uh(n,r,c){c=_i(-1,c),c.tag=3,c.payload={element:null};var g=r.value;return c.callback=function(){la||(la=!0,Ml=g),Sl(n,r)},c}function ch(n,r,c){c=_i(-1,c),c.tag=3;var g=n.type.getDerivedStateFromError;if(typeof g=="function"){var y=r.value;c.payload=function(){return g(y)},c.callback=function(){Sl(n,r)}}var x=n.stateNode;return x!==null&&typeof x.componentDidCatch=="function"&&(c.callback=function(){Sl(n,r),typeof g!="function"&&(Qi===null?Qi=new Set([this]):Qi.add(this));var L=r.stack;this.componentDidCatch(r.value,{componentStack:L!==null?L:""})}),c}function dh(n,r,c){var g=n.pingCache;if(g===null){g=n.pingCache=new C0;var y=new Set;g.set(r,y)}else y=g.get(r),y===void 0&&(y=new Set,g.set(r,y));y.has(c)||(y.add(c),n=V0.bind(null,n,r,c),r.then(n,n))}function hh(n){do{var r;if((r=n.tag===13)&&(r=n.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return n;n=n.return}while(n!==null);return null}function fh(n,r,c,g,y){return(n.mode&1)===0?(n===r?n.flags|=65536:(n.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(r=_i(-1,1),r.tag=2,Yi(c,r,1))),c.lanes|=1),n):(n.flags|=65536,n.lanes=y,n)}var D0=C.ReactCurrentOwner,It=!1;function xt(n,r,c,g){r.child=n===null?Pd(r,null,c,g):Yn(r,n.child,c,g)}function gh(n,r,c,g,y){c=c.render;var x=r.ref;return Qn(r,y),g=hl(n,r,c,g,x,y),c=fl(),n!==null&&!It?(r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~y,ki(n,r,y)):(Ke&&c&&qo(r),r.flags|=1,xt(n,r,g,y),r.child)}function mh(n,r,c,g,y){if(n===null){var x=c.type;return typeof x=="function"&&!Kl(x)&&x.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(r.tag=15,r.type=x,ph(n,r,x,g,y)):(n=ga(c.type,null,g,r,r.mode,y),n.ref=r.ref,n.return=r,r.child=n)}if(x=n.child,(n.lanes&y)===0){var L=x.memoizedProps;if(c=c.compare,c=c!==null?c:Os,c(L,g)&&n.ref===r.ref)return ki(n,r,y)}return r.flags|=1,n=en(x,g),n.ref=r.ref,n.return=r,r.child=n}function ph(n,r,c,g,y){if(n!==null){var x=n.memoizedProps;if(Os(x,g)&&n.ref===r.ref)if(It=!1,r.pendingProps=g=x,(n.lanes&y)!==0)(n.flags&131072)!==0&&(It=!0);else return r.lanes=n.lanes,ki(n,r,y)}return Tl(n,r,c,g,y)}function yh(n,r,c){var g=r.pendingProps,y=g.children,x=n!==null?n.memoizedState:null;if(g.mode==="hidden")if((r.mode&1)===0)r.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ue(es,Nt),Nt|=c;else{if((c&1073741824)===0)return n=x!==null?x.baseLanes|c:c,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:n,cachePool:null,transitions:null},r.updateQueue=null,Ue(es,Nt),Nt|=n,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},g=x!==null?x.baseLanes:c,Ue(es,Nt),Nt|=g}else x!==null?(g=x.baseLanes|c,r.memoizedState=null):g=c,Ue(es,Nt),Nt|=g;return xt(n,r,y,c),r.child}function vh(n,r){var c=r.ref;(n===null&&c!==null||n!==null&&n.ref!==c)&&(r.flags|=512,r.flags|=2097152)}function Tl(n,r,c,g,y){var x=Lt(c)?gn:mt.current;return x=Vn(r,x),Qn(r,y),c=hl(n,r,c,g,x,y),g=fl(),n!==null&&!It?(r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~y,ki(n,r,y)):(Ke&&g&&qo(r),r.flags|=1,xt(n,r,c,y),r.child)}function Eh(n,r,c,g,y){if(Lt(c)){var x=!0;Ur(r)}else x=!1;if(Qn(r,y),r.stateNode===null)na(n,r),oh(r,c,g),El(r,c,g,y),g=!0;else if(n===null){var L=r.stateNode,w=r.memoizedProps;L.props=w;var P=L.context,W=c.contextType;typeof W=="object"&&W!==null?W=Vt(W):(W=Lt(c)?gn:mt.current,W=Vn(r,W));var Z=c.getDerivedStateFromProps,ee=typeof Z=="function"||typeof L.getSnapshotBeforeUpdate=="function";ee||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(w!==g||P!==W)&&lh(r,L,g,W),zi=!1;var X=r.memoizedState;L.state=X,Yr(r,g,L,y),P=r.memoizedState,w!==g||X!==P||At.current||zi?(typeof Z=="function"&&(vl(r,c,Z,g),P=r.memoizedState),(w=zi||ah(r,c,w,g,X,P,W))?(ee||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount()),typeof L.componentDidMount=="function"&&(r.flags|=4194308)):(typeof L.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=g,r.memoizedState=P),L.props=g,L.state=P,L.context=W,g=w):(typeof L.componentDidMount=="function"&&(r.flags|=4194308),g=!1)}else{L=r.stateNode,Nd(n,r),w=r.memoizedProps,W=r.type===r.elementType?w:ii(r.type,w),L.props=W,ee=r.pendingProps,X=L.context,P=c.contextType,typeof P=="object"&&P!==null?P=Vt(P):(P=Lt(c)?gn:mt.current,P=Vn(r,P));var ce=c.getDerivedStateFromProps;(Z=typeof ce=="function"||typeof L.getSnapshotBeforeUpdate=="function")||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(w!==ee||X!==P)&&lh(r,L,g,P),zi=!1,X=r.memoizedState,L.state=X,Yr(r,g,L,y);var me=r.memoizedState;w!==ee||X!==me||At.current||zi?(typeof ce=="function"&&(vl(r,c,ce,g),me=r.memoizedState),(W=zi||ah(r,c,W,g,X,me,P)||!1)?(Z||typeof L.UNSAFE_componentWillUpdate!="function"&&typeof L.componentWillUpdate!="function"||(typeof L.componentWillUpdate=="function"&&L.componentWillUpdate(g,me,P),typeof L.UNSAFE_componentWillUpdate=="function"&&L.UNSAFE_componentWillUpdate(g,me,P)),typeof L.componentDidUpdate=="function"&&(r.flags|=4),typeof L.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof L.componentDidUpdate!="function"||w===n.memoizedProps&&X===n.memoizedState||(r.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||w===n.memoizedProps&&X===n.memoizedState||(r.flags|=1024),r.memoizedProps=g,r.memoizedState=me),L.props=g,L.state=me,L.context=P,g=W):(typeof L.componentDidUpdate!="function"||w===n.memoizedProps&&X===n.memoizedState||(r.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||w===n.memoizedProps&&X===n.memoizedState||(r.flags|=1024),g=!1)}return Al(n,r,c,g,x,y)}function Al(n,r,c,g,y,x){vh(n,r);var L=(r.flags&128)!==0;if(!g&&!L)return y&&Ld(r,c,!1),ki(n,r,x);g=r.stateNode,D0.current=r;var w=L&&typeof c.getDerivedStateFromError!="function"?null:g.render();return r.flags|=1,n!==null&&L?(r.child=Yn(r,n.child,null,x),r.child=Yn(r,null,w,x)):xt(n,r,w,x),r.memoizedState=g.state,y&&Ld(r,c,!0),r.child}function xh(n){var r=n.stateNode;r.pendingContext?Td(n,r.pendingContext,r.pendingContext!==r.context):r.context&&Td(n,r.context,!1),al(n,r.containerInfo)}function Sh(n,r,c,g,y){return zn(),Jo(y),r.flags|=256,xt(n,r,c,g),r.child}var Ll={dehydrated:null,treeContext:null,retryLane:0};function Il(n){return{baseLanes:n,cachePool:null,transitions:null}}function Th(n,r,c){var g=r.pendingProps,y=Ve.current,x=!1,L=(r.flags&128)!==0,w;if((w=L)||(w=n!==null&&n.memoizedState===null?!1:(y&2)!==0),w?(x=!0,r.flags&=-129):(n===null||n.memoizedState!==null)&&(y|=1),Ue(Ve,y&1),n===null)return Zo(r),n=r.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?((r.mode&1)===0?r.lanes=1:n.data==="$!"?r.lanes=8:r.lanes=1073741824,null):(L=g.children,n=g.fallback,x?(g=r.mode,x=r.child,L={mode:"hidden",children:L},(g&1)===0&&x!==null?(x.childLanes=0,x.pendingProps=L):x=ma(L,g,0,null),n=Ln(n,g,c,null),x.return=r,n.return=r,x.sibling=n,r.child=x,r.child.memoizedState=Il(c),r.memoizedState=Ll,n):Rl(r,L));if(y=n.memoizedState,y!==null&&(w=y.dehydrated,w!==null))return b0(n,r,L,g,w,y,c);if(x){x=g.fallback,L=r.mode,y=n.child,w=y.sibling;var P={mode:"hidden",children:g.children};return(L&1)===0&&r.child!==y?(g=r.child,g.childLanes=0,g.pendingProps=P,r.deletions=null):(g=en(y,P),g.subtreeFlags=y.subtreeFlags&14680064),w!==null?x=en(w,x):(x=Ln(x,L,c,null),x.flags|=2),x.return=r,g.return=r,g.sibling=x,r.child=g,g=x,x=r.child,L=n.child.memoizedState,L=L===null?Il(c):{baseLanes:L.baseLanes|c,cachePool:null,transitions:L.transitions},x.memoizedState=L,x.childLanes=n.childLanes&~c,r.memoizedState=Ll,g}return x=n.child,n=x.sibling,g=en(x,{mode:"visible",children:g.children}),(r.mode&1)===0&&(g.lanes=c),g.return=r,g.sibling=null,n!==null&&(c=r.deletions,c===null?(r.deletions=[n],r.flags|=16):c.push(n)),r.child=g,r.memoizedState=null,g}function Rl(n,r){return r=ma({mode:"visible",children:r},n.mode,0,null),r.return=n,n.child=r}function ia(n,r,c,g){return g!==null&&Jo(g),Yn(r,n.child,null,c),n=Rl(r,r.pendingProps.children),n.flags|=2,r.memoizedState=null,n}function b0(n,r,c,g,y,x,L){if(c)return r.flags&256?(r.flags&=-257,g=xl(Error(t(422))),ia(n,r,L,g)):r.memoizedState!==null?(r.child=n.child,r.flags|=128,null):(x=g.fallback,y=r.mode,g=ma({mode:"visible",children:g.children},y,0,null),x=Ln(x,y,L,null),x.flags|=2,g.return=r,x.return=r,g.sibling=x,r.child=g,(r.mode&1)!==0&&Yn(r,n.child,null,L),r.child.memoizedState=Il(L),r.memoizedState=Ll,x);if((r.mode&1)===0)return ia(n,r,L,null);if(y.data==="$!"){if(g=y.nextSibling&&y.nextSibling.dataset,g)var w=g.dgst;return g=w,x=Error(t(419)),g=xl(x,g,void 0),ia(n,r,L,g)}if(w=(L&n.childLanes)!==0,It||w){if(g=at,g!==null){switch(L&-L){case 4:y=2;break;case 16:y=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:y=32;break;case 536870912:y=268435456;break;default:y=0}y=(y&(g.suspendedLanes|L))!==0?0:y,y!==0&&y!==x.retryLane&&(x.retryLane=y,Ri(n,y),ri(g,n,y,-1))}return jl(),g=xl(Error(t(421))),ia(n,r,L,g)}return y.data==="$?"?(r.flags|=128,r.child=n.child,r=H0.bind(null,n),y._reactRetry=r,null):(n=x.treeContext,Ot=Ki(y.nextSibling),Pt=r,Ke=!0,ti=null,n!==null&&(jt[Kt++]=Li,jt[Kt++]=Ii,jt[Kt++]=mn,Li=n.id,Ii=n.overflow,mn=r),r=Rl(r,g.children),r.flags|=4096,r)}function Ah(n,r,c){n.lanes|=r;var g=n.alternate;g!==null&&(g.lanes|=r),nl(n.return,r,c)}function _l(n,r,c,g,y){var x=n.memoizedState;x===null?n.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:g,tail:c,tailMode:y}:(x.isBackwards=r,x.rendering=null,x.renderingStartTime=0,x.last=g,x.tail=c,x.tailMode=y)}function Lh(n,r,c){var g=r.pendingProps,y=g.revealOrder,x=g.tail;if(xt(n,r,g.children,c),g=Ve.current,(g&2)!==0)g=g&1|2,r.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=r.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Ah(n,c,r);else if(n.tag===19)Ah(n,c,r);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===r)break e;for(;n.sibling===null;){if(n.return===null||n.return===r)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}g&=1}if(Ue(Ve,g),(r.mode&1)===0)r.memoizedState=null;else switch(y){case"forwards":for(c=r.child,y=null;c!==null;)n=c.alternate,n!==null&&qr(n)===null&&(y=c),c=c.sibling;c=y,c===null?(y=r.child,r.child=null):(y=c.sibling,c.sibling=null),_l(r,!1,y,c,x);break;case"backwards":for(c=null,y=r.child,r.child=null;y!==null;){if(n=y.alternate,n!==null&&qr(n)===null){r.child=y;break}n=y.sibling,y.sibling=c,c=y,y=n}_l(r,!0,c,null,x);break;case"together":_l(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function na(n,r){(r.mode&1)===0&&n!==null&&(n.alternate=null,r.alternate=null,r.flags|=2)}function ki(n,r,c){if(n!==null&&(r.dependencies=n.dependencies),xn|=r.lanes,(c&r.childLanes)===0)return null;if(n!==null&&r.child!==n.child)throw Error(t(153));if(r.child!==null){for(n=r.child,c=en(n,n.pendingProps),r.child=c,c.return=r;n.sibling!==null;)n=n.sibling,c=c.sibling=en(n,n.pendingProps),c.return=r;c.sibling=null}return r.child}function P0(n,r,c){switch(r.tag){case 3:xh(r),zn();break;case 5:Bd(r);break;case 1:Lt(r.type)&&Ur(r);break;case 4:al(r,r.stateNode.containerInfo);break;case 10:var g=r.type._context,y=r.memoizedProps.value;Ue(Hr,g._currentValue),g._currentValue=y;break;case 13:if(g=r.memoizedState,g!==null)return g.dehydrated!==null?(Ue(Ve,Ve.current&1),r.flags|=128,null):(c&r.child.childLanes)!==0?Th(n,r,c):(Ue(Ve,Ve.current&1),n=ki(n,r,c),n!==null?n.sibling:null);Ue(Ve,Ve.current&1);break;case 19:if(g=(c&r.childLanes)!==0,(n.flags&128)!==0){if(g)return Lh(n,r,c);r.flags|=128}if(y=r.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),Ue(Ve,Ve.current),g)break;return null;case 22:case 23:return r.lanes=0,yh(n,r,c)}return ki(n,r,c)}var Ih,kl,Rh,_h;Ih=function(n,r){for(var c=r.child;c!==null;){if(c.tag===5||c.tag===6)n.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===r)break;for(;c.sibling===null;){if(c.return===null||c.return===r)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},kl=function(){},Rh=function(n,r,c,g){var y=n.memoizedProps;if(y!==g){n=r.stateNode,vn(di.current);var x=null;switch(c){case"input":y=cn(n,y),g=cn(n,g),x=[];break;case"select":y=q({},y,{value:void 0}),g=q({},g,{value:void 0}),x=[];break;case"textarea":y=Xt(n,y),g=Xt(n,g),x=[];break;default:typeof y.onClick!="function"&&typeof g.onClick=="function"&&(n.onclick=Mr)}oo(c,g);var L;c=null;for(W in y)if(!g.hasOwnProperty(W)&&y.hasOwnProperty(W)&&y[W]!=null)if(W==="style"){var w=y[W];for(L in w)w.hasOwnProperty(L)&&(c||(c={}),c[L]="")}else W!=="dangerouslySetInnerHTML"&&W!=="children"&&W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&W!=="autoFocus"&&(s.hasOwnProperty(W)?x||(x=[]):(x=x||[]).push(W,null));for(W in g){var P=g[W];if(w=y!=null?y[W]:void 0,g.hasOwnProperty(W)&&P!==w&&(P!=null||w!=null))if(W==="style")if(w){for(L in w)!w.hasOwnProperty(L)||P&&P.hasOwnProperty(L)||(c||(c={}),c[L]="");for(L in P)P.hasOwnProperty(L)&&w[L]!==P[L]&&(c||(c={}),c[L]=P[L])}else c||(x||(x=[]),x.push(W,c)),c=P;else W==="dangerouslySetInnerHTML"?(P=P?P.__html:void 0,w=w?w.__html:void 0,P!=null&&w!==P&&(x=x||[]).push(W,P)):W==="children"?typeof P!="string"&&typeof P!="number"||(x=x||[]).push(W,""+P):W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&(s.hasOwnProperty(W)?(P!=null&&W==="onScroll"&&$e("scroll",n),x||w===P||(x=[])):(x=x||[]).push(W,P))}c&&(x=x||[]).push("style",c);var W=x;(r.updateQueue=W)&&(r.flags|=4)}},_h=function(n,r,c,g){c!==g&&(r.flags|=4)};function qs(n,r){if(!Ke)switch(n.tailMode){case"hidden":r=n.tail;for(var c=null;r!==null;)r.alternate!==null&&(c=r),r=r.sibling;c===null?n.tail=null:c.sibling=null;break;case"collapsed":c=n.tail;for(var g=null;c!==null;)c.alternate!==null&&(g=c),c=c.sibling;g===null?r||n.tail===null?n.tail=null:n.tail.sibling=null:g.sibling=null}}function yt(n){var r=n.alternate!==null&&n.alternate.child===n.child,c=0,g=0;if(r)for(var y=n.child;y!==null;)c|=y.lanes|y.childLanes,g|=y.subtreeFlags&14680064,g|=y.flags&14680064,y.return=n,y=y.sibling;else for(y=n.child;y!==null;)c|=y.lanes|y.childLanes,g|=y.subtreeFlags,g|=y.flags,y.return=n,y=y.sibling;return n.subtreeFlags|=g,n.childLanes=c,r}function O0(n,r,c){var g=r.pendingProps;switch(Qo(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yt(r),null;case 1:return Lt(r.type)&&Br(),yt(r),null;case 3:return g=r.stateNode,Xn(),Ge(At),Ge(mt),ul(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(n===null||n.child===null)&&(Kr(r)?r.flags|=4:n===null||n.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,ti!==null&&(Ul(ti),ti=null))),kl(n,r),yt(r),null;case 5:ol(r);var y=vn(Vs.current);if(c=r.type,n!==null&&r.stateNode!=null)Rh(n,r,c,g,y),n.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!g){if(r.stateNode===null)throw Error(t(166));return yt(r),null}if(n=vn(di.current),Kr(r)){g=r.stateNode,c=r.type;var x=r.memoizedProps;switch(g[ci]=r,g[Us]=x,n=(r.mode&1)!==0,c){case"dialog":$e("cancel",g),$e("close",g);break;case"iframe":case"object":case"embed":$e("load",g);break;case"video":case"audio":for(y=0;y<Ms.length;y++)$e(Ms[y],g);break;case"source":$e("error",g);break;case"img":case"image":case"link":$e("error",g),$e("load",g);break;case"details":$e("toggle",g);break;case"input":ao(g,x),$e("invalid",g);break;case"select":g._wrapperState={wasMultiple:!!x.multiple},$e("invalid",g);break;case"textarea":ps(g,x),$e("invalid",g)}oo(c,x),y=null;for(var L in x)if(x.hasOwnProperty(L)){var w=x[L];L==="children"?typeof w=="string"?g.textContent!==w&&(x.suppressHydrationWarning!==!0&&Nr(g.textContent,w,n),y=["children",w]):typeof w=="number"&&g.textContent!==""+w&&(x.suppressHydrationWarning!==!0&&Nr(g.textContent,w,n),y=["children",""+w]):s.hasOwnProperty(L)&&w!=null&&L==="onScroll"&&$e("scroll",g)}switch(c){case"input":Gt(g),Et(g,x,!0);break;case"textarea":Gt(g),ys(g);break;case"select":case"option":break;default:typeof x.onClick=="function"&&(g.onclick=Mr)}g=y,r.updateQueue=g,g!==null&&(r.flags|=4)}else{L=y.nodeType===9?y:y.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Ni(c)),n==="http://www.w3.org/1999/xhtml"?c==="script"?(n=L.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof g.is=="string"?n=L.createElement(c,{is:g.is}):(n=L.createElement(c),c==="select"&&(L=n,g.multiple?L.multiple=!0:g.size&&(L.size=g.size))):n=L.createElementNS(n,c),n[ci]=r,n[Us]=g,Ih(n,r,!1,!1),r.stateNode=n;e:{switch(L=lo(c,g),c){case"dialog":$e("cancel",n),$e("close",n),y=g;break;case"iframe":case"object":case"embed":$e("load",n),y=g;break;case"video":case"audio":for(y=0;y<Ms.length;y++)$e(Ms[y],n);y=g;break;case"source":$e("error",n),y=g;break;case"img":case"image":case"link":$e("error",n),$e("load",n),y=g;break;case"details":$e("toggle",n),y=g;break;case"input":ao(n,g),y=cn(n,g),$e("invalid",n);break;case"option":y=g;break;case"select":n._wrapperState={wasMultiple:!!g.multiple},y=q({},g,{value:void 0}),$e("invalid",n);break;case"textarea":ps(n,g),y=Xt(n,g),$e("invalid",n);break;default:y=g}oo(c,y),w=y;for(x in w)if(w.hasOwnProperty(x)){var P=w[x];x==="style"?pc(n,P):x==="dangerouslySetInnerHTML"?(P=P?P.__html:void 0,P!=null&&vs(n,P)):x==="children"?typeof P=="string"?(c!=="textarea"||P!=="")&&Mi(n,P):typeof P=="number"&&Mi(n,""+P):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(s.hasOwnProperty(x)?P!=null&&x==="onScroll"&&$e("scroll",n):P!=null&&_(n,x,P,L))}switch(c){case"input":Gt(n),Et(n,g,!1);break;case"textarea":Gt(n),ys(n);break;case"option":g.value!=null&&n.setAttribute("value",""+Se(g.value));break;case"select":n.multiple=!!g.multiple,x=g.value,x!=null?Dt(n,!!g.multiple,x,!1):g.defaultValue!=null&&Dt(n,!!g.multiple,g.defaultValue,!0);break;default:typeof y.onClick=="function"&&(n.onclick=Mr)}switch(c){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}}g&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return yt(r),null;case 6:if(n&&r.stateNode!=null)_h(n,r,n.memoizedProps,g);else{if(typeof g!="string"&&r.stateNode===null)throw Error(t(166));if(c=vn(Vs.current),vn(di.current),Kr(r)){if(g=r.stateNode,c=r.memoizedProps,g[ci]=r,(x=g.nodeValue!==c)&&(n=Pt,n!==null))switch(n.tag){case 3:Nr(g.nodeValue,c,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Nr(g.nodeValue,c,(n.mode&1)!==0)}x&&(r.flags|=4)}else g=(c.nodeType===9?c:c.ownerDocument).createTextNode(g),g[ci]=r,r.stateNode=g}return yt(r),null;case 13:if(Ge(Ve),g=r.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ke&&Ot!==null&&(r.mode&1)!==0&&(r.flags&128)===0)Cd(),zn(),r.flags|=98560,x=!1;else if(x=Kr(r),g!==null&&g.dehydrated!==null){if(n===null){if(!x)throw Error(t(318));if(x=r.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(t(317));x[ci]=r}else zn(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;yt(r),x=!1}else ti!==null&&(Ul(ti),ti=null),x=!0;if(!x)return r.flags&65536?r:null}return(r.flags&128)!==0?(r.lanes=c,r):(g=g!==null,g!==(n!==null&&n.memoizedState!==null)&&g&&(r.child.flags|=8192,(r.mode&1)!==0&&(n===null||(Ve.current&1)!==0?it===0&&(it=3):jl())),r.updateQueue!==null&&(r.flags|=4),yt(r),null);case 4:return Xn(),kl(n,r),n===null&&Fs(r.stateNode.containerInfo),yt(r),null;case 10:return il(r.type._context),yt(r),null;case 17:return Lt(r.type)&&Br(),yt(r),null;case 19:if(Ge(Ve),x=r.memoizedState,x===null)return yt(r),null;if(g=(r.flags&128)!==0,L=x.rendering,L===null)if(g)qs(x,!1);else{if(it!==0||n!==null&&(n.flags&128)!==0)for(n=r.child;n!==null;){if(L=qr(n),L!==null){for(r.flags|=128,qs(x,!1),g=L.updateQueue,g!==null&&(r.updateQueue=g,r.flags|=4),r.subtreeFlags=0,g=c,c=r.child;c!==null;)x=c,n=g,x.flags&=14680066,L=x.alternate,L===null?(x.childLanes=0,x.lanes=n,x.child=null,x.subtreeFlags=0,x.memoizedProps=null,x.memoizedState=null,x.updateQueue=null,x.dependencies=null,x.stateNode=null):(x.childLanes=L.childLanes,x.lanes=L.lanes,x.child=L.child,x.subtreeFlags=0,x.deletions=null,x.memoizedProps=L.memoizedProps,x.memoizedState=L.memoizedState,x.updateQueue=L.updateQueue,x.type=L.type,n=L.dependencies,x.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),c=c.sibling;return Ue(Ve,Ve.current&1|2),r.child}n=n.sibling}x.tail!==null&&Qe()>ts&&(r.flags|=128,g=!0,qs(x,!1),r.lanes=4194304)}else{if(!g)if(n=qr(L),n!==null){if(r.flags|=128,g=!0,c=n.updateQueue,c!==null&&(r.updateQueue=c,r.flags|=4),qs(x,!0),x.tail===null&&x.tailMode==="hidden"&&!L.alternate&&!Ke)return yt(r),null}else 2*Qe()-x.renderingStartTime>ts&&c!==1073741824&&(r.flags|=128,g=!0,qs(x,!1),r.lanes=4194304);x.isBackwards?(L.sibling=r.child,r.child=L):(c=x.last,c!==null?c.sibling=L:r.child=L,x.last=L)}return x.tail!==null?(r=x.tail,x.rendering=r,x.tail=r.sibling,x.renderingStartTime=Qe(),r.sibling=null,c=Ve.current,Ue(Ve,g?c&1|2:c&1),r):(yt(r),null);case 22:case 23:return Gl(),g=r.memoizedState!==null,n!==null&&n.memoizedState!==null!==g&&(r.flags|=8192),g&&(r.mode&1)!==0?(Nt&1073741824)!==0&&(yt(r),r.subtreeFlags&6&&(r.flags|=8192)):yt(r),null;case 24:return null;case 25:return null}throw Error(t(156,r.tag))}function N0(n,r){switch(Qo(r),r.tag){case 1:return Lt(r.type)&&Br(),n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 3:return Xn(),Ge(At),Ge(mt),ul(),n=r.flags,(n&65536)!==0&&(n&128)===0?(r.flags=n&-65537|128,r):null;case 5:return ol(r),null;case 13:if(Ge(Ve),n=r.memoizedState,n!==null&&n.dehydrated!==null){if(r.alternate===null)throw Error(t(340));zn()}return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 19:return Ge(Ve),null;case 4:return Xn(),null;case 10:return il(r.type._context),null;case 22:case 23:return Gl(),null;case 24:return null;default:return null}}var sa=!1,vt=!1,M0=typeof WeakSet=="function"?WeakSet:Set,ge=null;function Jn(n,r){var c=n.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(g){Ye(n,r,g)}else c.current=null}function wl(n,r,c){try{c()}catch(g){Ye(n,r,g)}}var kh=!1;function F0(n,r){if(Go=Lr,n=ad(),Po(n)){if("selectionStart"in n)var c={start:n.selectionStart,end:n.selectionEnd};else e:{c=(c=n.ownerDocument)&&c.defaultView||window;var g=c.getSelection&&c.getSelection();if(g&&g.rangeCount!==0){c=g.anchorNode;var y=g.anchorOffset,x=g.focusNode;g=g.focusOffset;try{c.nodeType,x.nodeType}catch{c=null;break e}var L=0,w=-1,P=-1,W=0,Z=0,ee=n,X=null;t:for(;;){for(var ce;ee!==c||y!==0&&ee.nodeType!==3||(w=L+y),ee!==x||g!==0&&ee.nodeType!==3||(P=L+g),ee.nodeType===3&&(L+=ee.nodeValue.length),(ce=ee.firstChild)!==null;)X=ee,ee=ce;for(;;){if(ee===n)break t;if(X===c&&++W===y&&(w=L),X===x&&++Z===g&&(P=L),(ce=ee.nextSibling)!==null)break;ee=X,X=ee.parentNode}ee=ce}c=w===-1||P===-1?null:{start:w,end:P}}else c=null}c=c||{start:0,end:0}}else c=null;for(jo={focusedElem:n,selectionRange:c},Lr=!1,ge=r;ge!==null;)if(r=ge,n=r.child,(r.subtreeFlags&1028)!==0&&n!==null)n.return=r,ge=n;else for(;ge!==null;){r=ge;try{var me=r.alternate;if((r.flags&1024)!==0)switch(r.tag){case 0:case 11:case 15:break;case 1:if(me!==null){var pe=me.memoizedProps,Xe=me.memoizedState,j=r.stateNode,N=j.getSnapshotBeforeUpdate(r.elementType===r.type?pe:ii(r.type,pe),Xe);j.__reactInternalSnapshotBeforeUpdate=N}break;case 3:var V=r.stateNode.containerInfo;V.nodeType===1?V.textContent="":V.nodeType===9&&V.documentElement&&V.removeChild(V.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(ie){Ye(r,r.return,ie)}if(n=r.sibling,n!==null){n.return=r.return,ge=n;break}ge=r.return}return me=kh,kh=!1,me}function Qs(n,r,c){var g=r.updateQueue;if(g=g!==null?g.lastEffect:null,g!==null){var y=g=g.next;do{if((y.tag&n)===n){var x=y.destroy;y.destroy=void 0,x!==void 0&&wl(r,c,x)}y=y.next}while(y!==g)}}function ra(n,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var c=r=r.next;do{if((c.tag&n)===n){var g=c.create;c.destroy=g()}c=c.next}while(c!==r)}}function Cl(n){var r=n.ref;if(r!==null){var c=n.stateNode;switch(n.tag){case 5:n=c;break;default:n=c}typeof r=="function"?r(n):r.current=n}}function wh(n){var r=n.alternate;r!==null&&(n.alternate=null,wh(r)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(r=n.stateNode,r!==null&&(delete r[ci],delete r[Us],delete r[Wo],delete r[E0],delete r[x0])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Ch(n){return n.tag===5||n.tag===3||n.tag===4}function Dh(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Ch(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Dl(n,r,c){var g=n.tag;if(g===5||g===6)n=n.stateNode,r?c.nodeType===8?c.parentNode.insertBefore(n,r):c.insertBefore(n,r):(c.nodeType===8?(r=c.parentNode,r.insertBefore(n,c)):(r=c,r.appendChild(n)),c=c._reactRootContainer,c!=null||r.onclick!==null||(r.onclick=Mr));else if(g!==4&&(n=n.child,n!==null))for(Dl(n,r,c),n=n.sibling;n!==null;)Dl(n,r,c),n=n.sibling}function bl(n,r,c){var g=n.tag;if(g===5||g===6)n=n.stateNode,r?c.insertBefore(n,r):c.appendChild(n);else if(g!==4&&(n=n.child,n!==null))for(bl(n,r,c),n=n.sibling;n!==null;)bl(n,r,c),n=n.sibling}var ct=null,ni=!1;function qi(n,r,c){for(c=c.child;c!==null;)bh(n,r,c),c=c.sibling}function bh(n,r,c){if(ui&&typeof ui.onCommitFiberUnmount=="function")try{ui.onCommitFiberUnmount(vr,c)}catch{}switch(c.tag){case 5:vt||Jn(c,r);case 6:var g=ct,y=ni;ct=null,qi(n,r,c),ct=g,ni=y,ct!==null&&(ni?(n=ct,c=c.stateNode,n.nodeType===8?n.parentNode.removeChild(c):n.removeChild(c)):ct.removeChild(c.stateNode));break;case 18:ct!==null&&(ni?(n=ct,c=c.stateNode,n.nodeType===8?Ho(n.parentNode,c):n.nodeType===1&&Ho(n,c),ks(n)):Ho(ct,c.stateNode));break;case 4:g=ct,y=ni,ct=c.stateNode.containerInfo,ni=!0,qi(n,r,c),ct=g,ni=y;break;case 0:case 11:case 14:case 15:if(!vt&&(g=c.updateQueue,g!==null&&(g=g.lastEffect,g!==null))){y=g=g.next;do{var x=y,L=x.destroy;x=x.tag,L!==void 0&&((x&2)!==0||(x&4)!==0)&&wl(c,r,L),y=y.next}while(y!==g)}qi(n,r,c);break;case 1:if(!vt&&(Jn(c,r),g=c.stateNode,typeof g.componentWillUnmount=="function"))try{g.props=c.memoizedProps,g.state=c.memoizedState,g.componentWillUnmount()}catch(w){Ye(c,r,w)}qi(n,r,c);break;case 21:qi(n,r,c);break;case 22:c.mode&1?(vt=(g=vt)||c.memoizedState!==null,qi(n,r,c),vt=g):qi(n,r,c);break;default:qi(n,r,c)}}function Ph(n){var r=n.updateQueue;if(r!==null){n.updateQueue=null;var c=n.stateNode;c===null&&(c=n.stateNode=new M0),r.forEach(function(g){var y=W0.bind(null,n,g);c.has(g)||(c.add(g),g.then(y,y))})}}function si(n,r){var c=r.deletions;if(c!==null)for(var g=0;g<c.length;g++){var y=c[g];try{var x=n,L=r,w=L;e:for(;w!==null;){switch(w.tag){case 5:ct=w.stateNode,ni=!1;break e;case 3:ct=w.stateNode.containerInfo,ni=!0;break e;case 4:ct=w.stateNode.containerInfo,ni=!0;break e}w=w.return}if(ct===null)throw Error(t(160));bh(x,L,y),ct=null,ni=!1;var P=y.alternate;P!==null&&(P.return=null),y.return=null}catch(W){Ye(y,r,W)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)Oh(r,n),r=r.sibling}function Oh(n,r){var c=n.alternate,g=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(si(r,n),fi(n),g&4){try{Qs(3,n,n.return),ra(3,n)}catch(pe){Ye(n,n.return,pe)}try{Qs(5,n,n.return)}catch(pe){Ye(n,n.return,pe)}}break;case 1:si(r,n),fi(n),g&512&&c!==null&&Jn(c,c.return);break;case 5:if(si(r,n),fi(n),g&512&&c!==null&&Jn(c,c.return),n.flags&32){var y=n.stateNode;try{Mi(y,"")}catch(pe){Ye(n,n.return,pe)}}if(g&4&&(y=n.stateNode,y!=null)){var x=n.memoizedProps,L=c!==null?c.memoizedProps:x,w=n.type,P=n.updateQueue;if(n.updateQueue=null,P!==null)try{w==="input"&&x.type==="radio"&&x.name!=null&&Ce(y,x),lo(w,L);var W=lo(w,x);for(L=0;L<P.length;L+=2){var Z=P[L],ee=P[L+1];Z==="style"?pc(y,ee):Z==="dangerouslySetInnerHTML"?vs(y,ee):Z==="children"?Mi(y,ee):_(y,Z,ee,W)}switch(w){case"input":Je(y,x);break;case"textarea":dn(y,x);break;case"select":var X=y._wrapperState.wasMultiple;y._wrapperState.wasMultiple=!!x.multiple;var ce=x.value;ce!=null?Dt(y,!!x.multiple,ce,!1):X!==!!x.multiple&&(x.defaultValue!=null?Dt(y,!!x.multiple,x.defaultValue,!0):Dt(y,!!x.multiple,x.multiple?[]:"",!1))}y[Us]=x}catch(pe){Ye(n,n.return,pe)}}break;case 6:if(si(r,n),fi(n),g&4){if(n.stateNode===null)throw Error(t(162));y=n.stateNode,x=n.memoizedProps;try{y.nodeValue=x}catch(pe){Ye(n,n.return,pe)}}break;case 3:if(si(r,n),fi(n),g&4&&c!==null&&c.memoizedState.isDehydrated)try{ks(r.containerInfo)}catch(pe){Ye(n,n.return,pe)}break;case 4:si(r,n),fi(n);break;case 13:si(r,n),fi(n),y=n.child,y.flags&8192&&(x=y.memoizedState!==null,y.stateNode.isHidden=x,!x||y.alternate!==null&&y.alternate.memoizedState!==null||(Nl=Qe())),g&4&&Ph(n);break;case 22:if(Z=c!==null&&c.memoizedState!==null,n.mode&1?(vt=(W=vt)||Z,si(r,n),vt=W):si(r,n),fi(n),g&8192){if(W=n.memoizedState!==null,(n.stateNode.isHidden=W)&&!Z&&(n.mode&1)!==0)for(ge=n,Z=n.child;Z!==null;){for(ee=ge=Z;ge!==null;){switch(X=ge,ce=X.child,X.tag){case 0:case 11:case 14:case 15:Qs(4,X,X.return);break;case 1:Jn(X,X.return);var me=X.stateNode;if(typeof me.componentWillUnmount=="function"){g=X,c=X.return;try{r=g,me.props=r.memoizedProps,me.state=r.memoizedState,me.componentWillUnmount()}catch(pe){Ye(g,c,pe)}}break;case 5:Jn(X,X.return);break;case 22:if(X.memoizedState!==null){Fh(ee);continue}}ce!==null?(ce.return=X,ge=ce):Fh(ee)}Z=Z.sibling}e:for(Z=null,ee=n;;){if(ee.tag===5){if(Z===null){Z=ee;try{y=ee.stateNode,W?(x=y.style,typeof x.setProperty=="function"?x.setProperty("display","none","important"):x.display="none"):(w=ee.stateNode,P=ee.memoizedProps.style,L=P!=null&&P.hasOwnProperty("display")?P.display:null,w.style.display=mc("display",L))}catch(pe){Ye(n,n.return,pe)}}}else if(ee.tag===6){if(Z===null)try{ee.stateNode.nodeValue=W?"":ee.memoizedProps}catch(pe){Ye(n,n.return,pe)}}else if((ee.tag!==22&&ee.tag!==23||ee.memoizedState===null||ee===n)&&ee.child!==null){ee.child.return=ee,ee=ee.child;continue}if(ee===n)break e;for(;ee.sibling===null;){if(ee.return===null||ee.return===n)break e;Z===ee&&(Z=null),ee=ee.return}Z===ee&&(Z=null),ee.sibling.return=ee.return,ee=ee.sibling}}break;case 19:si(r,n),fi(n),g&4&&Ph(n);break;case 21:break;default:si(r,n),fi(n)}}function fi(n){var r=n.flags;if(r&2){try{e:{for(var c=n.return;c!==null;){if(Ch(c)){var g=c;break e}c=c.return}throw Error(t(160))}switch(g.tag){case 5:var y=g.stateNode;g.flags&32&&(Mi(y,""),g.flags&=-33);var x=Dh(n);bl(n,x,y);break;case 3:case 4:var L=g.stateNode.containerInfo,w=Dh(n);Dl(n,w,L);break;default:throw Error(t(161))}}catch(P){Ye(n,n.return,P)}n.flags&=-3}r&4096&&(n.flags&=-4097)}function B0(n,r,c){ge=n,Nh(n)}function Nh(n,r,c){for(var g=(n.mode&1)!==0;ge!==null;){var y=ge,x=y.child;if(y.tag===22&&g){var L=y.memoizedState!==null||sa;if(!L){var w=y.alternate,P=w!==null&&w.memoizedState!==null||vt;w=sa;var W=vt;if(sa=L,(vt=P)&&!W)for(ge=y;ge!==null;)L=ge,P=L.child,L.tag===22&&L.memoizedState!==null?Bh(y):P!==null?(P.return=L,ge=P):Bh(y);for(;x!==null;)ge=x,Nh(x),x=x.sibling;ge=y,sa=w,vt=W}Mh(n)}else(y.subtreeFlags&8772)!==0&&x!==null?(x.return=y,ge=x):Mh(n)}}function Mh(n){for(;ge!==null;){var r=ge;if((r.flags&8772)!==0){var c=r.alternate;try{if((r.flags&8772)!==0)switch(r.tag){case 0:case 11:case 15:vt||ra(5,r);break;case 1:var g=r.stateNode;if(r.flags&4&&!vt)if(c===null)g.componentDidMount();else{var y=r.elementType===r.type?c.memoizedProps:ii(r.type,c.memoizedProps);g.componentDidUpdate(y,c.memoizedState,g.__reactInternalSnapshotBeforeUpdate)}var x=r.updateQueue;x!==null&&Fd(r,x,g);break;case 3:var L=r.updateQueue;if(L!==null){if(c=null,r.child!==null)switch(r.child.tag){case 5:c=r.child.stateNode;break;case 1:c=r.child.stateNode}Fd(r,L,c)}break;case 5:var w=r.stateNode;if(c===null&&r.flags&4){c=w;var P=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":P.autoFocus&&c.focus();break;case"img":P.src&&(c.src=P.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var W=r.alternate;if(W!==null){var Z=W.memoizedState;if(Z!==null){var ee=Z.dehydrated;ee!==null&&ks(ee)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}vt||r.flags&512&&Cl(r)}catch(X){Ye(r,r.return,X)}}if(r===n){ge=null;break}if(c=r.sibling,c!==null){c.return=r.return,ge=c;break}ge=r.return}}function Fh(n){for(;ge!==null;){var r=ge;if(r===n){ge=null;break}var c=r.sibling;if(c!==null){c.return=r.return,ge=c;break}ge=r.return}}function Bh(n){for(;ge!==null;){var r=ge;try{switch(r.tag){case 0:case 11:case 15:var c=r.return;try{ra(4,r)}catch(P){Ye(r,c,P)}break;case 1:var g=r.stateNode;if(typeof g.componentDidMount=="function"){var y=r.return;try{g.componentDidMount()}catch(P){Ye(r,y,P)}}var x=r.return;try{Cl(r)}catch(P){Ye(r,x,P)}break;case 5:var L=r.return;try{Cl(r)}catch(P){Ye(r,L,P)}}}catch(P){Ye(r,r.return,P)}if(r===n){ge=null;break}var w=r.sibling;if(w!==null){w.return=r.return,ge=w;break}ge=r.return}}var U0=Math.ceil,aa=C.ReactCurrentDispatcher,Pl=C.ReactCurrentOwner,Wt=C.ReactCurrentBatchConfig,De=0,at=null,et=null,dt=0,Nt=0,es=Vi(0),it=0,Xs=null,xn=0,oa=0,Ol=0,Zs=null,Rt=null,Nl=0,ts=1/0,wi=null,la=!1,Ml=null,Qi=null,ua=!1,Xi=null,ca=0,Js=0,Fl=null,da=-1,ha=0;function St(){return(De&6)!==0?Qe():da!==-1?da:da=Qe()}function Zi(n){return(n.mode&1)===0?1:(De&2)!==0&&dt!==0?dt&-dt:T0.transition!==null?(ha===0&&(ha=Dc()),ha):(n=Pe,n!==0||(n=window.event,n=n===void 0?16:$c(n.type)),n)}function ri(n,r,c,g){if(50<Js)throw Js=0,Fl=null,Error(t(185));As(n,c,g),((De&2)===0||n!==at)&&(n===at&&((De&2)===0&&(oa|=c),it===4&&Ji(n,dt)),_t(n,g),c===1&&De===0&&(r.mode&1)===0&&(ts=Qe()+500,$r&&Wi()))}function _t(n,r){var c=n.callbackNode;Tp(n,r);var g=Sr(n,n===at?dt:0);if(g===0)c!==null&&kc(c),n.callbackNode=null,n.callbackPriority=0;else if(r=g&-g,n.callbackPriority!==r){if(c!=null&&kc(c),r===1)n.tag===0?S0($h.bind(null,n)):Id($h.bind(null,n)),y0(function(){(De&6)===0&&Wi()}),c=null;else{switch(bc(g)){case 1:c=po;break;case 4:c=wc;break;case 16:c=yr;break;case 536870912:c=Cc;break;default:c=yr}c=Yh(c,Uh.bind(null,n))}n.callbackPriority=r,n.callbackNode=c}}function Uh(n,r){if(da=-1,ha=0,(De&6)!==0)throw Error(t(327));var c=n.callbackNode;if(is()&&n.callbackNode!==c)return null;var g=Sr(n,n===at?dt:0);if(g===0)return null;if((g&30)!==0||(g&n.expiredLanes)!==0||r)r=fa(n,g);else{r=g;var y=De;De|=2;var x=jh();(at!==n||dt!==r)&&(wi=null,ts=Qe()+500,Tn(n,r));do try{j0();break}catch(w){Gh(n,w)}while(!0);tl(),aa.current=x,De=y,et!==null?r=0:(at=null,dt=0,r=it)}if(r!==0){if(r===2&&(y=yo(n),y!==0&&(g=y,r=Bl(n,y))),r===1)throw c=Xs,Tn(n,0),Ji(n,g),_t(n,Qe()),c;if(r===6)Ji(n,g);else{if(y=n.current.alternate,(g&30)===0&&!$0(y)&&(r=fa(n,g),r===2&&(x=yo(n),x!==0&&(g=x,r=Bl(n,x))),r===1))throw c=Xs,Tn(n,0),Ji(n,g),_t(n,Qe()),c;switch(n.finishedWork=y,n.finishedLanes=g,r){case 0:case 1:throw Error(t(345));case 2:An(n,Rt,wi);break;case 3:if(Ji(n,g),(g&130023424)===g&&(r=Nl+500-Qe(),10<r)){if(Sr(n,0)!==0)break;if(y=n.suspendedLanes,(y&g)!==g){St(),n.pingedLanes|=n.suspendedLanes&y;break}n.timeoutHandle=Vo(An.bind(null,n,Rt,wi),r);break}An(n,Rt,wi);break;case 4:if(Ji(n,g),(g&4194240)===g)break;for(r=n.eventTimes,y=-1;0<g;){var L=31-Jt(g);x=1<<L,L=r[L],L>y&&(y=L),g&=~x}if(g=y,g=Qe()-g,g=(120>g?120:480>g?480:1080>g?1080:1920>g?1920:3e3>g?3e3:4320>g?4320:1960*U0(g/1960))-g,10<g){n.timeoutHandle=Vo(An.bind(null,n,Rt,wi),g);break}An(n,Rt,wi);break;case 5:An(n,Rt,wi);break;default:throw Error(t(329))}}}return _t(n,Qe()),n.callbackNode===c?Uh.bind(null,n):null}function Bl(n,r){var c=Zs;return n.current.memoizedState.isDehydrated&&(Tn(n,r).flags|=256),n=fa(n,r),n!==2&&(r=Rt,Rt=c,r!==null&&Ul(r)),n}function Ul(n){Rt===null?Rt=n:Rt.push.apply(Rt,n)}function $0(n){for(var r=n;;){if(r.flags&16384){var c=r.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var g=0;g<c.length;g++){var y=c[g],x=y.getSnapshot;y=y.value;try{if(!ei(x(),y))return!1}catch{return!1}}}if(c=r.child,r.subtreeFlags&16384&&c!==null)c.return=r,r=c;else{if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Ji(n,r){for(r&=~Ol,r&=~oa,n.suspendedLanes|=r,n.pingedLanes&=~r,n=n.expirationTimes;0<r;){var c=31-Jt(r),g=1<<c;n[c]=-1,r&=~g}}function $h(n){if((De&6)!==0)throw Error(t(327));is();var r=Sr(n,0);if((r&1)===0)return _t(n,Qe()),null;var c=fa(n,r);if(n.tag!==0&&c===2){var g=yo(n);g!==0&&(r=g,c=Bl(n,g))}if(c===1)throw c=Xs,Tn(n,0),Ji(n,r),_t(n,Qe()),c;if(c===6)throw Error(t(345));return n.finishedWork=n.current.alternate,n.finishedLanes=r,An(n,Rt,wi),_t(n,Qe()),null}function $l(n,r){var c=De;De|=1;try{return n(r)}finally{De=c,De===0&&(ts=Qe()+500,$r&&Wi())}}function Sn(n){Xi!==null&&Xi.tag===0&&(De&6)===0&&is();var r=De;De|=1;var c=Wt.transition,g=Pe;try{if(Wt.transition=null,Pe=1,n)return n()}finally{Pe=g,Wt.transition=c,De=r,(De&6)===0&&Wi()}}function Gl(){Nt=es.current,Ge(es)}function Tn(n,r){n.finishedWork=null,n.finishedLanes=0;var c=n.timeoutHandle;if(c!==-1&&(n.timeoutHandle=-1,p0(c)),et!==null)for(c=et.return;c!==null;){var g=c;switch(Qo(g),g.tag){case 1:g=g.type.childContextTypes,g!=null&&Br();break;case 3:Xn(),Ge(At),Ge(mt),ul();break;case 5:ol(g);break;case 4:Xn();break;case 13:Ge(Ve);break;case 19:Ge(Ve);break;case 10:il(g.type._context);break;case 22:case 23:Gl()}c=c.return}if(at=n,et=n=en(n.current,null),dt=Nt=r,it=0,Xs=null,Ol=oa=xn=0,Rt=Zs=null,yn!==null){for(r=0;r<yn.length;r++)if(c=yn[r],g=c.interleaved,g!==null){c.interleaved=null;var y=g.next,x=c.pending;if(x!==null){var L=x.next;x.next=y,g.next=L}c.pending=g}yn=null}return n}function Gh(n,r){do{var c=et;try{if(tl(),Qr.current=ea,Xr){for(var g=He.memoizedState;g!==null;){var y=g.queue;y!==null&&(y.pending=null),g=g.next}Xr=!1}if(En=0,rt=tt=He=null,Hs=!1,Ws=0,Pl.current=null,c===null||c.return===null){it=1,Xs=r,et=null;break}e:{var x=n,L=c.return,w=c,P=r;if(r=dt,w.flags|=32768,P!==null&&typeof P=="object"&&typeof P.then=="function"){var W=P,Z=w,ee=Z.tag;if((Z.mode&1)===0&&(ee===0||ee===11||ee===15)){var X=Z.alternate;X?(Z.updateQueue=X.updateQueue,Z.memoizedState=X.memoizedState,Z.lanes=X.lanes):(Z.updateQueue=null,Z.memoizedState=null)}var ce=hh(L);if(ce!==null){ce.flags&=-257,fh(ce,L,w,x,r),ce.mode&1&&dh(x,W,r),r=ce,P=W;var me=r.updateQueue;if(me===null){var pe=new Set;pe.add(P),r.updateQueue=pe}else me.add(P);break e}else{if((r&1)===0){dh(x,W,r),jl();break e}P=Error(t(426))}}else if(Ke&&w.mode&1){var Xe=hh(L);if(Xe!==null){(Xe.flags&65536)===0&&(Xe.flags|=256),fh(Xe,L,w,x,r),Jo(Zn(P,w));break e}}x=P=Zn(P,w),it!==4&&(it=2),Zs===null?Zs=[x]:Zs.push(x),x=L;do{switch(x.tag){case 3:x.flags|=65536,r&=-r,x.lanes|=r;var j=uh(x,P,r);Md(x,j);break e;case 1:w=P;var N=x.type,V=x.stateNode;if((x.flags&128)===0&&(typeof N.getDerivedStateFromError=="function"||V!==null&&typeof V.componentDidCatch=="function"&&(Qi===null||!Qi.has(V)))){x.flags|=65536,r&=-r,x.lanes|=r;var ie=ch(x,w,r);Md(x,ie);break e}}x=x.return}while(x!==null)}Vh(c)}catch(ve){r=ve,et===c&&c!==null&&(et=c=c.return);continue}break}while(!0)}function jh(){var n=aa.current;return aa.current=ea,n===null?ea:n}function jl(){(it===0||it===3||it===2)&&(it=4),at===null||(xn&268435455)===0&&(oa&268435455)===0||Ji(at,dt)}function fa(n,r){var c=De;De|=2;var g=jh();(at!==n||dt!==r)&&(wi=null,Tn(n,r));do try{G0();break}catch(y){Gh(n,y)}while(!0);if(tl(),De=c,aa.current=g,et!==null)throw Error(t(261));return at=null,dt=0,it}function G0(){for(;et!==null;)Kh(et)}function j0(){for(;et!==null&&!fp();)Kh(et)}function Kh(n){var r=zh(n.alternate,n,Nt);n.memoizedProps=n.pendingProps,r===null?Vh(n):et=r,Pl.current=null}function Vh(n){var r=n;do{var c=r.alternate;if(n=r.return,(r.flags&32768)===0){if(c=O0(c,r,Nt),c!==null){et=c;return}}else{if(c=N0(c,r),c!==null){c.flags&=32767,et=c;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{it=6,et=null;return}}if(r=r.sibling,r!==null){et=r;return}et=r=n}while(r!==null);it===0&&(it=5)}function An(n,r,c){var g=Pe,y=Wt.transition;try{Wt.transition=null,Pe=1,K0(n,r,c,g)}finally{Wt.transition=y,Pe=g}return null}function K0(n,r,c,g){do is();while(Xi!==null);if((De&6)!==0)throw Error(t(327));c=n.finishedWork;var y=n.finishedLanes;if(c===null)return null;if(n.finishedWork=null,n.finishedLanes=0,c===n.current)throw Error(t(177));n.callbackNode=null,n.callbackPriority=0;var x=c.lanes|c.childLanes;if(Ap(n,x),n===at&&(et=at=null,dt=0),(c.subtreeFlags&2064)===0&&(c.flags&2064)===0||ua||(ua=!0,Yh(yr,function(){return is(),null})),x=(c.flags&15990)!==0,(c.subtreeFlags&15990)!==0||x){x=Wt.transition,Wt.transition=null;var L=Pe;Pe=1;var w=De;De|=4,Pl.current=null,F0(n,c),Oh(c,n),u0(jo),Lr=!!Go,jo=Go=null,n.current=c,B0(c),gp(),De=w,Pe=L,Wt.transition=x}else n.current=c;if(ua&&(ua=!1,Xi=n,ca=y),x=n.pendingLanes,x===0&&(Qi=null),yp(c.stateNode),_t(n,Qe()),r!==null)for(g=n.onRecoverableError,c=0;c<r.length;c++)y=r[c],g(y.value,{componentStack:y.stack,digest:y.digest});if(la)throw la=!1,n=Ml,Ml=null,n;return(ca&1)!==0&&n.tag!==0&&is(),x=n.pendingLanes,(x&1)!==0?n===Fl?Js++:(Js=0,Fl=n):Js=0,Wi(),null}function is(){if(Xi!==null){var n=bc(ca),r=Wt.transition,c=Pe;try{if(Wt.transition=null,Pe=16>n?16:n,Xi===null)var g=!1;else{if(n=Xi,Xi=null,ca=0,(De&6)!==0)throw Error(t(331));var y=De;for(De|=4,ge=n.current;ge!==null;){var x=ge,L=x.child;if((ge.flags&16)!==0){var w=x.deletions;if(w!==null){for(var P=0;P<w.length;P++){var W=w[P];for(ge=W;ge!==null;){var Z=ge;switch(Z.tag){case 0:case 11:case 15:Qs(8,Z,x)}var ee=Z.child;if(ee!==null)ee.return=Z,ge=ee;else for(;ge!==null;){Z=ge;var X=Z.sibling,ce=Z.return;if(wh(Z),Z===W){ge=null;break}if(X!==null){X.return=ce,ge=X;break}ge=ce}}}var me=x.alternate;if(me!==null){var pe=me.child;if(pe!==null){me.child=null;do{var Xe=pe.sibling;pe.sibling=null,pe=Xe}while(pe!==null)}}ge=x}}if((x.subtreeFlags&2064)!==0&&L!==null)L.return=x,ge=L;else e:for(;ge!==null;){if(x=ge,(x.flags&2048)!==0)switch(x.tag){case 0:case 11:case 15:Qs(9,x,x.return)}var j=x.sibling;if(j!==null){j.return=x.return,ge=j;break e}ge=x.return}}var N=n.current;for(ge=N;ge!==null;){L=ge;var V=L.child;if((L.subtreeFlags&2064)!==0&&V!==null)V.return=L,ge=V;else e:for(L=N;ge!==null;){if(w=ge,(w.flags&2048)!==0)try{switch(w.tag){case 0:case 11:case 15:ra(9,w)}}catch(ve){Ye(w,w.return,ve)}if(w===L){ge=null;break e}var ie=w.sibling;if(ie!==null){ie.return=w.return,ge=ie;break e}ge=w.return}}if(De=y,Wi(),ui&&typeof ui.onPostCommitFiberRoot=="function")try{ui.onPostCommitFiberRoot(vr,n)}catch{}g=!0}return g}finally{Pe=c,Wt.transition=r}}return!1}function Hh(n,r,c){r=Zn(c,r),r=uh(n,r,1),n=Yi(n,r,1),r=St(),n!==null&&(As(n,1,r),_t(n,r))}function Ye(n,r,c){if(n.tag===3)Hh(n,n,c);else for(;r!==null;){if(r.tag===3){Hh(r,n,c);break}else if(r.tag===1){var g=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(Qi===null||!Qi.has(g))){n=Zn(c,n),n=ch(r,n,1),r=Yi(r,n,1),n=St(),r!==null&&(As(r,1,n),_t(r,n));break}}r=r.return}}function V0(n,r,c){var g=n.pingCache;g!==null&&g.delete(r),r=St(),n.pingedLanes|=n.suspendedLanes&c,at===n&&(dt&c)===c&&(it===4||it===3&&(dt&130023424)===dt&&500>Qe()-Nl?Tn(n,0):Ol|=c),_t(n,r)}function Wh(n,r){r===0&&((n.mode&1)===0?r=1:(r=xr,xr<<=1,(xr&130023424)===0&&(xr=4194304)));var c=St();n=Ri(n,r),n!==null&&(As(n,r,c),_t(n,c))}function H0(n){var r=n.memoizedState,c=0;r!==null&&(c=r.retryLane),Wh(n,c)}function W0(n,r){var c=0;switch(n.tag){case 13:var g=n.stateNode,y=n.memoizedState;y!==null&&(c=y.retryLane);break;case 19:g=n.stateNode;break;default:throw Error(t(314))}g!==null&&g.delete(r),Wh(n,c)}var zh;zh=function(n,r,c){if(n!==null)if(n.memoizedProps!==r.pendingProps||At.current)It=!0;else{if((n.lanes&c)===0&&(r.flags&128)===0)return It=!1,P0(n,r,c);It=(n.flags&131072)!==0}else It=!1,Ke&&(r.flags&1048576)!==0&&Rd(r,jr,r.index);switch(r.lanes=0,r.tag){case 2:var g=r.type;na(n,r),n=r.pendingProps;var y=Vn(r,mt.current);Qn(r,c),y=hl(null,r,g,n,y,c);var x=fl();return r.flags|=1,typeof y=="object"&&y!==null&&typeof y.render=="function"&&y.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,Lt(g)?(x=!0,Ur(r)):x=!1,r.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,rl(r),y.updater=ta,r.stateNode=y,y._reactInternals=r,El(r,g,n,c),r=Al(null,r,g,!0,x,c)):(r.tag=0,Ke&&x&&qo(r),xt(null,r,y,c),r=r.child),r;case 16:g=r.elementType;e:{switch(na(n,r),n=r.pendingProps,y=g._init,g=y(g._payload),r.type=g,y=r.tag=Y0(g),n=ii(g,n),y){case 0:r=Tl(null,r,g,n,c);break e;case 1:r=Eh(null,r,g,n,c);break e;case 11:r=gh(null,r,g,n,c);break e;case 14:r=mh(null,r,g,ii(g.type,n),c);break e}throw Error(t(306,g,""))}return r;case 0:return g=r.type,y=r.pendingProps,y=r.elementType===g?y:ii(g,y),Tl(n,r,g,y,c);case 1:return g=r.type,y=r.pendingProps,y=r.elementType===g?y:ii(g,y),Eh(n,r,g,y,c);case 3:e:{if(xh(r),n===null)throw Error(t(387));g=r.pendingProps,x=r.memoizedState,y=x.element,Nd(n,r),Yr(r,g,null,c);var L=r.memoizedState;if(g=L.element,x.isDehydrated)if(x={element:g,isDehydrated:!1,cache:L.cache,pendingSuspenseBoundaries:L.pendingSuspenseBoundaries,transitions:L.transitions},r.updateQueue.baseState=x,r.memoizedState=x,r.flags&256){y=Zn(Error(t(423)),r),r=Sh(n,r,g,c,y);break e}else if(g!==y){y=Zn(Error(t(424)),r),r=Sh(n,r,g,c,y);break e}else for(Ot=Ki(r.stateNode.containerInfo.firstChild),Pt=r,Ke=!0,ti=null,c=Pd(r,null,g,c),r.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(zn(),g===y){r=ki(n,r,c);break e}xt(n,r,g,c)}r=r.child}return r;case 5:return Bd(r),n===null&&Zo(r),g=r.type,y=r.pendingProps,x=n!==null?n.memoizedProps:null,L=y.children,Ko(g,y)?L=null:x!==null&&Ko(g,x)&&(r.flags|=32),vh(n,r),xt(n,r,L,c),r.child;case 6:return n===null&&Zo(r),null;case 13:return Th(n,r,c);case 4:return al(r,r.stateNode.containerInfo),g=r.pendingProps,n===null?r.child=Yn(r,null,g,c):xt(n,r,g,c),r.child;case 11:return g=r.type,y=r.pendingProps,y=r.elementType===g?y:ii(g,y),gh(n,r,g,y,c);case 7:return xt(n,r,r.pendingProps,c),r.child;case 8:return xt(n,r,r.pendingProps.children,c),r.child;case 12:return xt(n,r,r.pendingProps.children,c),r.child;case 10:e:{if(g=r.type._context,y=r.pendingProps,x=r.memoizedProps,L=y.value,Ue(Hr,g._currentValue),g._currentValue=L,x!==null)if(ei(x.value,L)){if(x.children===y.children&&!At.current){r=ki(n,r,c);break e}}else for(x=r.child,x!==null&&(x.return=r);x!==null;){var w=x.dependencies;if(w!==null){L=x.child;for(var P=w.firstContext;P!==null;){if(P.context===g){if(x.tag===1){P=_i(-1,c&-c),P.tag=2;var W=x.updateQueue;if(W!==null){W=W.shared;var Z=W.pending;Z===null?P.next=P:(P.next=Z.next,Z.next=P),W.pending=P}}x.lanes|=c,P=x.alternate,P!==null&&(P.lanes|=c),nl(x.return,c,r),w.lanes|=c;break}P=P.next}}else if(x.tag===10)L=x.type===r.type?null:x.child;else if(x.tag===18){if(L=x.return,L===null)throw Error(t(341));L.lanes|=c,w=L.alternate,w!==null&&(w.lanes|=c),nl(L,c,r),L=x.sibling}else L=x.child;if(L!==null)L.return=x;else for(L=x;L!==null;){if(L===r){L=null;break}if(x=L.sibling,x!==null){x.return=L.return,L=x;break}L=L.return}x=L}xt(n,r,y.children,c),r=r.child}return r;case 9:return y=r.type,g=r.pendingProps.children,Qn(r,c),y=Vt(y),g=g(y),r.flags|=1,xt(n,r,g,c),r.child;case 14:return g=r.type,y=ii(g,r.pendingProps),y=ii(g.type,y),mh(n,r,g,y,c);case 15:return ph(n,r,r.type,r.pendingProps,c);case 17:return g=r.type,y=r.pendingProps,y=r.elementType===g?y:ii(g,y),na(n,r),r.tag=1,Lt(g)?(n=!0,Ur(r)):n=!1,Qn(r,c),oh(r,g,y),El(r,g,y,c),Al(null,r,g,!0,n,c);case 19:return Lh(n,r,c);case 22:return yh(n,r,c)}throw Error(t(156,r.tag))};function Yh(n,r){return _c(n,r)}function z0(n,r,c,g){this.tag=n,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zt(n,r,c,g){return new z0(n,r,c,g)}function Kl(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Y0(n){if(typeof n=="function")return Kl(n)?1:0;if(n!=null){if(n=n.$$typeof,n===te)return 11;if(n===ae)return 14}return 2}function en(n,r){var c=n.alternate;return c===null?(c=zt(n.tag,r,n.key,n.mode),c.elementType=n.elementType,c.type=n.type,c.stateNode=n.stateNode,c.alternate=n,n.alternate=c):(c.pendingProps=r,c.type=n.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=n.flags&14680064,c.childLanes=n.childLanes,c.lanes=n.lanes,c.child=n.child,c.memoizedProps=n.memoizedProps,c.memoizedState=n.memoizedState,c.updateQueue=n.updateQueue,r=n.dependencies,c.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},c.sibling=n.sibling,c.index=n.index,c.ref=n.ref,c}function ga(n,r,c,g,y,x){var L=2;if(g=n,typeof n=="function")Kl(n)&&(L=1);else if(typeof n=="string")L=5;else e:switch(n){case O:return Ln(c.children,y,x,r);case B:L=8,y|=8;break;case U:return n=zt(12,c,r,y|2),n.elementType=U,n.lanes=x,n;case se:return n=zt(13,c,r,y),n.elementType=se,n.lanes=x,n;case le:return n=zt(19,c,r,y),n.elementType=le,n.lanes=x,n;case ne:return ma(c,y,x,r);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case M:L=10;break e;case z:L=9;break e;case te:L=11;break e;case ae:L=14;break e;case J:L=16,g=null;break e}throw Error(t(130,n==null?n:typeof n,""))}return r=zt(L,c,r,y),r.elementType=n,r.type=g,r.lanes=x,r}function Ln(n,r,c,g){return n=zt(7,n,g,r),n.lanes=c,n}function ma(n,r,c,g){return n=zt(22,n,g,r),n.elementType=ne,n.lanes=c,n.stateNode={isHidden:!1},n}function Vl(n,r,c){return n=zt(6,n,null,r),n.lanes=c,n}function Hl(n,r,c){return r=zt(4,n.children!==null?n.children:[],n.key,r),r.lanes=c,r.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},r}function q0(n,r,c,g,y){this.tag=r,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vo(0),this.expirationTimes=vo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vo(0),this.identifierPrefix=g,this.onRecoverableError=y,this.mutableSourceEagerHydrationData=null}function Wl(n,r,c,g,y,x,L,w,P){return n=new q0(n,r,c,w,P),r===1?(r=1,x===!0&&(r|=8)):r=0,x=zt(3,null,null,r),n.current=x,x.stateNode=n,x.memoizedState={element:g,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},rl(x),n}function Q0(n,r,c){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:K,key:g==null?null:""+g,children:n,containerInfo:r,implementation:c}}function qh(n){if(!n)return Hi;n=n._reactInternals;e:{if(hn(n)!==n||n.tag!==1)throw Error(t(170));var r=n;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(Lt(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(t(171))}if(n.tag===1){var c=n.type;if(Lt(c))return Ad(n,c,r)}return r}function Qh(n,r,c,g,y,x,L,w,P){return n=Wl(c,g,!0,n,y,x,L,w,P),n.context=qh(null),c=n.current,g=St(),y=Zi(c),x=_i(g,y),x.callback=r??null,Yi(c,x,y),n.current.lanes=y,As(n,y,g),_t(n,g),n}function pa(n,r,c,g){var y=r.current,x=St(),L=Zi(y);return c=qh(c),r.context===null?r.context=c:r.pendingContext=c,r=_i(x,L),r.payload={element:n},g=g===void 0?null:g,g!==null&&(r.callback=g),n=Yi(y,r,L),n!==null&&(ri(n,y,L,x),zr(n,y,L)),L}function ya(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Xh(n,r){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var c=n.retryLane;n.retryLane=c!==0&&c<r?c:r}}function zl(n,r){Xh(n,r),(n=n.alternate)&&Xh(n,r)}function X0(){return null}var Zh=typeof reportError=="function"?reportError:function(n){console.error(n)};function Yl(n){this._internalRoot=n}va.prototype.render=Yl.prototype.render=function(n){var r=this._internalRoot;if(r===null)throw Error(t(409));pa(n,r,null,null)},va.prototype.unmount=Yl.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var r=n.containerInfo;Sn(function(){pa(null,n,null,null)}),r[Ti]=null}};function va(n){this._internalRoot=n}va.prototype.unstable_scheduleHydration=function(n){if(n){var r=Nc();n={blockedOn:null,target:n,priority:r};for(var c=0;c<$i.length&&r!==0&&r<$i[c].priority;c++);$i.splice(c,0,n),c===0&&Bc(n)}};function ql(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Ea(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Jh(){}function Z0(n,r,c,g,y){if(y){if(typeof g=="function"){var x=g;g=function(){var W=ya(L);x.call(W)}}var L=Qh(r,g,n,0,null,!1,!1,"",Jh);return n._reactRootContainer=L,n[Ti]=L.current,Fs(n.nodeType===8?n.parentNode:n),Sn(),L}for(;y=n.lastChild;)n.removeChild(y);if(typeof g=="function"){var w=g;g=function(){var W=ya(P);w.call(W)}}var P=Wl(n,0,!1,null,null,!1,!1,"",Jh);return n._reactRootContainer=P,n[Ti]=P.current,Fs(n.nodeType===8?n.parentNode:n),Sn(function(){pa(r,P,c,g)}),P}function xa(n,r,c,g,y){var x=c._reactRootContainer;if(x){var L=x;if(typeof y=="function"){var w=y;y=function(){var P=ya(L);w.call(P)}}pa(r,L,n,y)}else L=Z0(c,r,n,y,g);return ya(L)}Pc=function(n){switch(n.tag){case 3:var r=n.stateNode;if(r.current.memoizedState.isDehydrated){var c=Ts(r.pendingLanes);c!==0&&(Eo(r,c|1),_t(r,Qe()),(De&6)===0&&(ts=Qe()+500,Wi()))}break;case 13:Sn(function(){var g=Ri(n,1);if(g!==null){var y=St();ri(g,n,1,y)}}),zl(n,1)}},xo=function(n){if(n.tag===13){var r=Ri(n,134217728);if(r!==null){var c=St();ri(r,n,134217728,c)}zl(n,134217728)}},Oc=function(n){if(n.tag===13){var r=Zi(n),c=Ri(n,r);if(c!==null){var g=St();ri(c,n,r,g)}zl(n,r)}},Nc=function(){return Pe},Mc=function(n,r){var c=Pe;try{return Pe=n,r()}finally{Pe=c}},ho=function(n,r,c){switch(r){case"input":if(Je(n,c),r=c.name,c.type==="radio"&&r!=null){for(c=n;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<c.length;r++){var g=c[r];if(g!==n&&g.form===n.form){var y=Fr(g);if(!y)throw Error(t(90));gr(g),Je(g,y)}}}break;case"textarea":dn(n,c);break;case"select":r=c.value,r!=null&&Dt(n,!!c.multiple,r,!1)}},xc=$l,Sc=Sn;var J0={usingClientEntryPoint:!1,Events:[$s,jn,Fr,vc,Ec,$l]},er={findFiberByHostInstance:fn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ey={bundleType:er.bundleType,version:er.version,rendererPackageName:er.rendererPackageName,rendererConfig:er.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:C.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Ic(n),n===null?null:n.stateNode},findFiberByHostInstance:er.findFiberByHostInstance||X0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Sa=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Sa.isDisabled&&Sa.supportsFiber)try{vr=Sa.inject(ey),ui=Sa}catch{}}return kt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=J0,kt.createPortal=function(n,r){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ql(r))throw Error(t(200));return Q0(n,r,null,c)},kt.createRoot=function(n,r){if(!ql(n))throw Error(t(299));var c=!1,g="",y=Zh;return r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(g=r.identifierPrefix),r.onRecoverableError!==void 0&&(y=r.onRecoverableError)),r=Wl(n,1,!1,null,null,c,!1,g,y),n[Ti]=r.current,Fs(n.nodeType===8?n.parentNode:n),new Yl(r)},kt.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var r=n._reactInternals;if(r===void 0)throw typeof n.render=="function"?Error(t(188)):(n=Object.keys(n).join(","),Error(t(268,n)));return n=Ic(r),n=n===null?null:n.stateNode,n},kt.flushSync=function(n){return Sn(n)},kt.hydrate=function(n,r,c){if(!Ea(r))throw Error(t(200));return xa(null,n,r,!0,c)},kt.hydrateRoot=function(n,r,c){if(!ql(n))throw Error(t(405));var g=c!=null&&c.hydratedSources||null,y=!1,x="",L=Zh;if(c!=null&&(c.unstable_strictMode===!0&&(y=!0),c.identifierPrefix!==void 0&&(x=c.identifierPrefix),c.onRecoverableError!==void 0&&(L=c.onRecoverableError)),r=Qh(r,null,n,1,c??null,y,!1,x,L),n[Ti]=r.current,Fs(n),g)for(n=0;n<g.length;n++)c=g[n],y=c._getVersion,y=y(c._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[c,y]:r.mutableSourceEagerHydrationData.push(c,y);return new va(r)},kt.render=function(n,r,c){if(!Ea(r))throw Error(t(200));return xa(null,n,r,!1,c)},kt.unmountComponentAtNode=function(n){if(!Ea(n))throw Error(t(40));return n._reactRootContainer?(Sn(function(){xa(null,null,n,!1,function(){n._reactRootContainer=null,n[Ti]=null})}),!0):!1},kt.unstable_batchedUpdates=$l,kt.unstable_renderSubtreeIntoContainer=function(n,r,c,g){if(!Ea(c))throw Error(t(200));if(n==null||n._reactInternals===void 0)throw Error(t(38));return xa(n,r,c,!1,g)},kt.version="18.3.1-next-f1338f8080-20240426",kt}var lf;function uy(){if(lf)return Zl.exports;lf=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(e){console.error(e)}}return l(),Zl.exports=ly(),Zl.exports}var uf;function cy(){if(uf)return Ta;uf=1;var l=uy();return Ta.createRoot=l.createRoot,Ta.hydrateRoot=l.hydrateRoot,Ta}var dy=cy();const hy=kg(dy),fy=()=>{const[l,e]=wn.useState(!1);return D.jsx("nav",{className:"fixed top-0 left-0 right-0 z-50 flex justify-center p-4 md:p-6 transition-all duration-300",children:D.jsxs("div",{className:`flex flex-col w-full max-w-7xl transition-all duration-500 rounded-[32px] md:rounded-full border border-white/5 bg-black/40 backdrop-blur-2xl overflow-hidden ${l?"max-h-[500px] px-6 py-6":"max-h-[80px] px-6 md:px-8 py-3"}`,children:[D.jsxs("div",{className:"flex items-center justify-between w-full h-[32px] md:h-auto",children:[D.jsx("div",{className:"flex items-center gap-2",children:D.jsx("span",{className:"text-xl font-bold text-white tracking-tighter",children:"webvoss"})}),D.jsxs("div",{className:"hidden md:flex items-center gap-10 text-sm font-medium text-white/50",children:[D.jsx("a",{href:"#features",className:"hover:text-white transition-colors",children:"Services"}),D.jsx("a",{href:"#developers",className:"hover:text-white transition-colors",children:"Developers"}),D.jsx("a",{href:"#pricing",className:"hover:text-white transition-colors",children:"Pricing"}),D.jsx("a",{href:"#about",className:"hover:text-white transition-colors",children:"About"})]}),D.jsxs("div",{className:"flex items-center gap-4 md:gap-6",children:[D.jsx("button",{className:"hidden md:block text-sm font-medium text-white/50 hover:text-white transition-colors",children:"Log in"}),D.jsx("button",{className:"px-5 md:px-6 py-2 text-xs md:text-sm font-bold bg-white text-black rounded-full hover:bg-white/90 transition-all",children:"Book a Demo"}),D.jsxs("button",{className:"flex md:hidden flex-col gap-1.5 p-1",onClick:()=>e(!l),children:[D.jsx("span",{className:`w-6 h-0.5 bg-white transition-all ${l?"rotate-45 translate-y-2":""}`}),D.jsx("span",{className:`w-6 h-0.5 bg-white transition-all ${l?"opacity-0":""}`}),D.jsx("span",{className:`w-6 h-0.5 bg-white transition-all ${l?"-rotate-45 -translate-y-2":""}`})]})]})]}),D.jsxs("div",{className:`flex flex-col gap-6 pt-10 pb-4 md:hidden text-lg font-medium text-white/50 ${l?"opacity-100":"opacity-0"}`,children:[D.jsx("a",{href:"#features",onClick:()=>e(!1),className:"hover:text-white transition-colors border-b border-white/5 pb-2",children:"Services"}),D.jsx("a",{href:"#developers",onClick:()=>e(!1),className:"hover:text-white transition-colors border-b border-white/5 pb-2",children:"Developers"}),D.jsx("a",{href:"#pricing",onClick:()=>e(!1),className:"hover:text-white transition-colors border-b border-white/5 pb-2",children:"Pricing"}),D.jsx("a",{href:"#about",onClick:()=>e(!1),className:"hover:text-white transition-colors border-b border-white/5 pb-2",children:"About"}),D.jsx("button",{className:"text-left py-2 hover:text-white transition-colors",children:"Log in"})]})]})})},oe=Number.isFinite||function(l){return typeof l=="number"&&isFinite(l)},gy=Number.isSafeInteger||function(l){return typeof l=="number"&&Math.abs(l)<=my},my=Number.MAX_SAFE_INTEGER||9007199254740991;let ye=(function(l){return l.NETWORK_ERROR="networkError",l.MEDIA_ERROR="mediaError",l.KEY_SYSTEM_ERROR="keySystemError",l.MUX_ERROR="muxError",l.OTHER_ERROR="otherError",l})({}),G=(function(l){return l.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",l.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",l.KEY_SYSTEM_NO_SESSION="keySystemNoSession",l.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",l.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",l.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",l.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",l.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",l.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",l.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",l.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",l.MANIFEST_LOAD_ERROR="manifestLoadError",l.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",l.MANIFEST_PARSING_ERROR="manifestParsingError",l.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",l.LEVEL_EMPTY_ERROR="levelEmptyError",l.LEVEL_LOAD_ERROR="levelLoadError",l.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",l.LEVEL_PARSING_ERROR="levelParsingError",l.LEVEL_SWITCH_ERROR="levelSwitchError",l.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",l.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",l.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",l.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",l.FRAG_LOAD_ERROR="fragLoadError",l.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",l.FRAG_DECRYPT_ERROR="fragDecryptError",l.FRAG_PARSING_ERROR="fragParsingError",l.FRAG_GAP="fragGap",l.REMUX_ALLOC_ERROR="remuxAllocError",l.KEY_LOAD_ERROR="keyLoadError",l.KEY_LOAD_TIMEOUT="keyLoadTimeOut",l.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",l.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",l.BUFFER_APPEND_ERROR="bufferAppendError",l.BUFFER_APPENDING_ERROR="bufferAppendingError",l.BUFFER_STALLED_ERROR="bufferStalledError",l.BUFFER_FULL_ERROR="bufferFullError",l.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",l.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",l.ASSET_LIST_LOAD_ERROR="assetListLoadError",l.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",l.ASSET_LIST_PARSING_ERROR="assetListParsingError",l.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",l.INTERNAL_EXCEPTION="internalException",l.INTERNAL_ABORTED="aborted",l.ATTACH_MEDIA_ERROR="attachMediaError",l.UNKNOWN="unknown",l})({}),S=(function(l){return l.MEDIA_ATTACHING="hlsMediaAttaching",l.MEDIA_ATTACHED="hlsMediaAttached",l.MEDIA_DETACHING="hlsMediaDetaching",l.MEDIA_DETACHED="hlsMediaDetached",l.MEDIA_ENDED="hlsMediaEnded",l.STALL_RESOLVED="hlsStallResolved",l.BUFFER_RESET="hlsBufferReset",l.BUFFER_CODECS="hlsBufferCodecs",l.BUFFER_CREATED="hlsBufferCreated",l.BUFFER_APPENDING="hlsBufferAppending",l.BUFFER_APPENDED="hlsBufferAppended",l.BUFFER_EOS="hlsBufferEos",l.BUFFERED_TO_END="hlsBufferedToEnd",l.BUFFER_FLUSHING="hlsBufferFlushing",l.BUFFER_FLUSHED="hlsBufferFlushed",l.MANIFEST_LOADING="hlsManifestLoading",l.MANIFEST_LOADED="hlsManifestLoaded",l.MANIFEST_PARSED="hlsManifestParsed",l.LEVEL_SWITCHING="hlsLevelSwitching",l.LEVEL_SWITCHED="hlsLevelSwitched",l.LEVEL_LOADING="hlsLevelLoading",l.LEVEL_LOADED="hlsLevelLoaded",l.LEVEL_UPDATED="hlsLevelUpdated",l.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",l.LEVELS_UPDATED="hlsLevelsUpdated",l.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",l.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",l.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",l.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",l.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",l.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",l.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",l.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",l.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",l.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",l.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",l.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",l.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",l.CUES_PARSED="hlsCuesParsed",l.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",l.INIT_PTS_FOUND="hlsInitPtsFound",l.FRAG_LOADING="hlsFragLoading",l.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",l.FRAG_LOADED="hlsFragLoaded",l.FRAG_DECRYPTED="hlsFragDecrypted",l.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",l.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",l.FRAG_PARSING_METADATA="hlsFragParsingMetadata",l.FRAG_PARSED="hlsFragParsed",l.FRAG_BUFFERED="hlsFragBuffered",l.FRAG_CHANGED="hlsFragChanged",l.FPS_DROP="hlsFpsDrop",l.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",l.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",l.ERROR="hlsError",l.DESTROYING="hlsDestroying",l.KEY_LOADING="hlsKeyLoading",l.KEY_LOADED="hlsKeyLoaded",l.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",l.BACK_BUFFER_REACHED="hlsBackBufferReached",l.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",l.ASSET_LIST_LOADING="hlsAssetListLoading",l.ASSET_LIST_LOADED="hlsAssetListLoaded",l.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",l.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",l.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",l.INTERSTITIAL_STARTED="hlsInterstitialStarted",l.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",l.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",l.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",l.INTERSTITIAL_ENDED="hlsInterstitialEnded",l.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",l.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",l.EVENT_CUE_ENTER="hlsEventCueEnter",l})({});var ke={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},fe={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class ns{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class py{constructor(e,t,i,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ns(e),this.fast_=new ns(t),this.defaultTTFB_=s,this.ttfb_=new ns(e)}update(e,t){const{slow_:i,fast_:s,ttfb_:a}=this;i.halfLife!==e&&(this.slow_=new ns(e,i.getEstimate(),i.getTotalWeight())),s.halfLife!==t&&(this.fast_=new ns(t,s.getEstimate(),s.getTotalWeight())),a.halfLife!==e&&(this.ttfb_=new ns(e,a.getEstimate(),a.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,s=e/1e3,a=i/s;this.fast_.sample(s,a),this.slow_.sample(s,a)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function yy(l,e,t){return(e=Ey(e))in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}function Me(){return Me=Object.assign?Object.assign.bind():function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(l[i]=t[i])}return l},Me.apply(null,arguments)}function cf(l,e){var t=Object.keys(l);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(l);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(l,s).enumerable})),t.push.apply(t,i)}return t}function Oe(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?cf(Object(t),!0).forEach(function(i){yy(l,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(t)):cf(Object(t)).forEach(function(i){Object.defineProperty(l,i,Object.getOwnPropertyDescriptor(t,i))})}return l}function vy(l,e){if(typeof l!="object"||!l)return l;var t=l[Symbol.toPrimitive];if(t!==void 0){var i=t.call(l,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(l)}function Ey(l){var e=vy(l,"string");return typeof e=="symbol"?e:e+""}class qt{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${e}]:`;this.trace=rn,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}}const rn=function(){},xy={trace:rn,debug:rn,log:rn,warn:rn,info:rn,error:rn};function Iu(){return Me({},xy)}function Sy(l,e){const t=self.console[l];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${l}] >`):rn}function df(l,e,t){return e[l]?e[l].bind(e):Sy(l,t)}const Ru=Iu();function Ty(l,e,t){const i=Iu();if(typeof console=="object"&&l===!0||typeof l=="object"){const s=["debug","log","info","warn","error"];s.forEach(a=>{i[a]=df(a,l,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Iu()}s.forEach(a=>{Ru[a]=df(a,l)})}else Me(Ru,i);return i}const Ne=Ru;function ln(l=!0){return typeof self>"u"?void 0:(l||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function Ay(l){return typeof self<"u"&&l===self.ManagedMediaSource}function wg(l,e){const t=Object.keys(l),i=Object.keys(e),s=t.length,a=i.length;return!s||!a||s===a&&!t.some(o=>i.indexOf(o)===-1)}function $t(l,e=!1){if(typeof TextDecoder<"u"){const d=new TextDecoder("utf-8").decode(l);if(e){const f=d.indexOf("\0");return f!==-1?d.substring(0,f):d}return d.replace(/\0/g,"")}const t=l.length;let i,s,a,o="",u=0;for(;u<t;){if(i=l[u++],i===0&&e)return o;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:s=l[u++],o+=String.fromCharCode((i&31)<<6|s&63);break;case 14:s=l[u++],a=l[u++],o+=String.fromCharCode((i&15)<<12|(s&63)<<6|(a&63)<<0);break}}return o}function ft(l){let e="";for(let t=0;t<l.length;t++){let i=l[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}function Cg(l){return Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function Ly(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var tu={exports:{}},hf;function Iy(){return hf||(hf=1,(function(l,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,u={buildAbsoluteURL:function(h,d,f){if(f=f||{},h=h.trim(),d=d.trim(),!d){if(!f.alwaysNormalize)return h;var m=u.parseURL(h);if(!m)throw new Error("Error trying to parse base URL.");return m.path=u.normalizePath(m.path),u.buildURLFromParts(m)}var p=u.parseURL(d);if(!p)throw new Error("Error trying to parse relative URL.");if(p.scheme)return f.alwaysNormalize?(p.path=u.normalizePath(p.path),u.buildURLFromParts(p)):d;var v=u.parseURL(h);if(!v)throw new Error("Error trying to parse base URL.");if(!v.netLoc&&v.path&&v.path[0]!=="/"){var E=s.exec(v.path);v.netLoc=E[1],v.path=E[2]}v.netLoc&&!v.path&&(v.path="/");var A={scheme:v.scheme,netLoc:p.netLoc,path:null,params:p.params,query:p.query,fragment:p.fragment};if(!p.netLoc&&(A.netLoc=v.netLoc,p.path[0]!=="/"))if(!p.path)A.path=v.path,p.params||(A.params=v.params,p.query||(A.query=v.query));else{var T=v.path,I=T.substring(0,T.lastIndexOf("/")+1)+p.path;A.path=u.normalizePath(I)}return A.path===null&&(A.path=f.alwaysNormalize?u.normalizePath(p.path):p.path),u.buildURLFromParts(A)},parseURL:function(h){var d=i.exec(h);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(h){for(h=h.split("").reverse().join("").replace(a,"");h.length!==(h=h.replace(o,"")).length;);return h.split("").reverse().join("")},buildURLFromParts:function(h){return h.scheme+h.netLoc+h.path+h.params+h.query+h.fragment}};l.exports=u})()})(tu)),tu.exports}var Hu=Iy();class Wu{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Fe={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Dg{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,_y(this,"stats")}setByteRange(e,t){const i=e.split("@",2);let s;i.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(i[1]),this._byteRange=[s,parseInt(i[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Fe.AUDIO]:null,[Fe.VIDEO]:null,[Fe.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Wu),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Hu.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Fe.AUDIO]=null,e[Fe.VIDEO]=null,e[Fe.AUDIOVIDEO]=null}}function Ze(l){return l.sn!=="initSegment"}class iu extends Dg{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(oe(e)&&oe(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const i=Object.keys(t);if(i.length===1){const s=this._decryptdata=t[i[0]]||null;s&&(this._decryptdata=s.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=oe(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const i=Object.keys(this.levelkeys),s=i.length;if(s>1||s===1&&(t=this.levelkeys[i[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!oe(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Ze(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var i;const s=t[e];s&&!((i=this._decryptdata)!=null&&i.keyId)&&(this._decryptdata=s.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,s,a,o=!1){const{elementaryStreams:u}=this,h=u[e];if(!h){u[e]={startPTS:t,endPTS:i,startDTS:s,endDTS:a,partial:o};return}h.startPTS=Math.min(h.startPTS,t),h.endPTS=Math.max(h.endPTS,i),h.startDTS=Math.min(h.startDTS,s),h.endDTS=Math.max(h.endDTS,a)}}class Ry extends Dg{constructor(e,t,i,s,a){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,a),a&&(this.fragOffset=a.fragOffset+a.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function bg(l,e){const t=Object.getPrototypeOf(l);if(t){const i=Object.getOwnPropertyDescriptor(t,e);return i||bg(t,e)}}function _y(l,e){const t=bg(l,e);t&&(t.enumerable=!0,Object.defineProperty(l,e,t))}const ff=Math.pow(2,32)-1,ky=[].push,Pg={video:1,audio:2,id3:3,text:4};function nt(l){return String.fromCharCode.apply(null,l)}function Og(l,e){const t=l[e]<<8|l[e+1];return t<0?65536+t:t}function Ae(l,e){const t=Ng(l,e);return t<0?4294967296+t:t}function gf(l,e){let t=Ae(l,e);return t*=Math.pow(2,32),t+=Ae(l,e+4),t}function Ng(l,e){return l[e]<<24|l[e+1]<<16|l[e+2]<<8|l[e+3]}function wy(l){const e=l.byteLength;for(let t=0;t<e;){const i=Ae(l,t);if(i>8&&l[t+4]===109&&l[t+5]===111&&l[t+6]===111&&l[t+7]===102)return!0;t=i>1?t+i:e}return!1}function Re(l,e){const t=[];if(!e.length)return t;const i=l.byteLength;for(let s=0;s<i;){const a=Ae(l,s),o=nt(l.subarray(s+4,s+8)),u=a>1?s+a:i;if(o===e[0])if(e.length===1)t.push(l.subarray(s+8,u));else{const h=Re(l.subarray(s+8,u),e.slice(1));h.length&&ky.apply(t,h)}s=u}return t}function Cy(l){const e=[],t=l[0];let i=8;const s=Ae(l,i);i+=4;let a=0,o=0;t===0?(a=Ae(l,i),o=Ae(l,i+4),i+=8):(a=gf(l,i),o=gf(l,i+8),i+=16),i+=2;let u=l.length+o;const h=Og(l,i);i+=2;for(let d=0;d<h;d++){let f=i;const m=Ae(l,f);f+=4;const p=m&2147483647;if((m&2147483648)>>>31===1)return Ne.warn("SIDX has hierarchical references (not supported)"),null;const E=Ae(l,f);f+=4,e.push({referenceSize:p,subsegmentDuration:E,info:{duration:E/s,start:u,end:u+p-1}}),u+=p,f+=4,i=f}return{earliestPresentationTime:a,timescale:s,version:t,referencesCount:h,references:e}}function Mg(l){const e=[],t=Re(l,["moov","trak"]);for(let s=0;s<t.length;s++){const a=t[s],o=Re(a,["tkhd"])[0];if(o){let u=o[0];const h=Ae(o,u===0?12:20),d=Re(a,["mdia","mdhd"])[0];if(d){u=d[0];const f=Ae(d,u===0?12:20),m=Re(a,["mdia","hdlr"])[0];if(m){const p=nt(m.subarray(8,12)),v={soun:Fe.AUDIO,vide:Fe.VIDEO}[p],E=Re(a,["mdia","minf","stbl","stsd"])[0],A=Dy(E);v?(e[h]={timescale:f,type:v,stsd:A},e[v]=Oe({timescale:f,id:h},A)):e[h]={timescale:f,type:p,stsd:A}}}}}return Re(l,["moov","mvex","trex"]).forEach(s=>{const a=Ae(s,4),o=e[a];o&&(o.default={duration:Ae(s,12),flags:Ae(s,20)})}),e}function Dy(l){const e=l.subarray(8),t=e.subarray(86),i=nt(e.subarray(4,8));let s=i,a;const o=i==="enca"||i==="encv";if(o){const d=Re(e,[i])[0].subarray(i==="enca"?28:78);Re(d,["sinf"]).forEach(m=>{const p=Re(m,["schm"])[0];if(p){const v=nt(p.subarray(4,8));if(v==="cbcs"||v==="cenc"){const E=Re(m,["frma"])[0];E&&(s=nt(E))}}})}const u=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const h=Re(t,["avcC"])[0];h&&h.length>3&&(s+="."+La(h[1])+La(h[2])+La(h[3]),a=Aa(u==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const h=Re(e,[i])[0],d=Re(h.subarray(28),["esds"])[0];if(d&&d.length>7){let f=4;if(d[f++]!==3)break;f=nu(d,f),f+=2;const m=d[f++];if(m&128&&(f+=2),m&64&&(f+=d[f++]),d[f++]!==4)break;f=nu(d,f);const p=d[f++];if(p===64)s+="."+La(p);else break;if(f+=12,d[f++]!==5)break;f=nu(d,f);const v=d[f++];let E=(v&248)>>3;E===31&&(E+=1+((v&7)<<3)+((d[f]&224)>>5)),s+="."+E}break}case"hvc1":case"hev1":{const h=Re(t,["hvcC"])[0];if(h&&h.length>12){const d=h[1],f=["","A","B","C"][d>>6],m=d&31,p=Ae(h,2),v=(d&32)>>5?"H":"L",E=h[12],A=h.subarray(6,12);s+="."+f+m,s+="."+by(p).toString(16).toUpperCase(),s+="."+v+E;let T="";for(let I=A.length;I--;){const R=A[I];(R||T)&&(T="."+R.toString(16).toUpperCase()+T)}s+=T}a=Aa(u=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=Aa(s,t)||s;break}case"vp09":{const h=Re(t,["vpcC"])[0];if(h&&h.length>6){const d=h[4],f=h[5],m=h[6]>>4&15;s+="."+pi(d)+"."+pi(f)+"."+pi(m)}break}case"av01":{const h=Re(t,["av1C"])[0];if(h&&h.length>2){const d=h[1]>>>5,f=h[1]&31,m=h[2]>>>7?"H":"M",p=(h[2]&64)>>6,v=(h[2]&32)>>5,E=d===2&&p?v?12:10:p?10:8,A=(h[2]&16)>>4,T=(h[2]&8)>>3,I=(h[2]&4)>>2,R=h[2]&3;s+="."+d+"."+pi(f)+m+"."+pi(E)+"."+A+"."+T+I+R+"."+pi(1)+"."+pi(1)+"."+pi(1)+"."+0,a=Aa("dav1",t)}break}}return{codec:s,encrypted:o,supplemental:a}}function Aa(l,e){const t=Re(e,["dvvC"]),i=t.length?t[0]:Re(e,["dvcC"])[0];if(i){const s=i[2]>>1&127,a=i[2]<<5&32|i[3]>>3&31;return l+"."+pi(s)+"."+pi(a)}}function by(l){let e=0;for(let t=0;t<32;t++)e|=(l>>t&1)<<31-t;return e>>>0}function nu(l,e){const t=e+5;for(;l[e++]&128&&e<t;);return e}function La(l){return("0"+l.toString(16).toUpperCase()).slice(-2)}function pi(l){return(l<10?"0":"")+l}function Py(l,e){if(!l||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&Fg(l,(i,s)=>{const a=i.subarray(8,24);a.some(o=>o!==0)||(Ne.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${ft(a)} -> ${ft(t)}`),i.set(t,8))})}function Oy(l){const e=[];return Fg(l,t=>e.push(t.subarray(8,24))),e}function Fg(l,e){Re(l,["moov","trak"]).forEach(i=>{const s=Re(i,["mdia","minf","stbl","stsd"])[0];if(!s)return;const a=s.subarray(8);let o=Re(a,["enca"]);const u=o.length>0;u||(o=Re(a,["encv"])),o.forEach(h=>{const d=u?h.subarray(28):h.subarray(78);Re(d,["sinf"]).forEach(m=>{const p=Bg(m);p&&e(p,u)})})})}function Bg(l){const e=Re(l,["schm"])[0];if(e){const t=nt(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const i=Re(l,["schi","tenc"])[0];if(i)return i}}}function Ny(l,e,t){const i={},s=Re(l,["moof","traf"]);for(let a=0;a<s.length;a++){const o=s[a],u=Re(o,["tfhd"])[0],h=Ae(u,4),d=e[h];if(!d)continue;i[h]||(i[h]={start:NaN,duration:0,sampleCount:0,timescale:d.timescale,type:d.type});const f=i[h],m=Re(o,["tfdt"])[0];if(m){const _=m[0];let C=Ae(m,4);_===1&&(C===ff?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(C*=ff+1,C+=Ae(m,8))),oe(C)&&(!oe(f.start)||C<f.start)&&(f.start=C)}const p=d.default,v=Ae(u,0)|(p==null?void 0:p.flags);let E=(p==null?void 0:p.duration)||0;v&8&&(v&2?E=Ae(u,12):E=Ae(u,8));const A=Re(o,["trun"]);let T=f.start||0,I=0,R=E;for(let _=0;_<A.length;_++){const C=A[_],b=Ae(C,4),K=f.sampleCount;f.sampleCount+=b;const O=C[3]&1,B=C[3]&4,U=C[2]&1,M=C[2]&2,z=C[2]&4,te=C[2]&8;let se=8,le=b;for(O&&(se+=4),B&&b&&(!(C[se+1]&1)&&f.keyFrameIndex===void 0&&(f.keyFrameIndex=K),se+=4,U?(R=Ae(C,se),se+=4):R=E,M&&(se+=4),te&&(se+=4),T+=R,I+=R,le--);le--;)U?(R=Ae(C,se),se+=4):R=E,M&&(se+=4),z&&(C[se+1]&1||f.keyFrameIndex===void 0&&(f.keyFrameIndex=f.sampleCount-(le+1),f.keyFrameStart=T),se+=4),te&&(se+=4),T+=R,I+=R;!I&&E&&(I+=E*b)}f.duration+=I}if(!Object.keys(i).some(a=>i[a].duration)){let a=1/0,o=0;const u=Re(l,["sidx"]);for(let h=0;h<u.length;h++){const d=Cy(u[h]);if(d!=null&&d.references){a=Math.min(a,d.earliestPresentationTime/d.timescale);const f=d.references.reduce((m,p)=>m+p.info.duration||0,0);o=Math.max(o,f+d.earliestPresentationTime/d.timescale)}}o&&oe(o)&&Object.keys(i).forEach(h=>{i[h].duration||(i[h].duration=o*i[h].timescale-i[h].start)})}return i}function My(l){const e={valid:null,remainder:null},t=Re(l,["moof"]);if(t.length<2)return e.remainder=l,e;const i=t[t.length-1];return e.valid=l.slice(0,i.byteOffset-8),e.remainder=l.slice(i.byteOffset-8),e}function Yt(l,e){const t=new Uint8Array(l.length+e.length);return t.set(l),t.set(e,l.length),t}function mf(l,e){const t=[],i=e.samples,s=e.timescale,a=e.id;let o=!1;return Re(i,["moof"]).map(h=>{const d=h.byteOffset-8;Re(h,["traf"]).map(m=>{const p=Re(m,["tfdt"]).map(v=>{const E=v[0];let A=Ae(v,4);return E===1&&(A*=Math.pow(2,32),A+=Ae(v,8)),A/s})[0];return p!==void 0&&(l=p),Re(m,["tfhd"]).map(v=>{const E=Ae(v,4),A=Ae(v,0)&16777215,T=(A&1)!==0,I=(A&2)!==0,R=(A&8)!==0;let _=0;const C=(A&16)!==0;let b=0;const K=(A&32)!==0;let O=8;E===a&&(T&&(O+=8),I&&(O+=4),R&&(_=Ae(v,O),O+=4),C&&(b=Ae(v,O),O+=4),K&&(O+=4),e.type==="video"&&(o=no(e.codec)),Re(m,["trun"]).map(B=>{const U=B[0],M=Ae(B,0)&16777215,z=(M&1)!==0;let te=0;const se=(M&4)!==0,le=(M&256)!==0;let ae=0;const J=(M&512)!==0;let ne=0;const H=(M&1024)!==0,Q=(M&2048)!==0;let q=0;const k=Ae(B,4);let F=8;z&&(te=Ae(B,F),F+=4),se&&(F+=4);let re=te+d;for(let de=0;de<k;de++){if(le?(ae=Ae(B,F),F+=4):ae=_,J?(ne=Ae(B,F),F+=4):ne=b,H&&(F+=4),Q&&(U===0?q=Ae(B,F):q=Ng(B,F),F+=4),e.type===Fe.VIDEO){let ue=0;for(;ue<ne;){const he=Ae(i,re);if(re+=4,Fy(o,i[re])){const Ie=i.subarray(re,re+he);zu(Ie,o?2:1,l+q/s,t)}re+=he,ue+=he+4}}l+=ae/s}}))})})}),t}function no(l){if(!l)return!1;const e=l.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function Fy(l,e){if(l){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function zu(l,e,t,i){const s=Ug(l);let a=0;a+=e;let o=0,u=0,h=0;for(;a<s.length;){o=0;do{if(a>=s.length)break;h=s[a++],o+=h}while(h===255);u=0;do{if(a>=s.length)break;h=s[a++],u+=h}while(h===255);const d=s.length-a;let f=a;if(u<d)a+=u;else if(u>d){Ne.error(`Malformed SEI payload. ${u} is too small, only ${d} bytes left to parse.`);break}if(o===4){if(s[f++]===181){const p=Og(s,f);if(f+=2,p===49){const v=Ae(s,f);if(f+=4,v===1195456820){const E=s[f++];if(E===3){const A=s[f++],T=31&A,I=64&A,R=I?2+T*3:0,_=new Uint8Array(R);if(I){_[0]=A;for(let C=1;C<R;C++)_[C]=s[f++]}i.push({type:E,payloadType:o,pts:t,bytes:_})}}}}}else if(o===5&&u>16){const m=[];for(let E=0;E<16;E++){const A=s[f++].toString(16);m.push(A.length==1?"0"+A:A),(E===3||E===5||E===7||E===9)&&m.push("-")}const p=u-16,v=new Uint8Array(p);for(let E=0;E<p;E++)v[E]=s[f++];i.push({payloadType:o,pts:t,uuid:m.join(""),userData:$t(v),userDataBytes:v})}}}function Ug(l){const e=l.byteLength,t=[];let i=1;for(;i<e-2;)l[i]===0&&l[i+1]===0&&l[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return l;const s=e-t.length,a=new Uint8Array(s);let o=0;for(i=0;i<s;o++,i++)o===t[0]&&(o++,t.shift()),a[i]=l[o];return a}function By(l){const e=l[0];let t="",i="",s=0,a=0,o=0,u=0,h=0,d=0;if(e===0){for(;nt(l.subarray(d,d+1))!=="\0";)t+=nt(l.subarray(d,d+1)),d+=1;for(t+=nt(l.subarray(d,d+1)),d+=1;nt(l.subarray(d,d+1))!=="\0";)i+=nt(l.subarray(d,d+1)),d+=1;i+=nt(l.subarray(d,d+1)),d+=1,s=Ae(l,12),a=Ae(l,16),u=Ae(l,20),h=Ae(l,24),d=28}else if(e===1){d+=4,s=Ae(l,d),d+=4;const m=Ae(l,d);d+=4;const p=Ae(l,d);for(d+=4,o=2**32*m+p,gy(o)||(o=Number.MAX_SAFE_INTEGER,Ne.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),u=Ae(l,d),d+=4,h=Ae(l,d),d+=4;nt(l.subarray(d,d+1))!=="\0";)t+=nt(l.subarray(d,d+1)),d+=1;for(t+=nt(l.subarray(d,d+1)),d+=1;nt(l.subarray(d,d+1))!=="\0";)i+=nt(l.subarray(d,d+1)),d+=1;i+=nt(l.subarray(d,d+1)),d+=1}const f=l.subarray(d,l.byteLength);return{schemeIdUri:t,value:i,timeScale:s,presentationTime:o,presentationTimeDelta:a,eventDuration:u,id:h,payload:f}}function Uy(l,...e){const t=e.length;let i=8,s=t;for(;s--;)i+=e[s].byteLength;const a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=i&255,a.set(l,4),s=0,i=8;s<t;s++)a.set(e[s],i),i+=e[s].byteLength;return a}function $y(l,e,t){if(l.byteLength!==16)throw new RangeError("Invalid system id");let i,s;i=0,s=new Uint8Array;let a;i>0?(a=new Uint8Array(4),e.length>0&&new DataView(a.buffer).setUint32(0,e.length,!1)):a=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),Uy([112,115,115,104],new Uint8Array([i,0,0,0]),l,a,s,o,t)}function Gy(l){const e=[];if(l instanceof ArrayBuffer){const t=l.byteLength;let i=0;for(;i+32<t;){const s=new DataView(l,i),a=jy(s);e.push(a),i+=a.size}}return e}function jy(l){const e=l.getUint32(0),t=l.byteOffset,i=l.byteLength;if(i<e)return{offset:t,size:i};if(l.getUint32(4)!==1886614376)return{offset:t,size:e};const a=l.getUint32(8)>>>24;if(a!==0&&a!==1)return{offset:t,size:e};const o=l.buffer,u=ft(new Uint8Array(o,t+12,16));let h=null,d=null,f=0;if(a===0)f=28;else{const p=l.getUint32(28);if(!p||i<32+p*16)return{offset:t,size:e};h=[];for(let v=0;v<p;v++)h.push(new Uint8Array(o,t+32+v*16,16));f=32+p*16}if(!f)return{offset:t,size:e};const m=l.getUint32(f);return e-32<m?{offset:t,size:e}:(d=new Uint8Array(o,t+f+4,m),{version:a,systemId:u,kids:h,data:d,offset:t,size:e})}const $g=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),gs={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Yu(l,e){const t=gs[e];return!!t&&!!t[l.slice(0,4)]}function or(l,e,t=!0){return!l.split(",").some(i=>!qu(i,e,t))}function qu(l,e,t=!0){var i;const s=ln(t);return(i=s==null?void 0:s.isTypeSupported(lr(l,e)))!=null?i:!1}function lr(l,e){return`${e}/mp4;codecs=${l}`}function pf(l){if(l){const e=l.substring(0,4);return gs.video[e]}return 2}function Wa(l){const e=$g();return l.split(",").reduce((t,i)=>{const a=e&&no(i)?9:gs.video[i];return a?(a*2+t)/(t?3:2):(gs.audio[i]+t)/(t?2:1)},0)}const su={};function Ky(l,e=!0){if(su[l])return su[l];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[l];for(let s=0;s<t.length;s++){var i;if(qu(t[s],"audio",e))return su[l]=t[s],t[s];if(t[s]==="mp3"&&(i=ln(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return l}const Vy=/flac|opus|mp4a\.40\.34/i;function za(l,e=!0){return l.replace(Vy,t=>Ky(t.toLowerCase(),e))}function Hy(l,e){const t=[];if(l){const i=l.split(",");for(let s=0;s<i.length;s++)Yu(i[s],"video")||t.push(i[s])}return e&&t.push(e),t.join(",")}function Ba(l,e){if(l&&(l.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(l)!==-1)&&(yf(l,"audio")||yf(l,"video")))return l;if(e){const t=e.split(",");if(t.length>1){if(l){for(let i=t.length;i--;)if(t[i].substring(0,4)===l.substring(0,4))return t[i]}return t[0]}}return e||l}function yf(l,e){return Yu(l,e)&&qu(l,e)}function Wy(l){const e=l.split(",");for(let t=0;t<e.length;t++){const i=e[t].split(".");i.length>2&&i[0]==="avc1"&&(e[t]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return e.join(",")}function zy(l){if(l.startsWith("av01.")){const e=l.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return l}function vf(l){const e=ln(l)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function _u(l){return l.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Yy={supported:!0,powerEfficient:!0,smooth:!0},qy={supported:!1,smooth:!1,powerEfficient:!1},Gg={supported:!0,configurations:[],decodingInfoResults:[Yy]};function jg(l,e){return{supported:!1,configurations:e,decodingInfoResults:[qy],error:l}}function Qy(l,e,t,i,s,a){const o=l.videoCodec,u=l.audioCodec?l.audioGroups:null,h=a==null?void 0:a.audioCodec,d=a==null?void 0:a.channels,f=d?parseInt(d):h?1/0:2;let m=null;if(u!=null&&u.length)try{u.length===1&&u[0]?m=e.groups[u[0]].channels:m=u.reduce((p,v)=>{if(v){const E=e.groups[v];if(!E)throw new Error(`Audio track group ${v} not found`);Object.keys(E.channels).forEach(A=>{p[A]=(p[A]||0)+E.channels[A]})}return p},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(p=>no(p))||l.width>1920&&l.height>1088||l.height>1920&&l.width>1088||l.frameRate>Math.max(i,30)||l.videoRange!=="SDR"&&l.videoRange!==t||l.bitrate>Math.max(s,8e6))||!!m&&oe(f)&&Object.keys(m).some(p=>parseInt(p)>f)}function Kg(l,e,t,i={}){const s=l.videoCodec;if(!s&&!l.audioCodec||!t)return Promise.resolve(Gg);const a=[],o=Xy(l),u=o.length,h=Zy(l,e,u>0),d=h.length;for(let f=u||1*d||1;f--;){const m={type:"media-source"};if(u&&(m.video=o[f%u]),d){m.audio=h[f%d];const p=m.audio.bitrate;m.video&&p&&(m.video.bitrate-=p)}a.push(m)}if(s){const f=navigator.userAgent;if(s.split(",").some(m=>no(m))&&$g())return Promise.resolve(jg(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${f})`),a))}return Promise.all(a.map(f=>{const m=ev(f);return i[m]||(i[m]=t.decodingInfo(f))})).then(f=>({supported:!f.some(m=>!m.supported),configurations:a,decodingInfoResults:f})).catch(f=>({supported:!1,configurations:a,decodingInfoResults:[],error:f}))}function Xy(l){var e;const t=(e=l.videoCodec)==null?void 0:e.split(","),i=Vg(l),s=l.width||640,a=l.height||480,o=l.frameRate||30,u=l.videoRange.toLowerCase();return t?t.map(h=>{const d={contentType:lr(zy(h),"video"),width:s,height:a,bitrate:i,framerate:o};return u!=="sdr"&&(d.transferFunction=u),d}):[]}function Zy(l,e,t){var i;const s=(i=l.audioCodec)==null?void 0:i.split(","),a=Vg(l);return s&&l.audioGroups?l.audioGroups.reduce((o,u)=>{var h;const d=u?(h=e.groups[u])==null?void 0:h.tracks:null;return d?d.reduce((f,m)=>{if(m.groupId===u){const p=parseFloat(m.channels||"");s.forEach(v=>{const E={contentType:lr(v,"audio"),bitrate:t?Jy(v,a):a};p&&(E.channels=""+p),f.push(E)})}return f},o):o},[]):[]}function Jy(l,e){if(e<=1)return 1;let t=128e3;return l==="ec-3"?t=768e3:l==="ac-3"&&(t=64e4),Math.min(e/2,t)}function Vg(l){return Math.ceil(Math.max(l.bitrate*.9,l.averageBitrate)/1e3)*1e3||1}function ev(l){let e="";const{audio:t,video:i}=l;if(i){const s=_u(i.contentType);e+=`${s}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(t){const s=_u(t.contentType);e+=`${i?"_":""}${s}_c${t.channels}`}return e}const ku=["NONE","TYPE-0","TYPE-1",null];function tv(l){return ku.indexOf(l)>-1}const Ya=["SDR","PQ","HLG"];function iv(l){return!!l&&Ya.indexOf(l)>-1}var Ua={No:"",Yes:"YES",v2:"v2"};function Ef(l){const{canSkipUntil:e,canSkipDateRanges:t,age:i}=l,s=i<e/2;return e&&s?t?Ua.v2:Ua.Yes:Ua.No}class xf{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class ur{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Sf(this._audioGroups,e)}hasSubtitleGroup(e){return Sf(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Sf(l,e){return!e||!l?!1:l.indexOf(e)!==-1}function nv(){if(typeof matchMedia=="function"){const l=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(l.media!==e.media)return l.matches===!0}return!1}function sv(l,e){let t=!1,i=[];if(l&&(t=l!=="SDR",i=[l]),e){i=e.allowedVideoRanges||Ya.slice(0);const s=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&nv(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}const rv=l=>{const e=new WeakSet;return(t,i)=>{if(l&&(i=l(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},Be=(l,e)=>JSON.stringify(l,rv(e));function av(l,e,t,i,s){const a=Object.keys(l),o=i==null?void 0:i.channels,u=i==null?void 0:i.audioCodec,h=s==null?void 0:s.videoCodec,d=o&&parseInt(o)===2;let f=!1,m=!1,p=1/0,v=1/0,E=1/0,A=1/0,T=0,I=[];const{preferHDR:R,allowedVideoRanges:_}=sv(e,s);for(let B=a.length;B--;){const U=l[a[B]];f||(f=U.channels[2]>0),p=Math.min(p,U.minHeight),v=Math.min(v,U.minFramerate),E=Math.min(E,U.minBitrate),_.filter(z=>U.videoRanges[z]>0).length>0&&(m=!0)}p=oe(p)?p:0,v=oe(v)?v:0;const C=Math.max(1080,p),b=Math.max(30,v);E=oe(E)?E:t,t=Math.max(E,t),m||(e=void 0);const K=a.length>1;return{codecSet:a.reduce((B,U)=>{const M=l[U];if(U===B)return B;if(I=m?_.filter(z=>M.videoRanges[z]>0):[],K){if(M.minBitrate>t)return gi(U,`min bitrate of ${M.minBitrate} > current estimate of ${t}`),B;if(!M.hasDefaultAudio)return gi(U,"no renditions with default or auto-select sound found"),B;if(u&&U.indexOf(u.substring(0,4))%5!==0)return gi(U,`audio codec preference "${u}" not found`),B;if(o&&!d){if(!M.channels[o])return gi(U,`no renditions with ${o} channel sound found (channels options: ${Object.keys(M.channels)})`),B}else if((!u||d)&&f&&M.channels[2]===0)return gi(U,"no renditions with stereo sound found"),B;if(M.minHeight>C)return gi(U,`min resolution of ${M.minHeight} > maximum of ${C}`),B;if(M.minFramerate>b)return gi(U,`min framerate of ${M.minFramerate} > maximum of ${b}`),B;if(!I.some(z=>M.videoRanges[z]>0))return gi(U,`no variants with VIDEO-RANGE of ${Be(I)} found`),B;if(h&&U.indexOf(h.substring(0,4))%5!==0)return gi(U,`video codec preference "${h}" not found`),B;if(M.maxScore<T)return gi(U,`max score of ${M.maxScore} < selected max of ${T}`),B}return B&&(Wa(U)>=Wa(B)||M.fragmentError>l[B].fragmentError)?B:(A=M.minIndex,T=M.maxScore,U)},void 0),videoRanges:I,preferHDR:R,minFramerate:v,minBitrate:E,minIndex:A}}function gi(l,e){Ne.log(`[abr] start candidates with "${l}" ignored because ${e}`)}function Hg(l){return l.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);const s=t.channels||"2";return i.channels[s]=(i.channels[s]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function ov(l,e,t,i){return l.slice(t,i+1).reduce((s,a,o)=>{if(!a.codecSet)return s;const u=a.audioGroups;let h=s[a.codecSet];h||(s[a.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!u,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,a.bitrate);const d=Math.min(a.height,a.width);return h.minHeight=Math.min(h.minHeight,d),h.minFramerate=Math.min(h.minFramerate,a.frameRate),h.minIndex=Math.min(h.minIndex,o),h.maxScore=Math.max(h.maxScore,a.score),h.fragmentError+=a.fragmentError,h.videoRanges[a.videoRange]=(h.videoRanges[a.videoRange]||0)+1,u&&u.forEach(f=>{if(!f)return;const m=e.groups[f];m&&(h.hasDefaultAudio=h.hasDefaultAudio||e.hasDefaultAudio?m.hasDefault:m.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(m.channels).forEach(p=>{h.channels[p]=(h.channels[p]||0)+m.channels[p]}))}),s},{})}function Tf(l){if(!l)return l;const{lang:e,assocLang:t,characteristics:i,channels:s,audioCodec:a}=l;return{lang:e,assocLang:t,characteristics:i,channels:s,audioCodec:a}}function vi(l,e,t){if("attrs"in l){const i=e.indexOf(l);if(i!==-1)return i}for(let i=0;i<e.length;i++){const s=e[i];if(kn(l,s,t))return i}return-1}function kn(l,e,t){const{groupId:i,name:s,lang:a,assocLang:o,default:u}=l,h=l.forced;return(i===void 0||e.groupId===i)&&(s===void 0||e.name===s)&&(a===void 0||lv(a,e.lang))&&(a===void 0||e.assocLang===o)&&(u===void 0||e.default===u)&&(h===void 0||e.forced===h)&&(!("characteristics"in l)||uv(l.characteristics||"",e.characteristics))&&(t===void 0||t(l,e))}function lv(l,e="--"){return l.length===e.length?l===e:l.startsWith(e)||e.startsWith(l)}function uv(l,e=""){const t=l.split(","),i=e.split(",");return t.length===i.length&&!t.some(s=>i.indexOf(s)===-1)}function _n(l,e){const{audioCodec:t,channels:i}=l;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function cv(l,e,t,i,s){const a=e[i],u=e.reduce((p,v,E)=>{const A=v.uri;return(p[A]||(p[A]=[])).push(E),p},{})[a.uri];u.length>1&&(i=Math.max.apply(Math,u));const h=a.videoRange,d=a.frameRate,f=a.codecSet.substring(0,4),m=Af(e,i,p=>{if(p.videoRange!==h||p.frameRate!==d||p.codecSet.substring(0,4)!==f)return!1;const v=p.audioGroups,E=t.filter(A=>!v||v.indexOf(A.groupId)!==-1);return vi(l,E,s)>-1});return m>-1?m:Af(e,i,p=>{const v=p.audioGroups,E=t.filter(A=>!v||v.indexOf(A.groupId)!==-1);return vi(l,E,s)>-1})}function Af(l,e,t){for(let i=e;i>-1;i--)if(t(l[i]))return i;for(let i=e+1;i<l.length;i++)if(t(l[i]))return i;return-1}function qa(l,e){var t;return!!l&&l!==((t=e.loadLevelObj)==null?void 0:t.uri)}class dv extends qt{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;const{fragCurrent:s,partCurrent:a,hls:o}=this,{autoLevelEnabled:u,media:h}=o;if(!s||!h)return;const d=performance.now(),f=a?a.stats:s.stats,m=a?a.duration:s.duration,p=d-f.loading.start,v=o.minAutoLevel,E=s.level,A=this._nextAutoLevel;if(f.aborted||f.loaded&&f.loaded===f.total||E<=v){this.clearTimer(),this._nextAutoLevel=-1;return}if(!u)return;const T=A>-1&&A!==E,I=!!t||T;if(!I&&(h.paused||!h.playbackRate||!h.readyState))return;const R=o.mainForwardBufferInfo;if(!I&&R===null)return;const _=this.bwEstimator.getEstimateTTFB(),C=Math.abs(h.playbackRate);if(p<=Math.max(_,1e3*(m/(C*2))))return;const b=R?R.len/C:0,K=f.loading.first?f.loading.first-f.loading.start:-1,O=f.loaded&&K>-1,B=this.getBwEstimate(),U=o.levels,M=U[E],z=Math.max(f.loaded,Math.round(m*(s.bitrate||M.averageBitrate)/8));let te=O?p-K:p;te<1&&O&&(te=Math.min(p,f.loaded*8/B));const se=O?f.loaded*1e3/te:0,le=_/1e3,ae=se?(z-f.loaded)/se:z*8/B+le;if(ae<=b)return;const J=se?se*8:B,ne=((i=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,H=this.hls.config.abrBandWidthUpFactor;let Q=Number.POSITIVE_INFINITY,q;for(q=E-1;q>v;q--){const de=U[q].maxBitrate,ue=!U[q].details||ne;if(Q=this.getTimeToLoadFrag(le,J,m*de,ue),Q<Math.min(b,m+le))break}if(Q>=ae||Q>m*10)return;O?this.bwEstimator.sample(p-Math.min(_,K),f.loaded):this.bwEstimator.sampleTTFB(p);const k=U[q].maxBitrate;this.getBwEstimate()*H>k&&this.resetEstimator(k);const F=this.findBestLevel(k,v,q,0,b,1,1);F>-1&&(q=F),this.warn(`Fragment ${s.sn}${a?" part "+a.index:""} of level ${E} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${b.toFixed(3)} s
      Estimated load time for current fragment: ${ae.toFixed(3)} s
      Estimated load time for down switch fragment: ${Q.toFixed(3)} s
      TTFB estimate: ${K|0} ms
      Current BW estimate: ${oe(B)?B|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${q} @ ${k|0} bps`),o.nextLoadLevel=o.nextAutoLevel=q,this.clearTimer();const re=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===q&&q>0){const de=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${q>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${de.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,q>v){let ue=this.findBestLevel(this.hls.levels[v].bitrate,v,q,0,de,1,1);ue===-1&&(ue=v),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ue,this.resetEstimator(this.hls.levels[ue].bitrate)}}};T||ae>Q*2?re():this.timer=self.setInterval(re,Q*1e3),o.trigger(S.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:a,stats:f})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new py(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(S.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var s;this.fragCurrent=i,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case G.BUFFER_ADD_CODEC_ERROR:case G.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case G.FRAG_LOAD_TIMEOUT:{const i=t.frag,{fragCurrent:s,partCurrent:a}=this;if(i&&s&&i.sn===s.sn&&i.level===s.level){const o=performance.now(),u=a?a.stats:i.stats,h=o-u.loading.start,d=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&d>-1){const m=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(h-Math.min(m,d),u.loaded)}else this.bwEstimator.sampleTTFB(h)}break}}}getTimeToLoadFrag(e,t,i,s){const a=e+i/t,o=s?e+this.lastLevelLoadSec:0;return a+o}onLevelLoaded(e,t){const i=this.hls.config,{loading:s}=t.stats,a=s.end-s.first;oe(a)&&(this.lastLevelLoadSec=a/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){const s=i?i.stats:t.stats;if(t.type===fe.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const a=i?i.duration:t.duration,o=this.hls.levels[t.level],u=(o.loaded?o.loaded.bytes:0)+s.loaded,h=(o.loaded?o.loaded.duration:0)+a;o.loaded={bytes:u,duration:h},o.realBitrate=Math.round(8*u/h)}if(t.bitrateTest){const a={stats:s,frag:t,part:i,id:t.type};this.onFragBuffered(S.FRAG_BUFFERED,a),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:i,part:s}=t,a=s!=null&&s.stats.loaded?s.stats:i.stats;if(a.aborted||this.ignoreFragment(i))return;const o=a.parsing.end-a.loading.start-Math.min(a.loading.first-a.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,a.loaded),a.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==fe.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,a=this.findBestLevel(i,t,e,0,s,1,1);if(a>-1)return a;const o=this.hls.firstLevel,u=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${u}`),u}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const a=i&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,a)&&o[e].loadError<=o[a].loadError)return e}return this._nextAutoLevel=a,this.nextAutoLevelKey=this.getAutoLevelKey(),a}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:s,config:a,minAutoLevel:o}=i,u=t?t.duration:e?e.duration:0,h=this.getBwEstimate(),d=this.getStarvationDelay();let f=a.abrBandWidthFactor,m=a.abrBandWidthUpFactor;if(d){const T=this.findBestLevel(h,o,s,d,0,f,m);if(T>=0)return this.rebufferNotice=-1,T}let p=u?Math.min(u,a.maxStarvationDelay):a.maxStarvationDelay;if(!d){const T=this.bitrateTestDelay;T&&(p=(u?Math.min(u,a.maxLoadingDelay):a.maxLoadingDelay)-T,this.info(`bitrate test took ${Math.round(1e3*T)}ms, set first fragment max fetchDuration to ${Math.round(1e3*p)} ms`),f=m=1)}const v=this.findBestLevel(h,o,s,d,p,f,m);if(this.rebufferNotice!==v&&(this.rebufferNotice=v,this.info(`${d?"rebuffering expected":"buffer is empty"}, optimal quality level ${v}`)),v>-1)return v;const E=i.levels[o],A=i.loadLevelObj;return A&&(E==null?void 0:E.bitrate)<A.bitrate?o:i.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,s,a,o,u){var h;const d=s+a,f=this.lastLoadedFragLevel,m=f===-1?this.hls.firstLevel:f,{fragCurrent:p,partCurrent:v}=this,{levels:E,allAudioTracks:A,loadLevel:T,config:I}=this.hls;if(E.length===1)return 0;const R=E[m],_=!!((h=this.hls.latestLevelDetails)!=null&&h.live),C=T===-1||f===-1;let b,K="SDR",O=(R==null?void 0:R.frameRate)||0;const{audioPreference:B,videoPreference:U}=I,M=this.audioTracksByGroup||(this.audioTracksByGroup=Hg(A));let z=-1;if(C){if(this.firstSelection!==-1)return this.firstSelection;const J=this.codecTiers||(this.codecTiers=ov(E,M,t,i)),ne=av(J,K,e,B,U),{codecSet:H,videoRanges:Q,minFramerate:q,minBitrate:k,minIndex:F,preferHDR:re}=ne;z=F,b=H,K=re?Q[Q.length-1]:Q[0],O=q,e=Math.max(e,k),this.log(`picked start tier ${Be(ne)}`)}else b=R==null?void 0:R.codecSet,K=R==null?void 0:R.videoRange;const te=v?v.duration:p?p.duration:0,se=this.bwEstimator.getEstimateTTFB()/1e3,le=[];for(let J=i;J>=t;J--){var ae;const ne=E[J],H=J>m;if(!ne)continue;if(I.useMediaCapabilities&&!ne.supportedResult&&!ne.supportedPromise){const ue=navigator.mediaCapabilities;typeof(ue==null?void 0:ue.decodingInfo)=="function"&&Qy(ne,M,K,O,e,B)?(ne.supportedPromise=Kg(ne,M,ue,this.supportedCache),ne.supportedPromise.then(he=>{if(!this.hls)return;ne.supportedResult=he;const Ie=this.hls.levels,Se=Ie.indexOf(ne);he.error?this.warn(`MediaCapabilities decodingInfo error: "${he.error}" for level ${Se} ${Be(he)}`):he.supported?he.decodingInfoResults.some(we=>we.smooth===!1||we.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Se} not smooth or powerEfficient: ${Be(he)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Se} ${Be(he)}`),Se>-1&&Ie.length>1&&(this.log(`Removing unsupported level ${Se}`),this.hls.removeLevel(Se),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(he=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${he}`)})):ne.supportedResult=Gg}if((b&&ne.codecSet!==b||K&&ne.videoRange!==K||H&&O>ne.frameRate||!H&&O>0&&O<ne.frameRate||(ae=ne.supportedResult)!=null&&(ae=ae.decodingInfoResults)!=null&&ae.some(ue=>ue.smooth===!1))&&(!C||J!==z)){le.push(J);continue}const Q=ne.details,q=(v?Q==null?void 0:Q.partTarget:Q==null?void 0:Q.averagetargetduration)||te;let k;H?k=u*e:k=o*e;const F=te&&s>=te*2&&a===0?ne.averageBitrate:ne.maxBitrate,re=this.getTimeToLoadFrag(se,k,F*q,Q===void 0);if(k>=F&&(J===f||ne.loadError===0&&ne.fragmentError===0)&&(re<=se||!oe(re)||_&&!this.bitrateTestDelay||re<d)){const ue=this.forcedAutoLevel;return J!==T&&(ue===-1||ue!==T)&&(le.length&&this.trace(`Skipped level(s) ${le.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${E[le[0]].codecs}" ${E[le[0]].videoRange}; not compatible with "${b}" ${K}`),this.info(`switch candidate:${m}->${J} adjustedbw(${Math.round(k)})-bitrate=${Math.round(k-F)} ttfb:${se.toFixed(1)} avgDuration:${q.toFixed(1)} maxFetchDuration:${d.toFixed(1)} fetchDuration:${re.toFixed(1)} firstSelection:${C} codecSet:${ne.codecSet} videoRange:${ne.videoRange} hls.loadLevel:${T}`)),C&&(this.firstSelection=J),J}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}}const Wg={search:function(l,e){let t=0,i=l.length-1,s=null,a=null;for(;t<=i;){s=(t+i)/2|0,a=l[s];const o=e(a);if(o>0)t=s+1;else if(o<0)i=s-1;else return a}return null}};function hv(l,e,t){if(e===null||!Array.isArray(l)||!l.length||!oe(e))return null;const i=l[0].programDateTime;if(e<(i||0))return null;const s=l[l.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let a=0;a<l.length;++a){const o=l[a];if(gv(e,t,o))return o}return null}function Cn(l,e,t=0,i=0,s=.005){let a=null;if(l){a=e[1+l.sn-e[0].sn]||null;const u=l.endDTS-t;u>0&&u<15e-7&&(t+=15e-7),a&&l.level!==a.level&&a.end<=l.end&&(a=e[2+l.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(a=e[0]);if(a&&((!l||l.level===a.level)&&Lf(t,i,a)===0||fv(a,l,Math.min(s,i))))return a;const o=Wg.search(e,Lf.bind(null,t,i));return o&&(o!==l||!a)?o:a}function fv(l,e,t){if(e&&e.start===0&&e.level<l.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((s,a)=>(a[0]==="INF"&&(s+=parseFloat(a[1])),s),t);return l.start<=i}return!1}function Lf(l=0,e=0,t){if(t.start<=l&&t.start+t.duration>l)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=l?1:t.start-i>l&&t.start?-1:0}function gv(l,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>l}function zg(l,e,t){if(l&&l.startCC<=e&&l.endCC>=e){let i=l.fragments;const{fragmentHint:s}=l;s&&(i=i.concat(s));let a;return Wg.search(i,o=>o.cc<e?1:o.cc>e?-1:(a=o,o.end<=t?1:o.start>t?-1:0)),a||null}return null}function Qa(l){switch(l.details){case G.FRAG_LOAD_TIMEOUT:case G.KEY_LOAD_TIMEOUT:case G.LEVEL_LOAD_TIMEOUT:case G.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Yg(l){return l.details.startsWith("key")}function qg(l){return Yg(l)&&!!l.frag&&!l.frag.decryptdata}function If(l,e){const t=Qa(e);return l.default[`${t?"timeout":"error"}Retry`]}function Qu(l,e){const t=l.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*l.retryDelayMs,l.maxRetryDelayMs)}function Rf(l){return Oe(Oe({},l),{errorRetry:null,timeoutRetry:null})}function Xa(l,e,t,i){if(!l)return!1;const s=i==null?void 0:i.code,a=e<l.maxNumRetry&&(mv(s)||!!t);return l.shouldRetry?l.shouldRetry(l,e,t,i,a):a}function mv(l){return wu(l)||!!l&&(l<400||l>499)}function wu(l){return l===0&&navigator.onLine===!1}var ht={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Ft={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class pv extends qt{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.ERROR,this.onError,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.ERROR,this.onError,this),e.off(S.ERROR,this.onErrorOut,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===fe.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,i=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||i===-1?t.loadLevel:i}variantHasKey(e,t){if(e){var i;if((i=e.details)!=null&&i.hasKey(t))return!0;const s=e.audioGroups;if(s)return this.hls.allAudioTracks.filter(o=>s.indexOf(o.groupId)>=0).some(o=>{var u;return(u=o.details)==null?void 0:u.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;const s=this.hls,a=t.context;switch(t.details){case G.FRAG_LOAD_ERROR:case G.FRAG_LOAD_TIMEOUT:case G.KEY_LOAD_ERROR:case G.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case G.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=cs();return}case G.FRAG_GAP:case G.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=ht.SendAlternateToPenaltyBox;return}case G.LEVEL_EMPTY_ERROR:case G.LEVEL_PARSING_ERROR:{var o;const h=t.parent===fe.MAIN?t.level:s.loadLevel;t.details===G.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,h):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,h))}return;case G.LEVEL_LOAD_ERROR:case G.LEVEL_LOAD_TIMEOUT:typeof(a==null?void 0:a.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level));return;case G.AUDIO_TRACK_LOAD_ERROR:case G.AUDIO_TRACK_LOAD_TIMEOUT:case G.SUBTITLE_LOAD_ERROR:case G.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const h=s.loadLevelObj;if(h&&(a.type===ke.AUDIO_TRACK&&h.hasAudioGroup(a.groupId)||a.type===ke.SUBTITLE_TRACK&&h.hasSubtitleGroup(a.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=ht.SendAlternateToPenaltyBox,t.errorAction.flags=Ft.MoveAllAlternatesMatchingHost;return}}return;case G.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:ht.SendAlternateToPenaltyBox,flags:Ft.MoveAllAlternatesMatchingHDCP};return;case G.KEY_SYSTEM_SESSION_UPDATE_FAILED:case G.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case G.KEY_SYSTEM_NO_SESSION:t.errorAction={action:ht.SendAlternateToPenaltyBox,flags:Ft.MoveAllAlternatesMatchingKey};return;case G.BUFFER_ADD_CODEC_ERROR:case G.REMUX_ALLOC_ERROR:case G.BUFFER_APPEND_ERROR:if(!t.errorAction){var u;t.errorAction=this.getLevelSwitchAction(t,(u=t.level)!=null?u:s.loadLevel)}return;case G.INTERNAL_EXCEPTION:case G.BUFFER_APPENDING_ERROR:case G.BUFFER_FULL_ERROR:case G.LEVEL_SWITCH_ERROR:case G.BUFFER_STALLED_ERROR:case G.BUFFER_SEEK_OVER_HOLE:case G.BUFFER_NUDGE_ON_STALL:t.errorAction=cs();return}t.type===ye.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=cs())}getPlaylistRetryOrSwitchAction(e,t){const i=this.hls,s=If(i.config.playlistLoadPolicy,e),a=this.playlistError++;if(Xa(s,a,Qa(e),e.response))return{action:ht.RetryRequest,flags:Ft.None,retryConfig:s,retryCount:a};const u=this.getLevelSwitchAction(e,t);return s&&(u.retryConfig=s,u.retryCount=a),u}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),s=t.levels[i],{fragLoadPolicy:a,keyLoadPolicy:o}=t.config,u=If(Yg(e)?o:a,e),h=t.levels.reduce((f,m)=>f+m.fragmentError,0);if(s&&(e.details!==G.FRAG_GAP&&s.fragmentError++,!qg(e)&&Xa(u,h,Qa(e),e.response)))return{action:ht.RetryRequest,flags:Ft.None,retryConfig:u,retryCount:h};const d=this.getLevelSwitchAction(e,i);return u&&(d.retryConfig=u,d.retryCount=h),d}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const s=this.hls.levels[t];if(s){var a,o;const d=e.details;s.loadError++,d===G.BUFFER_APPEND_ERROR&&s.fragmentError++;let f=-1;const{levels:m,loadLevel:p,minAutoLevel:v,maxAutoLevel:E}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);const A=(a=e.frag)==null?void 0:a.type,I=(A===fe.AUDIO&&d===G.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(d===G.BUFFER_ADD_CODEC_ERROR||d===G.BUFFER_APPEND_ERROR))&&m.some(({audioCodec:K})=>s.audioCodec!==K),_=e.sourceBufferName==="video"&&(d===G.BUFFER_ADD_CODEC_ERROR||d===G.BUFFER_APPEND_ERROR)&&m.some(({codecSet:K,audioCodec:O})=>s.codecSet!==K&&s.audioCodec===O),{type:C,groupId:b}=(o=e.context)!=null?o:{};for(let K=m.length;K--;){const O=(K+p)%m.length;if(O!==p&&O>=v&&O<=E&&m[O].loadError===0){var u,h;const B=m[O];if(d===G.FRAG_GAP&&A===fe.MAIN&&e.frag){const U=m[O].details;if(U){const M=Cn(e.frag,U.fragments,e.frag.start);if(M!=null&&M.gap)continue}}else{if(C===ke.AUDIO_TRACK&&B.hasAudioGroup(b)||C===ke.SUBTITLE_TRACK&&B.hasSubtitleGroup(b))continue;if(A===fe.AUDIO&&(u=s.audioGroups)!=null&&u.some(U=>B.hasAudioGroup(U))||A===fe.SUBTITLE&&(h=s.subtitleGroups)!=null&&h.some(U=>B.hasSubtitleGroup(U))||I&&s.audioCodec===B.audioCodec||_&&s.codecSet===B.codecSet||!I&&s.codecSet!==B.codecSet)continue}f=O;break}}if(f>-1&&i.loadLevel!==f)return e.levelRetry=!0,this.playlistError=0,{action:ht.SendAlternateToPenaltyBox,flags:Ft.None,nextAutoLevel:f}}return{action:ht.SendAlternateToPenaltyBox,flags:Ft.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case ht.DoNothing:break;case ht.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==G.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:s}=i,a=i.nextAutoLevel;switch(s){case Ft.None:this.switchLevel(e,a);break;case Ft.MoveAllAlternatesMatchingHDCP:{const h=this.getVariantLevelIndex(e.frag),d=t.levels[h],f=d==null?void 0:d.attrs["HDCP-LEVEL"];if(i.hdcpLevel=f,f==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(f){t.maxHdcpLevel=ku[ku.indexOf(f)-1],i.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Ft.MoveAllAlternatesMatchingKey:{const h=e.decryptdata;if(h){const d=this.hls.levels,f=d.length;for(let p=f;p--;)if(this.variantHasKey(d[p],h)){var o,u;this.log(`Banned key found in level ${p} (${d[p].bitrate}bps) or audio group "${(o=d[p].audioGroups)==null?void 0:o.join(",")}" (${(u=e.frag)==null?void 0:u.type} fragment) ${ft(h.keyId||[])}`),d[p].fragmentError++,d[p].loadError++,this.log(`Removing level ${p} with key error (${e.error})`),this.hls.removeLevel(p)}const m=e.frag;if(this.hls.levels.length<f)i.resolved=!0;else if(m&&m.type!==fe.MAIN){const p=m.decryptdata;p&&!h.matches(p)&&(i.resolved=!0)}}break}}i.resolved||this.switchLevel(e,a)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===G.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const i=_u(e.mimeType),s=this.hls.levels;for(let a=s.length;a--;)s[a][`${e.sourceBufferName}Codec`]===i&&(this.log(`Removing level ${a} for ${e.details} ("${i}" not supported)`),this.hls.removeLevel(a))}}}function cs(l){const e={action:ht.DoNothing,flags:Ft.None};return l&&(e.resolved=!0),e}var st={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class yv{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let s=i.length;s--;){const a=i[s];if(!a)break;if(a.start<=e&&e<=a.end&&a.loaded)return a}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){const{fragments:s}=this,a=Object.keys(s);for(let o=a.length;o--;){const u=s[a[o]];if((u==null?void 0:u.body.type)===t&&(!i||u.buffered)){const h=u.body;if(h.start<=e&&e<=h.end)return h}}return null}detectEvictedFragments(e,t,i,s,a){this.timeRanges&&(this.timeRanges[e]=t);const o=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(u=>{const h=this.fragments[u];if(!h||o>=h.body.sn)return;if(!h.buffered&&(!h.loaded||a)){h.body.type===i&&this.removeFragment(h.body);return}const d=h.range[e];if(d){if(d.time.length===0){this.removeFragment(h.body);return}d.time.some(f=>{const m=!this.isTimeBuffered(f.startPTS,f.endPTS,t);return m&&this.removeFragment(h.body),m})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const i=e.frag,s=ss(i),a=this.fragments[s];if(!a||a.buffered&&i.gap)return;const o=!i.relurl;Object.keys(t).forEach(u=>{const h=i.elementaryStreams[u];if(!h)return;const d=t[u],f=o||h.partial===!0;a.range[u]=this.getBufferedTimes(i,e.part,f,d)}),a.loaded=null,Object.keys(a.range).length?(this.bufferedEnd(a,i),Ia(a)||this.removeParts(i.sn-1,i.type)):this.removeFragment(a.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=_f(i,s=>s.fragment.sn>=e))}fragBuffered(e,t){const i=ss(e);let s=this.fragments[i];!s&&t&&(s=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,this.bufferedEnd(s,e))}getBufferedTimes(e,t,i,s){const a={time:[],partial:i},o=e.start,u=e.end,h=e.minEndPTS||u,d=e.maxStartPTS||o;for(let f=0;f<s.length;f++){const m=s.start(f)-this.bufferPadding,p=s.end(f)+this.bufferPadding;if(d>=m&&h<=p){a.time.push({startPTS:Math.max(o,s.start(f)),endPTS:Math.min(u,s.end(f))});break}else if(o<p&&u>m){const v=Math.max(o,s.start(f)),E=Math.min(u,s.end(f));E>v&&(a.partial=!0,a.time.push({startPTS:v,endPTS:E}))}else if(u<=m)break}return a}getPartialFragment(e){let t=null,i,s,a,o=0;const{bufferPadding:u,fragments:h}=this;return Object.keys(h).forEach(d=>{const f=h[d];f&&Ia(f)&&(s=f.body.start-u,a=f.body.end+u,e>=s&&e<=a&&(i=Math.min(e-s,a-e),o<=i&&(t=f.body,o=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Ia(t))}getState(e){const t=ss(e),i=this.fragments[t];return i?i.buffered?Ia(i)?st.PARTIAL:st.OK:st.APPENDING:st.NOT_LOADED}isTimeBuffered(e,t,i){let s,a;for(let o=0;o<i.length;o++){if(s=i.start(o)-this.bufferPadding,a=i.end(o)+this.bufferPadding,e>=s&&t<=a)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const i=t.frag,s=t.part?null:t,a=ss(i);this.fragments[a]={body:i,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:s,timeRanges:a,type:o}=t;if(i.sn==="initSegment")return;const u=i.type;if(s){let d=this.activePartLists[u];d||(this.activePartLists[u]=d=[]),d.push(s)}this.timeRanges=a;const h=a[o];this.detectEvictedFragments(o,h,u,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=ss(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let s=i.length;s--;){const a=t[i[s]];if((a==null?void 0:a.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,s,a){s&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const u=this.fragments[o];if(!u)return;const h=u.body;h.type!==i||s&&!h.gap||h.start<t&&h.end>e&&(u.buffered||a)&&this.removeFragment(h)})}removeFragment(e){const t=ss(e);e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const s=e.sn;this.activePartLists[e.type]=_f(i,a=>a.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(i=>i.clearElementaryStreamInfo())}}function Ia(l){var e,t,i;return l.buffered&&!!(l.body.gap||(e=l.range.video)!=null&&e.partial||(t=l.range.audio)!=null&&t.partial||(i=l.range.audiovideo)!=null&&i.partial)}function ss(l){return`${l.type}_${l.level}_${l.sn}`}function _f(l,e){return l.filter(t=>{const i=e(t);return i||t.clearElementaryStreamInfo(),i})}var un={cbc:0,ctr:1};class vv{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case un.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case un.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function Ev(l){const e=l.byteLength,t=e&&new DataView(l.buffer).getUint8(e-1);return t?l.slice(0,e-t):l}class xv{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let s=0;s<4;s++)i[s]=t.getUint32(s*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,s=i[0],a=i[1],o=i[2],u=i[3],h=this.invSubMix,d=h[0],f=h[1],m=h[2],p=h[3],v=new Uint32Array(256);let E=0,A=0,T=0;for(T=0;T<256;T++)T<128?v[T]=T<<1:v[T]=T<<1^283;for(T=0;T<256;T++){let I=A^A<<1^A<<2^A<<3^A<<4;I=I>>>8^I&255^99,e[E]=I,t[I]=E;const R=v[E],_=v[R],C=v[_];let b=v[I]*257^I*16843008;s[E]=b<<24|b>>>8,a[E]=b<<16|b>>>16,o[E]=b<<8|b>>>24,u[E]=b,b=C*16843009^_*65537^R*257^E*16843008,d[I]=b<<24|b>>>8,f[I]=b<<16|b>>>16,m[I]=b<<8|b>>>24,p[I]=b,E?(E=R^v[v[v[C^R]]],A^=v[v[A]]):E=A=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,s=0;for(;s<t.length&&i;)i=t[s]===this.key[s],s++;if(i)return;this.key=t;const a=this.keySize=t.length;if(a!==4&&a!==6&&a!==8)throw new Error("Invalid aes key size="+a);const o=this.ksRows=(a+6+1)*4;let u,h;const d=this.keySchedule=new Uint32Array(o),f=this.invKeySchedule=new Uint32Array(o),m=this.sBox,p=this.rcon,v=this.invSubMix,E=v[0],A=v[1],T=v[2],I=v[3];let R,_;for(u=0;u<o;u++){if(u<a){R=d[u]=t[u];continue}_=R,u%a===0?(_=_<<8|_>>>24,_=m[_>>>24]<<24|m[_>>>16&255]<<16|m[_>>>8&255]<<8|m[_&255],_^=p[u/a|0]<<24):a>6&&u%a===4&&(_=m[_>>>24]<<24|m[_>>>16&255]<<16|m[_>>>8&255]<<8|m[_&255]),d[u]=R=(d[u-a]^_)>>>0}for(h=0;h<o;h++)u=o-h,h&3?_=d[u]:_=d[u-4],h<4||u<=4?f[h]=_:f[h]=E[m[_>>>24]]^A[m[_>>>16&255]]^T[m[_>>>8&255]]^I[m[_&255]],f[h]=f[h]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const s=this.keySize+6,a=this.invKeySchedule,o=this.invSBox,u=this.invSubMix,h=u[0],d=u[1],f=u[2],m=u[3],p=this.uint8ArrayToUint32Array_(i);let v=p[0],E=p[1],A=p[2],T=p[3];const I=new Int32Array(e),R=new Int32Array(I.length);let _,C,b,K,O,B,U,M,z,te,se,le,ae,J;const ne=this.networkToHostOrderSwap;for(;t<I.length;){for(z=ne(I[t]),te=ne(I[t+1]),se=ne(I[t+2]),le=ne(I[t+3]),O=z^a[0],B=le^a[1],U=se^a[2],M=te^a[3],ae=4,J=1;J<s;J++)_=h[O>>>24]^d[B>>16&255]^f[U>>8&255]^m[M&255]^a[ae],C=h[B>>>24]^d[U>>16&255]^f[M>>8&255]^m[O&255]^a[ae+1],b=h[U>>>24]^d[M>>16&255]^f[O>>8&255]^m[B&255]^a[ae+2],K=h[M>>>24]^d[O>>16&255]^f[B>>8&255]^m[U&255]^a[ae+3],O=_,B=C,U=b,M=K,ae=ae+4;_=o[O>>>24]<<24^o[B>>16&255]<<16^o[U>>8&255]<<8^o[M&255]^a[ae],C=o[B>>>24]<<24^o[U>>16&255]<<16^o[M>>8&255]<<8^o[O&255]^a[ae+1],b=o[U>>>24]<<24^o[M>>16&255]<<16^o[O>>8&255]<<8^o[B&255]^a[ae+2],K=o[M>>>24]<<24^o[O>>16&255]<<16^o[B>>8&255]<<8^o[U&255]^a[ae+3],R[t]=ne(_^v),R[t+1]=ne(K^E),R[t+2]=ne(b^A),R[t+3]=ne(C^T),v=z,E=te,A=se,T=le,t=t+4}return R.buffer}}class Sv{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){const e=Tv(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function Tv(l){switch(l){case un.cbc:return"AES-CBC";case un.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${l}`)}}const Av=16;class Xu{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Ev(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,s){return this.useSoftware?new Promise((a,o)=>{const u=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(u,t,i,s);const h=this.flush();h?a(h.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,s)}softwareDecrypt(e,t,i,s){const{currentIV:a,currentResult:o,remainderData:u}=this;if(s!==un.cbc||t.byteLength!==16)return Ne.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(e=Yt(u,e),this.remainderData=null);const h=this.getValidChunk(e);if(!h.length)return null;a&&(i=a);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new xv),d.expandKey(t);const f=o;return this.currentResult=d.decrypt(h.buffer,0,i),this.currentIV=h.slice(-16).buffer,f||null}webCryptoDecrypt(e,t,i,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,s));this.key=t,this.fastAesKey=new Sv(this.subtle,t,s)}return this.fastAesKey.expandKey().then(a=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new vv(this.subtle,new Uint8Array(i),s).decrypt(e.buffer,a)):Promise.reject(new Error("web crypto not initialized"))).catch(a=>(Ne.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${a.name}: ${a.message}`),this.onWebCryptoError(e,t,i,s)))}onWebCryptoError(e,t,i,s){const a=this.enableSoftwareAES;if(a){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,s);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(a?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%Av;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(Ne.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const kf=Math.pow(2,17);class Lv{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new bi({type:ye.NETWORK_ERROR,details:G.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,a=s.fLoader,o=s.loader;return new Promise((u,h)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(E=>E[0]==="GAP")){h(Cf(e));return}else e.gap=!1;const d=this.loader=a?new a(s):new o(s),f=wf(e);e.loader=d;const m=Rf(s.fragLoadPolicy.default),p={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:kf};e.stats=d.stats;const v={onSuccess:(E,A,T,I)=>{this.resetLoader(e,d);let R=E.data;T.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(R.slice(0,16)),R=R.slice(16)),u({frag:e,part:null,payload:R,networkDetails:I})},onError:(E,A,T,I)=>{this.resetLoader(e,d),h(new bi({type:ye.NETWORK_ERROR,details:G.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Oe({url:i,data:void 0},E),error:new Error(`HTTP Error ${E.code} ${E.text}`),networkDetails:T,stats:I}))},onAbort:(E,A,T)=>{this.resetLoader(e,d),h(new bi({type:ye.NETWORK_ERROR,details:G.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:T,stats:E}))},onTimeout:(E,A,T)=>{this.resetLoader(e,d),h(new bi({type:ye.NETWORK_ERROR,details:G.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:T,stats:E}))}};t&&(v.onProgress=(E,A,T,I)=>t({frag:e,part:null,payload:T,networkDetails:I})),d.load(f,p,v)})}loadPart(e,t,i){this.abort();const s=this.config,a=s.fLoader,o=s.loader;return new Promise((u,h)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){h(Cf(e,t));return}const d=this.loader=a?new a(s):new o(s),f=wf(e,t);e.loader=d;const m=Rf(s.fragLoadPolicy.default),p={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:kf};t.stats=d.stats,d.load(f,p,{onSuccess:(v,E,A,T)=>{this.resetLoader(e,d),this.updateStatsFromPart(e,t);const I={frag:e,part:t,payload:v.data,networkDetails:T};i(I),u(I)},onError:(v,E,A,T)=>{this.resetLoader(e,d),h(new bi({type:ye.NETWORK_ERROR,details:G.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Oe({url:f.url,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:A,stats:T}))},onAbort:(v,E,A)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,d),h(new bi({type:ye.NETWORK_ERROR,details:G.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:A,stats:v}))},onTimeout:(v,E,A)=>{this.resetLoader(e,d),h(new bi({type:ye.NETWORK_ERROR,details:G.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:A,stats:v}))}})})}updateStatsFromPart(e,t){const i=e.stats,s=t.stats,a=s.total;if(i.loaded+=s.loaded,a){const h=Math.round(e.duration/t.duration),d=Math.min(Math.round(i.loaded/a),h),m=(h-d)*Math.round(i.loaded/d);i.total=i.loaded+m}else i.total=Math.max(i.loaded,i.total);const o=i.loading,u=s.loading;o.start?o.first+=u.first-u.start:(o.start=u.start,o.first=u.first),o.end=u.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function wf(l,e=null){const t=e||l,i={frag:l,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,a=t.byteRangeEndOffset;if(oe(s)&&oe(a)){var o;let u=s,h=a;if(l.sn==="initSegment"&&Iv((o=l.decryptdata)==null?void 0:o.method)){const d=a-s;d%16&&(h=a+(16-d%16)),s!==0&&(i.resetIV=!0,u=s-16)}i.rangeStart=u,i.rangeEnd=h}return i}function Cf(l,e){const t=new Error(`GAP ${l.gap?"tag":"attribute"} found`),i={type:ye.MEDIA_ERROR,details:G.FRAG_GAP,fatal:!1,frag:l,error:t,networkDetails:null};return e&&(i.part=e),(e||l).stats.aborted=!0,new bi(i)}function Iv(l){return l==="AES-128"||l==="AES-256"}class bi extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Qg extends qt{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Zu{constructor(e,t,i,s=0,a=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Ra(),this.buffering={audio:Ra(),video:Ra(),audiovideo:Ra()},this.level=e,this.sn=t,this.id=i,this.size=s,this.part=a,this.partial=o}}function Ra(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Df={length:0,start:()=>0,end:()=>0};class Le{static isBuffered(e,t){if(e){const i=Le.getBuffered(e);for(let s=i.length;s--;)if(t>=i.start(s)&&t<=i.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=Le.getBuffered(e);return Le.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){const s=Le.bufferedRanges(e);if(s.length)return Le.bufferedInfo(s,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((f,m)=>f.start-m.start||m.end-f.end);let s=-1,a=[];if(i)for(let f=0;f<e.length;f++){t>=e[f].start&&t<=e[f].end&&(s=f);const m=a.length;if(m){const p=a[m-1].end;e[f].start-p<i?e[f].end>p&&(a[m-1].end=e[f].end):a.push(e[f])}else a.push(e[f])}else a=e;let o=0,u,h=t,d=t;for(let f=0;f<a.length;f++){const m=a[f].start,p=a[f].end;if(s===-1&&t>=m&&t<=p&&(s=f),t+i>=m&&t<p)h=m,d=p,o=d-t;else if(t+i<m){u=m;break}}return{len:o,start:h||0,end:d||0,nextStart:u,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||Df}catch(t){return Ne.log("failed to get media.buffered",t),Df}}}const Xg=/\{\$([a-zA-Z0-9-_]+)\}/g;function bf(l){return Xg.test(l)}function Cu(l,e){if(l.variableList!==null||l.hasVariableRefs){const t=l.variableList;return e.replace(Xg,i=>{const s=i.substring(2,i.length-1),a=t==null?void 0:t[s];return a===void 0?(l.playlistParsingError||(l.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),i):a})}return e}function Pf(l,e,t){let i=l.variableList;i||(l.variableList=i={});let s,a;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(s))a=o.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(o){l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else s=e.NAME,a=e.VALUE;s in i?l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):i[s]=a||""}function Rv(l,e,t){const i=e.IMPORT;if(t&&i in t){let s=l.variableList;s||(l.variableList=s={}),s[i]=t[i]}else l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const _v=/^(\d+)x(\d+)$/,Of=/(.+?)=(".*?"|.*?)(?:,|$)/g;class We{constructor(e,t){typeof e=="string"&&(e=We.parseAttrList(e,t)),Me(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)i[s]=parseInt(t.slice(s*2,s*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((s,a)=>(s[a.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=_v.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i;const s={};for(Of.lastIndex=0;(i=Of.exec(e))!==null;){const o=i[1].trim();let u=i[2];const h=u.indexOf('"')===0&&u.lastIndexOf('"')===u.length-1;let d=!1;if(h)u=u.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(t&&(h||d))u=Cu(t,u);else if(!d&&!h)switch(o){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Ne.warn(`${e}: attribute ${o} is missing quotes`)}s[o]=u}return s}}const kv="com.apple.hls.interstitial";function wv(l){return l!=="ID"&&l!=="CLASS"&&l!=="CUE"&&l!=="START-DATE"&&l!=="DURATION"&&l!=="END-DATE"&&l!=="END-ON-NEXT"}function Cv(l){return l==="SCTE35-OUT"||l==="SCTE35-IN"||l==="SCTE35-CMD"}class Zg{constructor(e,t,i=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(s=t==null?void 0:t.tagOrder)!=null?s:i,t){const a=t.attr;for(const o in a)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==a[o]){Ne.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=Me(new We({}),a,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const a=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);oe(a.getTime())&&(this._endDate=a)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Ne.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(oe(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===kv}get isValid(){return!!this.id&&!this._badValueForSameId&&oe(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const Dv=10;class bv{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let i=t.decryptdata;return i||(t.setKeyFormat(e.keyFormat),i=t.decryptdata),!!i&&e.matches(i)})}get hasProgramDateTime(){return this.fragments.length?oe(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Dv}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Za(l,e){return l.length===e.length?!l.some((t,i)=>t!==e[i]):!1}function Nf(l,e){return!l&&!e?!0:!l||!e?!1:Za(l,e)}function ds(l){return l==="AES-128"||l==="AES-256"||l==="AES-256-CTR"}function Ju(l){switch(l){case"AES-128":case"AES-256":return un.cbc;case"AES-256-CTR":return un.ctr;default:throw new Error(`invalid full segment method ${l}`)}}function ec(l){return Uint8Array.from(atob(l),e=>e.charCodeAt(0))}function Du(l){return Uint8Array.from(unescape(encodeURIComponent(l)),e=>e.charCodeAt(0))}function Pv(l){const e=Du(l).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Jg(l){const e=function(i,s,a){const o=i[s];i[s]=i[a],i[a]=o};e(l,0,3),e(l,1,2),e(l,4,5),e(l,6,7)}function em(l){const e=l.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),s=i[i.length-1].split(",");if(s.length===2){const a=s[0]==="base64",o=s[1];a?(i.splice(-1,1),t=ec(o)):t=Pv(o)}}return t}const Ja=typeof self<"u"?self:void 0;var ze={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},gt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function $a(l){switch(l){case gt.FAIRPLAY:return ze.FAIRPLAY;case gt.PLAYREADY:return ze.PLAYREADY;case gt.WIDEVINE:return ze.WIDEVINE;case gt.CLEARKEY:return ze.CLEARKEY}}function ru(l){switch(l){case ze.FAIRPLAY:return gt.FAIRPLAY;case ze.PLAYREADY:return gt.PLAYREADY;case ze.WIDEVINE:return gt.WIDEVINE;case ze.CLEARKEY:return gt.CLEARKEY}}function nr(l){const{drmSystems:e,widevineLicenseUrl:t}=l,i=e?[ze.FAIRPLAY,ze.WIDEVINE,ze.PLAYREADY,ze.CLEARKEY].filter(s=>!!e[s]):[];return!i[ze.WIDEVINE]&&t&&i.push(ze.WIDEVINE),i}const tm=(function(l){return Ja!=null&&(l=Ja.navigator)!=null&&l.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function Ov(l,e,t,i){let s;switch(l){case ze.FAIRPLAY:s=["cenc","sinf"];break;case ze.WIDEVINE:case ze.PLAYREADY:s=["cenc"];break;case ze.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${l}`)}return Nv(s,e,t,i)}function Nv(l,e,t,i){return[{initDataTypes:l,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(a=>({contentType:`audio/mp4; codecs=${a}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(a=>({contentType:`video/mp4; codecs=${a}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function Mv(l){var e;return!!l&&(l.sessionType==="persistent-license"||!!((e=l.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function im(l){const e=new Uint16Array(l.buffer,l.byteOffset,l.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(o){const u=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(u){const h=ec(u).subarray(0,16);return Jg(h),h}}return null}let rs={};class on{static clearKeyUriToKeyIdMap(){rs={}}static setKeyIdForUri(e,t){rs[e]=t}static addKeyIdForUri(e){const t=Object.keys(rs).length%Number.MAX_SAFE_INTEGER,i=new Uint8Array(16);return new DataView(i.buffer,12,4).setUint32(0,t),rs[e]=i,i}constructor(e,t,i,s=[1],a=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=s,this.iv=a,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!ds(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(Cg(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Za(e.keyFormatVersions,this.keyFormatVersions)&&Nf(e.iv,this.iv)&&Nf(e.keyId,this.keyId)}isSupported(){if(this.method){if(ds(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case gt.FAIRPLAY:case gt.WIDEVINE:case gt.PLAYREADY:case gt.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(ds(this.method)){let a=this.iv;return a||(typeof e!="number"&&(Ne.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),a=Bv(e)),new on(this.method,this.uri,"identity",this.keyFormatVersions,a)}if(this.keyId){const a=rs[this.uri];if(a&&!Za(this.keyId,a)&&on.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const i=em(this.uri);if(i)switch(this.keyFormat){case gt.WIDEVINE:if(this.pssh=i,!this.keyId){const a=Gy(i.buffer);if(a.length){var s;const o=a[0];this.keyId=(s=o.kids)!=null&&s.length?o.kids[0]:null}}this.keyId||(this.keyId=Mf(t));break;case gt.PLAYREADY:{const a=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=$y(a,null,i),this.keyId=im(i);break}default:{let a=i.subarray(0,16);if(a.length!==16){const o=new Uint8Array(16);o.set(a,16-a.length),a=o}this.keyId=a;break}}if(!this.keyId||this.keyId.byteLength!==16){let a;a=Fv(t),a||(a=Mf(t),a||(a=rs[this.uri])),a&&(this.keyId=a,on.setKeyIdForUri(this.uri,a))}return this}}function Fv(l){const e=l==null?void 0:l[gt.WIDEVINE];return e?e.keyId:null}function Mf(l){const e=l==null?void 0:l[gt.PLAYREADY];if(e){const t=em(e.uri);if(t)return im(t)}return null}function Bv(l){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=l>>8*(15-t)&255;return e}const Ff=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Bf=/#EXT-X-MEDIA:(.*)/g,Uv=/^#EXT(?:INF|-X-TARGETDURATION):/m,au=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),$v=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Ei{static findGroup(e,t){for(let i=0;i<e.length;i++){const s=e[i];if(s.id===t)return s}}static resolve(e,t){return Hu.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Uv.test(e)}static parseMasterPlaylist(e,t){const i=bf(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},a=[];if(Ff.lastIndex=0,!e.startsWith("#EXTM3U"))return s.playlistParsingError=new Error("no EXTM3U delimiter"),s;let o;for(;(o=Ff.exec(e))!=null;)if(o[1]){var u;const d=new We(o[1],s),f=Cu(s,o[2]),m={attrs:d,bitrate:d.decimalInteger("BANDWIDTH")||d.decimalInteger("AVERAGE-BANDWIDTH"),name:d.NAME,url:Ei.resolve(f,t)},p=d.decimalResolution("RESOLUTION");p&&(m.width=p.width,m.height=p.height),Gf(d.CODECS,m);const v=d["SUPPLEMENTAL-CODECS"];v&&(m.supplemental={},Gf(v,m.supplemental)),(u=m.unknownCodecs)!=null&&u.length||a.push(m),s.levels.push(m)}else if(o[3]){const d=o[3],f=o[4];switch(d){case"SESSION-DATA":{const m=new We(f,s),p=m["DATA-ID"];p&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[p]=m);break}case"SESSION-KEY":{const m=Uf(f,t,s);m.encrypted&&m.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(m)):Ne.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${f}"`);break}case"DEFINE":{{const m=new We(f,s);Pf(s,m,t)}break}case"CONTENT-STEERING":{const m=new We(f,s);s.contentSteering={uri:Ei.resolve(m["SERVER-URI"],t),pathwayId:m["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=$f(f);break}}}const h=a.length>0&&a.length<s.levels.length;return s.levels=h?a:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,i){let s;const a={},o=i.levels,u={AUDIO:o.map(d=>({id:d.attrs.AUDIO,audioCodec:d.audioCodec})),SUBTITLES:o.map(d=>({id:d.attrs.SUBTITLES,textCodec:d.textCodec})),"CLOSED-CAPTIONS":[]};let h=0;for(Bf.lastIndex=0;(s=Bf.exec(e))!==null;){const d=new We(s[1],i),f=d.TYPE;if(f){const m=u[f],p=a[f]||[];a[f]=p;const v=d.LANGUAGE,E=d["ASSOC-LANGUAGE"],A=d.CHANNELS,T=d.CHARACTERISTICS,I=d["INSTREAM-ID"],R={attrs:d,bitrate:0,id:h++,groupId:d["GROUP-ID"]||"",name:d.NAME||v||"",type:f,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:v,url:d.URI?Ei.resolve(d.URI,t):""};if(E&&(R.assocLang=E),A&&(R.channels=A),T&&(R.characteristics=T),I&&(R.instreamId=I),m!=null&&m.length){const _=Ei.findGroup(m,R.groupId)||m[0];jf(R,_,"audioCodec"),jf(R,_,"textCodec")}p.push(R)}}return a}static parseLevelPlaylist(e,t,i,s,a,o){var u;const h={url:t},d=new bv(t),f=d.fragments,m=[];let p=null,v=0,E=0,A=0,T=0,I=0,R=null,_=new iu(s,h),C,b,K,O=-1,B=!1,U=null,M;if(au.lastIndex=0,d.m3u8=e,d.hasVariableRefs=bf(e),((u=au.exec(e))==null?void 0:u[0])!=="#EXTM3U")return d.playlistParsingError=new Error("Missing format identifier #EXTM3U"),d;for(;(C=au.exec(e))!==null;){B&&(B=!1,_=new iu(s,h),_.playlistOffset=A,_.setStart(A),_.sn=v,_.cc=T,I&&(_.bitrate=I),_.level=i,p&&(_.initSegment=p,p.rawProgramDateTime&&(_.rawProgramDateTime=p.rawProgramDateTime,p.rawProgramDateTime=null),U&&(_.setByteRange(U),U=null)));const le=C[1];if(le){_.duration=parseFloat(le);const ae=(" "+C[2]).slice(1);_.title=ae||null,_.tagList.push(ae?["INF",le,ae]:["INF",le])}else if(C[3]){if(oe(_.duration)){_.playlistOffset=A,_.setStart(A),K&&Vf(_,K,d),_.sn=v,_.level=i,_.cc=T,f.push(_);const ae=(" "+C[3]).slice(1);_.relurl=Cu(d,ae),bu(_,R,m),R=_,A+=_.duration,v++,E=0,B=!0}}else{if(C=C[0].match($v),!C){Ne.warn("No matches on slow regex match for level playlist!");continue}for(b=1;b<C.length&&C[b]===void 0;b++);const ae=(" "+C[b]).slice(1),J=(" "+C[b+1]).slice(1),ne=C[b+2]?(" "+C[b+2]).slice(1):null;switch(ae){case"BYTERANGE":R?_.setByteRange(J,R):_.setByteRange(J);break;case"PROGRAM-DATE-TIME":_.rawProgramDateTime=J,_.tagList.push(["PROGRAM-DATE-TIME",J]),O===-1&&(O=f.length);break;case"PLAYLIST-TYPE":d.type&&Ci(d,ae,C),d.type=J.toUpperCase();break;case"MEDIA-SEQUENCE":d.startSN!==0?Ci(d,ae,C):f.length>0&&Hf(d,ae,C),v=d.startSN=parseInt(J);break;case"SKIP":{d.skippedSegments&&Ci(d,ae,C);const H=new We(J,d),Q=H.decimalInteger("SKIPPED-SEGMENTS");if(oe(Q)){d.skippedSegments+=Q;for(let k=Q;k--;)f.push(null);v+=Q}const q=H.enumeratedString("RECENTLY-REMOVED-DATERANGES");q&&(d.recentlyRemovedDateranges=(d.recentlyRemovedDateranges||[]).concat(q.split("	")));break}case"TARGETDURATION":d.targetduration!==0&&Ci(d,ae,C),d.targetduration=Math.max(parseInt(J),1);break;case"VERSION":d.version!==null&&Ci(d,ae,C),d.version=parseInt(J);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":d.live||Ci(d,ae,C),d.live=!1;break;case"#":(J||ne)&&_.tagList.push(ne?[J,ne]:[J]);break;case"DISCONTINUITY":T++,_.tagList.push(["DIS"]);break;case"GAP":_.gap=!0,_.tagList.push([ae]);break;case"BITRATE":_.tagList.push([ae,J]),I=parseInt(J)*1e3,oe(I)?_.bitrate=I:I=0;break;case"DATERANGE":{const H=new We(J,d),Q=new Zg(H,d.dateRanges[H.ID],d.dateRangeTagCount);d.dateRangeTagCount++,Q.isValid||d.skippedSegments?d.dateRanges[Q.id]=Q:Ne.warn(`Ignoring invalid DATERANGE tag: "${J}"`),_.tagList.push(["EXT-X-DATERANGE",J]);break}case"DEFINE":{{const H=new We(J,d);"IMPORT"in H?Rv(d,H,o):Pf(d,H,t)}break}case"DISCONTINUITY-SEQUENCE":d.startCC!==0?Ci(d,ae,C):f.length>0&&Hf(d,ae,C),d.startCC=T=parseInt(J);break;case"KEY":{const H=Uf(J,t,d);if(H.isSupported()){if(H.method==="NONE"){K=void 0;break}K||(K={});const Q=K[H.keyFormat];Q!=null&&Q.matches(H)||(Q&&(K=Me({},K)),K[H.keyFormat]=H)}else Ne.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${J}"`);break}case"START":d.startTimeOffset=$f(J);break;case"MAP":{const H=new We(J,d);if(_.duration){const Q=new iu(s,h);Kf(Q,H,i,K),p=Q,_.initSegment=p,p.rawProgramDateTime&&!_.rawProgramDateTime&&(_.rawProgramDateTime=p.rawProgramDateTime)}else{const Q=_.byteRangeEndOffset;if(Q){const q=_.byteRangeStartOffset;U=`${Q-q}@${q}`}else U=null;Kf(_,H,i,K),p=_,B=!0}p.cc=T;break}case"SERVER-CONTROL":{M&&Ci(d,ae,C),M=new We(J),d.canBlockReload=M.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=M.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&M.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=M.optionalFloat("PART-HOLD-BACK",0),d.holdBack=M.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{d.partTarget&&Ci(d,ae,C);const H=new We(J);d.partTarget=H.decimalFloatingPoint("PART-TARGET");break}case"PART":{let H=d.partList;H||(H=d.partList=[]);const Q=E>0?H[H.length-1]:void 0,q=E++,k=new We(J,d),F=new Ry(k,_,h,q,Q);H.push(F),_.duration+=F.duration;break}case"PRELOAD-HINT":{const H=new We(J,d);d.preloadHint=H;break}case"RENDITION-REPORT":{const H=new We(J,d);d.renditionReports=d.renditionReports||[],d.renditionReports.push(H);break}default:Ne.warn(`line parsed but not handled: ${C}`);break}}}R&&!R.relurl?(f.pop(),A-=R.duration,d.partList&&(d.fragmentHint=R)):d.partList&&(bu(_,R,m),_.cc=T,d.fragmentHint=_,K&&Vf(_,K,d)),d.targetduration||(d.playlistParsingError=new Error("Missing Target Duration"));const z=f.length,te=f[0],se=f[z-1];if(A+=d.skippedSegments*d.targetduration,A>0&&z&&se){d.averagetargetduration=A/z;const le=se.sn;d.endSN=le!=="initSegment"?le:0,d.live||(se.endList=!0),O>0&&(jv(f,O),te&&m.unshift(te))}return d.fragmentHint&&(A+=d.fragmentHint.duration),d.totalduration=A,m.length&&d.dateRangeTagCount&&te&&nm(m,d),d.endCC=T,d}}function nm(l,e){let t=l.length;if(!t)if(e.hasProgramDateTime){const u=e.fragments[e.fragments.length-1];l.push(u),t++}else return;const i=l[t-1],s=e.live?1/0:e.totalduration,a=Object.keys(e.dateRanges);for(let u=a.length;u--;){const h=e.dateRanges[a[u]],d=h.startDate.getTime();h.tagAnchor=i.ref;for(let f=t;f--;){var o;if(((o=l[f])==null?void 0:o.sn)<e.startSN)break;const m=Gv(e,d,l,f,s);if(m!==-1){h.tagAnchor=e.fragments[m].ref;break}}}}function Gv(l,e,t,i,s){const a=t[i];if(a){const u=a.programDateTime;if(e>=u||i===0){var o;const h=(((o=t[i+1])==null?void 0:o.start)||s)-a.start;if(e<=u+h*1e3){const d=t[i].sn-l.startSN;if(d<0)return-1;const f=l.fragments;if(f.length>t.length){const p=(t[i+1]||f[f.length-1]).sn-l.startSN;for(let v=p;v>d;v--){const E=f[v].programDateTime;if(e>=E&&e<E+f[v].duration*1e3)return v}}return d}}}return-1}function Uf(l,e,t){var i,s;const a=new We(l,t),o=(i=a.METHOD)!=null?i:"",u=a.URI,h=a.hexadecimalInteger("IV"),d=a.KEYFORMATVERSIONS,f=(s=a.KEYFORMAT)!=null?s:"identity";u&&a.IV&&!h&&Ne.error(`Invalid IV: ${a.IV}`);const m=u?Ei.resolve(u,e):"",p=(d||"1").split("/").map(Number).filter(Number.isFinite);return new on(o,m,f,p,h,a.KEYID)}function $f(l){const t=new We(l).decimalFloatingPoint("TIME-OFFSET");return oe(t)?t:null}function Gf(l,e){let t=(l||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const s=t.filter(a=>Yu(a,i));s.length&&(e[`${i}Codec`]=s.map(a=>a.split("/")[0]).join(","),t=t.filter(a=>s.indexOf(a)===-1))}),e.unknownCodecs=t}function jf(l,e,t){const i=e[t];i&&(l[t]=i)}function jv(l,e){let t=l[e];for(let i=e;i--;){const s=l[i];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function bu(l,e,t){l.rawProgramDateTime?t.push(l):e!=null&&e.programDateTime&&(l.programDateTime=e.endProgramDateTime)}function Kf(l,e,t,i){l.relurl=e.URI,e.BYTERANGE&&l.setByteRange(e.BYTERANGE),l.level=t,l.sn="initSegment",i&&(l.levelkeys=i),l.initSegment=null}function Vf(l,e,t){l.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&i.push(l)}function Ci(l,e,t){l.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Hf(l,e,t){l.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function ou(l,e){const t=e.startPTS;if(oe(t)){let i=0,s;e.sn>l.sn?(i=t-l.start,s=l):(i=l.start-t,s=e),s.duration!==i&&s.setDuration(i)}else e.sn>l.sn?l.cc===e.cc&&l.minEndPTS?e.setStart(l.start+(l.minEndPTS-l.start)):e.setStart(l.start+l.duration):e.setStart(Math.max(l.start-e.duration,0))}function sm(l,e,t,i,s,a,o){i-t<=0&&(o.warn("Fragment should have a positive duration",e),i=t+e.duration,a=s+e.duration);let h=t,d=i;const f=e.startPTS,m=e.endPTS;if(oe(f)){const I=Math.abs(f-t);l&&I>l.totalduration?o.warn(`media timestamps and playlist times differ by ${I}s for level ${e.level} ${l.url}`):oe(e.deltaPTS)?e.deltaPTS=Math.max(I,e.deltaPTS):e.deltaPTS=I,h=Math.max(t,f),t=Math.min(t,f),s=e.startDTS!==void 0?Math.min(s,e.startDTS):s,d=Math.min(i,m),i=Math.max(i,m),a=e.endDTS!==void 0?Math.max(a,e.endDTS):a}const p=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=h,e.startDTS=s,e.endPTS=i,e.minEndPTS=d,e.endDTS=a;const v=e.sn;if(!l||v<l.startSN||v>l.endSN)return 0;let E;const A=v-l.startSN,T=l.fragments;for(T[A]=e,E=A;E>0;E--)ou(T[E],T[E-1]);for(E=A;E<T.length-1;E++)ou(T[E],T[E+1]);return l.fragmentHint&&ou(T[T.length-1],l.fragmentHint),l.PTSKnown=l.alignedSliding=!0,p}function Kv(l,e,t){if(l===e)return;let i=null;const s=l.fragments;for(let f=s.length-1;f>=0;f--){const m=s[f].initSegment;if(m){i=m;break}}l.fragmentHint&&delete l.fragmentHint.endPTS;let a;Wv(l,e,(f,m,p,v)=>{if((!e.startCC||e.skippedSegments)&&m.cc!==f.cc){const E=f.cc-m.cc;for(let A=p;A<v.length;A++)v[A].cc+=E;e.endCC=v[v.length-1].cc}oe(f.startPTS)&&oe(f.endPTS)&&(m.setStart(m.startPTS=f.startPTS),m.startDTS=f.startDTS,m.maxStartPTS=f.maxStartPTS,m.endPTS=f.endPTS,m.endDTS=f.endDTS,m.minEndPTS=f.minEndPTS,m.setDuration(f.endPTS-f.startPTS),m.duration&&(a=m),e.PTSKnown=e.alignedSliding=!0),f.hasStreams&&(m.elementaryStreams=f.elementaryStreams),m.loader=f.loader,f.hasStats&&(m.stats=f.stats),f.initSegment&&(m.initSegment=f.initSegment,i=f.initSegment)});const o=e.fragments,u=e.fragmentHint?o.concat(e.fragmentHint):o;if(i&&u.forEach(f=>{var m;f&&(!f.initSegment||f.initSegment.relurl===((m=i)==null?void 0:m.relurl))&&(f.initSegment=i)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(f=>!f),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let f=e.skippedSegments;f--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=Vv(l.dateRanges,e,t));const f=l.fragments.filter(m=>m.rawProgramDateTime);if(l.hasProgramDateTime&&!e.hasProgramDateTime)for(let m=1;m<u.length;m++)u[m].programDateTime===null&&bu(u[m],u[m-1],f);nm(f,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var h;const f=om(l,e.startSN-1);e.startCC=(h=f==null?void 0:f.cc)!=null?h:o[0].cc}Hv(l.partList,e.partList,(f,m)=>{m.elementaryStreams=f.elementaryStreams,m.stats=f.stats}),a?sm(e,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS,t):rm(l,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=l.driftStartTime,e.driftStart=l.driftStart;const d=e.advancedDateTime;if(e.advanced&&d){const f=e.edge;e.driftStart||(e.driftStartTime=d,e.driftStart=f),e.driftEndTime=d,e.driftEnd=f}else e.driftEndTime=l.driftEndTime,e.driftEnd=l.driftEnd,e.advancedDateTime=l.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=l.requestScheduled)}function Vv(l,e,t){const{dateRanges:i,recentlyRemovedDateranges:s}=e,a=Me({},l);s&&s.forEach(h=>{delete a[h]});const u=Object.keys(a).length;return u?(Object.keys(i).forEach(h=>{const d=a[h],f=new Zg(i[h].attr,d);f.isValid?(a[h]=f,d||(f.tagOrder+=u)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Be(i[h].attr)}"`)}),a):i}function Hv(l,e,t){if(l&&e){let i=0;for(let s=0,a=l.length;s<=a;s++){const o=l[s],u=e[s+i];o&&u&&o.index===u.index&&o.fragment.sn===u.fragment.sn?t(o,u):i--}}}function Wv(l,e,t){const i=e.skippedSegments,s=Math.max(l.startSN,e.startSN)-e.startSN,a=(l.fragmentHint?1:0)+(i?e.endSN:Math.min(l.endSN,e.endSN))-e.startSN,o=e.startSN-l.startSN,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,h=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments;for(let d=s;d<=a;d++){const f=h[o+d];let m=u[d];if(i&&!m&&f&&(m=e.fragments[d]=f),f&&m){t(f,m,d,u);const p=f.relurl,v=m.relurl;if(p&&zv(p,v)){e.playlistParsingError=Wf(`media sequence mismatch ${m.sn}:`,l,e,f,m);return}else if(f.cc!==m.cc){e.playlistParsingError=Wf(`discontinuity sequence mismatch (${f.cc}!=${m.cc})`,l,e,f,m);return}}}}function Wf(l,e,t,i,s){return new Error(`${l} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function rm(l,e,t=!0){const i=e.startSN+e.skippedSegments-l.startSN,s=l.fragments,a=i>=0;let o=0;if(a&&i<s.length)o=s[i].start;else if(a&&e.startSN===l.endSN+1)o=l.fragmentEnd;else if(a&&t)o=l.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=l.fragmentStart;else return;Pu(e,o)}function Pu(l,e){if(e){const t=l.fragments;for(let i=l.skippedSegments;i<t.length;i++)t[i].addStart(e);l.fragmentHint&&l.fragmentHint.addStart(e)}}function am(l,e=1/0){let t=1e3*l.targetduration;if(l.updated){const i=l.fragments;if(i.length&&t*4>e){const a=i[i.length-1].duration*1e3;a<t&&(t=a)}}else t/=2;return Math.round(t)}function om(l,e,t){if(!l)return null;let i=l.fragments[e-l.startSN];return i||(i=l.fragmentHint,i&&i.sn===e)?i:e<l.startSN&&t&&t.sn===e?t:null}function zf(l,e,t){return l?lm(l.partList,e,t):null}function lm(l,e,t){if(l)for(let i=l.length;i--;){const s=l[i];if(s.index===t&&s.fragment.sn===e)return s}return null}function um(l){l.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function zv(l,e){return l!==e&&e?Yf(l)!==Yf(e):!1}function Yf(l){return l.replace(/\?[^?]*$/,"")}function sr(l,e){for(let i=0,s=l.length;i<s;i++){var t;if(((t=l[i])==null?void 0:t.cc)===e)return l[i]}return null}function Yv(l,e){return!!(l&&e.startCC<l.endCC&&e.endCC>l.startCC)}function qf(l,e){const t=l.start+e;l.startPTS=t,l.setStart(t),l.endPTS=t+l.duration}function cm(l,e){const t=e.fragments;for(let i=0,s=t.length;i<s;i++)qf(t[i],l);e.fragmentHint&&qf(e.fragmentHint,l),e.alignedSliding=!0}function qv(l,e){l&&(dm(e,l),e.alignedSliding||eo(e,l),!e.alignedSliding&&!e.skippedSegments&&rm(l,e,!1))}function dm(l,e){if(!Yv(e,l))return;const t=Math.min(e.endCC,l.endCC),i=sr(e.fragments,t),s=sr(l.fragments,t);if(!i||!s)return;Ne.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const a=i.start-s.start;cm(a,l)}function eo(l,e){if(!l.hasProgramDateTime||!e.hasProgramDateTime)return;const t=l.fragments,i=e.fragments;if(!t.length||!i.length)return;let s,a;const o=Math.min(e.endCC,l.endCC);e.startCC<o&&l.startCC<o&&(s=sr(i,o),a=sr(t,o)),(!s||!a)&&(s=i[Math.floor(i.length/2)],a=sr(t,s.cc)||t[Math.floor(t.length/2)]);const u=s.programDateTime,h=a.programDateTime;if(!u||!h)return;const d=(h-u)/1e3-(a.start-s.start);cm(d,l)}function Tt(l,e,t){Ct(l,e,t),l.addEventListener(e,t)}function Ct(l,e,t){l.removeEventListener(e,t)}const Qv={toString:function(l){let e="";const t=l.length;for(let i=0;i<t;i++)e+=`[${l.start(i).toFixed(3)}-${l.end(i).toFixed(3)}]`;return e}},Y={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class tc extends Qg{constructor(e,t,i,s,a){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Y.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:u,media:h,mediaBuffer:d,state:f}=this,m=h?h.currentTime:0,p=Le.bufferInfo(d||h,m,o.maxBufferHole),v=!p.len;if(this.log(`Media seeking to ${oe(m)?m.toFixed(3):m}, state: ${f}, ${v?"out of":"in"} buffer`),this.state===Y.ENDED)this.resetLoadingState();else if(u){const E=o.maxFragLookUpTolerance,A=u.start-E,T=u.start+u.duration+E;if(v||T<p.start||A>p.end){const I=m>T;(m<A||I)&&(I&&u.loader&&(this.log(`Cancelling fragment load for seek (sn: ${u.sn})`),u.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(h){this.fragmentTracker.removeFragmentsInRange(m,1/0,this.playlistType,!0);const E=this.lastCurrentTime;if(m>E&&(this.lastCurrentTime=m),!this.loadingParts){const A=Math.max(p.end,m),T=this.shouldLoadParts(this.getLevelDetails(),A);T&&(this.log(`LL-Part loading ON after seeking to ${m.toFixed(2)} with buffer @${A.toFixed(2)}`),this.loadingParts=T)}}this.hls.hasEnoughToStart||(this.log(`Setting ${v?"startPosition":"nextLoadPosition"} to ${m} for seek without enough to start`),this.nextLoadPosition=m,v&&(this.startPosition=m)),v&&this.state===Y.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=a,this.hls=e,this.fragmentLoader=new Lv(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Xu(e.config)}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===Y.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Y.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const i=e.end||0,s=this.config.timelineOffset||0;if(i<=s)return!1;const a=e.buffered;this.config.maxBufferHole&&a&&a.length>1&&(e=Le.bufferedInfo(a,e.start,0));const o=e.nextStart;if(o&&o>s&&o<t.edge||this.media.currentTime<e.start)return!1;const h=t.partList;if(h!=null&&h.length){const f=h[h.length-1];return Le.isBuffered(this.media,f.start+f.duration/2)}const d=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;Tt(i,"seeking",this.onMediaSeeking),Tt(i,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===Y.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const i=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Ct(s,"seeking",this.onMediaSeeking),Ct(s,"ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=Y.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const s=a=>{const o=a.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${a.part?" part: "+a.part.index:""} of ${this.fragInfo(o,!1,a.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(a)};this._doFragLoad(e,t,i,s).then(a=>{if(!a)return;const o=this.state,u=a.frag;if(this.fragContextChanged(u)){(o===Y.FRAG_LOADING||!this.fragCurrent&&o===Y.PARSING)&&(this.fragmentTracker.removeFragment(u),this.state=Y.IDLE);return}"payload"in a&&(this.log(`Loaded ${u.type} sn: ${u.sn} of ${this.playlistLabel()} ${u.level}`),this.hls.trigger(S.FRAG_LOADED,a)),this._handleFragmentLoadComplete(a)}).catch(a=>{this.state===Y.STOPPED||this.state===Y.ERROR||(this.warn(`Frag error: ${(a==null?void 0:a.message)||a}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===st.APPENDING){const a=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,a),u=Math.max(e.duration,o?o.len:this.config.maxBufferLength),h=this.backtrackFragment;((h?e.sn-h.sn:0)===1||this.reduceMaxBufferLength(u,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===st.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:i};this.hls.trigger(S.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{const s=i==null?void 0:i.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:s}=this,{frag:a,payload:o}=i,u=a.decryptdata;if(o&&o.byteLength>0&&u!=null&&u.key&&u.iv&&ds(u.method)){const h=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),u.key.buffer,u.iv.buffer,Ju(u.method)).catch(d=>{throw s.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:G.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:a}),d}).then(d=>{const f=self.performance.now();return s.trigger(S.FRAG_DECRYPTED,{frag:a,payload:d,stats:{tstart:h,tdecrypt:f}}),i.payload=d,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===Y.STOPPED||this.state===Y.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state!==Y.STOPPED&&(this.state=Y.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var i,s;const a=e.tracks;if(a&&!t.encrypted&&((i=a.audio)!=null&&i.encrypted||(s=a.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,u=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(u.message),!o||o.mediaKeys?!1:(this.hls.trigger(S.ERROR,{type:ye.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_KEYS,fatal:!1,error:u,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?Qv.toString(Le.getBuffered(i)):"(detached)"})`),Ze(e)){var s;if(e.type!==fe.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(u=>!!o[u])){this.state=Y.IDLE;return}}const a=(s=this.levels)==null?void 0:s[e.level];a!=null&&a.fragmentError&&(this.log(`Resetting level fragment error count of ${a.fragmentError} on frag buffered`),a.fragmentError=0)}this.state=Y.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:s,partsLoaded:a}=e,o=!a||a.length===0||a.some(h=>!h),u=new Zu(i.level,i.sn,i.stats.chunkCount+1,0,s?s.index:-1,!o);t.flush(u)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,s){var a;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let u=null;if(e.encrypted&&!((a=e.decryptdata)!=null&&a.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=Y.KEY_LOADING,this.fragCurrent=e,u=this.keyLoader.load(e).then(p=>{if(!this.fragContextChanged(p.frag))return this.hls.trigger(S.KEY_LOADED,p),this.state===Y.KEY_LOADING&&(this.state=Y.IDLE),p}),this.hls.trigger(S.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(u=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),u&&this.log("[eme] blocking frag load until media-keys acquired"));const h=this.fragPrevious;if(Ze(e)&&(!h||e.sn!==h.sn)){const p=this.shouldLoadParts(t.details,e.end);p!==this.loadingParts&&(this.log(`LL-Part loading ${p?"ON":"OFF"} loading sn ${h==null?void 0:h.sn}->${e.sn}`),this.loadingParts=p)}if(i=Math.max(e.start,i||0),this.loadingParts&&Ze(e)){const p=o.partList;if(p&&s){i>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const v=this.getNextPart(p,e,i);if(v>-1){const E=p[v];e=this.fragCurrent=E.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${E.index} (${v}/${p.length-1}) of ${this.fragInfo(e,!1,E)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=E.start+E.duration,this.state=Y.FRAG_LOADING;let A;return u?A=u.then(T=>!T||this.fragContextChanged(T.frag)?null:this.doFragPartsLoad(e,E,t,s)).catch(T=>this.handleFragLoadError(T)):A=this.doFragPartsLoad(e,E,t,s).catch(T=>this.handleFragLoadError(T)),this.hls.trigger(S.FRAG_LOADING,{frag:e,part:E,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):A}else if(!e.url||this.loadedEndOfParts(p,i))return Promise.resolve(null)}}if(Ze(e)&&this.loadingParts){var d;this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(d=o.partList)==null?void 0:d.filter(p=>p.loaded).map(p=>`[${p.start}-${p.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(i.toFixed(3))}`),oe(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Y.FRAG_LOADING;const f=this.config.progressive&&e.type!==fe.SUBTITLE;let m;return f&&u?m=u.then(p=>!p||this.fragContextChanged(p.frag)?null:this.fragmentLoader.load(e,s)).catch(p=>this.handleFragLoadError(p)):m=Promise.all([this.fragmentLoader.load(e,f?s:void 0),u]).then(([p])=>(!f&&s&&s(p),p)).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(S.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):m}doFragPartsLoad(e,t,i,s){return new Promise((a,o)=>{var u;const h=[],d=(u=i.details)==null?void 0:u.partList,f=m=>{this.fragmentLoader.loadPart(e,m,s).then(p=>{h[m.index]=p;const v=p.part;this.hls.trigger(S.FRAG_LOADED,p);const E=zf(i.details,e.sn,m.index+1)||lm(d,e.sn,m.index+1);if(E)f(E);else return a({frag:e,part:v,partsLoaded:h})}).catch(o)};f(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===G.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===ye.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(S.ERROR,t)}else this.hls.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:G.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==Y.PARSING){!this.fragCurrent&&this.state!==Y.STOPPED&&this.state!==Y.ERROR&&(this.state=Y.IDLE);return}const{frag:i,part:s,level:a}=t,o=self.performance.now();i.stats.parsing.end=o,s&&(s.stats.parsing.end=o);const u=this.getLevelDetails(),d=u&&i.sn>u.endSN||this.shouldLoadParts(u,i.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=d),this.updateLevelTiming(i,s,a,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var i;const a=e.partList[0];if(a.fragment.type===fe.SUBTITLE)return!1;const o=a.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=o){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>a.start-a.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:s,sn:a,part:o}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${a} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const u=t[s],h=u.details,d=o>-1?zf(h,a,o):null,f=d?d.fragment:om(h,a,i);return f?(i&&i!==f&&(f.stats=i.stats),{frag:f,part:d,level:u}):null}bufferFragmentData(e,t,i,s,a){if(this.state!==Y.PARSING)return;const{data1:o,data2:u}=e;let h=o;if(u&&(h=Yt(o,u)),!h.length)return;const d=this.initPTS[t.cc],f=d?-d.baseTime/d.timescale:void 0,m={type:e.type,frag:t,part:i,chunkMeta:s,offset:f,parent:t.type,data:h};if(this.hls.trigger(S.BUFFER_APPENDING,m),e.dropped&&e.independent&&!i){if(a)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Le.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,s=Le.bufferInfo(t,i,0),a=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,a*.25),u=Math.max(Math.min(e.start-o,s.end-o),i+o);e.start-u>o&&this.flushMainBuffer(u,e.start)}getFwdBufferInfo(e,t){var i;const s=this.getLoadPosition();if(!oe(s))return null;const o=this.lastCurrentTime>s||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,o)}getFwdBufferInfoAtPos(e,t,i,s){const a=Le.bufferInfo(e,t,s);if(a.len===0&&a.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,i);if(o&&(a.nextStart<=o.end||o.gap)){const u=Math.max(Math.min(a.nextStart,o.end)-t,s);return Le.bufferInfo(e,t,u)}}return a}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const i=this.config,s=Math.max(Math.min(e-t,i.maxBufferLength),t),a=Math.max(e-t*3,i.maxMaxBufferLength/2,s);return a>=s?(i.maxMaxBufferLength=a,this.warn(`Reduce max buffer length to ${a}s`),!0):!1}getAppendedFrag(e,t=fe.MAIN){const i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const i=t.fragments,s=i.length;if(!s)return null;const{config:a}=this,o=i[0].start,u=a.lowLatencyMode&&!!t.partList;let h=null;if(t.live){const m=a.initialLiveManifestSize;if(s<m)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${m})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var d;u&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),h=this.getInitialLiveFragment(t);const p=this.hls.startPosition,v=this.hls.liveSyncPosition,E=h?(p!==-1&&p>=o?p:v)||h.start:e;this.log(`Setting startPosition to ${E} to match start frag at live edge. mainStart: ${p} liveSyncPosition: ${v} frag.start: ${(d=h)==null?void 0:d.start}`),this.startPosition=this.nextLoadPosition=E}}else e<=o&&(h=i[0]);if(!h){const m=this.loadingParts?t.partEnd:t.fragmentEnd;h=this.getFragmentAtPosition(e,m,t)}let f=this.filterReplacedPrimary(h,t);if(!f&&h){const m=h.sn-t.startSN;f=this.filterReplacedPrimary(i[m+1]||null,t)}return this.mapToInitFragWhenRequired(f)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===st.OK||i===st.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,s,a){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&i.nextStart)){const u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,s,0);if(u!==null&&i.len+u.len>=a){const h=o.sn;return this.loopSn!==h&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${h}`),this.loopSn=h),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(Qf(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Qf(this.config)&&e.type!==fe.SUBTITLE){const i=this.hls.interstitialsManager,s=i==null?void 0:i.bufferingItem;if(s){const o=s.event;if(o){if(o.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&(t==null?void 0:t.live)===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const a=i==null?void 0:i.playerQueue;if(a)for(let o=a.length;o--;){const u=a[o].interstitial;if(u.appendInPlace&&e.start>=u.startTime&&e.end<=u.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let s=-1,a=!1,o=!0;for(let u=0,h=e.length;u<h;u++){const d=e[u];if(o=o&&!d.independent,s>-1&&i<d.start)break;const f=d.loaded;f?s=-1:(a||(d.independent||o)&&d.fragment===t)&&(d.fragment!==t&&this.warn(`Need buffer at ${i} but next unloaded part starts at ${d.start}`),s=u),a=f}return s}loadedEndOfParts(e,t){let i;for(let s=e.length;s--;){if(i=e[s],!i.loaded)return!1;if(t>i.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,i=this.fragPrevious;let s=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),s=hv(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const a=i.sn+1;if(a>=e.startSN&&a<=e.endSN){const o=t[a-e.startSN];i.cc===o.cc&&(s=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=zg(e,i.cc,i.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const a=this.hls.liveSyncPosition;a!==null&&(s=this.getFragmentAtPosition(a,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,i){const{config:s}=this;let{fragPrevious:a}=this,{fragments:o,endSN:u}=i;const{fragmentHint:h}=i,{maxFragLookUpTolerance:d}=s,f=i.partList,m=!!(this.loadingParts&&f!=null&&f.length&&h);m&&!this.bitrateTest&&f[f.length-1].fragment.sn===h.sn&&(o=o.concat(h),u=h.sn);let p;if(e<t){var v;const A=e<this.lastCurrentTime||e>t-d||(v=this.media)!=null&&v.paused||!this.startFragRequested?0:d;p=Cn(a,o,e,A)}else p=o[o.length-1];if(p){const E=p.sn-i.startSN,A=this.fragmentTracker.getState(p);if((A===st.OK||A===st.PARTIAL&&p.gap)&&(a=p),a&&p.sn===a.sn&&(!m||f[0].fragment.sn>p.sn||!i.live)&&p.level===a.level){const I=o[E+1];p.sn<u&&this.fragmentTracker.getState(I)!==st.OK?p=I:p=null}}return p}alignPlaylists(e,t,i){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const a=e.fragmentStart,o=!t,u=e.alignedSliding&&oe(a);if(o||!u&&!a){qv(i,e);const h=e.fragmentStart;return this.log(`Live playlist sliding: ${h.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),h}return a}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);const s=this.timelineOffset;if(i===-1){const a=this.startTimeOffset!==null,o=a?this.startTimeOffset:e.startTimeOffset;o!==null&&oe(o)?(i=t+o,o<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${o} found in ${a?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+s}this.nextLoadPosition=i+s}getLoadPosition(){var e;const{media:t}=this;let i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Ze(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==Y.FRAG_LOADING_WAITING_RETRY)&&(this.state=Y.IDLE)}onFragmentOrKeyLoadError(e,t){var i;if(t.chunkMeta&&!t.frag){const I=this.getCurrentContext(t.chunkMeta);I&&(t.frag=I.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var a;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(a=this.fragCurrent)==null?void 0:a.url}`);return}const o=t.details===G.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(s,!0);const u=t.errorAction;if(!u){this.state=Y.ERROR;return}const{action:h,flags:d,retryCount:f=0,retryConfig:m}=u,p=!!m,v=p&&h===ht.RetryRequest,E=p&&!u.resolved&&d===Ft.MoveAllAlternatesMatchingHost,A=(i=this.hls.latestLevelDetails)==null?void 0:i.live;if(!v&&E&&Ze(s)&&!s.endList&&A&&!qg(t))this.resetFragmentErrors(e),this.treatAsGap(s),u.resolved=!0;else if((v||E)&&f<m.maxNumRetry){var T;const I=wu((T=t.response)==null?void 0:T.code),R=Qu(m,f);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+R,this.state=Y.FRAG_LOADING_WAITING_RETRY,u.resolved=!0,I){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${f+1}/${m.maxNumRetry} in ${R}ms`)}else if(m)if(this.resetFragmentErrors(e),f<m.maxNumRetry)!o&&h!==ht.RemoveAlternatePermanently&&(u.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${f})`);return}else h===ht.SendAlternateToPenaltyBox?this.state=Y.WAITING_LEVEL:this.state=Y.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,i=t===1/0;(!t||e>=t||i&&!wu(0))&&(i&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=Y.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===Y.PARSING||this.state===Y.PARSED){const t=e.frag,i=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,i),a=s&&s.len>.5;a&&this.reduceMaxBufferLength(s.len,(t==null?void 0:t.duration)||10);const o=!a;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===fe.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==Y.STOPPED&&(this.state=Y.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const s=Le.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,i),this.state===Y.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==Y.STOPPED&&(this.state=Y.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,s){const a=i.details;if(!a){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((h,d)=>{const f=e.elementaryStreams[d];if(f){const m=f.endPTS-f.startPTS;if(m<=0)return this.warn(`Could not parse fragment ${e.sn} ${d} duration reliably (${m})`),h||!1;const p=s?0:sm(a,e,f.startPTS,f.endPTS,f.startDTS,f.endDTS,this);return this.hls.trigger(S.LEVEL_PTS_UPDATED,{details:a,level:i,drift:p,type:d,frag:e,start:f.startPTS,end:f.endPTS}),!0}return h},!1)){var u;const h=((u=this.transmuxer)==null?void 0:u.error)===null;if((i.fragmentError===0||h&&(i.fragmentError<2||e.endList))&&this.treatAsGap(e,i),h){const d=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(d.message),this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=Y.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(S.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===fe.MAIN?"level":"track"}fragInfo(e,t=!0,i){var s,a;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((s=t&&!i?e.startPTS:(i||e).start)!=null?s:NaN).toFixed(3)}-${((a=t&&!i?e.endPTS:(i||e).end)!=null?a:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Qf(l){return!!l.interstitialsController&&l.enableInterstitialPlayback!==!1}class hm{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=Xv(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function Xv(l,e){const t=new Uint8Array(e);let i=0;for(let s=0;s<l.length;s++){const a=l[s];t.set(a,i),i+=a.length}return t}var lu={exports:{}},Xf;function Zv(){return Xf||(Xf=1,(function(l){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function s(h,d,f){this.fn=h,this.context=d,this.once=f||!1}function a(h,d,f,m,p){if(typeof f!="function")throw new TypeError("The listener must be a function");var v=new s(f,m||h,p),E=t?t+d:d;return h._events[E]?h._events[E].fn?h._events[E]=[h._events[E],v]:h._events[E].push(v):(h._events[E]=v,h._eventsCount++),h}function o(h,d){--h._eventsCount===0?h._events=new i:delete h._events[d]}function u(){this._events=new i,this._eventsCount=0}u.prototype.eventNames=function(){var d=[],f,m;if(this._eventsCount===0)return d;for(m in f=this._events)e.call(f,m)&&d.push(t?m.slice(1):m);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(f)):d},u.prototype.listeners=function(d){var f=t?t+d:d,m=this._events[f];if(!m)return[];if(m.fn)return[m.fn];for(var p=0,v=m.length,E=new Array(v);p<v;p++)E[p]=m[p].fn;return E},u.prototype.listenerCount=function(d){var f=t?t+d:d,m=this._events[f];return m?m.fn?1:m.length:0},u.prototype.emit=function(d,f,m,p,v,E){var A=t?t+d:d;if(!this._events[A])return!1;var T=this._events[A],I=arguments.length,R,_;if(T.fn){switch(T.once&&this.removeListener(d,T.fn,void 0,!0),I){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,f),!0;case 3:return T.fn.call(T.context,f,m),!0;case 4:return T.fn.call(T.context,f,m,p),!0;case 5:return T.fn.call(T.context,f,m,p,v),!0;case 6:return T.fn.call(T.context,f,m,p,v,E),!0}for(_=1,R=new Array(I-1);_<I;_++)R[_-1]=arguments[_];T.fn.apply(T.context,R)}else{var C=T.length,b;for(_=0;_<C;_++)switch(T[_].once&&this.removeListener(d,T[_].fn,void 0,!0),I){case 1:T[_].fn.call(T[_].context);break;case 2:T[_].fn.call(T[_].context,f);break;case 3:T[_].fn.call(T[_].context,f,m);break;case 4:T[_].fn.call(T[_].context,f,m,p);break;default:if(!R)for(b=1,R=new Array(I-1);b<I;b++)R[b-1]=arguments[b];T[_].fn.apply(T[_].context,R)}}return!0},u.prototype.on=function(d,f,m){return a(this,d,f,m,!1)},u.prototype.once=function(d,f,m){return a(this,d,f,m,!0)},u.prototype.removeListener=function(d,f,m,p){var v=t?t+d:d;if(!this._events[v])return this;if(!f)return o(this,v),this;var E=this._events[v];if(E.fn)E.fn===f&&(!p||E.once)&&(!m||E.context===m)&&o(this,v);else{for(var A=0,T=[],I=E.length;A<I;A++)(E[A].fn!==f||p&&!E[A].once||m&&E[A].context!==m)&&T.push(E[A]);T.length?this._events[v]=T.length===1?T[0]:T:o(this,v)}return this},u.prototype.removeAllListeners=function(d){var f;return d?(f=t?t+d:d,this._events[f]&&o(this,f)):(this._events=new i,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,l.exports=u})(lu)),lu.exports}var Jv=Zv(),ic=Ly(Jv);const cr="1.6.15",ms={};function eE(){return typeof __HLS_WORKER_BUNDLE__=="function"}function tE(){const l=ms[cr];if(l)return l.clientCount++,l;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return ms[cr]=s,s}function iE(l){const e=ms[l];if(e)return e.clientCount++,e;const t=new self.URL(l,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return ms[l]=s,s}function nE(l){const e=ms[l||cr];if(e&&e.clientCount--===1){const{worker:i,objectURL:s}=e;delete ms[l||cr],s&&self.URL.revokeObjectURL(s),i.terminate()}}function fm(l,e){return e+10<=l.length&&l[e]===51&&l[e+1]===68&&l[e+2]===73&&l[e+3]<255&&l[e+4]<255&&l[e+6]<128&&l[e+7]<128&&l[e+8]<128&&l[e+9]<128}function nc(l,e){return e+10<=l.length&&l[e]===73&&l[e+1]===68&&l[e+2]===51&&l[e+3]<255&&l[e+4]<255&&l[e+6]<128&&l[e+7]<128&&l[e+8]<128&&l[e+9]<128}function so(l,e){let t=0;return t=(l[e]&127)<<21,t|=(l[e+1]&127)<<14,t|=(l[e+2]&127)<<7,t|=l[e+3]&127,t}function dr(l,e){const t=e;let i=0;for(;nc(l,e);){i+=10;const s=so(l,e+6);i+=s,fm(l,e+10)&&(i+=10),e+=i}if(i>0)return l.subarray(t,t+i)}function sE(l,e,t,i){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],a=e[t+2],o=a>>2&15;if(o>12){const v=new Error(`invalid ADTS sampling index:${o}`);l.emit(S.ERROR,S.ERROR,{type:ye.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,fatal:!0,error:v,reason:v.message});return}const u=(a>>6&3)+1,h=e[t+3]>>6&3|(a&1)<<2,d="mp4a.40."+u,f=s[o];let m=o;(u===5||u===29)&&(m-=3);const p=[u<<3|(m&14)>>1,(m&1)<<7|h<<3];return Ne.log(`manifest codec:${i}, parsed codec:${d}, channels:${h}, rate:${f} (ADTS object type:${u} sampling index:${o})`),{config:p,samplerate:f,channelCount:h,codec:d,parsedCodec:d,manifestCodec:i}}function gm(l,e){return l[e]===255&&(l[e+1]&246)===240}function mm(l,e){return l[e+1]&1?7:9}function sc(l,e){return(l[e+3]&3)<<11|l[e+4]<<3|(l[e+5]&224)>>>5}function rE(l,e){return e+5<l.length}function to(l,e){return e+1<l.length&&gm(l,e)}function aE(l,e){return rE(l,e)&&gm(l,e)&&sc(l,e)<=l.length-e}function oE(l,e){if(to(l,e)){const t=mm(l,e);if(e+t>=l.length)return!1;const i=sc(l,e);if(i<=t)return!1;const s=e+i;return s===l.length||to(l,s)}return!1}function pm(l,e,t,i,s){if(!l.samplerate){const a=sE(e,t,i,s);if(!a)return;Me(l,a)}}function ym(l){return 1024*9e4/l}function lE(l,e){const t=mm(l,e);if(e+t<=l.length){const i=sc(l,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function vm(l,e,t,i,s){const a=ym(l.samplerate),o=i+s*a,u=lE(e,t);let h;if(u){const{frameLength:m,headerLength:p}=u,v=p+m,E=Math.max(0,t+v-e.length);E?(h=new Uint8Array(v-p),h.set(e.subarray(t+p,e.length),0)):h=e.subarray(t+p,t+v);const A={unit:h,pts:o};return E||l.samples.push(A),{sample:A,length:v,missing:E}}const d=e.length-t;return h=new Uint8Array(d),h.set(e.subarray(t,e.length),0),{sample:{unit:h,pts:o},length:d,missing:-1}}function uE(l,e){return nc(l,e)&&so(l,e+6)+10<=l.length-e}function cE(l){return l instanceof ArrayBuffer?l:l.byteOffset==0&&l.byteLength==l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer}function uu(l,e=0,t=1/0){return dE(l,e,t,Uint8Array)}function dE(l,e,t,i){const s=hE(l);let a=1;"BYTES_PER_ELEMENT"in i&&(a=i.BYTES_PER_ELEMENT);const o=fE(l)?l.byteOffset:0,u=(o+l.byteLength)/a,h=(o+e)/a,d=Math.floor(Math.max(0,Math.min(h,u))),f=Math.floor(Math.min(d+Math.max(t,0),u));return new i(s,d,f-d)}function hE(l){return l instanceof ArrayBuffer?l:l.buffer}function fE(l){return l&&l.buffer instanceof ArrayBuffer&&l.byteLength!==void 0&&l.byteOffset!==void 0}function gE(l){const e={key:l.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(l.size<2)return;if(l.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const i=l.data.subarray(1).indexOf(0);if(i===-1)return;const s=$t(uu(l.data,1,i)),a=l.data[2+i],o=l.data.subarray(3+i).indexOf(0);if(o===-1)return;const u=$t(uu(l.data,3+i,o));let h;return s==="-->"?h=$t(uu(l.data,4+i+o)):h=cE(l.data.subarray(4+i+o)),e.mimeType=s,e.pictureType=a,e.description=u,e.data=h,e}function mE(l){if(l.size<2)return;const e=$t(l.data,!0),t=new Uint8Array(l.data.subarray(e.length+1));return{key:l.type,info:e,data:t.buffer}}function pE(l){if(l.size<2)return;if(l.type==="TXXX"){let t=1;const i=$t(l.data.subarray(t),!0);t+=i.length+1;const s=$t(l.data.subarray(t));return{key:l.type,info:i,data:s}}const e=$t(l.data.subarray(1));return{key:l.type,info:"",data:e}}function yE(l){if(l.type==="WXXX"){if(l.size<2)return;let t=1;const i=$t(l.data.subarray(t),!0);t+=i.length+1;const s=$t(l.data.subarray(t));return{key:l.type,info:i,data:s}}const e=$t(l.data);return{key:l.type,info:"",data:e}}function vE(l){return l.type==="PRIV"?mE(l):l.type[0]==="W"?yE(l):l.type==="APIC"?gE(l):pE(l)}function EE(l){const e=String.fromCharCode(l[0],l[1],l[2],l[3]),t=so(l,4),i=10;return{type:e,size:t,data:l.subarray(i,i+t)}}const _a=10,xE=10;function Em(l){let e=0;const t=[];for(;nc(l,e);){const i=so(l,e+6);l[e+5]>>6&1&&(e+=_a),e+=_a;const s=e+i;for(;e+xE<s;){const a=EE(l.subarray(e)),o=vE(a);o&&t.push(o),e+=a.size+_a}fm(l,e)&&(e+=_a)}return t}function xm(l){return l&&l.key==="PRIV"&&l.info==="com.apple.streaming.transportStreamTimestamp"}function SE(l){if(l.data.byteLength===8){const e=new Uint8Array(l.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function rc(l){const e=Em(l);for(let t=0;t<e.length;t++){const i=e[t];if(xm(i))return SE(i)}}let Ut=(function(l){return l.audioId3="org.id3",l.dateRange="com.apple.quicktime.HLS",l.emsg="https://aomedia.org/emsg/ID3",l.misbklv="urn:misb:KLV:bin:1910.1",l})({});function yi(l="",e=9e4){return{type:l,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class ac{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=Yt(this.cachedData,e),this.cachedData=null);let i=dr(e,0),s=i?i.length:0,a;const o=this._audioTrack,u=this._id3Track,h=i?rc(i):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&oe(h))&&(this.basePTS=TE(h,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Ut.audioId3,duration:Number.POSITIVE_INFINITY});s<d;){if(this.canParse(e,s)){const f=this.appendFrame(o,e,s);f?(this.frameIndex++,this.lastPTS=f.sample.pts,s+=f.length,a=s):s=d}else uE(e,s)?(i=dr(e,s),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Ut.audioId3,duration:Number.POSITIVE_INFINITY}),s+=i.length,a=s):s++;if(s===d&&a!==d){const f=e.slice(a);this.cachedData?this.cachedData=Yt(this.cachedData,f):this.cachedData=f}}return{audioTrack:o,videoTrack:yi(),id3Track:u,textTrack:yi()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:yi(),id3Track:this._id3Track,textTrack:yi()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const TE=(l,e,t)=>{if(oe(l))return l*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};let ka=null;const AE=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],LE=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],IE=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],RE=[0,1,1,4];function Sm(l,e,t,i,s){if(t+24>e.length)return;const a=Tm(e,t);if(a&&t+a.frameLength<=e.length){const o=a.samplesPerFrame*9e4/a.sampleRate,u=i+s*o,h={unit:e.subarray(t,t+a.frameLength),pts:u,dts:u};return l.config=[],l.channelCount=a.channelCount,l.samplerate=a.sampleRate,l.samples.push(h),{sample:h,length:a.frameLength,missing:0}}}function Tm(l,e){const t=l[e+1]>>3&3,i=l[e+1]>>1&3,s=l[e+2]>>4&15,a=l[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&a!==3){const o=l[e+2]>>1&1,u=l[e+3]>>6,h=t===3?3-i:i===3?3:4,d=AE[h*14+s-1]*1e3,m=LE[(t===3?0:t===2?1:2)*3+a],p=u===3?1:2,v=IE[t][i],E=RE[i],A=v*8*E,T=Math.floor(v*d/m+o)*E;if(ka===null){const _=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ka=_?parseInt(_[1]):0}return!!ka&&ka<=87&&i===2&&d>=224e3&&u===0&&(l[e+3]=l[e+3]|128),{sampleRate:m,channelCount:p,frameLength:T,samplesPerFrame:A}}}function oc(l,e){return l[e]===255&&(l[e+1]&224)===224&&(l[e+1]&6)!==0}function Am(l,e){return e+1<l.length&&oc(l,e)}function _E(l,e){return oc(l,e)&&4<=l.length-e}function Lm(l,e){if(e+1<l.length&&oc(l,e)){const i=Tm(l,e);let s=4;i!=null&&i.frameLength&&(s=i.frameLength);const a=e+s;return a===l.length||Am(l,a)}return!1}class kE extends ac{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const i=dr(e,0);let s=(i==null?void 0:i.length)||0;if(Lm(e,s))return!1;for(let a=e.length;s<a;s++)if(oE(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return aE(e,t)}appendFrame(e,t,i){pm(e,this.observer,t,i,e.manifestCodec);const s=vm(e,t,i,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const Im=(l,e)=>{let t=0,i=5;e+=i;const s=new Uint32Array(1),a=new Uint32Array(1),o=new Uint8Array(1);for(;i>0;){o[0]=l[e];const u=Math.min(i,8),h=8-u;a[0]=4278190080>>>24+h<<h,s[0]=(o[0]&a[0])>>h,t=t?t<<u|s[0]:s[0],e+=1,i-=u}return t};class wE extends ac{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){const s=Rm(e,t,i,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=dr(e,0);if(!t)return!1;const i=t.length;return e[i]===11&&e[i+1]===119&&rc(t)!==void 0&&Im(e,i)<16}}function Rm(l,e,t,i,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const a=e[t+4]>>6;if(a>=3)return-1;const u=[48e3,44100,32e3][a],h=e[t+4]&63,f=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][h*3+a]*2;if(t+f>e.length)return-1;const m=e[t+6]>>5;let p=0;m===2?p+=2:(m&1&&m!==1&&(p+=2),m&4&&(p+=2));const v=(e[t+6]<<8|e[t+7])>>12-p&1,A=[2,1,2,3,3,4,4,5][m]+v,T=e[t+5]>>3,I=e[t+5]&7,R=new Uint8Array([a<<6|T<<1|I>>2,(I&3)<<6|m<<3|v<<2|h>>4,h<<4&224]),_=1536/u*9e4,C=i+s*_,b=e.subarray(t,t+f);return l.config=R,l.channelCount=A,l.samplerate=u,l.samples.push({unit:b,pts:C}),f}class CE extends ac{resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=dr(e,0);let i=(t==null?void 0:t.length)||0;if(t&&e[i]===11&&e[i+1]===119&&rc(t)!==void 0&&Im(e,i)<=16)return!1;for(let s=e.length;i<s;i++)if(Lm(e,i))return Ne.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return _E(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return Sm(e,t,i,this.basePTS,this.frameIndex)}}const DE=/\/emsg[-/]ID3/i;class bE{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,s){const a=this.videoTrack=yi("video",1),o=this.audioTrack=yi("audio",1),u=this.txtTrack=yi("text",1);if(this.id3Track=yi("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const h=Mg(e);if(h.video){const{id:d,timescale:f,codec:m,supplemental:p}=h.video;a.id=d,a.timescale=u.timescale=f,a.codec=m,a.supplemental=p}if(h.audio){const{id:d,timescale:f,codec:m}=h.audio;o.id=d,o.timescale=f,o.codec=m}u.id=Pg.text,a.sampleDuration=0,a.duration=o.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return wy(e)}demux(e,t){this.timeOffset=t;let i=e;const s=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=Yt(this.remainderData,e));const u=My(i);this.remainderData=u.remainder,s.samples=u.valid||new Uint8Array}else s.samples=i;const o=this.extractID3Track(s,t);return a.samples=mf(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return i.samples=mf(e,t),{videoTrack:t,audioTrack:yi(),id3Track:s,textTrack:yi()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const s=Re(e.samples,["emsg"]);s&&s.forEach(a=>{const o=By(a);if(DE.test(o.schemeIdUri)){const u=Zf(o,t);let h=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);const d=o.payload;i.samples.push({data:d,len:d.byteLength,dts:u,pts:u,type:Ut.emsg,duration:h})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const u=Zf(o,t);i.samples.push({data:o.payload,len:o.payload.byteLength,dts:u,pts:u,type:Ut.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Zf(l,e){return oe(l.presentationTime)?l.presentationTime/l.timeScale:e+l.presentationTimeDelta/l.timeScale}class PE{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Xu(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,un.cbc)}decryptAacSample(e,t,i){const s=e[t].unit;if(s.length<=16)return;const a=s.subarray(16,s.length-s.length%16),o=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(o).then(u=>{const h=new Uint8Array(u);s.set(h,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)}).catch(i)}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let s=0;for(let a=32;a<e.length-16;a+=160,s+=16)i.set(e.subarray(a,a+16),s);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let s=0;for(let a=32;a<e.length-16;a+=160,s+=16)e.set(i.subarray(s,s+16),a);return e}decryptAvcSample(e,t,i,s,a){const o=Ug(a.data),u=this.getAvcEncryptedData(o);this.decryptBuffer(u.buffer).then(h=>{a.data=this.getAvcDecryptedUnit(o,h),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,s)}).catch(s)}decryptAvcSamples(e,t,i,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){s();return}const a=e[t].units;for(;!(i>=a.length);i++){const o=a[i];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,i,s,o),!this.decrypter.isSync()))return}}}}class _m{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,s;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const a=i.units;s=a[a.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const i=t.samples,s=i.length;if(s){const a=i[s-1];e.pts=a.pts,e.dts=a.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){const s=t.byteLength;let a=e.naluState||0;const o=a,u=[];let h=0,d,f,m,p=-1,v=0;for(a===-1&&(p=0,v=this.getNALuType(t,0),a=0,h=1);h<s;){if(d=t[h++],!a){a=d?0:1;continue}if(a===1){a=d?0:2;continue}if(!d)a=3;else if(d===1){if(f=h-a-1,p>=0){const E={data:t.subarray(p,f),type:v};u.push(E)}else{const E=this.getLastNalUnit(e.samples);E&&(o&&h<=4-o&&E.state&&(E.data=E.data.subarray(0,E.data.byteLength-o)),f>0&&(E.data=Yt(E.data,t.subarray(0,f)),E.state=0))}h<s?(m=this.getNALuType(t,h),p=h,v=m,a=0):a=-1}else a=0}if(p>=0&&a>=0){const E={data:t.subarray(p,s),type:v,state:a};u.push(E)}if(u.length===0){const E=this.getLastNalUnit(e.samples);E&&(E.data=Yt(E.data,t))}return e.naluState=a,u}}class rr{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,s=new Uint8Array(4),a=Math.min(4,t);if(a===0)throw new Error("no bytes available");s.set(e.subarray(i,i+a)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=a*8,this.bytesAvailable-=a}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&Ne.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class OE extends _m{parsePES(e,t,i,s){const a=this.parseNALu(e,i.data,s);let o=this.VideoSample,u,h=!1;i.data=null,o&&a.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),a.forEach(d=>{var f,m;switch(d.type){case 1:{let A=!1;u=!0;const T=d.data;if(h&&T.length>4){const I=this.readSliceType(T);(I===2||I===4||I===7||I===9)&&(A=!0)}if(A){var p;(p=o)!=null&&p.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.frame=!0,o.key=A;break}case 5:u=!0,(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 6:{u=!0,zu(d.data,1,i.pts,t.samples);break}case 7:{var v,E;u=!0,h=!0;const A=d.data,T=this.readSPS(A);if(!e.sps||e.width!==T.width||e.height!==T.height||((v=e.pixelRatio)==null?void 0:v[0])!==T.pixelRatio[0]||((E=e.pixelRatio)==null?void 0:E[1])!==T.pixelRatio[1]){e.width=T.width,e.height=T.height,e.pixelRatio=T.pixelRatio,e.sps=[A];const I=A.subarray(1,4);let R="avc1.";for(let _=0;_<3;_++){let C=I[_].toString(16);C.length<2&&(C="0"+C),R+=C}e.codec=R}break}case 8:u=!0,e.pps=[d.data];break;case 9:u=!0,e.audFound=!0,(m=o)!=null&&m.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:u=!0;break;default:u=!1;break}o&&u&&o.units.push(d)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new rr(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,s=8,a;for(let o=0;o<e;o++)s!==0&&(a=t.readEG(),s=(i+a+256)%256),i=s===0?i:s}readSPS(e){const t=new rr(e);let i=0,s=0,a=0,o=0,u,h,d;const f=t.readUByte.bind(t),m=t.readBits.bind(t),p=t.readUEG.bind(t),v=t.readBoolean.bind(t),E=t.skipBits.bind(t),A=t.skipEG.bind(t),T=t.skipUEG.bind(t),I=this.skipScalingList.bind(this);f();const R=f();if(m(5),E(3),f(),T(),R===100||R===110||R===122||R===244||R===44||R===83||R===86||R===118||R===128){const B=p();if(B===3&&E(1),T(),T(),E(1),v())for(h=B!==3?8:12,d=0;d<h;d++)v()&&(d<6?I(16,t):I(64,t))}T();const _=p();if(_===0)p();else if(_===1)for(E(1),A(),A(),u=p(),d=0;d<u;d++)A();T(),E(1);const C=p(),b=p(),K=m(1);K===0&&E(1),E(1),v()&&(i=p(),s=p(),a=p(),o=p());let O=[1,1];if(v()&&v())switch(f()){case 1:O=[1,1];break;case 2:O=[12,11];break;case 3:O=[10,11];break;case 4:O=[16,11];break;case 5:O=[40,33];break;case 6:O=[24,11];break;case 7:O=[20,11];break;case 8:O=[32,11];break;case 9:O=[80,33];break;case 10:O=[18,11];break;case 11:O=[15,11];break;case 12:O=[64,33];break;case 13:O=[160,99];break;case 14:O=[4,3];break;case 15:O=[3,2];break;case 16:O=[2,1];break;case 255:{O=[f()<<8|f(),f()<<8|f()];break}}return{width:Math.ceil((C+1)*16-i*2-s*2),height:(2-K)*(b+1)*16-(K?2:4)*(a+o),pixelRatio:O}}}class NE extends _m{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,s){const a=this.parseNALu(e,i.data,s);let o=this.VideoSample,u,h=!1;i.data=null,o&&a.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),a.forEach(d=>{var f,m;switch(d.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),o.frame=!0,u=!0;break;case 16:case 17:case 18:case 21:if(u=!0,h){var p;(p=o)!=null&&p.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:u=!0,(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 39:u=!0,zu(d.data,2,i.pts,t.samples);break;case 32:u=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Me(e.params,this.readVPS(d.data)),this.initVPS=d.data),e.vps=[d.data];break;case 33:if(u=!0,h=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],d.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const v=this.readSPS(d.data);e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.codec=v.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const E in v.params)e.params[E]=v.params[E]}this.pushParameterSet(e.sps,d.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0;break;case 34:if(u=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const v=this.readPPS(d.data);for(const E in v)e.params[E]=v[E]}this.pushParameterSet(e.pps,d.data,e.vps)}break;case 35:u=!0,e.audFound=!0,(m=o)!=null&&m.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:u=!1;break}o&&u&&o.units.push(d)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let i=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[i]=e[s],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new rr(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const i=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:s}}readSPS(e){const t=new rr(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const i=t.readBits(3);t.readBoolean();const s=t.readBits(2),a=t.readBoolean(),o=t.readBits(5),u=t.readUByte(),h=t.readUByte(),d=t.readUByte(),f=t.readUByte(),m=t.readUByte(),p=t.readUByte(),v=t.readUByte(),E=t.readUByte(),A=t.readUByte(),T=t.readUByte(),I=t.readUByte(),R=[],_=[];for(let Ce=0;Ce<i;Ce++)R.push(t.readBoolean()),_.push(t.readBoolean());if(i>0)for(let Ce=i;Ce<8;Ce++)t.readBits(2);for(let Ce=0;Ce<i;Ce++)R[Ce]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),_[Ce]&&t.readUByte();t.readUEG();const C=t.readUEG();C==3&&t.skipBits(1);const b=t.readUEG(),K=t.readUEG(),O=t.readBoolean();let B=0,U=0,M=0,z=0;O&&(B+=t.readUEG(),U+=t.readUEG(),M+=t.readUEG(),z+=t.readUEG());const te=t.readUEG(),se=t.readUEG(),le=t.readUEG(),ae=t.readBoolean();for(let Ce=ae?0:i;Ce<=i;Ce++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Je=0;Je<4;Je++)for(let Et=0;Et<(Je===3?2:6);Et++)if(!t.readBoolean())t.readUEG();else{const ut=Math.min(64,1<<4+(Je<<1));Je>1&&t.readEG();for(let Dt=0;Dt<ut;Dt++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const H=t.readUEG();let Q=0;for(let Ce=0;Ce<H;Ce++){let Je=!1;if(Ce!==0&&(Je=t.readBoolean()),Je){Ce===H&&t.readUEG(),t.readBoolean(),t.readUEG();let Et=0;for(let Qt=0;Qt<=Q;Qt++){const ut=t.readBoolean();let Dt=!1;ut||(Dt=t.readBoolean()),(ut||Dt)&&Et++}Q=Et}else{const Et=t.readUEG(),Qt=t.readUEG();Q=Et+Qt;for(let ut=0;ut<Et;ut++)t.readUEG(),t.readBoolean();for(let ut=0;ut<Qt;ut++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ce=t.readUEG();for(let Je=0;Je<Ce;Je++){for(let Et=0;Et<le+4;Et++)t.readBits(1);t.readBits(1)}}let k=0,F=1,re=1,de=!0,ue=1,he=0;t.readBoolean(),t.readBoolean();let Ie=!1;if(t.readBoolean()){if(t.readBoolean()){const Xt=t.readUByte(),ps=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],dn=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Xt>0&&Xt<16?(F=ps[Xt-1],re=dn[Xt-1]):Xt===255&&(F=t.readBits(16),re=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Ie=t.readBoolean(),Ie&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ue=t.readBits(32),he=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const dn=t.readBoolean(),ys=t.readBoolean();let Ni=!1;(dn||ys)&&(Ni=t.readBoolean(),Ni&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Ni&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Dn=0;Dn<=i;Dn++){de=t.readBoolean();const bn=de||t.readBoolean();let vs=!1;bn?t.readEG():vs=t.readBoolean();const Mi=vs?1:t.readUEG()+1;if(dn)for(let Zt=0;Zt<Mi;Zt++)t.readUEG(),t.readUEG(),Ni&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(ys)for(let Zt=0;Zt<Mi;Zt++)t.readUEG(),t.readUEG(),Ni&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),k=t.readUEG())}let we=b,je=K;if(O){let Ce=1,Je=1;C===1?Ce=Je=2:C==2&&(Ce=2),we=b-Ce*U-Ce*B,je=K-Je*z-Je*M}const Gt=s?["A","B","C"][s]:"",gr=u<<24|h<<16|d<<8|f;let Oi=0;for(let Ce=0;Ce<32;Ce++)Oi=(Oi|(gr>>Ce&1)<<31-Ce)>>>0;let cn=Oi.toString(16);return o===1&&cn==="2"&&(cn="6"),{codecString:`hvc1.${Gt}${o}.${cn}.${a?"H":"L"}${I}.B0`,params:{general_tier_flag:a,general_profile_idc:o,general_profile_space:s,general_profile_compatibility_flags:[u,h,d,f],general_constraint_indicator_flags:[m,p,v,E,A,T],general_level_idc:I,bit_depth:te+8,bit_depth_luma_minus8:te,bit_depth_chroma_minus8:se,min_spatial_segmentation_idc:k,chroma_format_idc:C,frame_rate:{fixed:de,fps:he/ue}},width:we,height:je,pixelRatio:[F,re]}}readPPS(e){const t=new rr(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),a=t.readBoolean();let o=1;return a&&s?o=0:a?o=3:s&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const lt=188;class an{constructor(e,t,i,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=s,this.videoParser=null}static probe(e,t){const i=an.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const t=e.length;let i=Math.min(lt*5,t-lt)+1,s=0;for(;s<i;){let a=!1,o=-1,u=0;for(let h=s;h<t;h+=lt)if(e[h]===71&&(t-h===lt||e[h+lt]===71)){if(u++,o===-1&&(o=h,o!==0&&(i=Math.min(o+lt*99,e.length-lt)+1)),a||(a=Ou(e,h)===0),a&&u>1&&(o===0&&u>2||h+lt>i))return o}else{if(u)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Pg[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=an.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=an.createTrack("audio",s),this._id3Track=an.createTrack("id3"),this._txtTrack=an.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,s=!1){i||(this.sampleAes=null);let a;const o=this._videoTrack,u=this._audioTrack,h=this._id3Track,d=this._txtTrack;let f=o.pid,m=o.pesData,p=u.pid,v=h.pid,E=u.pesData,A=h.pesData,T=null,I=this.pmtParsed,R=this._pmtId,_=e.length;if(this.remainderData&&(e=Yt(this.remainderData,e),_=e.length,this.remainderData=null),_<lt&&!s)return this.remainderData=e,{audioTrack:u,videoTrack:o,id3Track:h,textTrack:d};const C=Math.max(0,an.syncOffset(e));_-=(_-C)%lt,_<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,_,e.buffer.byteLength-_));let b=0;for(let O=C;O<_;O+=lt)if(e[O]===71){const B=!!(e[O+1]&64),U=Ou(e,O),M=(e[O+3]&48)>>4;let z;if(M>1){if(z=O+5+e[O+4],z===O+lt)continue}else z=O+4;switch(U){case f:B&&(m&&(a=as(m,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,d,a,!1)),m={data:[],size:0}),m&&(m.data.push(e.subarray(z,O+lt)),m.size+=O+lt-z);break;case p:if(B){if(E&&(a=as(E,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,a);break;case"mp3":this.parseMPEGPES(u,a);break;case"ac3":this.parseAC3PES(u,a);break}E={data:[],size:0}}E&&(E.data.push(e.subarray(z,O+lt)),E.size+=O+lt-z);break;case v:B&&(A&&(a=as(A,this.logger))&&this.parseID3PES(h,a),A={data:[],size:0}),A&&(A.data.push(e.subarray(z,O+lt)),A.size+=O+lt-z);break;case 0:B&&(z+=e[z]+1),R=this._pmtId=ME(e,z);break;case R:{B&&(z+=e[z]+1);const te=FE(e,z,this.typeSupported,i,this.observer,this.logger);f=te.videoPid,f>0&&(o.pid=f,o.segmentCodec=te.segmentVideoCodec),p=te.audioPid,p>0&&(u.pid=p,u.segmentCodec=te.segmentAudioCodec),v=te.id3Pid,v>0&&(h.pid=v),T!==null&&!I&&(this.logger.warn(`MPEG-TS PMT found at ${O} after unknown PID '${T}'. Backtracking to sync byte @${C} to parse all TS packets.`),T=null,O=C-188),I=this.pmtParsed=!0;break}case 17:case 8191:break;default:T=U;break}}else b++;b>0&&Nu(this.observer,new Error(`Found ${b} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=m,u.pesData=E,h.pesData=A;const K={audioTrack:u,videoTrack:o,id3Track:h,textTrack:d};return s&&this.extractRemainingSamples(K),K}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:s,textTrack:a}=e,o=i.pesData,u=t.pesData,h=s.pesData;let d;if(o&&(d=as(o,this.logger))?(this.readyVideoParser(i.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(i,a,d,!0),i.pesData=null)):i.pesData=o,u&&(d=as(u,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,d);break;case"mp3":this.parseMPEGPES(t,d);break;case"ac3":this.parseAC3PES(t,d);break}t.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=u;h&&(d=as(h,this.logger))?(this.parseID3PES(s,d),s.pesData=null):s.pesData=h}demuxSampleAes(e,t,i){const s=this.demux(e,i,!0,!this.config.progressive),a=this.sampleAes=new PE(this.observer,this.config,t);return this.decrypt(s,a)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new OE:e==="hevc"&&(this.videoParser=new NE))}decrypt(e,t){return new Promise(i=>{const{audioTrack:s,videoTrack:a}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{a.samples?t.decryptAvcSamples(a.samples,0,0,()=>{i(e)}):i(e)}):a.samples&&t.decryptAvcSamples(a.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0;const s=this.aacOverFlow;let a=t.data;if(s){this.aacOverFlow=null;const m=s.missing,p=s.sample.unit.byteLength;if(m===-1)a=Yt(s.sample.unit,a);else{const v=p-m;s.sample.unit.set(a.subarray(0,m),v),e.samples.push(s.sample),i=s.missing}}let o,u;for(o=i,u=a.length;o<u-1&&!to(a,o);o++);if(o!==i){let m;const p=o<u-1;if(p?m=`AAC PES did not start with ADTS header,offset:${o}`:m="No ADTS header found in AAC PES",Nu(this.observer,new Error(m),p,this.logger),!p)return}pm(e,this.observer,a,o,this.audioCodec);let h;if(t.pts!==void 0)h=t.pts;else if(s){const m=ym(e.samplerate);h=s.sample.pts+m}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0,f;for(;o<u;)if(f=vm(e,a,o,h,d),o+=f.length,f.missing){this.aacOverFlow=f;break}else for(d++;o<u-1&&!to(a,o);o++);}parseMPEGPES(e,t){const i=t.data,s=i.length;let a=0,o=0;const u=t.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<s;)if(Am(i,o)){const h=Sm(e,i,o,u,a);if(h)o+=h.length,a++;else break}else o++}parseAC3PES(e,t){{const i=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const a=i.length;let o=0,u=0,h;for(;u<a&&(h=Rm(e,i,u,s,o++))>0;)u+=h}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=Me({},t,{type:this._videoTrack?Ut.emsg:Ut.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function Ou(l,e){return((l[e+1]&31)<<8)+l[e+2]}function ME(l,e){return(l[e+10]&31)<<8|l[e+11]}function FE(l,e,t,i,s,a){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},u=(l[e+1]&15)<<8|l[e+2],h=e+3+u-4,d=(l[e+10]&15)<<8|l[e+11];for(e+=12+d;e<h;){const f=Ou(l,e),m=(l[e+3]&15)<<8|l[e+4];switch(l[e]){case 207:if(!i){cu("ADTS AAC",a);break}case 15:o.audioPid===-1&&(o.audioPid=f);break;case 21:o.id3Pid===-1&&(o.id3Pid=f);break;case 219:if(!i){cu("H.264",a);break}case 27:o.videoPid===-1&&(o.videoPid=f);break;case 3:case 4:!t.mpeg&&!t.mp3?a.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=f,o.segmentAudioCodec="mp3");break;case 193:if(!i){cu("AC-3",a);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=f,o.segmentAudioCodec="ac3"):a.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&m>0){let p=e+5,v=m;for(;v>2;){switch(l[p]){case 106:t.ac3!==!0?a.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=f,o.segmentAudioCodec="ac3");break}const A=l[p+1]+2;p+=A,v-=A}}break;case 194:case 135:return Nu(s,new Error("Unsupported EC-3 in M2TS found"),void 0,a),o;case 36:o.videoPid===-1&&(o.videoPid=f,o.segmentVideoCodec="hevc",a.log("HEVC in M2TS found"));break}e+=m+5}return o}function Nu(l,e,t,i){i.warn(`parsing error: ${e.message}`),l.emit(S.ERROR,S.ERROR,{type:ye.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function cu(l,e){e.log(`${l} with AES-128-CBC encryption found in unencrypted stream`)}function as(l,e){let t=0,i,s,a,o,u;const h=l.data;if(!l||l.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=Yt(h[0],h[1]),h.splice(1,1);if(i=h[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(s=(i[4]<<8)+i[5],s&&s>l.size-6)return null;const f=i[7];f&192&&(o=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,f&64?(u=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,o-u>60*9e4&&(e.warn(`${Math.round((o-u)/9e4)}s delta between PTS and DTS, align them`),o=u)):u=o),a=i[8];let m=a+9;if(l.size<=m)return null;l.size-=m;const p=new Uint8Array(l.size);for(let v=0,E=h.length;v<E;v++){i=h[v];let A=i.byteLength;if(m)if(m>A){m-=A;continue}else i=i.subarray(m),A-=m,m=0;p.set(i,t),t+=A}return s&&(s-=a+3),{data:p,pts:o,dts:u,len:s}}return null}class BE{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const nn=Math.pow(2,32)-1;class ${static init(){$.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in $.types)$.types.hasOwnProperty(e)&&($.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);$.HDLR_TYPES={video:t,audio:i};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);$.STTS=$.STSC=$.STCO=a,$.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),$.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),$.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),$.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),u=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);$.FTYP=$.box($.types.ftyp,o,h,o,u),$.DINF=$.box($.types.dinf,$.box($.types.dref,s))}static box(e,...t){let i=8,s=t.length;const a=s;for(;s--;)i+=t[s].byteLength;const o=new Uint8Array(i);for(o[0]=i>>24&255,o[1]=i>>16&255,o[2]=i>>8&255,o[3]=i&255,o.set(e,4),s=0,i=8;s<a;s++)o.set(t[s],i),i+=t[s].byteLength;return o}static hdlr(e){return $.box($.types.hdlr,$.HDLR_TYPES[e])}static mdat(e){return $.box($.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(nn+1)),s=Math.floor(t%(nn+1));return $.box($.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return $.box($.types.mdia,$.mdhd(e.timescale||0,e.duration||0),$.hdlr(e.type),$.minf(e))}static mfhd(e){return $.box($.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?$.box($.types.minf,$.box($.types.smhd,$.SMHD),$.DINF,$.stbl(e)):$.box($.types.minf,$.box($.types.vmhd,$.VMHD),$.DINF,$.stbl(e))}static moof(e,t,i){return $.box($.types.moof,$.mfhd(e),$.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=$.trak(e[t]);return $.box.apply(null,[$.types.moov,$.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat($.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=$.trex(e[t]);return $.box.apply(null,[$.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(nn+1)),s=Math.floor(t%(nn+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return $.box($.types.mvhd,a)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let s,a;for(s=0;s<t.length;s++)a=t[s].flags,i[s+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy;return $.box($.types.sdtp,i)}static stbl(e){return $.box($.types.stbl,$.stsd(e),$.box($.types.stts,$.STTS),$.box($.types.stsc,$.STSC),$.box($.types.stsz,$.STSZ),$.box($.types.stco,$.STCO))}static avc1(e){let t=[],i=[],s,a,o;for(s=0;s<e.sps.length;s++)a=e.sps[s],o=a.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(a));for(s=0;s<e.pps.length;s++)a=e.pps[s],o=a.byteLength,i.push(o>>>8&255),i.push(o&255),i=i.concat(Array.prototype.slice.call(a));const u=$.box($.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),h=e.width,d=e.height,f=e.pixelRatio[0],m=e.pixelRatio[1];return $.box($.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,$.box($.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),$.box($.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,m>>24,m>>16&255,m>>8&255,m&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return $.box($.types.mp4a,$.audioStsd(e),$.box($.types.esds,$.esds(e)))}static mp3(e){return $.box($.types[".mp3"],$.audioStsd(e))}static ac3(e){return $.box($.types["ac-3"],$.audioStsd(e),$.box($.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return $.box($.types.stsd,$.STSD,$.mp4a(e));if(t==="ac3"&&e.config)return $.box($.types.stsd,$.STSD,$.ac3(e));if(t==="mp3"&&e.codec==="mp3")return $.box($.types.stsd,$.STSD,$.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return $.box($.types.stsd,$.STSD,$.avc1(e));if(t==="hevc"&&e.vps)return $.box($.types.stsd,$.STSD,$.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,i=(e.duration||0)*(e.timescale||0),s=e.width||0,a=e.height||0,o=Math.floor(i/(nn+1)),u=Math.floor(i%(nn+1));return $.box($.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,u>>24,u>>16&255,u>>8&255,u&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,a>>8&255,a&255,0,0]))}static traf(e,t){const i=$.sdtp(e),s=e.id,a=Math.floor(t/(nn+1)),o=Math.floor(t%(nn+1));return $.box($.types.traf,$.box($.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),$.box($.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255])),$.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,$.box($.types.trak,$.tkhd(e),$.mdia(e))}static trex(e){const t=e.id;return $.box($.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],s=i.length,a=12+16*s,o=new Uint8Array(a);let u,h,d,f,m,p;for(t+=8+a,o.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),u=0;u<s;u++)h=i[u],d=h.duration,f=h.size,m=h.flags,p=h.cts,o.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,m.degradPrio&61440,m.degradPrio&15,p>>>24&255,p>>>16&255,p>>>8&255,p&255],12+16*u);return $.box($.types.trun,o)}static initSegment(e){$.types||$.init();const t=$.moov(e);return Yt($.FTYP,t)}static hvc1(e){const t=e.params,i=[e.vps,e.sps,e.pps],s=4,a=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),i.length]);let o=a.length;for(let E=0;E<i.length;E+=1){o+=3;for(let A=0;A<i[E].length;A+=1)o+=2+i[E][A].length}const u=new Uint8Array(o);u.set(a,0),o=a.length;const h=i.length-1;for(let E=0;E<i.length;E+=1){u.set(new Uint8Array([32+E|(E===h?128:0),0,i[E].length]),o),o+=3;for(let A=0;A<i[E].length;A+=1)u.set(new Uint8Array([i[E][A].length>>8,i[E][A].length&255]),o),o+=2,u.set(i[E][A],o),o+=i[E][A].length}const d=$.box($.types.hvcC,u),f=e.width,m=e.height,p=e.pixelRatio[0],v=e.pixelRatio[1];return $.box($.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,$.box($.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),$.box($.types.pasp,new Uint8Array([p>>24,p>>16&255,p>>8&255,p&255,v>>24,v>>16&255,v>>8&255,v&255])))}}$.types=void 0;$.HDLR_TYPES=void 0;$.STTS=void 0;$.STSC=void 0;$.STCO=void 0;$.STSZ=void 0;$.VMHD=void 0;$.SMHD=void 0;$.STSD=void 0;$.FTYP=void 0;$.DINF=void 0;const km=9e4;function lc(l,e,t=1,i=!1){const s=l*e*t;return i?Math.round(s):s}function UE(l,e,t=1,i=!1){return lc(l,e,1/t,i)}function ir(l,e=!1){return lc(l,1e3,1/km,e)}function $E(l,e=1){return lc(l,km,1/e)}function Jf(l){const{baseTime:e,timescale:t,trackId:i}=l;return`${e/t} (${e}/${t}) trackId: ${i}`}const GE=10*1e3,jE=1024,KE=1152,VE=1536;let os=null,du=null;function eg(l,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:l?2:1,isNonSync:l?0:1}}}class Ga extends qt{constructor(e,t,i,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,os===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);os=o?parseInt(o[1]):0}if(du===null){const a=navigator.userAgent.match(/Safari\/(\d+)/i);du=a?parseInt(a[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&Jf(t)} > ${e&&Jf(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const i=e[0].pts,s=e.reduce((a,o)=>{let u=o.pts,h=u-a;return h<-4294967296&&(t=!0,u=Bt(u,i),h=u-a),h>0?a:u},i);return t&&this.debug("PTS rollover detected"),s}remux(e,t,i,s,a,o,u,h){let d,f,m,p,v,E,A=a,T=a;const I=e.pid>-1,R=t.pid>-1,_=t.samples.length,C=e.samples.length>0,b=u&&_>0||_>1;if((!I||C)&&(!R||b)||this.ISGenerated||u){if(this.ISGenerated){var O,B,U,M;const le=this.videoTrackConfig;(le&&(t.width!==le.width||t.height!==le.height||((O=t.pixelRatio)==null?void 0:O[0])!==((B=le.pixelRatio)==null?void 0:B[0])||((U=t.pixelRatio)==null?void 0:U[1])!==((M=le.pixelRatio)==null?void 0:M[1]))||!le&&b||this.nextAudioTs===null&&C)&&this.resetInitSegment()}this.ISGenerated||(m=this.generateIS(e,t,a,o));const z=this.isVideoContiguous;let te=-1,se;if(b&&(te=HE(t.samples),!z&&this.config.forceKeyFrameOnDiscontinuity))if(E=!0,te>0){this.warn(`Dropped ${te} out of ${_} video samples due to a missing keyframe`);const le=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(te),t.dropped+=te,T+=(t.samples[0].pts-le)/t.inputTimeScale,se=T}else te===-1&&(this.warn(`No keyframe found out of ${_} video samples`),E=!1);if(this.ISGenerated){if(C&&b){const le=this.getVideoStartPts(t.samples),J=(Bt(e.samples[0].pts,le)-le)/t.inputTimeScale;A+=Math.max(0,J),T+=Math.max(0,-J)}if(C){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),m=this.generateIS(e,t,a,o)),f=this.remuxAudio(e,A,this.isAudioContiguous,o,R||b||h===fe.AUDIO?T:void 0),b){const le=f?f.endPTS-f.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),m=this.generateIS(e,t,a,o)),d=this.remuxVideo(t,T,z,le)}}else b&&(d=this.remuxVideo(t,T,z,0));d&&(d.firstKeyFrame=te,d.independent=te!==-1,d.firstKeyFramePTS=se)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(v=wm(i,a,this._initPTS,this._initDTS)),s.samples.length&&(p=Cm(s,a,this._initPTS))),{audio:f,video:d,initSegment:m,independent:E,text:p,id3:v}}computeInitPts(e,t,i,s){const a=Math.round(i*t);let o=Bt(e,a);if(o<a+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(a-o)/t} ${s}`);o<a+t;)o+=8589934592;return o-a}generateIS(e,t,i,s){const a=e.samples,o=t.samples,u=this.typeSupported,h={},d=this._initPTS;let f=!d||s,m="audio/mp4",p,v,E,A=-1;if(f&&(p=v=1/0),e.config&&a.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(m="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}h.audio={id:"audio",container:m,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):$.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(A=e.id,E=e.inputTimeScale,!d||E!==d.timescale?p=v=this.computeInitPts(a[0].pts,E,i,"audio"):f=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:$.initSegment([t]),metadata:{width:t.width,height:t.height}},f)if(A=t.id,E=t.inputTimeScale,!d||E!==d.timescale){const T=this.getVideoStartPts(o),I=Bt(o[0].dts,T),R=this.computeInitPts(I,E,i,"video"),_=this.computeInitPts(T,E,i,"video");v=Math.min(v,R),p=Math.min(p,_)}else f=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(h).length)return this.ISGenerated=!0,f?(d&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${i} ${p/E} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${p/E} (${p}/${E}) trackId: ${A}`),this._initPTS={baseTime:p,timescale:E,trackId:A},this._initDTS={baseTime:v,timescale:E,trackId:A}):p=E=void 0,{tracks:h,initPTS:p,timescale:E,trackId:A}}remuxVideo(e,t,i,s){const a=e.inputTimeScale,o=e.samples,u=[],h=o.length,d=this._initPTS,f=d.baseTime*a/d.timescale;let m=this.nextVideoTs,p=8,v=this.videoSampleDuration,E,A,T=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY,R=!1;if(!i||m===null){const k=f+t*a,F=o[0].pts-Bt(o[0].dts,o[0].pts);os&&m!==null&&Math.abs(k-F-(m+f))<15e3?i=!0:m=k-F-f}const _=m+f;for(let k=0;k<h;k++){const F=o[k];F.pts=Bt(F.pts,_),F.dts=Bt(F.dts,_),F.dts<o[k>0?k-1:k].dts&&(R=!0)}R&&o.sort(function(k,F){const re=k.dts-F.dts,de=k.pts-F.pts;return re||de}),E=o[0].dts,A=o[o.length-1].dts;const C=A-E,b=C?Math.round(C/(h-1)):v||e.inputTimeScale/30;if(i){const k=E-_,F=k>b,re=k<-1;if((F||re)&&(F?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ir(k,!0)} ms (${k}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ir(-k,!0)} ms (${k}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!re||_>=o[0].pts||os)){E=_;const de=o[0].pts-k;if(F)o[0].dts=E,o[0].pts=de;else{let ue=!0;for(let he=0;he<o.length&&!(o[he].dts>de&&ue);he++){const Ie=o[he].pts;if(o[he].dts-=k,o[he].pts-=k,he<o.length-1){const Se=o[he+1].pts,we=o[he].pts,je=Se<=we,Gt=Se<=Ie;ue=je==Gt}}}this.log(`Video: Initial PTS/DTS adjusted: ${ir(de,!0)}/${ir(E,!0)}, delta: ${ir(k,!0)} ms`)}}E=Math.max(0,E);let K=0,O=0,B=E;for(let k=0;k<h;k++){const F=o[k],re=F.units,de=re.length;let ue=0;for(let he=0;he<de;he++)ue+=re[he].data.length;O+=ue,K+=de,F.length=ue,F.dts<B?(F.dts=B,B+=b/4|0||1):B=F.dts,T=Math.min(F.pts,T),I=Math.max(F.pts,I)}A=o[h-1].dts;const U=O+4*K+8;let M;try{M=new Uint8Array(U)}catch(k){this.observer.emit(S.ERROR,S.ERROR,{type:ye.MUX_ERROR,details:G.REMUX_ALLOC_ERROR,fatal:!1,error:k,bytes:U,reason:`fail allocating video mdat ${U}`});return}const z=new DataView(M.buffer);z.setUint32(0,U),M.set($.types.mdat,4);let te=!1,se=Number.POSITIVE_INFINITY,le=Number.POSITIVE_INFINITY,ae=Number.NEGATIVE_INFINITY,J=Number.NEGATIVE_INFINITY;for(let k=0;k<h;k++){const F=o[k],re=F.units;let de=0;for(let Ie=0,Se=re.length;Ie<Se;Ie++){const we=re[Ie],je=we.data,Gt=we.data.byteLength;z.setUint32(p,Gt),p+=4,M.set(je,p),p+=Gt,de+=4+Gt}let ue;if(k<h-1)v=o[k+1].dts-F.dts,ue=o[k+1].pts-F.pts;else{const Ie=this.config,Se=k>0?F.dts-o[k-1].dts:b;if(ue=k>0?F.pts-o[k-1].pts:b,Ie.stretchShortVideoTrack&&this.nextAudioTs!==null){const we=Math.floor(Ie.maxBufferHole*a),je=(s?T+s*a:this.nextAudioTs+f)-F.pts;je>we?(v=je-Se,v<0?v=Se:te=!0,this.log(`It is approximately ${je/90} ms to the next segment; using duration ${v/90} ms for the last video frame.`)):v=Se}else v=Se}const he=Math.round(F.pts-F.dts);se=Math.min(se,v),ae=Math.max(ae,v),le=Math.min(le,ue),J=Math.max(J,ue),u.push(eg(F.key,v,de,he))}if(u.length){if(os){if(os<70){const k=u[0].flags;k.dependsOn=2,k.isNonSync=0}}else if(du&&J-le<ae-se&&b/ae<.025&&u[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let k=E;for(let F=0,re=u.length;F<re;F++){const de=k+u[F].duration,ue=k+u[F].cts;if(F<re-1){const he=de+u[F+1].cts;u[F].duration=he-ue}else u[F].duration=F?u[F-1].duration:b;u[F].cts=0,k=de}}}v=te||!v?b:v;const ne=A+v;this.nextVideoTs=m=ne-f,this.videoSampleDuration=v,this.isVideoContiguous=!0;const q={data1:$.moof(e.sequenceNumber++,E,Me(e,{samples:u})),data2:M,startPTS:(T-f)/a,endPTS:(I+v-f)/a,startDTS:(E-f)/a,endDTS:m/a,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,q}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return KE;case"ac3":return VE;default:return jE}}remuxAudio(e,t,i,s,a){const o=e.inputTimeScale,u=e.samplerate?e.samplerate:o,h=o/u,d=this.getSamplesPerFrame(e),f=d*h,m=this._initPTS,p=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,v=[],E=a!==void 0;let A=e.samples,T=p?0:8,I=this.nextAudioTs||-1;const R=m.baseTime*o/m.timescale,_=R+t*o;if(this.isAudioContiguous=i=i||A.length&&I>0&&(s&&Math.abs(_-(I+R))<9e3||Math.abs(Bt(A[0].pts,_)-(I+R))<20*f),A.forEach(function(J){J.pts=Bt(J.pts,_)}),!i||I<0){const J=A.length;if(A=A.filter(ne=>ne.pts>=0),J!==A.length&&this.warn(`Removed ${A.length-J} of ${J} samples (initPTS ${R} / ${o})`),!A.length)return;a===0?I=0:s&&!E?I=Math.max(0,_-R):I=A[0].pts-R}if(e.segmentCodec==="aac"){const J=this.config.maxAudioFramesDrift;for(let ne=0,H=I+R;ne<A.length;ne++){const Q=A[ne],q=Q.pts,k=q-H,F=Math.abs(1e3*k/o);if(k<=-J*f&&E)ne===0&&(this.warn(`Audio frame @ ${(q/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*k/o)} ms.`),this.nextAudioTs=I=q-R,H=q);else if(k>=J*f&&F<GE&&E){let re=Math.round(k/f);for(H=q-re*f;H<0&&re&&f;)re--,H+=f;ne===0&&(this.nextAudioTs=I=H-R),this.warn(`Injecting ${re} audio frames @ ${((H-R)/o).toFixed(3)}s due to ${Math.round(1e3*k/o)} ms gap.`);for(let de=0;de<re;de++){let ue=BE.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ue||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ue=Q.unit.subarray()),A.splice(ne,0,{unit:ue,pts:H}),H+=f,ne++}}Q.pts=H,H+=f}}let C=null,b=null,K,O=0,B=A.length;for(;B--;)O+=A[B].unit.byteLength;for(let J=0,ne=A.length;J<ne;J++){const H=A[J],Q=H.unit;let q=H.pts;if(b!==null){const F=v[J-1];F.duration=Math.round((q-b)/h)}else if(i&&e.segmentCodec==="aac"&&(q=I+R),C=q,O>0){O+=T;try{K=new Uint8Array(O)}catch(F){this.observer.emit(S.ERROR,S.ERROR,{type:ye.MUX_ERROR,details:G.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:O,reason:`fail allocating audio mdat ${O}`});return}p||(new DataView(K.buffer).setUint32(0,O),K.set($.types.mdat,4))}else return;K.set(Q,T);const k=Q.byteLength;T+=k,v.push(eg(!0,d,k,0)),b=q}const U=v.length;if(!U)return;const M=v[v.length-1];I=b-R,this.nextAudioTs=I+h*M.duration;const z=p?new Uint8Array(0):$.moof(e.sequenceNumber++,C/h,Me({},e,{samples:v}));e.samples=[];const te=(C-R)/o,se=this.nextAudioTs/o,ae={data1:z,data2:K,startPTS:te,endPTS:se,startDTS:te,endDTS:se,type:"audio",hasAudio:!0,hasVideo:!1,nb:U};return this.isAudioContiguous=!0,ae}}function Bt(l,e){let t;if(e===null)return l;for(e<l?t=-8589934592:t=8589934592;Math.abs(l-e)>4294967296;)l+=t;return l}function HE(l){for(let e=0;e<l.length;e++)if(l[e].key)return e;return-1}function wm(l,e,t,i){const s=l.samples.length;if(!s)return;const a=l.inputTimeScale;for(let u=0;u<s;u++){const h=l.samples[u];h.pts=Bt(h.pts-t.baseTime*a/t.timescale,e*a)/a,h.dts=Bt(h.dts-i.baseTime*a/i.timescale,e*a)/a}const o=l.samples;return l.samples=[],{samples:o}}function Cm(l,e,t){const i=l.samples.length;if(!i)return;const s=l.inputTimeScale;for(let o=0;o<i;o++){const u=l.samples[o];u.pts=Bt(u.pts-t.baseTime*s/t.timescale,e*s)/s}l.samples.sort((o,u)=>o.pts-u.pts);const a=l.samples;return l.samples=[],{samples:a}}class WE extends qt{constructor(e,t,i,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,i,s){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:i,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:a,video:o}=this.initData=Mg(e);if(t)Py(e,t);else{const h=a||o;h!=null&&h.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${h.codec}")!`)}a&&(i=tg(a,Fe.AUDIO,this)),o&&(s=tg(o,Fe.VIDEO,this));const u={};a&&o?u.audiovideo={container:"video/mp4",codec:i+","+s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:a?u.audio={container:"audio/mp4",codec:i,encrypted:a.encrypted,initSegment:e,id:"audio"}:o?u.video={container:"video/mp4",codec:s,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=u}remux(e,t,i,s,a,o){var u,h;let{initPTS:d,lastEndTime:f}=this;const m={audio:void 0,video:void 0,text:s,id3:i,initSegment:void 0};oe(f)||(f=this.lastEndTime=a||0);const p=t.samples;if(!p.length)return m;const v={initPTS:void 0,timescale:void 0,trackId:void 0};let E=this.initData;if((u=E)!=null&&u.length||(this.generateInitSegment(p),E=this.initData),!((h=E)!=null&&h.length))return this.warn("Failed to generate initSegment."),m;this.emitInitSegment&&(v.tracks=this.initTracks,this.emitInitSegment=!1);const A=Ny(p,E,this),T=E.audio?A[E.audio.id]:null,I=E.video?A[E.video.id]:null,R=wa(I,1/0),_=wa(T,1/0),C=wa(I,0,!0),b=wa(T,0,!0);let K=a,O=0;const B=T&&(!I||!d&&_<R||d&&d.trackId===E.audio.id),U=B?T:I;if(U){const H=U.timescale,Q=U.start-a*H,q=B?E.audio.id:E.video.id;K=U.start/H,O=B?b-_:C-R,(o||!d)&&(zE(d,K,a,O)||H!==d.timescale)&&(d&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${a} ${Q/H} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${a} offset: ${K-a} (${Q}/${H}) trackId: ${q}`),d=null,v.initPTS=Q,v.timescale=H,v.trackId=q)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${a}`);d?(v.initPTS=d.baseTime,v.timescale=d.timescale,v.trackId=d.trackId):((!v.timescale||v.trackId===void 0||v.initPTS===void 0)&&(this.warn("Could not set initPTS"),v.initPTS=K,v.timescale=1,v.trackId=-1),this.initPTS=d={baseTime:v.initPTS,timescale:v.timescale,trackId:v.trackId});const M=K-d.baseTime/d.timescale,z=M+O;O>0?this.lastEndTime=z:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const te=!!E.audio,se=!!E.video;let le="";te&&(le+="audio"),se&&(le+="video");const ae=(E.audio?E.audio.encrypted:!1)||(E.video?E.video.encrypted:!1),J={data1:p,startPTS:M,startDTS:M,endPTS:z,endDTS:z,type:le,hasAudio:te,hasVideo:se,nb:1,dropped:0,encrypted:ae};m.audio=te&&!se?J:void 0,m.video=se?J:void 0;const ne=I==null?void 0:I.sampleCount;if(ne){const H=I.keyFrameIndex,Q=H!==-1;J.nb=ne,J.dropped=H===0||this.isVideoContiguous?0:Q?H:ne,J.independent=Q,J.firstKeyFrame=H,Q&&I.keyFrameStart&&(J.firstKeyFramePTS=(I.keyFrameStart-d.baseTime)/d.timescale),this.isVideoContiguous||(m.independent=Q),this.isVideoContiguous||(this.isVideoContiguous=Q),J.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${H}/${ne} dropped: ${J.dropped} start: ${J.firstKeyFramePTS||"NA"}`)}return m.initSegment=v,m.id3=wm(i,a,d,d),s.samples.length&&(m.text=Cm(s,a,d)),m}}function wa(l,e,t=!1){return(l==null?void 0:l.start)!==void 0?(l.start+(t?l.duration:0))/l.timescale:e}function zE(l,e,t,i){if(l===null)return!0;const s=Math.max(i,1),a=e-l.baseTime/l.timescale;return Math.abs(a-t)>s}function tg(l,e,t){const i=l.codec;return i&&i.length>4?i:e===Fe.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?za(i,!1):(t.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(t.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}let Pi;try{Pi=self.performance.now.bind(self.performance)}catch{Pi=Date.now}const ja=[{demux:bE,remux:WE},{demux:an,remux:Ga},{demux:kE,remux:Ga},{demux:CE,remux:Ga}];ja.splice(2,0,{demux:wE,remux:Ga});class ig{constructor(e,t,i,s,a,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=a,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,s){const a=i.transmuxing;a.executeStart=Pi();let o=new Uint8Array(e);const{currentTransmuxState:u,transmuxConfig:h}=this;s&&(this.currentTransmuxState=s);const{contiguous:d,discontinuity:f,trackSwitch:m,accurateTimeOffset:p,timeOffset:v,initSegmentChange:E}=s||u,{audioCodec:A,videoCodec:T,defaultInitPts:I,duration:R,initSegmentData:_}=h,C=YE(o,t);if(C&&ds(C.method)){const B=this.getDecrypter(),U=Ju(C.method);if(B.isSync()){let M=B.softwareDecrypt(o,C.key.buffer,C.iv.buffer,U);if(i.part>-1){const te=B.flush();M=te&&te.buffer}if(!M)return a.executeEnd=Pi(),hu(i);o=new Uint8Array(M)}else return this.asyncResult=!0,this.decryptionPromise=B.webCryptoDecrypt(o,C.key.buffer,C.iv.buffer,U).then(M=>{const z=this.push(M,null,i);return this.decryptionPromise=null,z}),this.decryptionPromise}const b=this.needsProbing(f,m);if(b){const B=this.configureTransmuxer(o);if(B)return this.logger.warn(`[transmuxer] ${B.message}`),this.observer.emit(S.ERROR,S.ERROR,{type:ye.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,fatal:!1,error:B,reason:B.message}),a.executeEnd=Pi(),hu(i)}(f||m||E||b)&&this.resetInitSegment(_,A,T,R,t),(f||E||b)&&this.resetInitialTimestamp(I),d||this.resetContiguity();const K=this.transmux(o,C,v,p,i);this.asyncResult=hr(K);const O=this.currentTransmuxState;return O.contiguous=!0,O.discontinuity=!1,O.trackSwitch=!1,a.executeEnd=Pi(),K}flush(e){const t=e.transmuxing;t.executeStart=Pi();const{decrypter:i,currentTransmuxState:s,decryptionPromise:a}=this;if(a)return this.asyncResult=!0,a.then(()=>this.flush(e));const o=[],{timeOffset:u}=s;if(i){const m=i.flush();m&&o.push(this.push(m.buffer,null,e))}const{demuxer:h,remuxer:d}=this;if(!h||!d){t.executeEnd=Pi();const m=[hu(e)];return this.asyncResult?Promise.resolve(m):m}const f=h.flush(u);return hr(f)?(this.asyncResult=!0,f.then(m=>(this.flushRemux(o,m,e),o))):(this.flushRemux(o,f,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,i){const{audioTrack:s,videoTrack:a,id3Track:o,textTrack:u}=t,{accurateTimeOffset:h,timeOffset:d}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===fe.MAIN?"level":"track"} ${i.level}`);const f=this.remuxer.remux(s,a,o,u,d,h,!0,this.id);e.push({remuxResult:f,chunkMeta:i}),i.transmuxing.executeEnd=Pi()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,s,a){const{demuxer:o,remuxer:u}=this;!o||!u||(o.resetInitSegment(e,t,i,s),u.resetInitSegment(e,t,i,a))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,s,a){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,i,s,a):o=this.transmuxUnencrypted(e,i,s,a),o}transmuxUnencrypted(e,t,i,s){const{audioTrack:a,videoTrack:o,id3Track:u,textTrack:h}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(a,o,u,h,t,i,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,i,s,a){return this.demuxer.demuxSampleAes(e,t,i).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,i,s,!1,this.id),chunkMeta:a}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:s}=this;let a;for(let m=0,p=ja.length;m<p;m++){var o;if((o=ja[m].demux)!=null&&o.probe(e,this.logger)){a=ja[m];break}}if(!a)return new Error("Failed to find demuxer by probing fragment data");const u=this.demuxer,h=this.remuxer,d=a.remux,f=a.demux;(!h||!(h instanceof d))&&(this.remuxer=new d(i,t,s,this.logger)),(!u||!(u instanceof f))&&(this.demuxer=new f(i,t,s,this.logger),this.probe=f.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Xu(this.config)),e}}function YE(l,e){let t=null;return l.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const hu=l=>({remuxResult:{},chunkMeta:l});function hr(l){return"then"in l&&l.then instanceof Function}class qE{constructor(e,t,i,s,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=s,this.defaultInitPts=a||null}}class QE{constructor(e,t,i,s,a,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=s,this.timeOffset=a,this.initSegmentChange=o}}let ng=0;class Dm{constructor(e,t,i,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=ng++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=h=>{const d=h.data,f=this.hls;if(!(!f||!(d!=null&&d.event)||d.instanceNo!==this.instanceNo))switch(d.event){case"init":{var m;const p=(m=this.workerContext)==null?void 0:m.objectURL;p&&self.URL.revokeObjectURL(p);break}case"transmuxComplete":{this.handleTransmuxComplete(d.data);break}case"flush":{this.onFlush(d.data);break}case"workerLog":{f.logger[d.data.logType]&&f.logger[d.data.logType](d.data.message);break}default:{d.data=d.data||{},d.data.frag=this.frag,d.data.part=this.part,d.data.id=this.id,f.trigger(d.event,d.data);break}}},this.onWorkerError=h=>{if(!this.hls)return;const d=new Error(`${h.message}  (${h.filename}:${h.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:G.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})};const a=e.config;this.hls=e,this.id=t,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=i,this.onFlush=s;const o=(h,d)=>{d=d||{},d.frag=this.frag||void 0,h===S.ERROR&&(d=d,d.parent=this.id,d.part=this.part,this.error=d.error),this.hls.trigger(h,d)};this.observer=new ic,this.observer.on(S.FRAG_DECRYPTED,o),this.observer.on(S.ERROR,o);const u=vf(a.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const h=this.hls.logger;if(a.workerPath||eE()){try{a.workerPath?(h.log(`loading Web Worker ${a.workerPath} for "${t}"`),this.workerContext=iE(a.workerPath)):(h.log(`injecting Web Worker for "${t}"`),this.workerContext=tE());const{worker:f}=this.workerContext;f.addEventListener("message",this.onWorkerMessage),f.addEventListener("error",this.onWorkerError),f.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:Be(a)})}catch(f){h.warn(`Error setting up "${t}" Web Worker, fallback to inline`,f),this.terminateWorker(),this.error=null,this.transmuxer=new ig(this.observer,u,a,"",t,e.logger)}return}}this.transmuxer=new ig(this.observer,u,a,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=ng++;const t=this.hls.config,i=vf(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:Be(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),nE(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,s,a,o,u,h,d,f){var m,p;d.transmuxing.start=self.performance.now();const{instanceNo:v,transmuxer:E}=this,A=o?o.start:a.start,T=a.decryptdata,I=this.frag,R=!(I&&a.cc===I.cc),_=!(I&&d.level===I.level),C=I?d.sn-I.sn:-1,b=this.part?d.part-this.part.index:-1,K=C===0&&d.id>1&&d.id===(I==null?void 0:I.stats.chunkCount),O=!_&&(C===1||C===0&&(b===1||K&&b<=0)),B=self.performance.now();(_||C||a.stats.parsing.start===0)&&(a.stats.parsing.start=B),o&&(b||!O)&&(o.stats.parsing.start=B);const U=!(I&&((m=a.initSegment)==null?void 0:m.url)===((p=I.initSegment)==null?void 0:p.url)),M=new QE(R,O,h,_,A,U);if(!O||R||U){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${a.type} sn: ${d.sn}${d.part>-1?" part: "+d.part:""} ${this.id===fe.MAIN?"level":"track"}: ${d.level} id: ${d.id}
        discontinuity: ${R}
        trackSwitch: ${_}
        contiguous: ${O}
        accurateTimeOffset: ${h}
        timeOffset: ${A}
        initSegmentChange: ${U}`);const z=new qE(i,s,t,u,f);this.configureTransmuxer(z)}if(this.frag=a,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:v,cmd:"demux",data:e,decryptdata:T,chunkMeta:d,state:M},e instanceof ArrayBuffer?[e]:[]);else if(E){const z=E.push(e,T,d,M);hr(z)?z.then(te=>{this.handleTransmuxComplete(te)}).catch(te=>{this.transmuxerError(te,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(z)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){const s=i.flush(e);hr(s)?s.then(a=>{this.handleFlushResult(a,e)}).catch(a=>{this.transmuxerError(a,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const sg=100;class XE extends tc{constructor(e,t,i){super(e,t,i,"audio-stream-controller",fe.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:s,timescale:a,trackId:o}){if(i===fe.MAIN){const u=t.cc,h=this.fragCurrent;if(this.initPTS[u]={baseTime:s,timescale:a,trackId:o},this.log(`InitPTS for cc: ${u} found from main: ${s/a} (${s}/${a}) trackId: ${o}`),this.mainAnchor=t,this.state===Y.WAITING_INIT_PTS){const d=this.waitingData;(!d&&!this.loadingParts||d&&d.frag.cc!==u)&&this.syncWithAnchor(t,d==null?void 0:d.frag)}else!this.hls.hasEnoughToStart&&h&&h.cc!==u?(h.abortRequests(),this.syncWithAnchor(t,h)):this.state===Y.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var i;const s=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(t&&(s==null?void 0:s.cc)===t.cc)return;const a=(s||e).cc,o=this.getLevelDetails(),u=this.getLoadPosition(),h=zg(o,a,u);h&&(this.log(`Syncing with main frag at ${h.start} cc ${h.cc}`),this.startFragRequested=!1,this.nextLoadPosition=h.start,this.resetLoadingState(),this.state===Y.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=Y.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(sg),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=Y.IDLE):this.state=Y.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case Y.IDLE:this.doTickIdle();break;case Y.WAITING_TRACK:{const{levels:e,trackId:t}=this,i=e==null?void 0:e[t],s=i==null?void 0:i.details;if(s&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(s))break;this.state=Y.WAITING_INIT_PTS}break}case Y.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case Y.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:i,cache:s,complete:a}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=Y.FRAG_LOADING;const u=s.flush().buffer,h={frag:t,part:i,payload:u,networkDetails:null};this._handleFragmentLoadProgress(h),a&&super._handleFragmentLoadComplete(h)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=Y.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:i,media:s,trackId:a}=this,o=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(i!=null&&i[a]))return;const u=i[a],h=u.details;if(!h||this.waitForLive(u)||this.waitForCdnTuneIn(h)){this.state=Y.WAITING_TRACK,this.startFragRequested=!1;return}const d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,Fe.AUDIO,fe.AUDIO));const f=this.getFwdBufferInfo(d,fe.AUDIO);if(f===null)return;if(!this.switchingTrack&&this._streamEnded(f,h)){t.trigger(S.BUFFER_EOS,{type:"audio"}),this.state=Y.ENDED;return}const m=f.len,p=t.maxBufferLength,v=h.fragments,E=v[0].start,A=this.getLoadPosition(),T=this.flushing?A:f.end;if(this.switchingTrack&&s){const _=A;h.PTSKnown&&_<E&&(f.end>E||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=E+.05)}if(m>=p&&!this.switchingTrack&&T<v[v.length-1].start)return;let I=this.getNextFragment(T,h);if(I&&this.isLoopLoading(I,T)&&(I=this.getNextFragmentLoopLoading(I,h,f,fe.MAIN,p)),!I){this.bufferFlushed=!0;return}let R=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&R&&Ze(I)&&!I.endList&&(!h.live||!this.loadingParts&&T<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(R)===st.OK&&(this.mainFragLoading=R=null),R&&Ze(R))){if(I.start>R.end){const C=this.fragmentTracker.getFragAtPos(T,fe.MAIN);C&&C.end>R.end&&(R=C,this.mainFragLoading={frag:C,targetBufferTime:null})}if(I.start>R.end)return}this.loadFragment(I,u,T)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new ur(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==Y.STOPPED&&(this.setInterval(sg),this.state=Y.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(S.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;const{levels:s}=this,{details:a,id:o,groupId:u,track:h}=t;if(!s){this.warn(`Audio tracks reset while loading track ${o} "${h.name}" of "${u}"`);return}const d=this.mainDetails;if(!d||a.endCC>d.endCC||d.expired){this.cachedTrackLoadedData=t,this.state!==Y.STOPPED&&(this.state=Y.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${h.name}" of "${u}" loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`);const f=s[o];let m=0;if(a.live||(i=f.details)!=null&&i.live){if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;if(f.details){var p;m=this.alignPlaylists(a,f.details,(p=this.levelLastLoaded)==null?void 0:p.details)}a.alignedSliding||(dm(a,d),a.alignedSliding||eo(a,d),m=a.fragmentStart)}f.details=a,this.levelLastLoaded=f,this.startFragRequested||this.setStartPosition(d,m),this.hls.trigger(S.AUDIO_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.state===Y.WAITING_TRACK&&!this.waitForCdnTuneIn(a)&&(this.state=Y.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:s,payload:a}=e,{config:o,trackId:u,levels:h}=this;if(!h){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const d=h[u];if(!d){this.warn("Audio track is undefined on fragment load progress");return}const f=d.details;if(!f){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const m=o.defaultAudioCodec||d.audioCodec||"mp4a.40.2";let p=this.transmuxer;p||(p=this.transmuxer=new Dm(this.hls,fe.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const v=this.initPTS[i.cc],E=(t=i.initSegment)==null?void 0:t.data;if(v!==void 0){const T=s?s.index:-1,I=T!==-1,R=new Zu(i.level,i.sn,i.stats.chunkCount,a.byteLength,T,I);p.push(a,E,m,"",i,s,f.totalduration,!1,R,v)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${f.startSN} ,${f.endSN}],track ${u}`);const{cache:A}=this.waitingData=this.waitingData||{frag:i,part:s,cache:new hm,complete:!1};A.push(new Uint8Array(a)),this.state!==Y.STOPPED&&(this.state=Y.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===fe.MAIN&&Ze(t.frag)&&(this.mainFragLoading=t,this.state===Y.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:i,part:s}=t;if(i.type!==fe.AUDIO){!this.audioOnly&&i.type===fe.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Ze(i)){this.fragPrevious=i;const a=this.switchingTrack;a&&(this.bufferedTrack=a,this.switchingTrack=null,this.hls.trigger(S.AUDIO_TRACK_SWITCHED,Oe({},a)))}this.fragBufferedComplete(i,s),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=Y.ERROR;return}switch(t.details){case G.FRAG_GAP:case G.FRAG_PARSING_ERROR:case G.FRAG_DECRYPT_ERROR:case G.FRAG_LOAD_ERROR:case G.FRAG_LOAD_TIMEOUT:case G.KEY_LOAD_ERROR:case G.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(fe.AUDIO,t);break;case G.AUDIO_TRACK_LOAD_ERROR:case G.AUDIO_TRACK_LOAD_TIMEOUT:case G.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Y.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===ke.AUDIO_TRACK&&(this.state=Y.IDLE);break;case G.BUFFER_ADD_CODEC_ERROR:case G.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case G.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case G.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Fe.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Fe.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===Y.ENDED&&(this.state=Y.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,fe.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const i="audio",{hls:s}=this,{remuxResult:a,chunkMeta:o}=e,u=this.getCurrentContext(o);if(!u){this.resetWhenMissingContext(o);return}const{frag:h,part:d,level:f}=u,{details:m}=f,{audio:p,text:v,id3:E,initSegment:A}=a;if(this.fragContextChanged(h)||!m){this.fragmentTracker.removeFragment(h);return}if(this.state=Y.PARSING,this.switchingTrack&&p&&this.completeAudioSwitch(this.switchingTrack),A!=null&&A.tracks){const T=h.initSegment||h;if(this.unhandledEncryptionError(A,h))return;this._bufferInitSegment(f,A.tracks,T,o),s.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:i,tracks:A.tracks})}if(p){const{startPTS:T,endPTS:I,startDTS:R,endDTS:_}=p;d&&(d.elementaryStreams[Fe.AUDIO]={startPTS:T,endPTS:I,startDTS:R,endDTS:_}),h.setElementaryStreamInfo(Fe.AUDIO,T,I,R,_),this.bufferFragmentData(p,h,d,o)}if(E!=null&&(t=E.samples)!=null&&t.length){const T=Me({id:i,frag:h,details:m},E);s.trigger(S.FRAG_PARSING_METADATA,T)}if(v){const T=Me({id:i,frag:h,details:m},v);s.trigger(S.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(e,t,i,s){if(this.state!==Y.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const a=t.audio;a.id=fe.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${a.container}, codecs[level/parsed]=[${o}/${a.codec}]`),o&&o.split(",").length===1&&(a.levelCodec=o),this.hls.trigger(S.BUFFER_CODECS,t);const u=a.initSegment;if(u!=null&&u.byteLength){const h={type:"audio",frag:i,part:null,chunkMeta:s,parent:i.type,data:u};this.hls.trigger(S.BUFFER_APPENDING,h)}this.tickImmediate()}loadFragment(e,t,i){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===st.NOT_LOADED||s===st.PARTIAL){var a;if(!Ze(e))this._loadInitSegment(e,t);else if((a=t.details)!=null&&a.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Y.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&eo(t.details,o)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:i,assocLang:s,characteristics:a,audioCodec:o,channels:u}=this.bufferedTrack;kn({name:t,lang:i,assocLang:s,characteristics:a,audioCodec:o,channels:u},e,_n)||(qa(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(S.AUDIO_TRACK_SWITCHED,Oe({},e))}}class uc extends qt{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){const s=t==null?void 0:t.renditionReports;if(s){let a=-1;for(let o=0;o<s.length;o++){const u=s[o];let h;try{h=new self.URL(u.URI,t.url).href}catch(d){this.warn(`Could not construct new URL for Rendition Report: ${d}`),h=u.URI||""}if(h===e){a=o;break}else h===e.substring(0,h.length)&&(a=o)}if(a!==-1){const o=s[a],u=parseInt(o["LAST-MSN"])||t.lastPartSn;let h=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const f=Math.min(t.age-t.partTarget,t.targetduration);h>=0&&f>t.partTarget&&(h+=1)}const d=i&&Ef(i);return new xf(u,h>=0?h:void 0,d)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){const{details:s,stats:a}=t,o=self.performance.now(),u=a.loading.first?Math.max(0,o-a.loading.first):0;s.advancedDateTime=Date.now()-u;const h=this.hls.config.timelineOffset;if(h!==s.appliedTimelineOffset){const f=Math.max(h||0,0);s.appliedTimelineOffset=f,s.fragments.forEach(m=>{m.setStart(m.playlistOffset+f)})}if(s.live||i!=null&&i.live){const f="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(i),i&&s.fragments.length>0){Kv(i,s,this);const R=s.playlistParsingError;if(R){this.warn(R);const _=this.hls;if(!_.config.ignorePlaylistParsingErrors){var d;const{networkDetails:C}=t;_.trigger(S.ERROR,{type:ye.NETWORK_ERROR,details:G.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:R,reason:R.message,level:t.level||void 0,parent:(d=s.fragments[0])==null?void 0:d.type,networkDetails:C,stats:a});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=a.loading.start);const m=this.hls.mainForwardBufferInfo,p=m?m.end-m.len:0,v=(s.edge-p)*1e3,E=am(s,v);if(s.requestScheduled+E<o?s.requestScheduled=o:s.requestScheduled+=E,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let A,T,I;if(s.canBlockReload&&s.endSN&&s.advanced){const R=this.hls.config.lowLatencyMode,_=s.lastPartSn,C=s.endSN,b=s.lastPartIndex,K=b!==-1,O=_===C;K?O?(T=C+1,I=R?0:b):(T=_,I=R?b+1:s.maxPartIndex):T=C+1;const B=s.age,U=B+s.ageHeader;let M=Math.min(U-s.partTarget,s.targetduration*1.5);if(M>0){if(U>s.targetduration*3)this.log(`Playlist last advanced ${B.toFixed(2)}s ago. Omitting segment and part directives.`),T=void 0,I=void 0;else if(i!=null&&i.tuneInGoal&&U-s.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${M} with playlist age: ${s.age}`),M=0;else{const z=Math.floor(M/s.targetduration);if(T+=z,I!==void 0){const te=Math.round(M%s.targetduration/s.partTarget);I+=te}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${B.toFixed(2)}s goal: ${M} skip sn ${z} to part ${I}`)}s.tuneInGoal=M}if(A=this.getDeliveryDirectives(s,t.deliveryDirectives,T,I),R||!O){s.requestScheduled=o,this.loadingPlaylist(f,A);return}}else(s.canBlockReload||s.canSkipUntil)&&(A=this.getDeliveryDirectives(s,t.deliveryDirectives,T,I));A&&T!==void 0&&s.canBlockReload&&(s.requestScheduled=a.loading.first+Math.max(E-u*2,E/2)),this.scheduleLoading(f,A,s)}else this.clearTimer()}scheduleLoading(e,t,i){const s=i||e.details;if(!s){this.loadingPlaylist(e,t);return}const a=self.performance.now(),o=s.requestScheduled;if(a>=o){this.loadingPlaylist(e,t);return}const u=o-a;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(u)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),u)}getDeliveryDirectives(e,t,i,s){let a=Ef(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,s=t.part,a=Ua.No),new xf(i,s,a)}checkRetry(e){const t=e.details,i=Qa(e),s=e.errorAction,{action:a,retryCount:o=0,retryConfig:u}=s||{},h=!!s&&!!u&&(a===ht.RetryRequest||!s.resolved&&a===ht.SendAlternateToPenaltyBox);if(h){var d;if(o>=u.maxNumRetry)return!1;if(i&&(d=e.context)!=null&&d.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${u.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const f=Qu(u,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),f),this.warn(`Retrying playlist loading ${o+1}/${u.maxNumRetry} after "${t}" in ${f}ms`)}e.levelRetry=!0,s.resolved=!0}return h}}function bm(l,e){if(l.length!==e.length)return!1;for(let t=0;t<l.length;t++)if(!fr(l[t].attrs,e[t].attrs))return!1;return!0}function fr(l,e,t){const i=l["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>l[s]!==e[s])}function Mu(l,e){return e.label.toLowerCase()===l.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(l.lang||"").toLowerCase())}class ZE extends uc{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:s,details:a}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==s){this.warn(`Audio track with id:${i} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const u=o.details;o.details=t.details,this.log(`Audio track ${i} "${o.name}" lang:${o.lang} group:${s} loaded [${a.startSN}-${a.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.audioGroups||null,s=this.groupIds;let a=this.currentTrack;if(!i||(s==null?void 0:s.length)!==(i==null?void 0:i.length)||i!=null&&i.some(u=>(s==null?void 0:s.indexOf(u))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const u=this.tracks.filter(p=>!i||i.indexOf(p.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(p=>p.default)&&(this.selectDefaultTrack=!1),u.forEach((p,v)=>{p.id=v});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=u;const h=this.hls.config.audioPreference;if(!a&&h){const p=vi(h,u,_n);if(p>-1)a=u[p];else{const v=vi(h,this.tracks);a=this.tracks[v]}}let d=this.findTrackId(a);d===-1&&a&&(d=this.findTrackId(null));const f={audioTracks:u};this.log(`Updating audio tracks, ${u.length} track(s) found in group(s): ${i==null?void 0:i.join(",")}`),this.hls.trigger(S.AUDIO_TRACKS_UPDATED,f);const m=this.trackId;if(d!==-1&&m===-1)this.setAudioTrack(d);else if(u.length&&m===-1){var o;const p=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${u.length}`);this.warn(p.message),this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:G.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:p})}}}onError(e,t){t.fatal||!t.context||t.context.type===ke.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const s=this.currentTrack;if(s&&kn(e,s,_n))return s;const a=vi(e,this.tracksInGroup,_n);if(a>-1){const o=this.tracksInGroup[a];return this.setAudioTrack(a),o}else if(s){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const u=cv(e,t.levels,i,o,_n);if(u===-1)return null;t.nextLoadLevel=u}if(e.channels||e.audioCodec){const o=vi(e,i);if(o>-1)return i[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,s=t[e],a=s.details&&!s.details.live;if(e===this.trackId&&s===i&&a||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(S.AUDIO_TRACK_SWITCHING,Oe({},s)),a))return;const o=this.switchParams(s.url,i==null?void 0:i.details,s.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const s=t[i];if(!(this.selectDefaultTrack&&!s.default)&&(!e||kn(e,s,_n)))return i}if(e){const{name:i,lang:s,assocLang:a,characteristics:o,audioCodec:u,channels:h}=e;for(let d=0;d<t.length;d++){const f=t[d];if(kn({name:i,lang:s,assocLang:a,characteristics:o,audioCodec:u,channels:h},f,_n))return d}for(let d=0;d<t.length;d++){const f=t[d];if(fr(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return d}for(let d=0;d<t.length;d++){const f=t[d];if(fr(e.attrs,f.attrs,["LANGUAGE"]))return d}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&qa(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,s=e.groupId,a=this.getUrlWithDirectives(e.url,t),o=e.details,u=o==null?void 0:o.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${a}`),this.hls.trigger(S.AUDIO_TRACK_LOADING,{url:a,id:i,groupId:s,deliveryDirectives:t||null,track:e})}}class JE{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(a){var i;if(s.onError(a),this.queues===null||this.tracks===null)return;const o=(i=this.tracks[e])==null?void 0:i.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const i=(t=this.tracks)==null?void 0:t[e],s=i==null?void 0:i.buffer;return s?`SourceBuffer${s.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}}const rg=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Pm="HlsJsTrackRemovedError";class ex extends Error{constructor(e){super(e),this.name=Pm}}class tx extends qt{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:s,mediaSource:a}=this;i&&this.log("Media source opened"),!(!s||!a)&&(a.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(S.MEDIA_ATTACHED,{media:s,mediaSource:a}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:s}=this;i!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=Ay(ln(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_APPENDING,this.onBufferAppending,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.BUFFER_EOS,this.onBufferEos,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.FRAG_PARSED,this.onFragParsed,this),e.on(S.FRAG_CHANGED,this.onFragChanged,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_APPENDING,this.onBufferAppending,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_EOS,this.onBufferEos,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.FRAG_PARSED,this.onFragParsed,this),e.off(S.FRAG_CHANGED,this.onFragChanged,this),e.off(S.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const i={};if(this.operationQueue){const a=this.isUpdating();a||this.operationQueue.removeBlockers();const o=this.isQueued();(a||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${a?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?Me(i,s.tracks):this.sourceBuffers.forEach(a=>{const[o]=a;o&&(i[o]=Me({},this.tracks[o]),this.removeBuffer(o)),a[0]=a[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const i=this.media=t.media;this.transferData=this.overrides=void 0;const s=ln(this.appendSource);if(s){const a=!!t.mediaSource;(a||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(o),a)this._objectUrl=i.src,this.attachTransferred();else{const u=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{i.removeAttribute("src");const h=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||h&&o instanceof h,ag(i),ix(i,u),i.load()}catch{i.src=u}else i.src=u}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const i=this.tracks,s=t.tracks,a=s?Object.keys(s):null,o=a?a.length:0,u=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&a&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Be(i,(h,d)=>h==="initSegment"?void 0:d)};
transfer tracks: ${Be(s,(h,d)=>h==="initSegment"?void 0:d)}}`),!wg(s,i)){t.mediaSource=null,t.tracks=void 0;const h=e.currentTime,d=this.details,f=Math.max(h,(d==null?void 0:d.fragments[0].start)||0);if(f-h>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${h} -> ${f}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(i)}") start time: ${f} currentTime: ${h}`),this.onMediaDetaching(S.MEDIA_DETACHING,{}),this.onMediaAttaching(S.MEDIA_ATTACHING,t),e.currentTime=f;return}this.transferData=void 0,a.forEach(h=>{const d=h,f=s[d];if(f){const m=f.buffer;if(m){const p=this.fragmentTracker,v=f.id;if(p.hasFragments(v)||p.hasParts(v)){const T=Le.getBuffered(m);p.detectEvictedFragments(d,T,v,null,!0)}const E=fu(d),A=[d,m];this.sourceBuffers[E]=A,m.updating&&this.operationQueue&&this.operationQueue.prependBlocker(d),this.trackSourceBuffer(d,f)}}}),u(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),u()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const i=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:a,_objectUrl:o}=this;if(a){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([u])=>{u&&this.removeBuffer(u)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const u=a.readyState==="open";try{const h=a.sourceBuffers;for(let d=h.length;d--;)u&&h[d].abort(),a.removeSourceBuffer(h[d]);u&&a.endOfStream()}catch(h){this.warn(`onMediaDetaching: ${h.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.removeEventListener("startstreaming",this._onStartStreaming),a.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),i||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(s.removeAttribute("src"),this.appendSource&&ag(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(S.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(a){this.warn(`onBufferReset ${e}`,a)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[fu(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new JE(this.tracks)}onBufferCodecs(e,t){var i;const s=this.tracks,a=Object.keys(t);this.log(`BUFFER_CODECS: "${a}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),u=!o&&this.sourceBufferCount&&this.media&&a.some(h=>!s[h]);if(o||u){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${a}" SourceBuffers`);return}a.forEach(h=>{var d,f;const m=t[h],{id:p,codec:v,levelCodec:E,container:A,metadata:T,supplemental:I}=m;let R=s[h];const _=(d=this.transferData)==null||(d=d.tracks)==null?void 0:d[h],C=_!=null&&_.buffer?_:R,b=(C==null?void 0:C.pendingCodec)||(C==null?void 0:C.codec),K=C==null?void 0:C.levelCodec;R||(R=s[h]={buffer:void 0,listeners:[],codec:v,supplemental:I,container:A,levelCodec:E,metadata:T,id:p});const O=Ba(b,K),B=O==null?void 0:O.replace(rg,"$1");let U=Ba(v,E);const M=(f=U)==null?void 0:f.replace(rg,"$1");U&&O&&B!==M&&(h.slice(0,5)==="audio"&&(U=za(U,this.appendSource)),this.log(`switching codec ${b} to ${U}`),U!==(R.pendingCodec||R.codec)&&(R.pendingCodec=U),R.container=A,this.appendChangeType(h,A,U))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((i=t.audio)==null?void 0:i.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){const s=`${t};codecs=${i}`,a={label:`change-type=${s}`,execute:()=>{const o=this.tracks[e];if(o){const u=o.buffer;u!=null&&u.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),u.changeType(s),o.codec=i,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(a,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const i=e.start,s=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,fe.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var u;const h=this.tracks.video;(this.lastVideoAppendEnd>s||h!=null&&h.buffer&&Le.isBuffered(h.buffer,s)||((u=this.fragmentTracker.getAppendedFrag(s,fe.MAIN))==null?void 0:u.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:u=>{this.warn("Error executing block-audio operation",u)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:i}=this,{data:s,type:a,parent:o,frag:u,part:h,chunkMeta:d,offset:f}=t,m=d.buffering[a],{sn:p,cc:v}=u,E=self.performance.now();m.start=E;const A=u.stats.buffering,T=h?h.stats.buffering:null;A.start===0&&(A.start=E),T&&T.start===0&&(T.start=E);const I=i.audio;let R=!1;a==="audio"&&(I==null?void 0:I.container)==="audio/mpeg"&&(R=!this.lastMpegAudioChunk||d.id===1||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const _=i.video,C=_==null?void 0:_.buffer;if(C&&p!=="initSegment"){const O=h||u,B=this.blockedAudioAppend;if(a==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(_.ending||_.ended)){const M=O.start+O.duration*.05,z=C.buffered,te=this.currentOp("video");!z.length&&!te?this.blockAudio(O):!te&&!Le.isBuffered(C,M)&&this.lastVideoAppendEnd<M&&this.blockAudio(O)}else if(a==="video"){const U=O.end;if(B){const M=B.frag.start;(U>M||U<this.lastVideoAppendEnd||Le.isBuffered(C,M))&&this.unblockAudio()}this.lastVideoAppendEnd=U}}const b=(h||u).start,K={label:`append-${a}`,execute:()=>{var O;m.executeStart=self.performance.now();const B=(O=this.tracks[a])==null?void 0:O.buffer;B&&(R?this.updateTimestampOffset(B,b,.1,a,p,v):f!==void 0&&oe(f)&&this.updateTimestampOffset(B,f,1e-6,a,p,v)),this.appendExecutor(s,a)},onStart:()=>{},onComplete:()=>{const O=self.performance.now();m.executeEnd=m.end=O,A.first===0&&(A.first=O),T&&T.first===0&&(T.first=O);const B={};this.sourceBuffers.forEach(([U,M])=>{U&&(B[U]=Le.getBuffered(M))}),this.appendErrors[a]=0,a==="audio"||a==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(S.BUFFER_APPENDED,{type:a,frag:u,part:h,chunkMeta:d,parent:u.type,timeRanges:B})},onError:O=>{var B;const U={type:ye.MEDIA_ERROR,parent:u.type,details:G.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:u,part:h,chunkMeta:d,error:O,err:O,fatal:!1},M=(B=this.media)==null?void 0:B.error;if(O.code===DOMException.QUOTA_EXCEEDED_ERR||O.name=="QuotaExceededError"||"quota"in O)U.details=G.BUFFER_FULL_ERROR;else if(O.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!M)U.errorAction=cs(!0);else if(O.name===Pm&&this.sourceBufferCount===0)U.errorAction=cs(!0);else{const z=++this.appendErrors[a];this.warn(`Failed ${z}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${a}" sourceBuffer (${M||"no media error"})`),(z>=this.hls.config.appendErrorMaxRetry||M)&&(U.fatal=!0)}this.hls.trigger(S.ERROR,U)}};this.log(`queuing "${a}" append sn: ${p}${h?" p: "+h.index:""} of ${u.type===fe.MAIN?"level":"track"} ${u.level} cc: ${v}`),this.append(K,a,this.isPending(this.tracks[a]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(S.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:i,startOffset:s,endOffset:a}=t;i?this.append(this.getFlushOp(i,s,a),i):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,s,a),o)})}onFragParsed(e,t){const{frag:i,part:s}=t,a=[],o=s?s.elementaryStreams:i.elementaryStreams;o[Fe.AUDIOVIDEO]?a.push("audiovideo"):(o[Fe.AUDIO]&&a.push("audio"),o[Fe.VIDEO]&&a.push("video"));const u=()=>{const h=self.performance.now();i.stats.buffering.end=h,s&&(s.stats.buffering.end=h);const d=s?s.stats:i.stats;this.hls.trigger(S.FRAG_BUFFERED,{frag:i,part:s,stats:d,id:i.type})};a.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(u,a).catch(h=>{this.warn(`Fragment buffered callback ${h}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([o])=>{if(o){const u=this.tracks[o];(!t.type||t.type===o)&&(u.ending=!0,u.ended||(u.ended=!0,this.log(`${o} buffer reached EOS`)))}});const s=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var u;return o&&!((u=this.tracks[o])!=null&&u.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(S.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(S.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===G.BUFFER_APPEND_ERROR&&t.frag){var i;const s=(i=t.errorAction)==null?void 0:i.nextAutoLevel;oe(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;const s=e.config,a=i.currentTime,o=t.levelTargetDuration,u=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(oe(u)&&u>=0){const d=Math.max(u,o),f=Math.floor(a/o)*o-d;this.flushBackBuffer(a,o,f)}const h=s.frontBufferFlushThreshold;if(oe(h)&&h>0){const d=Math.max(s.maxBufferLength,h),f=Math.max(d,o),m=Math.floor(a/o)*o+f;this.flushFrontBuffer(a,o,m)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([s,a])=>{if(a){const u=Le.getBuffered(a);if(u.length>0&&i>u.start(0)){var o;this.hls.trigger(S.BACK_BUFFER_REACHED,{bufferEnd:i});const h=this.tracks[s];if((o=this.details)!=null&&o.live)this.hls.trigger(S.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(h!=null&&h.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:s})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([s,a])=>{if(a){const o=Le.getBuffered(a),u=o.length;if(u<2)return;const h=o.start(u-1),d=o.end(u-1);if(i>h||e>=h&&e<=d)return;this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:h,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:i}=this;if(!t||!this.media||(i==null?void 0:i.readyState)!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&i.setLiveSeekableRange){const d=Math.max(0,t.fragmentStart),f=Math.max(d,s);return{duration:1/0,start:d,end:f}}return{duration:1/0}}const a=(e=this.overrides)==null?void 0:e.duration;if(a)return oe(a)?{duration:a}:null;const o=this.media.duration,u=oe(i.duration)?i.duration:0;return s>u&&s>o||!oe(o)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:i}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(oe(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${i}.`),s.setLiveSeekableRange(t,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Be(i)}`),this.tracksReady){var s;const a=(s=this.transferData)==null?void 0:s.tracks;a&&Object.keys(a).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,i])=>{if(t){const s=this.tracks[t];e[t]={buffer:i,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(S.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:G.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const a in e){const o=a,u=e[o];if(this.isPending(u)){const h=this.getTrackCodec(u,o),d=`${u.container};codecs=${h}`;u.codec=h,this.log(`creating sourceBuffer(${d})${this.currentOp(o)?" Queued":""} ${Be(u)}`);try{const f=i.addSourceBuffer(d),m=fu(o),p=[o,f];t[m]=p,u.buffer=f}catch(f){var s;this.error(`error while trying to add sourceBuffer: ${f.message}`),this.shiftAndExecuteNext(o),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[o],this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:G.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,sourceBufferName:o,mimeType:d,parent:u.id});return}this.trackSourceBuffer(o,u)}}this.bufferCreated()}getTrackCodec(e,t){const i=e.supplemental;let s=e.codec;i&&(t==="video"||t==="audiovideo")&&or(i,"video")&&(s=Hy(s,i));const a=Ba(s,e.levelCodec);return a?t.slice(0,5)==="audio"?za(a,this.appendSource):a:""}trackSourceBuffer(e,t){const i=t.buffer;if(!i)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(a,o)=>{const u=o.removedRanges;u!=null&&u.length&&this.hls.trigger(S.BUFFER_FLUSHED,{type:a})})}get mediaSrc(){var e,t;const i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i==null?void 0:i.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${s}`,t),this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:G.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const a=this.currentOp(e);a&&a.onError(s)}updateTimestampOffset(e,t,i,s,a,o){const u=t-e.timestampOffset;Math.abs(u)>=i&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${a} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,i){const{media:s,mediaSource:a}=this,o=this.tracks[e],u=o==null?void 0:o.buffer;if(!s||!a||!u){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const h=oe(s.duration)?s.duration:1/0,d=oe(a.duration)?a.duration:1/0,f=Math.max(0,t),m=Math.min(i,h,d);m>f&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${f},${m}] from the ${e} SourceBuffer`),u.remove(f,m)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const i=this.tracks[t],s=i==null?void 0:i.buffer;if(!s)throw new ex(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:i}=this,s=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(o=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;const s=(i=this.tracks[t])==null?void 0:i.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){const s=this.tracks[e];if(!s)return;const a=s.buffer;if(!a)return;const o=i.bind(this,e);s.listeners.push({event:t,listener:o}),a.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const i=t.buffer;i&&(t.listeners.forEach(s=>{i.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function ag(l){const e=l.querySelectorAll("source");[].slice.call(e).forEach(t=>{l.removeChild(t)})}function ix(l,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,l.appendChild(t)}function fu(l){return l==="audio"?1:0}class cc{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&oe(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((s,a)=>this.isLevelAllowed(s)&&a<=e);return this.clientRect=null,cc.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const s=(u,h)=>h?u.width!==h.width||u.height!==h.height:!0;let a=e.length-1;const o=Math.max(t,i);for(let u=0;u<e.length;u+=1){const h=e[u];if((h.width>=o||h.height>=o)&&s(h,e[u+1])){a=u;break}}return a}}const nx={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},wt=nx,sx={HLS:"h"},rx=sx;class xi{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof xi?i:new xi(i))),this.value=e,this.params=t}}const ax="Dict";function ox(l){return Array.isArray(l)?JSON.stringify(l):l instanceof Map?"Map{}":l instanceof Set?"Set{}":typeof l=="object"?JSON.stringify(l):String(l)}function lx(l,e,t,i){return new Error(`failed to ${l} "${ox(e)}" as ${t}`,{cause:i})}function Si(l,e,t){return lx("serialize",l,e,t)}class Om{constructor(e){this.description=e}}const og="Bare Item",ux="Boolean";function cx(l){if(typeof l!="boolean")throw Si(l,ux);return l?"?1":"?0"}function dx(l){return btoa(String.fromCharCode(...l))}const hx="Byte Sequence";function fx(l){if(ArrayBuffer.isView(l)===!1)throw Si(l,hx);return`:${dx(l)}:`}const gx="Integer";function mx(l){return l<-999999999999999||999999999999999<l}function Nm(l){if(mx(l))throw Si(l,gx);return l.toString()}function px(l){return`@${Nm(l.getTime()/1e3)}`}function Mm(l,e){if(l<0)return-Mm(-l,e);const t=Math.pow(10,e);if(Math.abs(l*t%1-.5)<Number.EPSILON){const s=Math.floor(l*t);return(s%2===0?s:s+1)/t}else return Math.round(l*t)/t}const yx="Decimal";function vx(l){const e=Mm(l,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Si(l,yx);const t=e.toString();return t.includes(".")?t:`${t}.0`}const Ex="String",xx=/[\x00-\x1f\x7f]+/;function Sx(l){if(xx.test(l))throw Si(l,Ex);return`"${l.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function Tx(l){return l.description||l.toString().slice(7,-1)}const Ax="Token";function lg(l){const e=Tx(l);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Si(e,Ax);return e}function Fu(l){switch(typeof l){case"number":if(!oe(l))throw Si(l,og);return Number.isInteger(l)?Nm(l):vx(l);case"string":return Sx(l);case"symbol":return lg(l);case"boolean":return cx(l);case"object":if(l instanceof Date)return px(l);if(l instanceof Uint8Array)return fx(l);if(l instanceof Om)return lg(l);default:throw Si(l,og)}}const Lx="Key";function Bu(l){if(/^[a-z*][a-z0-9\-_.*]*$/.test(l)===!1)throw Si(l,Lx);return l}function dc(l){return l==null?"":Object.entries(l).map(([e,t])=>t===!0?`;${Bu(e)}`:`;${Bu(e)}=${Fu(t)}`).join("")}function Fm(l){return l instanceof xi?`${Fu(l.value)}${dc(l.params)}`:Fu(l)}function Ix(l){return`(${l.value.map(Fm).join(" ")})${dc(l.params)}`}function Rx(l,e={whitespace:!0}){if(typeof l!="object"||l==null)throw Si(l,ax);const t=l instanceof Map?l.entries():Object.entries(l),i=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,a])=>{a instanceof xi||(a=new xi(a));let o=Bu(s);return a.value===!0?o+=dc(a.params):(o+="=",Array.isArray(a.value)?o+=Ix(a):o+=Fm(a)),o}).join(`,${i}`)}function Bm(l,e){return Rx(l,e)}const mi="CMCD-Object",qe="CMCD-Request",In="CMCD-Session",sn="CMCD-Status",_x={br:mi,ab:mi,d:mi,ot:mi,tb:mi,tpb:mi,lb:mi,tab:mi,lab:mi,url:mi,pb:qe,bl:qe,tbl:qe,dl:qe,ltc:qe,mtp:qe,nor:qe,nrr:qe,rc:qe,sn:qe,sta:qe,su:qe,ttfb:qe,ttfbb:qe,ttlb:qe,cmsdd:qe,cmsds:qe,smrt:qe,df:qe,cs:qe,ts:qe,cid:In,pr:In,sf:In,sid:In,st:In,v:In,msd:In,bs:sn,bsd:sn,cdn:sn,rtp:sn,bg:sn,pt:sn,ec:sn,e:sn},kx={REQUEST:qe};function wx(l){return Object.keys(l).reduce((e,t)=>{var i;return(i=l[t])===null||i===void 0||i.forEach(s=>e[s]=t),e},{})}function Cx(l,e){const t={};if(!l)return t;const i=Object.keys(l),s=e?wx(e):{};return i.reduce((a,o)=>{var u;const h=_x[o]||s[o]||kx.REQUEST,d=(u=a[h])!==null&&u!==void 0?u:a[h]={};return d[o]=l[o],a},t)}function Dx(l){return["ot","sf","st","e","sta"].includes(l)}function bx(l){return typeof l=="number"?oe(l):l!=null&&l!==""&&l!==!1}const Um="event";function Px(l,e){const t=new URL(l),i=new URL(e);if(t.origin!==i.origin)return l;const s=t.pathname.split("/").slice(1),a=i.pathname.split("/").slice(1,-1);for(;s[0]===a[0];)s.shift(),a.shift();for(;a.length;)a.shift(),s.unshift("..");return s.join("/")+t.search+t.hash}const Ka=l=>Math.round(l),Uu=(l,e)=>Array.isArray(l)?l.map(t=>Uu(t,e)):l instanceof xi&&typeof l.value=="string"?new xi(Uu(l.value,e),l.params):(e.baseUrl&&(l=Px(l,e.baseUrl)),e.version===1?encodeURIComponent(l):l),Ca=l=>Ka(l/100)*100,Ox=(l,e)=>{let t=l;return e.version>=2&&(l instanceof xi&&typeof l.value=="string"?t=new xi([l]):typeof l=="string"&&(t=[l])),Uu(t,e)},Nx={br:Ka,d:Ka,bl:Ca,dl:Ca,mtp:Ca,nor:Ox,rtp:Ca,tb:Ka},$m="request",Gm="response",hc=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Mx=["e"],Fx=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function ro(l){return Fx.test(l)}function Bx(l){return hc.includes(l)||Mx.includes(l)||ro(l)}const jm=["d","dl","nor","ot","rtp","su"];function Ux(l){return hc.includes(l)||jm.includes(l)||ro(l)}const $x=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function Gx(l){return hc.includes(l)||jm.includes(l)||$x.includes(l)||ro(l)}const jx=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function Kx(l){return jx.includes(l)||ro(l)}const Vx={[Gm]:Gx,[Um]:Bx,[$m]:Ux};function Km(l,e={}){const t={};if(l==null||typeof l!="object")return t;const i=e.version||l.v||1,s=e.reportingMode||$m,a=i===1?Kx:Vx[s];let o=Object.keys(l).filter(a);const u=e.filter;typeof u=="function"&&(o=o.filter(u));const h=s===Gm||s===Um;h&&!o.includes("ts")&&o.push("ts"),i>1&&!o.includes("v")&&o.push("v");const d=Me({},Nx,e.formatters),f={version:i,reportingMode:s,baseUrl:e.baseUrl};return o.sort().forEach(m=>{let p=l[m];const v=d[m];if(typeof v=="function"&&(p=v(p,f)),m==="v"){if(i===1)return;p=i}m=="pr"&&p===1||(h&&m==="ts"&&!oe(p)&&(p=Date.now()),bx(p)&&(Dx(m)&&typeof p=="string"&&(p=new Om(p)),t[m]=p))}),t}function Hx(l,e={}){const t={};if(!l)return t;const i=Km(l,e),s=Cx(i,e==null?void 0:e.customHeaderMap);return Object.entries(s).reduce((a,[o,u])=>{const h=Bm(u,{whitespace:!1});return h&&(a[o]=h),a},t)}function Wx(l,e,t){return Me(l,Hx(e,t))}const zx="CMCD";function Yx(l,e={}){return l?Bm(Km(l,e),{whitespace:!1}):""}function qx(l,e={}){if(!l)return"";const t=Yx(l,e);return encodeURIComponent(t)}function Qx(l,e={}){if(!l)return"";const t=qx(l,e);return`${zx}=${t}`}const ug=/CMCD=[^&#]+/;function Xx(l,e,t){const i=Qx(e,t);if(!i)return l;if(ug.test(l))return l.replace(ug,i);const s=l.includes("?")?"&":"?";return`${l}${s}${i}`}class Zx{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:wt.MANIFEST,su:!this.initialized})}catch(a){this.hls.logger.warn("Could not generate manifest CMCD data.",a)}},this.applyFragmentData=s=>{try{const{frag:a,part:o}=s,u=this.hls.levels[a.level],h=this.getObjectType(a),d={d:(o||a).duration*1e3,ot:h};(h===wt.VIDEO||h===wt.AUDIO||h==wt.MUXED)&&(d.br=u.bitrate/1e3,d.tb=this.getTopBandwidth(h)/1e3,d.bl=this.getBufferLength(h));const f=o?this.getNextPart(o):this.getNextFrag(a);f!=null&&f.url&&f.url!==a.url&&(d.nor=f.url),this.apply(s,d)}catch(a){this.hls.logger.warn("Could not generate segment CMCD data.",a)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHED,this.onMediaDetached,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHED,this.onMediaDetached,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,s;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:rx.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Me(t,this.createData());const i=t.ot===wt.INIT||t.ot===wt.VIDEO||t.ot===wt.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((o,u)=>(s.includes(u)&&(o[u]=t[u]),o),{}));const a={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),Wx(e.headers,t,a)):e.url=Xx(e.url,t,a)}getNextFrag(e){var t;const i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){const s=e.sn-i.startSN;return i.fragments[s+1]}}getNextPart(e){var t;const{index:i,fragment:s}=e,a=(t=this.hls.levels[s.level])==null||(t=t.details)==null?void 0:t.partList;if(a){const{sn:o}=s;for(let u=a.length-1;u>=0;u--){const h=a[u];if(h.index===i&&h.fragment.sn===o)return a[u+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return wt.TIMED_TEXT;if(e.sn==="initSegment")return wt.INIT;if(t==="audio")return wt.AUDIO;if(t==="main")return this.hls.audioTracks.length?wt.VIDEO:wt.MUXED}getTopBandwidth(e){let t=0,i;const s=this.hls;if(e===wt.AUDIO)i=s.audioTracks;else{const a=s.maxAutoLevel,o=a>-1?a+1:s.levels.length;i=s.levels.slice(0,o)}return i.forEach(a=>{a.bitrate>t&&(t=a.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,i=e===wt.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:Le.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new i(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,o,u){t(a),this.loader.load(a,o,u)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new i(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,o,u){t(a),this.loader.load(a,o,u)}}}}const Jx=3e5;class eS extends qt{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if((i==null?void 0:i.action)===ht.SendAlternateToPenaltyBox&&i.flags===Ft.MoveAllAlternatesMatchingHost){const s=this.levels;let a=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:u,pathwayId:h,type:d}=t.context;u&&s?o=this.getPathwayForGroupId(u,d,o):h&&(o=h)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!a&&s&&(a=this.pathways()),a&&a.length>1&&(this.updatePathwayPriority(a),i.resolved=this.pathwayId!==o),t.details===G.BUFFER_APPEND_ERROR&&!t.fatal?i.resolved=!0:i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${s&&s.length} priorities: ${Be(a)} penalized: ${Be(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const i=this.penalizedPathways,s=performance.now();Object.keys(i).forEach(a=>{s-i[a]>Jx&&delete i[a]});for(let a=0;a<e.length;a++){const o=e[a];if(o in i)continue;if(o===this.pathwayId)return;const u=this.hls.nextLoadLevel,h=this.hls.levels[u];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,um(t),this.hls.trigger(S.LEVELS_UPDATED,{levels:t});const d=this.hls.levels[u];h&&d&&this.levels&&(d.attrs["STABLE-VARIANT-ID"]!==h.attrs["STABLE-VARIANT-ID"]&&d.bitrate!==h.bitrate&&this.log(`Unstable Pathways change from bitrate ${h.bitrate} to ${d.bitrate}`),this.hls.nextLoadLevel=u);break}}}getPathwayForGroupId(e,t,i){const s=this.getLevelsForPathway(i).concat(this.levels||[]);for(let a=0;a<s.length;a++)if(t===ke.AUDIO_TRACK&&s[a].hasAudioGroup(e)||t===ke.SUBTITLE_TRACK&&s[a].hasSubtitleGroup(e))return s[a].pathwayId;return i}clonePathways(e){const t=this.levels;if(!t)return;const i={},s={};e.forEach(a=>{const{ID:o,"BASE-ID":u,"URI-REPLACEMENT":h}=a;if(t.some(f=>f.pathwayId===o))return;const d=this.getLevelsForPathway(u).map(f=>{const m=new We(f.attrs);m["PATHWAY-ID"]=o;const p=m.AUDIO&&`${m.AUDIO}_clone_${o}`,v=m.SUBTITLES&&`${m.SUBTITLES}_clone_${o}`;p&&(i[m.AUDIO]=p,m.AUDIO=p),v&&(s[m.SUBTITLES]=v,m.SUBTITLES=v);const E=Vm(f.uri,m["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),A=new ur({attrs:m,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:E,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(let T=1;T<f.audioGroups.length;T++)A.addGroupId("audio",`${f.audioGroups[T]}_clone_${o}`);if(f.subtitleGroups)for(let T=1;T<f.subtitleGroups.length;T++)A.addGroupId("text",`${f.subtitleGroups[T]}_clone_${o}`);return A});t.push(...d),cg(this.audioTracks,i,h,o),cg(this.subtitleTracks,s,h,o)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const f=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+f)}const a={responseType:"json",url:s.href},o=t.steeringManifestLoadPolicy.default,u=o.errorRetry||o.timeoutRetry||{},h={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},d={onSuccess:(f,m,p,v)=>{this.log(`Loaded steering manifest: "${s}"`);const E=f.data;if((E==null?void 0:E.VERSION)!==1){this.log(`Steering VERSION ${E.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=E.TTL;const{"RELOAD-URI":A,"PATHWAY-CLONES":T,"PATHWAY-PRIORITY":I}=E;if(A)try{this.uri=new self.URL(A,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${A}`);return}this.scheduleRefresh(this.uri||p.url),T&&this.clonePathways(T);const R={steeringManifest:E,url:s.toString()};this.hls.trigger(S.STEERING_MANIFEST_LOADED,R),I&&this.updatePathwayPriority(I)},onError:(f,m,p,v)=>{if(this.log(`Error loading steering manifest: ${f.code} ${f.text} (${m.url})`),this.stopLoad(),f.code===410){this.enabled=!1,this.log(`Steering manifest ${m.url} no longer available`);return}let E=this.timeToLoad*1e3;if(f.code===429){const A=this.loader;if(typeof(A==null?void 0:A.getResponseHeader)=="function"){const T=A.getResponseHeader("Retry-After");T&&(E=parseFloat(T)*1e3)}this.log(`Steering manifest ${m.url} rate limited`);return}this.scheduleRefresh(this.uri||m.url,E)},onTimeout:(f,m,p)=>{this.log(`Timeout loading steering manifest (${m.url})`),this.scheduleRefresh(this.uri||m.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(a,h,d)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const s=(i=this.hls)==null?void 0:i.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function cg(l,e,t,i){l&&Object.keys(e).forEach(s=>{const a=l.filter(o=>o.groupId===s).map(o=>{const u=Me({},o);return u.details=void 0,u.attrs=new We(u.attrs),u.url=u.attrs.URI=Vm(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),u.groupId=u.attrs["GROUP-ID"]=e[s],u.attrs["PATHWAY-ID"]=i,u});l.push(...a)})}function Vm(l,e,t,i){const{HOST:s,PARAMS:a,[t]:o}=i;let u;e&&(u=o==null?void 0:o[e],u&&(l=u));const h=new self.URL(l);return s&&!u&&(h.host=s),a&&Object.keys(a).sort().forEach(d=>{d&&h.searchParams.set(d,a[d])}),h.href}class hs extends qt{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=hs.CDMCleanupPromise?[hs.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:i,initData:s}=t,a=`"${t.type}" event: init data type: "${i}"`;if(this.debug(a),s!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=nr(this.config));const u=o.map(ru).filter(h=>!!h);this.keyFormatPromise=this.getKeyFormatPromise(u)}this.keyFormatPromise.then(o=>{const u=$a(o);if(i!=="sinf"||u!==ze.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${i}" for selected key-system ${u}`);return}let h;try{const v=nt(new Uint8Array(s)),E=ec(JSON.parse(v).sinf),A=Bg(E);if(!A)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");h=new Uint8Array(A.subarray(8,24))}catch(v){this.warn(`${a} Failed to parse sinf: ${v}`);return}const d=ft(h),{keyIdToKeySessionPromise:f,mediaKeySessions:m}=this;let p=f[d];for(let v=0;v<m.length;v++){const E=m[v],A=E.decryptdata;if(!A.keyId)continue;const T=ft(A.keyId);if(Za(h,A.keyId)||A.uri.replace(/-/g,"").indexOf(d)!==-1){if(p=f[T],!p)continue;if(A.pssh)break;delete f[T],A.pssh=new Uint8Array(s),A.keyId=h,p=f[d]=p.then(()=>this.generateRequestWithPreferredKeySession(E,i,s,"encrypted-event-key-match")),p.catch(I=>this.handleError(I));break}}p||this.handleError(new Error(`Key ID ${d} not encountered in playlist. Key-system sessions ${m.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(S.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(S.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,s=t==null?void 0:t[e];if(s)return s.licenseUrl;if(e===ze.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t==null?void 0:t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(o,u,h)=>!!o&&h.indexOf(o)===u,s=t.map(o=>o.audioCodec).filter(i),a=t.map(o=>o.videoCodec).filter(i);return s.length+a.length===0&&a.push("avc1.42e01e"),new Promise((o,u)=>{const h=d=>{const f=d.shift();this.getMediaKeysPromise(f,s,a).then(m=>o({keySystem:f,mediaKeys:m})).catch(m=>{d.length?h(d):m instanceof Mt?u(m):u(new Mt({type:ye.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};h(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${i}`;return tm===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return i(e,t)}getMediaKeysPromise(e,t,i){var s;const a=Ov(e,t,i,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],u=(s=o)==null?void 0:s.keySystemAccess;if(!u){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Be(a)}`),u=this.requestMediaKeySystemAccess(e,a);const h=o=this.keySystemAccessPromises[e]={keySystemAccess:u};return u.catch(d=>{this.log(`Failed to obtain access to key-system "${e}": ${d}`)}),u.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const f=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const m=h.mediaKeys=d.createMediaKeys().then(p=>(this.log(`Media-keys created for "${e}"`),h.hasMediaKeys=!0,f.then(v=>v?this.setMediaKeysServerCertificate(p,e,v):p)));return m.catch(p=>{this.error(`Failed to create media-keys for "${e}"}: ${p}`)}),m})}return u.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${ft(e.keyId||[])} keyUri: ${e.uri}`);const s=i.createSession(),a={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),s=Da(t),a="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,a,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyId ${ft(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),i.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>ru(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:i})=>this.attemptSetMediaKeys(t,i))}selectKeySystem(e){return new Promise((t,i)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const a=ru(s);a?t(a):i(new Error(`Unable to find format for key-system "${s}"`))}).catch(i)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=nr(this.config),i=e.map($a).filter(s=>!!s&&t.indexOf(s)!==-1);return this.selectKeySystem(i)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let i=0;i<t.length;i++){const s=tS(e,t[i]);if(s)return s}}loadKey(e){const t=e.keyInfo.decryptdata,i=Da(t),s=this.bannedKeyIds[i];if(s||this.getKeyStatus(t)==="internal-error"){const u=dg(s||"internal-error",t);return this.handleError(u,e.frag),Promise.reject(u)}const a=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${a}`);const o=this.keyIdToKeySessionPromise[i];if(!o){const u=this.getKeySystemForKeyPromise(t).then(({keySystem:h,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${a}`),this.attemptSetMediaKeys(h,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:h,mediaKeys:d,decryptdata:t}))))).then(h=>{const d="cenc",f=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(h,d,f,"playlist-key")});return u.catch(h=>this.handleError(h,e.frag)),this.keyIdToKeySessionPromise[i]=u,u}return o.catch(u=>{if(u instanceof Mt){const h=Oe({},u.data);this.getKeyStatus(t)==="internal-error"&&(h.decryptdata=t);const d=new Mt(h,u.message);this.handleError(d,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Mt){t&&(e.data.frag=t);const i=e.data.decryptdata;this.error(`${e.message}${i?` (${ft(i.keyId||[])})`:""}`),this.hls.trigger(S.ERROR,e.data)}else this.error(e.message),this.hls.trigger(S.ERROR,{type:ye.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Da(e),i=this.keyIdToKeySessionPromise[t];if(!i){const s=$a(e.keyFormat),a=s?[s]:nr(this.config);return this.attemptKeySystemAccess(a)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=nr(this.config)),e.length===0)throw new Mt({type:ye.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Be({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(i).then(()=>this.media?this.media.setMediaKeys(t):new Promise((a,o)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return o(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(a).catch(o)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(a=>i.indexOf(a)===-1)})}generateRequestWithPreferredKeySession(e,t,i,s){var a;const o=(a=this.config.drmSystems)==null||(a=a[e.keySystem])==null?void 0:a.generateRequest;if(o)try{const E=o.call(this.hls,t,i,e);if(!E)throw new Error("Invalid response from configured generateRequest filter");t=E.initDataType,i=E.initData?E.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(E){if(this.warn(E.message),this.hls&&this.hls.config.debug)throw E}if(i===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const u=Da(e.decryptdata),h=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${u} URI: ${h} (init data type: ${t} length: ${i.byteLength})`);const d=new ic,f=e._onmessage=E=>{const A=e.mediaKeysSession;if(!A){d.emit("error",new Error("invalid state"));return}const{messageType:T,message:I}=E;this.log(`"${T}" message event for session "${A.sessionId}" message size: ${I.byteLength}`),T==="license-request"||T==="license-renewal"?this.renewLicense(e,I).catch(R=>{d.eventNames().length?d.emit("error",R):this.handleError(R)}):T==="license-release"?e.keySystem===ze.FAIRPLAY&&this.updateKeySession(e,Du("acknowledged")).then(()=>this.removeSession(e)).catch(R=>this.handleError(R)):this.warn(`unhandled media key message type "${T}"`)},m=(E,A)=>{A.keyStatus=E;let T;E.startsWith("usable")?d.emit("resolved"):E==="internal-error"||E==="output-restricted"||E==="output-downscaled"?T=dg(E,A.decryptdata):E==="expired"?T=new Error(`key expired (keyId: ${u})`):E==="released"?T=new Error("key released"):E==="status-pending"||this.warn(`unhandled key status change "${E}" (keyId: ${u})`),T&&(d.eventNames().length?d.emit("error",T):this.handleError(T))},p=e._onkeystatuseschange=E=>{if(!e.mediaKeysSession){d.emit("error",new Error("invalid state"));return}const T=this.getKeyStatuses(e);if(!Object.keys(T).some(C=>T[C]!=="status-pending"))return;if(T[u]==="expired"){this.log(`Expired key ${Be(T)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let R=T[u];if(R)m(R,e);else{var _;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(_=e.keyStatusTimeouts)[u]||(_[u]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const b=this.getKeyStatus(e.decryptdata);if(b&&b!=="status-pending")return this.log(`No status for keyId ${u} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${b} from other session.`),m(b,e);this.log(`key status for ${u} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),R="internal-error",m(R,e)},1e3)),this.log(`No status for keyId ${u} (${Be(T)}).`)}};Tt(e.mediaKeysSession,"message",f),Tt(e.mediaKeysSession,"keystatuseschange",p);const v=new Promise((E,A)=>{d.on("error",A),d.on("resolved",E)});return e.mediaKeysSession.generateRequest(t,i).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${u} URI: ${h}`)}).catch(E=>{throw new Mt({type:ye.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_SESSION,error:E,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${E}`)}).then(()=>v).catch(E=>(d.removeAllListeners(),this.removeSession(e).then(()=>{throw E}))).then(()=>(d.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((i,s)=>{if(typeof s=="string"&&typeof i=="object"){const u=s;s=i,i=u}const a="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);if(e.keySystem===ze.PLAYREADY&&a.length===16){const u=ft(a);t[u]=i,Jg(a)}const o=ft(a);i==="internal-error"&&(this.bannedKeyIds[o]=i),this.log(`key status change "${i}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),t[o]=i}),t}fetchServerCertificate(e){const t=this.config,i=t.loader,s=new i(t),a=this.getServerCertificateUrl(e);return a?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,u)=>{const h={responseType:"arraybuffer",url:a},d=t.certLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(p,v,E,A)=>{o(p.data)},onError:(p,v,E,A)=>{u(new Mt({type:ye.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:Oe({url:h.url,data:void 0},p)},`"${e}" certificate request failed (${a}). Status: ${p.code} (${p.text})`))},onTimeout:(p,v,E)=>{u(new Mt({type:ye.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:{url:h.url,data:void 0}},`"${e}" certificate request timed out (${a})`))},onAbort:(p,v,E)=>{u(new Error("aborted"))}};s.load(h,f,m)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((s,a)=>{e.setServerCertificate(i).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${i.byteLength}) on "${t}"`),s(e)}).catch(o=>{a(new Mt({type:ye.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(s=>{throw new Mt({type:ye.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,t){const i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(i,"application/xml"),a=s.querySelectorAll("HttpHeader");if(a.length>0){let f;for(let m=0,p=a.length;m<p;m++){var o,u;f=a[m];const v=(o=f.querySelector("name"))==null?void 0:o.textContent,E=(u=f.querySelector("value"))==null?void 0:u.textContent;v&&E&&e.setRequestHeader(v,E)}}const h=s.querySelector("Challenge"),d=h==null?void 0:h.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return Du(atob(d))}setupLicenseXHR(e,t,i,s){const a=this.config.licenseXhrSetup;return a?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return a.call(this.hls,e,t,i,s)}).catch(o=>{if(!i.decryptdata)throw o;return e.open("POST",t,!0),a.call(this.hls,e,t,i,s)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((s,a)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return a(new Error("invalid state"));if(u.readyState===4)if(u.status===200){this._requestLicenseFailureCount=0;let h=u.response;this.log(`License received ${h instanceof ArrayBuffer?h.byteLength:h}`);const d=this.config.licenseResponseCallback;if(d)try{h=d.call(this.hls,u,o,e)}catch(f){this.error(f)}s(h)}else{const h=i.errorRetry,d=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||u.status>=400&&u.status<500)a(new Mt({type:ye.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:u,response:{url:o,data:void 0,code:u.status,text:u.statusText}},`License Request XHR failed (${o}). Status: ${u.status} (${u.statusText})`));else{const f=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${f} attempts left`),this.requestLicense(e,t).then(s,a)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=u,this.setupLicenseXHR(u,o,e,t).then(({xhr:h,licenseChallenge:d})=>{e.keySystem==ze.PLAYREADY&&(d=this.unpackPlayReadyKeyMessage(h,d)),h.send(d)}).catch(a)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,Tt(i,"encrypted",this.onMediaEncrypted),Tt(i,"waitingforkey",this.onWaitingForKey);const s=this.mediaResolved;s?s():this.mediaKeys=i.mediaKeys}onMediaDetached(){const e=this.media;e&&(Ct(e,"encrypted",this.onMediaEncrypted),Ct(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const i=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,on.clearKeyUriToKeyIdMap();const a=s.length;hs.CDMCleanupPromise=Promise.all(s.map(o=>this.removeSession(o)).concat((i==null||(e=i.setMediaKeys(null))==null?void 0:e.catch(o=>{this.log(`Could not clear media keys: ${o}`),this.hls&&this.hls.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:G.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${o}`)})}))||Promise.resolve())).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`),this.hls&&this.hls.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:G.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${o}`)})}).then(()=>{a&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((s,a)=>(s.indexOf(a.keyFormat)===-1&&s.push(a.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i,decryptdata:s}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${ft((s==null?void 0:s.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const a=this.mediaKeySessions.indexOf(e);a>-1&&this.mediaKeySessions.splice(a,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(d=>self.clearTimeout(o[d]));const{drmSystemOptions:u}=this.config;return(Mv(u)?new Promise((d,f)=>{self.setTimeout(()=>f(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(d).catch(f)}):Promise.resolve()).catch(d=>{this.log(`Could not remove session: ${d}`),this.hls&&this.hls.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:G.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>t.close()).catch(d=>{this.log(`Could not close session: ${d}`),this.hls&&this.hls.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:G.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}return Promise.resolve()}}hs.CDMCleanupPromise=void 0;function Da(l){if(!l)throw new Error("Could not read keyId of undefined decryptdata");if(l.keyId===null)throw new Error("keyId is null");return ft(l.keyId)}function tS(l,e){if(l.keyId&&e.mediaKeysSession.keyStatuses.has(l.keyId))return e.mediaKeysSession.keyStatuses.get(l.keyId);if(l.matches(e.decryptdata))return e.keyStatus}class Mt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function dg(l,e){const t=l==="output-restricted",i=t?G.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:G.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Mt({type:ye.KEY_SYSTEM_ERROR,details:i,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${l}"`)}class iS{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){const s=performance.now();if(t){if(this.lastTime){const a=s-this.lastTime,o=i-this.lastDroppedFrames,u=t-this.lastDecodedFrames,h=1e3*o/a,d=this.hls;if(d.trigger(S.FPS_DROP,{currentDropped:o,currentDecoded:u,totalDroppedFrames:i}),h>0&&o>d.config.fpsDroppedMonitoringThreshold*u){let f=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=f)&&(f=f-1,d.trigger(S.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:d.currentLevel}),d.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function Hm(l,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=l,e.dispatchEvent(t)}function Wm(l,e){const t=l.mode;if(t==="disabled"&&(l.mode="hidden"),l.cues&&!l.cues.getCueById(e.id))try{if(l.addCue(e),!l.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){Ne.debug(`[texttrack-utils]: ${i}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,l.addCue(s)}catch(s){Ne.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(l.mode=t)}function us(l,e){const t=l.mode;if(t==="disabled"&&(l.mode="hidden"),l.cues)for(let i=l.cues.length;i--;)e&&l.cues[i].removeEventListener("enter",e),l.removeCue(l.cues[i]);t==="disabled"&&(l.mode=t)}function $u(l,e,t,i){const s=l.mode;if(s==="disabled"&&(l.mode="hidden"),l.cues&&l.cues.length>0){const a=sS(l.cues,e,t);for(let o=0;o<a.length;o++)(!i||i(a[o]))&&l.removeCue(a[o])}s==="disabled"&&(l.mode=s)}function nS(l,e){if(e<=l[0].startTime)return 0;const t=l.length-1;if(e>l[t].endTime)return-1;let i=0,s=t,a;for(;i<=s;)if(a=Math.floor((s+i)/2),e<l[a].startTime)s=a-1;else if(e>l[a].startTime&&i<t)i=a+1;else return a;return l[i].startTime-e<e-l[s].startTime?i:s}function sS(l,e,t){const i=[],s=nS(l,e);if(s>-1)for(let a=s,o=l.length;a<o;a++){const u=l[a];if(u.startTime>=e&&u.endTime<=t)i.push(u);else if(u.startTime>t)return i}return i}function Va(l){const e=[];for(let t=0;t<l.length;t++){const i=l[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(l[t])}return e}class rS extends uc{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const i=Va(this.media.textTracks);for(let a=0;a<i.length;a++)if(i[a].mode==="hidden")t=i[a];else if(i[a].mode==="showing"){t=i[a];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const i=this.media;if(!i)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;Va(i.textTracks).forEach(o=>{us(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,groupId:s,details:a}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==s){this.warn(`Subtitle track with id:${i} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const u=o.details;o.details=t.details,this.log(`Subtitle track ${i} "${o.name}" lang:${o.lang} group:${s} loaded [${a.startSN}-${a.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.subtitleGroups||null,s=this.groupIds;let a=this.currentTrack;if(!i||(s==null?void 0:s.length)!==(i==null?void 0:i.length)||i!=null&&i.some(o=>(s==null?void 0:s.indexOf(o))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(f=>!i||i.indexOf(f.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(f=>f.default)&&(this.selectDefaultTrack=!1),o.forEach((f,m)=>{f.id=m});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const u=this.hls.config.subtitlePreference;if(!a&&u){this.selectDefaultTrack=!1;const f=vi(u,o);if(f>-1)a=o[f];else{const m=vi(u,this.tracks);a=this.tracks[m]}}let h=this.findTrackId(a);h===-1&&a&&(h=this.findTrackId(null));const d={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${i==null?void 0:i.join(",")}" group-id`),this.hls.trigger(S.SUBTITLE_TRACKS_UPDATED,d),h!==-1&&this.trackId===-1&&this.setSubtitleTrack(h)}}findTrackId(e){const t=this.tracksInGroup,i=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const a=t[s];if(!(i&&!a.default||!i&&!e)&&(!e||kn(a,e)))return s}if(e){for(let s=0;s<t.length;s++){const a=t[s];if(fr(e.attrs,a.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const a=t[s];if(fr(e.attrs,a.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const s=t[i];if(Mu(s,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ke.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const i=this.currentTrack;if(i&&kn(e,i))return i;const s=vi(e,this.tracksInGroup);if(s>-1){const a=this.tracksInGroup[s];return this.setSubtitleTrack(s),a}else{if(i)return null;{const a=vi(e,t);if(a>-1)return t[a]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,s=e.groupId,a=this.getUrlWithDirectives(e.url,t),o=e.details,u=o==null?void 0:o.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${a}`),this.hls.trigger(S.SUBTITLE_TRACK_LOADING,{url:a,id:i,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Va(e.textTracks),i=this.currentTrack;let s;if(i&&(s=t.filter(a=>Mu(i,a))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(a=>{a.mode!=="disabled"&&a!==s&&(a.mode="disabled")}),s){const a=this.subtitleDisplay?"showing":"hidden";s.mode!==a&&(s.mode=a)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!oe(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:e});return}const a=!!s.details&&!s.details.live;if(e===this.trackId&&s===i&&a)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:o,groupId:u="",name:h,type:d,url:f}=s;this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:o,groupId:u,name:h,type:d,url:f});const m=this.switchParams(s.url,i==null?void 0:i.details,s.details);this.loadPlaylist(m)}}function aS(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const a=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?a:a&3|8).toString(16)})}}}function ar(l){let e=5381,t=l.length;for(;t;)e=e*33^l.charCodeAt(--t);return(e>>>0).toString()}const fs=.025;let io=(function(l){return l[l.Point=0]="Point",l[l.Range=1]="Range",l})({});function oS(l,e,t){return`${l.identifier}-${t+1}-${ar(e)}`}class lS{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const i=this.playoutLimit;return e<=0||isNaN(i)?!1:i===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>i}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return gu(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,i=gu(t,e);return t-i<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=oe(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return gu(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<fs))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?io.Range:io.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return uS(this)}}function gu(l,e){return l-e.start<e.duration/2&&!(Math.abs(l-(e.start+e.duration))<fs)?e.start:e.start+e.duration}function zm(l,e,t){const i=new self.URL(l,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function mu(l,e){for(;(t=l.assetList[++e])!=null&&t.error;)var t;return e}function uS(l){return`["${l.identifier}" ${l.cue.pre?"<pre>":l.cue.post?"<post>":""}${l.timelineStart.toFixed(2)}-${l.resumeTime.toFixed(2)}]`}function ls(l){const e=l.timelineStart,t=l.duration||0;return`["${l.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class cS{constructor(e,t,i,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(S.PLAYOUT_LIMIT_REACHED,{})};const a=this.hls=new e(t);this.interstitial=i,this.assetItem=s;const o=()=>{this.hasDetails=!0};a.once(S.LEVEL_LOADED,o),a.once(S.AUDIO_TRACK_LOADED,o),a.once(S.SUBTITLE_TRACK_LOADED,o),a.on(S.MEDIA_ATTACHING,(u,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&a.on(S.BUFFER_APPENDED,()=>{const f=this.bufferedEnd;this.reachedPlayout(f)&&(this._bufferedEosTime=f,a.trigger(S.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=zm(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const i=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,a=Le.bufferInfo(e,s,0);return this.getAssetTime(a.end)>=i-.02}reachedPlayout(e){const i=this.interstitial.playoutLimit;return this.startOffset+e>=i}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Le.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const i=t-this.startOffset;if(i>0&&i<e)return i}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const i=e-t;if(Math.abs(i)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=i=>delete i.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,i){var s;(s=this.hls)==null||s.on(e,t)}once(e,t,i){var s;(s=this.hls)==null||s.once(e,t)}off(e,t,i){var s;(s=this.hls)==null||s.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${ls(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const hg=.033;class dS extends qt{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,i+1):i,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(a=s[i])!=null&&a.event;){var a;i--}return i}findItemIndexAtTime(e,t){const i=this.items;if(i)for(let s=0;s<i.length;s++){let a=i[s];if(t&&t!=="primary"&&(a=a[t]),e===a.start||e>a.start&&e<a.end)return s}return-1}findJumpRestrictedIndex(e,t){const i=this.items;if(i)for(let s=e;s<=t&&i[s];s++){const a=i[s].event;if(a!=null&&a.restrictions.jump&&!a.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var i;if(((i=t[s].event)==null?void 0:i.identifier)===e)return s}return-1}findAssetIndex(e,t){const i=e.assetList,s=i.length;if(s>1)for(let a=0;a<s;a++){const o=i[a];if(!o.error){const u=o.timelineStart;if(t===u||t>u&&(t<u+(o.duration||0)||a===s-1))return a}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const i=t.assetList,s=i[i.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const i=e.main.details,{dateRanges:s}=i,a=this.events,o=this.parseDateRanges(s,{url:i.url},t),u=Object.keys(s),h=a?a.filter(d=>!u.includes(d.identifier)):[];o.length&&o.sort((d,f)=>{const m=d.cue.pre,p=d.cue.post,v=f.cue.pre,E=f.cue.post;if(m&&!v)return-1;if(v&&!m||p&&!E)return 1;if(E&&!p)return-1;if(!m&&!v&&!p&&!E){const A=d.startTime,T=f.startTime;if(A!==T)return A-T}return d.dateRange.tagOrder-f.dateRange.tagOrder}),this.events=o,h.forEach(d=>{this.removeEvent(d)}),this.updateSchedule(e,h)}updateSchedule(e,t=[],i=!1){const s=this.events||[];if(s.length||t.length||this.length<2){const a=this.items,o=this.parseSchedule(s,e);(i||t.length||(a==null?void 0:a.length)!==o.length||o.some((h,d)=>Math.abs(h.playout.start-a[d].playout.start)>.005||Math.abs(h.playout.end-a[d].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,a))}}parseDateRanges(e,t,i){const s=[],a=Object.keys(e);for(let o=0;o<a.length;o++){const u=a[o],h=e[u];if(h.isInterstitial){let d=this.eventMap[u];d?d.setDateRange(h):(d=new lS(h,t),this.eventMap[u]=d,i===!1&&(d.appendInPlace=i)),s.push(d)}}return s}parseSchedule(e,t){const i=[],s=t.main.details,a=s.live?1/0:s.edge;let o=0;if(e=e.filter(h=>!h.error&&!(h.cue.once&&h.hasPlayed)),e.length){this.resolveOffsets(e,t);let h=0,d=0;if(e.forEach((f,m)=>{const p=f.cue.pre,v=f.cue.post,E=e[m-1]||null,A=f.appendInPlace,T=v?a:f.startOffset,I=f.duration,R=f.timelineOccupancy===io.Range?I:0,_=f.resumptionOffset,C=(E==null?void 0:E.startTime)===T,b=T+f.cumulativeDuration;let K=A?b+I:T+_;if(p||!v&&T<=0){const B=d;d+=R,f.timelineStart=b;const U=o;o+=I,i.push({event:f,start:b,end:K,playout:{start:U,end:o},integrated:{start:B,end:d}})}else if(T<=a){if(!C){const M=T-h;if(M>hg){const z=h,te=d;d+=M;const se=o;o+=M;const le={previousEvent:e[m-1]||null,nextEvent:f,start:z,end:z+M,playout:{start:se,end:o},integrated:{start:te,end:d}};i.push(le)}else M>0&&E&&(E.cumulativeDuration+=M,i[i.length-1].end=T)}v&&(K=b),f.timelineStart=b;const B=d;d+=R;const U=o;o+=I,i.push({event:f,start:b,end:K,playout:{start:U,end:o},integrated:{start:B,end:d}})}else return;const O=f.resumeTime;v||O>a?h=a:h=O}),h<a){var u;const f=h,m=d,p=a-h;d+=p;const v=o;o+=p,i.push({previousEvent:((u=i[i.length-1])==null?void 0:u.event)||null,nextEvent:null,start:h,end:f+p,playout:{start:v,end:o},integrated:{start:m,end:d}})}this.setDurations(a,o,d)}else i.push({previousEvent:null,nextEvent:null,start:0,end:a,playout:{start:0,end:a},integrated:{start:0,end:a}}),this.setDurations(a,a,a);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){const i=t.main.details,s=i.live?1/0:i.edge;let a=0,o=-1;e.forEach((u,h)=>{const d=u.cue.pre,f=u.cue.post,m=d?0:f?s:u.startTime;this.updateAssetDurations(u),o===m?u.cumulativeDuration=a:(a=0,o=m),!f&&u.snapOptions.in&&(u.resumeAnchor=Cn(null,i.fragments,u.startOffset+u.resumptionOffset,0,0)||void 0),u.appendInPlace&&!u.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(u,t)||(u.appendInPlace=!1)),!u.appendInPlace&&h+1<e.length&&e[h+1].startTime-e[h].resumeTime<hg&&(e[h+1].appendInPlace=!1,e[h+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${u}`));const v=oe(u.resumeOffset)?u.resumeOffset:u.duration;a+=v})}primaryCanResumeInPlaceAt(e,t){const i=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(i-s)>fs?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${s}`),!1):!Object.keys(t).some(o=>{const u=t[o].details,h=u.edge;if(i>=h)return this.log(`"${e.identifier}" resumption ${i} past ${o} playlist end ${h}`),!1;const d=Cn(null,u.fragments,i);if(!d)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${o} playlist (${u.fragStart}-${u.fragmentEnd})`),!0;const f=o==="audio"?.175:0;return Math.abs(d.start-i)<fs+f||Math.abs(d.end-i)<fs+f?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${o} fragment bounds (${d.start}-${d.end} sn: ${d.sn} cc: ${d.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let i=0,s=!1,a=!1;for(let o=0;o<e.assetList.length;o++){const u=e.assetList[o],h=t+i;u.startOffset=i,u.timelineStart=h,s||(s=u.duration===null),a||(a=!!u.error);const d=u.error?0:u.duration||0;i+=d}s&&!a?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function ai(l){return`[${l.event?'"'+l.event.identifier+'"':"primary"}: ${l.start.toFixed(2)}-${l.end.toFixed(2)}]`}class hS{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const i=e.assetListUrl;let s;try{s=zm(i,this.hls.sessionId,e.baseUrl)}catch(p){const v=this.assignAssetListError(e,G.ASSET_LIST_LOAD_ERROR,p,i);this.hls.trigger(S.ERROR,v);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const a=this.hls.config,o=a.loader,u=new o(a),h={responseType:"json",url:s.href},d=a.interstitialAssetListLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(p,v,E,A)=>{const T=p.data,I=T==null?void 0:T.ASSETS;if(!Array.isArray(I)){const R=this.assignAssetListError(e,G.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),E.url,v,A);this.hls.trigger(S.ERROR,R);return}e.assetListResponse=T,this.hls.trigger(S.ASSET_LIST_LOADED,{event:e,assetListResponse:T,networkDetails:A})},onError:(p,v,E,A)=>{const T=this.assignAssetListError(e,G.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${p.code} ${p.text} (${v.url})`),v.url,A,E);this.hls.trigger(S.ERROR,T)},onTimeout:(p,v,E)=>{const A=this.assignAssetListError(e,G.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${v.url})`),v.url,p,E);this.hls.trigger(S.ERROR,A)}};return u.load(h,f,m),this.hls.trigger(S.ASSET_LIST_LOADING,{event:e}),u}assignAssetListError(e,t,i,s,a,o){return e.error=i,{type:ye.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:i,networkDetails:o,stats:a}}}function fg(l){var e;l==null||(e=l.play())==null||e.catch(()=>{})}function ba(l,e){return`[${l}] Advancing timeline position to ${e}`}class fS extends qt{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled||!this.schedule)return;const s=i-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const o=s<=-.01;this.timelinePos=i,this.bufferedPos=i;const u=this.playingItem;if(!u){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(i,i-s)&&this.updateSchedule(!0),this.checkBuffer(),o&&i<u.start||i>=u.end){var h;const v=this.findItemIndex(u);let E=this.schedule.findItemIndexAtTime(i);if(E===-1&&(E=v+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${i} (resolving from ${v} to ${E})`)),!this.isInterstitial(u)&&(h=this.media)!=null&&h.paused&&(this.shouldPlay=!1),!o&&E>v){const A=this.schedule.findJumpRestrictedIndex(v+1,E);if(A>v){this.setSchedulePosition(A);return}}this.setSchedulePosition(E);return}const d=this.playingAsset;if(!d){if(this.playingLastItem&&this.isInterstitial(u)){const v=u.event.assetList[0];v&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,v))}return}const f=d.timelineStart,m=d.duration||0;if(o&&i<f||i>=f+m){var p;(p=u.event)!=null&&p.appendInPlace&&(this.clearAssetPlayers(u.event,u),this.flushFrontBuffer(i)),this.setScheduleToAssetAtTime(i,d)}},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(i>=s.end){this.timelinePos=s.end;const u=this.findItemIndex(s);this.setSchedulePosition(u+1)}const a=this.playingAsset;if(!a)return;const o=a.timelineStart+(a.duration||0);i>=o&&this.setScheduleToAssetAtTime(i,a)},this.onScheduleUpdate=(i,s)=>{const a=this.schedule;if(!a)return;const o=this.playingItem,u=a.events||[],h=a.items||[],d=a.durations,f=i.map(A=>A.identifier),m=!!(u.length||f.length);(m||s)&&this.log(`INTERSTITIALS_UPDATED (${u.length}): ${u}
Schedule: ${h.map(A=>ai(A))} pos: ${this.timelinePos}`),f.length&&this.log(`Removed events ${f}`);let p=null,v=null;o&&(p=this.updateItem(o,this.timelinePos),this.itemsMatch(o,p)?this.playingItem=p:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const E=this.bufferingItem;if(E&&(v=this.updateItem(E,this.bufferedPos),this.itemsMatch(E,v)?this.bufferingItem=v:E.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(E.event,null))),i.forEach(A=>{A.assetList.forEach(T=>{this.clearAssetPlayer(T.identifier,null)})}),this.playerQueue.forEach(A=>{if(A.interstitial.appendInPlace){const T=A.assetItem.timelineStart,I=A.timelineOffset-T;if(I)try{A.timelineOffset=T}catch(R){Math.abs(I)>fs&&this.warn(`${R} ("${A.assetId}" ${A.timelineOffset}->${T})`)}}}),m||s){if(this.hls.trigger(S.INTERSTITIALS_UPDATED,{events:u.slice(0),schedule:h.slice(0),durations:d,removedIds:f}),this.isInterstitial(o)&&f.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(p,o),E&&v!==p&&this.trimInPlace(v,E),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new hS(e),this.schedule=new dS(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(S.MEDIA_ENDED,this.onMediaEnded,this),e.on(S.ERROR,this.onError,this),e.on(S.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(S.MEDIA_ENDED,this.onMediaEnded,this),e.off(S.ERROR,this.onError,this),e.off(S.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Ct(e,"play",this.onPlay),Ct(e,"pause",this.onPause),Ct(e,"seeking",this.onSeeking),Ct(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const i=this.media=t.media;Tt(i,"seeking",this.onSeeking),Tt(i,"timeupdate",this.onTimeupdate),Tt(i,"play",this.onPlay),Tt(i,"pause",this.onPause)}onMediaAttached(e,t){const i=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!s){this.clearScheduleState();const a=this.findItemIndex(i);this.setSchedulePosition(a)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const i=!!t.transferMedia,s=this.media;if(this.media=null,!i&&(s&&this.removeMediaListeners(s),this.detachedData)){const a=this.getBufferingPlayer();a&&(this.log(`Removing schedule state for detachedData and ${a}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,a.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,i=m=>m&&e.getAssetPlayer(m.identifier),s=(m,p,v,E,A)=>{if(m){let T=m[p].start;const I=m.event;if(I){if(p==="playout"||I.timelineOccupancy!==io.Point){const R=i(v);(R==null?void 0:R.interstitial)===I&&(T+=R.assetItem.startOffset+R[A])}}else{const R=E==="bufferedPos"?o():e[E];T+=R-m.start}return T}return 0},a=(m,p)=>{var v;if(m!==0&&p!=="primary"&&(v=e.schedule)!=null&&v.length){var E;const A=e.schedule.findItemIndexAtTime(m),T=(E=e.schedule.items)==null?void 0:E[A];if(T){const I=T[p].start-T.start;return m+I}}return m},o=()=>{const m=e.bufferedPos;return m===Number.MAX_VALUE?u("primary"):Math.max(m,0)},u=m=>{var p,v;return(p=e.primaryDetails)!=null&&p.live?e.primaryDetails.edge:((v=e.schedule)==null?void 0:v.durations[m])||0},h=(m,p)=>{var v,E;const A=e.effectivePlayingItem;if(A!=null&&(v=A.event)!=null&&v.restrictions.skip||!e.schedule)return;e.log(`seek to ${m} "${p}"`);const T=e.effectivePlayingItem,I=e.schedule.findItemIndexAtTime(m,p),R=(E=e.schedule.items)==null?void 0:E[I],_=e.getBufferingPlayer(),C=_==null?void 0:_.interstitial,b=C==null?void 0:C.appendInPlace,K=T&&e.itemsMatch(T,R);if(T&&(b||K)){const O=i(e.playingAsset),B=(O==null?void 0:O.media)||e.primaryMedia;if(B){const U=p==="primary"?B.currentTime:s(T,p,e.playingAsset,"timelinePos","currentTime"),M=m-U,z=(b?U:B.currentTime)+M;if(z>=0&&(!O||b||z<=O.duration)){B.currentTime=z;return}}}if(R){let O=m;if(p!=="primary"){const U=R[p].start,M=m-U;O=R.start+M}const B=!e.isInterstitial(R);if((!e.isInterstitial(T)||T.event.appendInPlace)&&(B||R.event.appendInPlace)){const U=e.media||(b?_==null?void 0:_.media:null);U&&(U.currentTime=O)}else if(T){const U=e.findItemIndex(T);if(I>U){const z=e.schedule.findJumpRestrictedIndex(U+1,I);if(z>U){e.setSchedulePosition(z);return}}let M=0;if(B)e.timelinePos=O,e.checkBuffer();else{const z=R.event.assetList,te=m-(R[p]||R).start;for(let se=z.length;se--;){const le=z[se];if(le.duration&&te>=le.startOffset&&te<le.startOffset+le.duration){M=se;break}}}e.setSchedulePosition(I,M)}}},d=()=>{const m=e.effectivePlayingItem;if(e.isInterstitial(m))return m;const p=t();return e.isInterstitial(p)?p:null},f={get bufferedEnd(){const m=t(),p=e.bufferingItem;if(p&&p===m){var v;return s(p,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-p.playout.start||((v=e.bufferingAsset)==null?void 0:v.startOffset)||0}return 0},get currentTime(){const m=d(),p=e.effectivePlayingItem;return p&&p===m?s(p,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-p.playout.start:0},set currentTime(m){const p=d(),v=e.effectivePlayingItem;v&&v===p&&h(m+v.playout.start,"playout")},get duration(){const m=d();return m?m.playout.end-m.playout.start:0},get assetPlayers(){var m;const p=(m=d())==null?void 0:m.event.assetList;return p?p.map(v=>e.getAssetPlayer(v.identifier)):[]},get playingIndex(){var m;const p=(m=d())==null?void 0:m.event;return p&&e.effectivePlayingAsset?p.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return d()}};return this.manager={get events(){var m;return((m=e.schedule)==null||(m=m.events)==null?void 0:m.slice(0))||[]},get schedule(){var m;return((m=e.schedule)==null||(m=m.items)==null?void 0:m.slice(0))||[]},get interstitialPlayer(){return d()?f:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const m=t();return e.findItemIndex(m)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const m=e.effectivePlayingItem;return e.findItemIndex(m)},primary:{get bufferedEnd(){return o()},get currentTime(){const m=e.timelinePos;return m>0?m:0},set currentTime(m){h(m,"primary")},get duration(){return u("primary")},get seekableStart(){var m;return((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(m){h(m,"integrated")},get duration(){return u("integrated")},get seekableStart(){var m;return a(((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0,"integrated")}},skip:()=>{const m=e.effectivePlayingItem,p=m==null?void 0:m.event;if(p&&!p.restrictions.skip){const v=e.findItemIndex(m);if(p.appendInPlace){const E=m.playout.start+m.event.duration;h(E+.001,"playout")}else e.advanceAfterAssetEnded(p,v,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);const a=(t=s)==null?void 0:t.currentTime;if(!(a===void 0||!oe(a)))return a}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){const i=e.interstitial.appendInPlace,s=e.media;if(i&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const a=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Be(a)}`),this.detachedData=a}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var i,s;if(e.media===t)return;let a=null;const o=this.hls,u=e!==o,h=u&&e.interstitial.appendInPlace,d=(i=this.detachedData)==null?void 0:i.mediaSource;let f;if(o.media)h&&(a=o.transferMedia(),this.detachedData=a),f="Primary";else if(d){const E=this.getBufferingPlayer();E?(a=E.transferMedia(),f=`${E}`):f="detached MediaSource"}else f="detached media";if(!a){if(d)a=this.detachedData,this.log(`using detachedData: MediaSource ${Be(a)}`);else if(!this.detachedData||o.media===t){const E=this.playerQueue;E.length>1&&E.forEach(A=>{if(u&&A.interstitial.appendInPlace!==h){const T=A.interstitial;this.clearInterstitial(A.interstitial,null),T.appendInPlace=!1,T.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${T}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const m=a&&"mediaSource"in a&&((s=a.mediaSource)==null?void 0:s.readyState)!=="closed",p=m&&a?a:t;this.log(`${m?"transfering MediaSource":"attaching media"} to ${u?e:"Primary"} from ${f} (media.currentTime: ${t.currentTime})`);const v=this.schedule;if(p===a&&v){const E=u&&e.assetId===v.assetIdAtEnd;p.overrides={duration:v.duration,endOfStream:!u||E,cueRemoval:!u}}e.attachMedia(p)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,s=this.effectivePlayingItem;if(i===-1){const a=this.hls.startPosition;if(this.log(ba("checkStart",a)),this.timelinePos=a,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(a>=0||!this.primaryLive){const o=this.timelinePos=a>0?a:0,u=e.findItemIndexAtTime(o);this.setSchedulePosition(u)}}else if(s&&!this.playingItem){const a=e.findItemIndex(s);this.setSchedulePosition(a)}}advanceAssetBuffering(e,t){const i=e.event,s=i.findAssetIndex(t),a=mu(i,s);if(!i.isAssetPastPlayoutLimit(a))this.bufferedToEvent(e,a);else if(this.schedule){var o;const u=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];u&&this.bufferedToItem(u)}}advanceAfterAssetEnded(e,t,i){const s=mu(e,i);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const a=this.schedule.items;if(a){const o=t+1,u=a.length;if(o>=u){this.setSchedulePosition(-1);return}const h=e.resumeTime;this.timelinePos<h&&(this.log(ba("advanceAfterAssetEnded",h)),this.timelinePos=h,e.appendInPlace&&this.advanceInPlace(h),this.checkBuffer(this.bufferedPos<h)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const a=e.assetList[s];a&&this.advanceInPlace(a.timelineStart)}this.setSchedulePosition(t,s)}}setScheduleToAssetAtTime(e,t){const i=this.schedule;if(!i)return;const s=t.parentIdentifier,a=i.getEvent(s);if(a){const o=i.findEventIndex(s),u=i.findAssetIndex(a,e);this.advanceAfterAssetEnded(a,o,u-1)}}setSchedulePosition(e,t){var i;const s=(i=this.schedule)==null?void 0:i.items;if(!s||this.playbackDisabled)return;const a=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${a&&ai(a)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,u=this.playingLastItem;if(this.isInterstitial(o)){const f=o.event,m=this.playingAsset,p=m==null?void 0:m.identifier,v=p?this.getAssetPlayer(p):null;if(v&&p&&(!this.eventItemsMatch(o,a)||t!==void 0&&p!==f.assetList[t].identifier)){var h;const E=f.findAssetIndex(m);if(this.log(`INTERSTITIAL_ASSET_ENDED ${E+1}/${f.assetList.length} ${ls(m)}`),this.endedAsset=m,this.playingAsset=null,this.hls.trigger(S.INTERSTITIAL_ASSET_ENDED,{asset:m,assetListIndex:E,event:f,schedule:s.slice(0),scheduleIndex:e,player:v}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(f,this.findItemIndex(this.playingItem),E);return}this.retreiveMediaSource(p,a),v.media&&!((h=this.detachedData)!=null&&h.mediaSource)&&v.detachMedia()}if(!this.eventItemsMatch(o,a)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${f} ${ai(o)}`),f.hasPlayed=!0,this.hls.trigger(S.INTERSTITIAL_ENDED,{event:f,schedule:s.slice(0),scheduleIndex:e}),f.cue.once)){var d;this.updateSchedule();const E=(d=this.schedule)==null?void 0:d.items;if(a&&E){const A=this.findItemIndex(a);this.advanceSchedule(A,E,t,o,u)}return}}this.advanceSchedule(e,s,t,o,u)}advanceSchedule(e,t,i,s,a){const o=this.schedule;if(!o)return;const u=t[e]||null,h=this.primaryMedia,d=this.playerQueue;if(d.length&&d.forEach(f=>{const m=f.interstitial,p=o.findEventIndex(m.identifier);(p<e||p>e+1)&&this.clearInterstitial(m,u)}),this.isInterstitial(u)){this.timelinePos=Math.min(Math.max(this.timelinePos,u.start),u.end);const f=u.event;if(i===void 0){i=o.findAssetIndex(f,this.timelinePos);const E=mu(f,i-1);if(f.isAssetPastPlayoutLimit(E)||f.appendInPlace&&this.timelinePos===u.end){this.advanceAfterAssetEnded(f,e,i);return}i=E}const m=this.waitingItem;this.assetsBuffered(u,h)||this.setBufferingItem(u);let p=this.preloadAssets(f,i);if(this.eventItemsMatch(u,m||s)||(this.waitingItem=u,this.log(`INTERSTITIAL_STARTED ${ai(u)} ${f.appendInPlace?"append in place":""}`),this.hls.trigger(S.INTERSTITIAL_STARTED,{event:f,schedule:t.slice(0),scheduleIndex:e})),!f.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${f}`);return}if(f.assetListLoader&&(f.assetListLoader.destroy(),f.assetListLoader=void 0),!h){this.log(`Waiting for attachMedia to start Interstitial ${f}`);return}this.waitingItem=this.endedItem=null,this.playingItem=u;const v=f.assetList[i];if(!v){this.advanceAfterAssetEnded(f,e,i||0);return}if(p||(p=this.getAssetPlayer(v.identifier)),p===null||p.destroyed){const E=f.assetList.length;this.warn(`asset ${i+1}/${E} player destroyed ${f}`),p=this.createAssetPlayer(f,v,i),p.loadSource()}if(!this.eventItemsMatch(u,this.bufferingItem)&&f.appendInPlace&&this.isAssetBuffered(v))return;this.startAssetPlayer(p,i,t,e,h),this.shouldPlay&&fg(p.media)}else u?(this.resumePrimary(u,e,s),this.shouldPlay&&fg(this.hls.media)):a&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var s,a;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${ai(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let u=this.timelinePos;(u<e.start||u>=e.end)&&(u=this.getPrimaryResumption(e,t),this.log(ba("resumePrimary",u)),this.timelinePos=u),this.attachPrimary(u,e)}if(!i)return;const o=(a=this.schedule)==null?void 0:a.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${ai(e)}`),this.hls.trigger(S.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const i=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(i<s.fragmentStart||i>s.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Le.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const a=this.hls;a.media?this.checkBuffer():(this.transferMediaTo(a,s),i&&this.startLoadingPrimaryAt(e,i)),i||(this.log(ba("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((i=s.mainForwardBufferInfo)==null?void 0:i.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(S.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(S.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const i=this.hls.levels[t.level];if(!i.details)return;const s=Oe(Oe({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const i=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Oe(Oe({},this.altSelection),{},{audio:i});return}const a=Oe(Oe({},s),{},{audio:i});this.mediaSelection=a}onSubtitleTrackUpdated(e,t){const i=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Oe(Oe({},this.altSelection),{},{subtitles:i});return}const a=Oe(Oe({},s),{},{subtitles:i});this.mediaSelection=a}onAudioTrackSwitching(e,t){const i=Tf(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(t)||s.setAudioOption(i)))}onSubtitleTrackSwitch(e,t){const i=Tf(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(t)||t.id!==-1&&s.setSubtitleOption(i)))}onBufferCodecs(e,t){const i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const a=t[s];if(a.cue.post){var i;const o=this.schedule.findEventIndex(a.identifier),u=(i=this.schedule.items)==null?void 0:i[o];this.isInterstitial(u)&&this.eventItemsMatch(u,this.bufferingItem)&&this.bufferedToItem(u,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){var i;const s=(i=this.schedule)==null?void 0:i.items;if(e&&s){const a=this.findItemIndex(e,t);return s[a]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((a,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(a.identifier,null)});const i=e.end+.25,s=Le.bufferInfo(this.primaryMedia,i,0);(s.end>i||(s.nextStart||0)>i)&&(this.log(`trim buffered interstitial ${ai(e)} (was ${ai(t)})`),this.attachPrimary(i,null,!0),this.flushFrontBuffer(i))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const i=this.mediaSelection;i&&((t=this.schedule)==null||t.updateSchedule(i,[],e))}checkBuffer(e){var t;const i=(t=this.schedule)==null?void 0:t.items;if(!i)return;const s=Le.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,i,e)}updateBufferedPos(e,t,i){const s=this.schedule,a=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(t.length===1&&this.itemsMatch(t[0],a)){this.bufferedPos=e;return}const o=this.playingItem,u=this.findItemIndex(o);let h=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var d;const f=this.findItemIndex(a),m=Math.min(f+1,t.length-1),p=t[m];if((h===-1&&a&&e>=a.end||(d=p.event)!=null&&d.appendInPlace&&e+.01>=p.start)&&(h=m),this.isInterstitial(a)){const v=a.event;if(m-u>1&&v.appendInPlace===!1||v.assetList.length===0&&v.assetListLoader)return}if(this.bufferedPos=e,h>f&&h>u)this.bufferedToItem(p);else{const v=this.primaryDetails;this.primaryLive&&v&&e>v.edge-v.targetduration&&p.start<v.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(p)&&this.preloadAssets(p.event,0)}}else i&&o&&!this.itemsMatch(o,a)&&(h===u?this.bufferedToItem(o):h===u+1&&this.bufferedToItem(t[h]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const a=this.getAssetPlayer(s.identifier);return!(a!=null&&a.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,i=this.schedule;if(!this.itemsMatch(e,t)&&i){const{items:s,events:a}=i;if(!s||!a)return t;const o=this.isInterstitial(e),u=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const h=u?u.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${ai(e)}`+(t?` (${h.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const d=i.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((f,m)=>{const p=this.getAssetPlayer(f.identifier);p&&(m===d&&p.loadSource(),p.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(d=>d.pauseBuffering());this.hls.trigger(S.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:a.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){const i=e.event,s=i.assetList.length===0&&!i.assetListLoader,a=i.cue.once;if(s||!a){const o=this.preloadAssets(i,t);if(o!=null&&o.interstitial.appendInPlace){const u=this.primaryMedia;u&&this.bufferAssetPlayer(o,u)}}}preloadAssets(e,t){const i=e.assetUrl,s=e.assetList.length,a=s===0&&!e.assetListLoader,o=e.cue.once;if(a){const h=e.timelineStart;if(e.appendInPlace){var u;const p=this.playingItem;!this.isInterstitial(p)&&(p==null||(u=p.nextEvent)==null?void 0:u.identifier)===e.identifier&&this.flushFrontBuffer(h+.25)}let d,f=0;if(!this.playingItem&&this.primaryLive&&(f=this.hls.startPosition,f===-1&&(f=this.hls.liveSyncPosition||0)),f&&!(e.cue.pre||e.cue.post)){const p=f-h;p>0&&(d=Math.round(p*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:s} ${e}${d?` live-start: ${f} start-offset: ${d}`:""}`),i)return this.createAsset(e,0,0,h,e.duration,i);const m=this.assetListLoader.loadAssetList(e,d);m&&(e.assetListLoader=m)}else if(!o&&s){for(let d=t;d<s;d++){const f=e.assetList[d],m=this.getAssetPlayerQueueIndex(f.identifier);(m===-1||this.playerQueue[m].destroyed)&&!f.error&&this.createAssetPlayer(e,f,d)}const h=e.assetList[t];if(h){const d=this.getAssetPlayer(h.identifier);return d&&d.loadSource(),d}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,s,a,o){const u={parentIdentifier:e.identifier,identifier:oS(e,o,t),duration:a,startOffset:i,timelineStart:s,uri:o};return this.createAssetPlayer(e,u,t)}createAssetPlayer(e,t,i){const s=this.hls,a=s.userConfig;let o=a.videoPreference;const u=s.loadLevelObj||s.levels[s.currentLevel];(o||u)&&(o=Me({},o),u.videoCodec&&(o.videoCodec=u.videoCodec),u.videoRange&&(o.allowedVideoRanges=[u.videoRange]));const h=s.audioTracks[s.audioTrack],d=s.subtitleTracks[s.subtitleTrack];let f=0;if(this.primaryLive||e.appendInPlace){const C=this.timelinePos-t.timelineStart;if(C>1){const b=t.duration;b&&C<b&&(f=C)}}const m=t.identifier,p=Oe(Oe({},a),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:m,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:f,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:h||a.audioPreference,subtitlePreference:d||a.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(p.timelineOffset=t.timelineStart));const v=p.cmcd;v!=null&&v.sessionId&&v.contentId&&(p.cmcd=Me({},v,{contentId:ar(t.uri)})),this.getAssetPlayer(m)&&this.warn(`Duplicate date range identifier ${e} and asset ${m}`);const E=new cS(this.HlsPlayerClass,p,e,t);this.playerQueue.push(E),e.assetList[i]=t;let A=!0;const T=C=>{if(C.live){var b;const B=new Error(`Interstitials MUST be VOD assets ${e}`),U={fatal:!0,type:ye.OTHER_ERROR,details:G.INTERSTITIAL_ASSET_ITEM_ERROR,error:B},M=((b=this.schedule)==null?void 0:b.findEventIndex(e.identifier))||-1;this.handleAssetItemError(U,e,M,i,B.message);return}const K=C.edge-C.fragmentStart,O=t.duration;(A||O===null||K>O)&&(A=!1,this.log(`Interstitial asset "${m}" duration change ${O} > ${K}`),t.duration=K,this.updateSchedule())};E.on(S.LEVEL_UPDATED,(C,{details:b})=>T(b)),E.on(S.LEVEL_PTS_UPDATED,(C,{details:b})=>T(b)),E.on(S.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const I=(C,b)=>{const K=this.getAssetPlayer(m);if(K&&b.tracks){K.off(S.BUFFER_CODECS,I),K.tracks=b.tracks;const O=this.primaryMedia;this.bufferingAsset===K.assetItem&&O&&!K.media&&this.bufferAssetPlayer(K,O)}};E.on(S.BUFFER_CODECS,I);const R=()=>{var C;const b=this.getAssetPlayer(m);if(this.log(`buffered to end of asset ${b}`),!b||!this.schedule)return;const K=this.schedule.findEventIndex(e.identifier),O=(C=this.schedule.items)==null?void 0:C[K];this.isInterstitial(O)&&this.advanceAssetBuffering(O,t)};E.on(S.BUFFERED_TO_END,R);const _=C=>()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;this.shouldPlay=!0;const K=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,K,C)};return E.once(S.MEDIA_ENDED,_(i)),E.once(S.PLAYOUT_LIMIT_REACHED,_(1/0)),E.on(S.ERROR,(C,b)=>{if(!this.schedule)return;const K=this.getAssetPlayer(m);if(b.details===G.BUFFER_STALLED_ERROR){if(K!=null&&K.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(b,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${b.error} ${e}`)}),E.on(S.DESTROYING,()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;const b=new Error(`Asset player destroyed unexpectedly ${m}`),K={fatal:!0,type:ye.OTHER_ERROR,details:G.INTERSTITIAL_ASSET_ITEM_ERROR,error:b};this.handleAssetItemError(K,e,this.schedule.findEventIndex(e.identifier),i,b.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${ls(t)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:E}),E}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,t){const i=this.getAssetPlayerQueueIndex(e);if(i!==-1){const s=this.playerQueue[i];this.log(`clear ${s} toSegment: ${t&&ai(t)}`),this.transferMediaFromPlayer(s,t),this.playerQueue.splice(i,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,s,a){const{interstitial:o,assetItem:u,assetId:h}=e,d=o.assetList.length,f=this.playingAsset;this.endedAsset=null,this.playingAsset=u,(!f||f.identifier!==h)&&(f&&(this.clearAssetPlayer(f.identifier,i[s]),delete f.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${d} ${ls(u)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_STARTED,{asset:u,assetListIndex:t,event:o,schedule:i.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,a)}bufferAssetPlayer(e,t){var i,s;if(!this.schedule)return;const{interstitial:a,assetItem:o}=e,u=this.schedule.findEventIndex(a.identifier),h=(i=this.schedule.items)==null?void 0:i[u];if(!h)return;e.loadSource(),this.setBufferingItem(h),this.bufferingAsset=o;const d=this.getBufferingPlayer();if(d===e)return;const f=a.appendInPlace;if(f&&(d==null?void 0:d.interstitial.appendInPlace)===!1)return;const m=(d==null?void 0:d.tracks)||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(f&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(m&&!wg(m,e.tracks)){const p=new Error(`Asset ${ls(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(m)}')`),v={fatal:!0,type:ye.OTHER_ERROR,details:G.INTERSTITIAL_ASSET_ITEM_ERROR,error:p},E=a.findAssetIndex(o);this.handleAssetItemError(v,a,u,E,p.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,i=this.primaryMedia;if(!t||!i)return;const s=i.currentTime,a=t.findAssetIndex(e,s),o=e.assetList[a];if(o){const u=this.getAssetPlayer(o.identifier);if(u){const h=u.currentTime||s-o.timelineStart,d=u.duration-h;if(this.warn(`Stalled at ${h} of ${h+d} in ${u} ${e} (media.currentTime: ${s})`),h&&(d/i.playbackRate<.5||u.bufferedInPlaceToEnd(i))&&u.hls){const f=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,f,a)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,i,s,a){if(e.details===G.BUFFER_STALLED_ERROR)return;const o=t.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&ls(o)} ${e.error}`),!this.schedule)return;const u=(o==null?void 0:o.identifier)||"",h=this.getAssetPlayerQueueIndex(u),d=this.playerQueue[h]||null,f=this.schedule.items,m=Me({},e,{fatal:!1,errorAction:cs(!0),asset:o,assetListIndex:s,event:t,schedule:f,scheduleIndex:i,player:d});if(this.hls.trigger(S.INTERSTITIAL_ASSET_ERROR,m),!e.fatal)return;const p=this.playingAsset,v=this.bufferingAsset,E=new Error(a);if(o&&(this.clearAssetPlayer(u,null),o.error=E),!t.assetList.some(A=>!A.error))t.error=E;else for(let A=s;A<t.assetList.length;A++)this.resetAssetPlayer(t.assetList[A].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):p&&p.identifier===u?this.advanceAfterAssetEnded(t,i,s):v&&v.identifier===u&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,v)}primaryFallback(e){const t=e.timelineStart,i=this.effectivePlayingItem;let s=this.timelinePos;if(i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${s} playing: ${ai(i)} error: ${e.error}`),s===-1&&(s=this.hls.startPosition);const o=this.updateItem(i,s);this.itemsMatch(i,o)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(s===-1){this.checkStart();return}if(!this.schedule)return;const a=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(a)}onAssetListLoaded(e,t){var i,s;const a=t.event,o=a.identifier,u=t.assetListResponse.ASSETS;if(!((i=this.schedule)!=null&&i.hasEvent(o)))return;const h=a.timelineStart,d=a.duration;let f=0;u.forEach((A,T)=>{const I=parseFloat(A.DURATION);this.createAsset(a,T,f,h+f,I,A.URI),f+=I}),a.duration=f,this.log(`Loaded asset-list with duration: ${f} (was: ${d}) ${a}`);const m=this.waitingItem,p=(m==null?void 0:m.event.identifier)===o;this.updateSchedule();const v=(s=this.bufferingItem)==null?void 0:s.event;if(p){var E;const A=this.schedule.findEventIndex(o),T=(E=this.schedule.items)==null?void 0:E[A];if(T){if(!this.playingItem&&this.timelinePos>T.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==A){a.error=new Error(`Interstitial ${u.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${a}`),this.log(a.error.message),this.updateSchedule(!0),this.primaryFallback(a);return}this.setBufferingItem(T)}this.setSchedulePosition(A)}else if((v==null?void 0:v.identifier)===o){const A=a.assetList[0];if(A){const T=this.getAssetPlayer(A.identifier);if(v.appendInPlace){const I=this.primaryMedia;T&&I&&this.bufferAssetPlayer(T,I)}else T&&T.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case G.ASSET_LIST_PARSING_ERROR:case G.ASSET_LIST_LOAD_ERROR:case G.ASSET_LIST_LOAD_TIMEOUT:{const i=t.interstitial;i&&(this.updateSchedule(!0),this.primaryFallback(i));break}case G.BUFFER_STALLED_ERROR:{const i=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&i.event.appendInPlace){this.handleInPlaceStall(i.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const gg=500;class gS extends tc{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",fe.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=Y.IDLE,this.setInterval(gg),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:s}=t;if(this.fragContextChanged(i)||(Ze(i)&&(this.fragPrevious=i),this.state=Y.IDLE),!s)return;const a=this.tracksBuffered[this.currentTrackId];if(!a)return;let o;const u=i.start;for(let d=0;d<a.length;d++)if(u>=a[d].start&&u<=a[d].end){o=a[d];break}const h=i.start+i.duration;o?o.end=h:(o={start:u,end:h},a.push(o)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:i,endOffset:s}=t;if(i===0&&s!==Number.POSITIVE_INFINITY){const a=s-1;if(a<=0)return;t.endOffsetSubtitles=Math.max(0,a),this.tracksBuffered.forEach(o=>{for(let u=0;u<o.length;){if(o[u].end<=a){o.shift();continue}else if(o[u].start<a)o[u].start=a;else break;u++}}),this.fragmentTracker.removeFragmentsInRange(i,a,fe.SUBTITLE)}}onError(e,t){const i=t.frag;(i==null?void 0:i.type)===fe.SUBTITLE&&(t.details===G.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Y.STOPPED&&(this.state=Y.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&bm(this.levels,t)){this.levels=t.map(i=>new ur(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const s=new ur(i);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,fe.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==Y.STOPPED&&this.setInterval(gg)}onSubtitleTrackLoaded(e,t){var i;const{currentTrackId:s,levels:a}=this,{details:o,id:u}=t;if(!a){this.warn(`Subtitle tracks were reset while loading level ${u}`);return}const h=a[u];if(u>=a.length||!h)return;this.log(`Subtitle track ${u} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(o.live||(i=h.details)!=null&&i.live){if(o.deltaUpdateFailed)return;const m=this.mainDetails;if(!m){this.startFragRequested=!1;return}const p=m.fragments[0];if(!h.details)o.hasProgramDateTime&&m.hasProgramDateTime?(eo(o,m),d=o.fragmentStart):p&&(d=p.start,Pu(o,d));else{var f;d=this.alignPlaylists(o,h.details,(f=this.levelLastLoaded)==null?void 0:f.details),d===0&&p&&(d=p.start,Pu(o,d))}m&&!this.startFragRequested&&this.setStartPosition(m,d)}h.details=o,this.levelLastLoaded=h,u===s&&(this.hls.trigger(S.SUBTITLE_TRACK_UPDATED,{details:o,id:u,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===Y.IDLE&&(Cn(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,s=t.decryptdata,a=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&s!=null&&s.key&&s.iv&&ds(s.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(i),s.key.buffer,s.iv.buffer,Ju(s.method)).catch(u=>{throw a.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:G.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:t}),u}).then(u=>{const h=performance.now();a.trigger(S.FRAG_DECRYPTED,{frag:t,payload:u,stats:{tstart:o,tdecrypt:h}})}).catch(u=>{this.warn(`${u.name}: ${u.message}`),this.state=Y.IDLE})}}doTick(){if(!this.media){this.state=Y.IDLE;return}if(this.state===Y.IDLE){const{currentTrackId:e,levels:t}=this,i=t==null?void 0:t[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;const{config:s}=this,a=this.getLoadPosition(),o=Le.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],a,s.maxBufferHole),{end:u,len:h}=o,d=i.details,f=this.hls.maxBufferLength+d.levelTargetDuration;if(h>f)return;const m=d.fragments,p=m.length,v=d.edge;let E=null;const A=this.fragPrevious;if(u<v){const R=s.maxFragLookUpTolerance,_=u>v-R?0:R;E=Cn(A,m,Math.max(m[0].start,u),_),!E&&A&&A.start<m[0].start&&(E=m[0])}else E=m[p-1];if(E=this.filterReplacedPrimary(E,i.details),!E)return;const T=E.sn-d.startSN,I=m[T-1];if(I&&I.cc===E.cc&&this.fragmentTracker.getState(I)===st.NOT_LOADED&&(E=I),this.fragmentTracker.getState(E)===st.NOT_LOADED){const R=this.mapToInitFragWhenRequired(E);R&&this.loadFragment(R,i,u)}}}loadFragment(e,t,i){Ze(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new mS(this.tracksBuffered[this.currentTrackId]||[])}}class mS{constructor(e){this.buffered=void 0;const t=(i,s,a)=>{if(s=s>>>0,s>a-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${a})`);return e[s][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}const pS={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Ym=l=>String.fromCharCode(pS[l]||l),oi=15,Di=100,yS={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},vS={17:2,18:4,21:6,22:8,23:10,19:13,20:15},ES={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},xS={25:2,26:4,29:6,30:8,31:10,27:13,28:15},SS=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class TS{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;Ne.log(`${this.time} [${e}] ${i}`)}}}const Rn=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class qm{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const s=t[i];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class AS{constructor(){this.uchar=" ",this.penState=new qm}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class LS{constructor(e){this.chars=[],this.pos=0,this.currPenState=new qm,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Di;t++)this.chars.push(new AS);this.logger=e}equals(e){for(let t=0;t<Di;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Di;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Di;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Di&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Di)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Ym(e);if(this.pos>=Di){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Di;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<Di;i++){const s=this.chars[i].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class pu{constructor(e){this.rows=[],this.currRow=oi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<oi;t++)this.rows.push(new LS(e));this.logger=e}reset(){for(let e=0;e<oi;e++)this.rows[e].clear();this.currRow=oi-1}equals(e){let t=!0;for(let i=0;i<oi;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<oi;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<oi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Be(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let u=0;u<oi;u++)this.rows[u].clear();const a=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const u=o.rows[a].cueStartTime,h=this.logger.time;if(u!==null&&h!==null&&u<h)for(let d=0;d<this.nrRollUpRows;d++)this.rows[t-this.nrRollUpRows+d+1].copy(o.rows[a+d])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const a=e.indent,o=Math.max(a-1,0);i.setCursor(e.indent),e.color=i.chars[o].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Be(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",s=-1;for(let a=0;a<oi;a++){const o=this.rows[a].getTextString();o&&(s=a+1,e?t.push("Row "+s+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class mg{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new pu(i),this.nonDisplayedMemory=new pu(i),this.lastOutputScreen=new pu(i),this.currRollUpRow=this.displayedMemory.rows[oi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[oi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[i]}this.logger.log(2,"MIDROW: "+Be(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class pg{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=RS(),this.logger=void 0;const s=this.logger=new TS;this.channels=[null,new mg(e,t,s),new mg(e+1,i,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){const s=t[i]&127,a=t[i+1]&127;let o=!1,u=null;if(s===0&&a===0)continue;this.logger.log(3,()=>"["+Rn([t[i],t[i+1]])+"] -> ("+Rn([s,a])+")");const h=this.cmdHistory;if(s>=16&&s<=31){if(IS(s,a,h)){Pa(null,null,h),this.logger.log(3,()=>"Repeated command ("+Rn([s,a])+") is dropped");continue}Pa(s,a,this.cmdHistory),o=this.parseCmd(s,a),o||(o=this.parseMidrow(s,a)),o||(o=this.parsePAC(s,a)),o||(o=this.parseBackgroundAttributes(s,a))}else Pa(null,null,h);if(!o&&(u=this.parseChars(s,a),u)){const f=this.currentChannel;f&&f>0?this.channels[f].insertChars(u):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!u&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Rn([s,a])+" orig: "+Rn([t[i],t[i+1]]))}}parseCmd(e,t){const i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(i||s))return!1;const a=e===20||e===21||e===23?1:2,o=this.channels[a];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=a,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[i];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Rn([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,a=(e===16||e===24)&&t>=64&&t<=95;if(!(s||a))return!1;const o=e<=23?1:2;t>=64&&t<=95?i=o===1?yS[e]:ES[e]:i=o===1?vS[e]:xS[e];const u=this.channels[o];return u?(u.setPAC(this.interpretPAC(i,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let i;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,s.underline=(i&1)===1,i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((i-16)/2)*4,s}parseChars(e,t){let i,s=null,a=null;if(e>=25?(i=2,a=e-8):(i=1,a=e),a>=17&&a<=19){let o;a===17?o=t+80:a===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+Ym(o)+"' in channel "+i),s=[o]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+Rn(s).join(",")),s}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(i||s))return!1;let a;const o={};e===16||e===24?(a=Math.floor((t-32)/2),o.background=SS[a],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const u=e<=23?1:2;return this.channels[u].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Pa(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function Pa(l,e,t){t.a=l,t.b=e}function IS(l,e,t){return t.a===l&&t.b===e}function RS(){return{a:null,b:null}}var fc=(function(){if(Ja!=null&&Ja.VTTCue)return self.VTTCue;const l=["","lr","rl"],e=["start","middle","end","left","right"];function t(u,h){if(typeof h!="string"||!Array.isArray(u))return!1;const d=h.toLowerCase();return~u.indexOf(d)?d:!1}function i(u){return t(l,u)}function s(u){return t(e,u)}function a(u,...h){let d=1;for(;d<arguments.length;d++){const f=arguments[d];for(const m in f)u[m]=f[m]}return u}function o(u,h,d){const f=this,m={enumerable:!0};f.hasBeenReset=!1;let p="",v=!1,E=u,A=h,T=d,I=null,R="",_=!0,C="auto",b="start",K=50,O="middle",B=50,U="middle";Object.defineProperty(f,"id",a({},m,{get:function(){return p},set:function(M){p=""+M}})),Object.defineProperty(f,"pauseOnExit",a({},m,{get:function(){return v},set:function(M){v=!!M}})),Object.defineProperty(f,"startTime",a({},m,{get:function(){return E},set:function(M){if(typeof M!="number")throw new TypeError("Start time must be set to a number.");E=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",a({},m,{get:function(){return A},set:function(M){if(typeof M!="number")throw new TypeError("End time must be set to a number.");A=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",a({},m,{get:function(){return T},set:function(M){T=""+M,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",a({},m,{get:function(){return I},set:function(M){I=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",a({},m,{get:function(){return R},set:function(M){const z=i(M);if(z===!1)throw new SyntaxError("An invalid or illegal string was specified.");R=z,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",a({},m,{get:function(){return _},set:function(M){_=!!M,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",a({},m,{get:function(){return C},set:function(M){if(typeof M!="number"&&M!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");C=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",a({},m,{get:function(){return b},set:function(M){const z=s(M);if(!z)throw new SyntaxError("An invalid or illegal string was specified.");b=z,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",a({},m,{get:function(){return K},set:function(M){if(M<0||M>100)throw new Error("Position must be between 0 and 100.");K=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",a({},m,{get:function(){return O},set:function(M){const z=s(M);if(!z)throw new SyntaxError("An invalid or illegal string was specified.");O=z,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",a({},m,{get:function(){return B},set:function(M){if(M<0||M>100)throw new Error("Size must be between 0 and 100.");B=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",a({},m,{get:function(){return U},set:function(M){const z=s(M);if(!z)throw new SyntaxError("An invalid or illegal string was specified.");U=z,this.hasBeenReset=!0}})),f.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o})();class _S{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Qm(l){function e(i,s,a,o){return(i|0)*3600+(s|0)*60+(a|0)+parseFloat(o||0)}const t=l.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class kS{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let s=0;s<i.length;++s)if(t===i[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function Xm(l,e,t,i){const s=i?l.split(i):[l];for(const a in s){if(typeof s[a]!="string")continue;const o=s[a].split(t);if(o.length!==2)continue;const u=o[0],h=o[1];e(u,h)}}const Gu=new fc(0,0,""),Oa=Gu.align==="middle"?"middle":"center";function wS(l,e,t){const i=l;function s(){const u=Qm(l);if(u===null)throw new Error("Malformed timestamp: "+i);return l=l.replace(/^[^\sa-zA-Z-]+/,""),u}function a(u,h){const d=new kS;Xm(u,function(p,v){let E;switch(p){case"region":for(let A=t.length-1;A>=0;A--)if(t[A].id===v){d.set(p,t[A].region);break}break;case"vertical":d.alt(p,v,["rl","lr"]);break;case"line":E=v.split(","),d.integer(p,E[0]),d.percent(p,E[0])&&d.set("snapToLines",!1),d.alt(p,E[0],["auto"]),E.length===2&&d.alt("lineAlign",E[1],["start",Oa,"end"]);break;case"position":E=v.split(","),d.percent(p,E[0]),E.length===2&&d.alt("positionAlign",E[1],["start",Oa,"end","line-left","line-right","auto"]);break;case"size":d.percent(p,v);break;case"align":d.alt(p,v,["start",Oa,"end","left","right"]);break}},/:/,/\s/),h.region=d.get("region",null),h.vertical=d.get("vertical","");let f=d.get("line","auto");f==="auto"&&Gu.line===-1&&(f=-1),h.line=f,h.lineAlign=d.get("lineAlign","start"),h.snapToLines=d.get("snapToLines",!0),h.size=d.get("size",100),h.align=d.get("align",Oa);let m=d.get("position","auto");m==="auto"&&Gu.position===50&&(m=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=m}function o(){l=l.replace(/^\s+/,"")}if(o(),e.startTime=s(),o(),l.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);l=l.slice(3),o(),e.endTime=s(),o(),a(l,e)}function Zm(l){return l.replace(/<br(?: \/)?>/gi,`
`)}class CS{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new _S,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let a=t.buffer,o=0;for(a=Zm(a);o<a.length&&a[o]!=="\r"&&a[o]!==`
`;)++o;const u=a.slice(0,o);return a[o]==="\r"&&++o,a[o]===`
`&&++o,t.buffer=a.slice(o),u}function s(a){Xm(a,function(o,u){},/:/)}try{let a="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;a=i();const u=a.match(/^()?WEBVTT([ \t].*)?$/);if(!(u!=null&&u[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:a=i(),t.state){case"HEADER":/:/.test(a)?s(a):a||(t.state="ID");continue;case"NOTE":a||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){t.state="NOTE";break}if(!a)continue;if(t.cue=new fc(0,0,""),t.state="CUE",a.indexOf("-->")===-1){t.cue.id=a;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{wS(a,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const u=a.indexOf("-->")!==-1;if(!a||u&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=a}continue;case"BADCUE":a||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const DS=/\r\n|\n\r|\n|\r/g,yu=function(e,t,i=0){return e.slice(i,i+t.length)===t},bS=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),a=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!oe(t)||!oe(i)||!oe(s)||!oe(a))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*s,t+=3600*1e3*a,t};function gc(l,e,t){return ar(l.toString())+ar(e.toString())+ar(t)}const PS=function(e,t,i){let s=e[t],a=e[s.prevCC];if(!a||!a.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(o=a)!=null&&o.new;){var o;e.ccOffset+=s.start-a.start,s.new=!1,s=a,a=e[s.prevCC]}e.presentationOffset=i};function OS(l,e,t,i,s,a,o){const u=new CS,h=$t(new Uint8Array(l)).trim().replace(DS,`
`).split(`
`),d=[],f=e?$E(e.baseTime,e.timescale):0;let m="00:00.000",p=0,v=0,E,A=!0;u.oncue=function(T){const I=t[i];let R=t.ccOffset;const _=(p-f)/9e4;if(I!=null&&I.new&&(v!==void 0?R=t.ccOffset=I.start:PS(t,i,_)),_){if(!e){E=new Error("Missing initPTS for VTT MPEGTS");return}R=_-t.presentationOffset}const C=T.endTime-T.startTime,b=Bt((T.startTime+R-v)*9e4,s*9e4)/9e4;T.startTime=Math.max(b,0),T.endTime=Math.max(b+C,0);const K=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(K)),T.id||(T.id=gc(T.startTime,T.endTime,K)),T.endTime>0&&d.push(T)},u.onparsingerror=function(T){E=T},u.onflush=function(){if(E){o(E);return}a(d)},h.forEach(T=>{if(A)if(yu(T,"X-TIMESTAMP-MAP=")){A=!1,T.slice(16).split(",").forEach(I=>{yu(I,"LOCAL:")?m=I.slice(6):yu(I,"MPEGTS:")&&(p=parseInt(I.slice(7)))});try{v=bS(m)/1e3}catch(I){E=I}return}else T===""&&(A=!1);u.parse(T+`
`)}),u.flush()}const vu="stpp.ttml.im1t",Jm=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ep=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,NS={left:"start",center:"center",right:"end",start:"start",end:"end"};function yg(l,e,t,i){const s=Re(new Uint8Array(l),["mdat"]);if(s.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const a=s.map(u=>$t(u)),o=UE(e.baseTime,1,e.timescale);try{a.forEach(u=>t(MS(u,o)))}catch(u){i(u)}}function MS(l,e){const s=new DOMParser().parseFromString(l,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const a={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(a).reduce((m,p)=>(m[p]=s.getAttribute(`ttp:${p}`)||a[p],m),{}),u=s.getAttribute("xml:space")!=="preserve",h=vg(Eu(s,"styling","style")),d=vg(Eu(s,"layout","region")),f=Eu(s,"body","[begin]");return[].map.call(f,m=>{const p=tp(m,u);if(!p||!m.hasAttribute("begin"))return null;const v=Su(m.getAttribute("begin"),o),E=Su(m.getAttribute("dur"),o);let A=Su(m.getAttribute("end"),o);if(v===null)throw Eg(m);if(A===null){if(E===null)throw Eg(m);A=v+E}const T=new fc(v-e,A-e,p);T.id=gc(T.startTime,T.endTime,T.text);const I=d[m.getAttribute("region")],R=h[m.getAttribute("style")],_=FS(I,R,h),{textAlign:C}=_;if(C){const b=NS[C];b&&(T.lineAlign=b),T.align=C}return Me(T,_),T}).filter(m=>m!==null)}function Eu(l,e,t){const i=l.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function vg(l){return l.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function tp(l,e){return[].slice.call(l.childNodes).reduce((t,i,s)=>{var a;return i.nodeName==="br"&&s?t+`
`:(a=i.childNodes)!=null&&a.length?tp(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function FS(l,e,t){const i="http://www.w3.org/ns/ttml#styling";let s=null;const a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=l!=null&&l.hasAttribute("style")?l.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(s=t[o]),a.reduce((u,h)=>{const d=xu(e,i,h)||xu(l,i,h)||xu(s,i,h);return d&&(u[h]=d),u},{})}function xu(l,e,t){return l&&l.hasAttributeNS(e,t)?l.getAttributeNS(e,t):null}function Eg(l){return new Error(`Could not parse ttml timestamp ${l}`)}function Su(l,e){if(!l)return null;let t=Qm(l);return t===null&&(Jm.test(l)?t=BS(l,e):ep.test(l)&&(t=US(l,e))),t}function BS(l,e){const t=Jm.exec(l),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function US(l,e){const t=ep.exec(l),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class Na{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class $S{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Sg(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Na(this,"textTrack1"),t=new Na(this,"textTrack2"),i=new Na(this,"textTrack3"),s=new Na(this,"textTrack4");this.cea608Parser1=new pg(1,e,t),this.cea608Parser2=new pg(3,i,s)}addCues(e,t,i,s,a){let o=!1;for(let u=a.length;u--;){const h=a[u],d=GS(h[0],h[1],t,i);if(d>=0&&(h[0]=Math.min(h[0],t),h[1]=Math.max(h[1],i),o=!0,d/(i-t)>.5))return}if(o||a.push([t,i]),this.config.renderTextTracksNatively){const u=this.captionsTracks[e];this.Cues.newCue(u,t,i,s)}else{const u=this.Cues.newCue(null,t,i,s);this.hls.trigger(S.CUES_PARSED,{type:"captions",cues:u,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:s,timescale:a,trackId:o}){const{unparsedVttFrags:u}=this;i===fe.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:a,trackId:o}),u.length&&(this.unparsedVttFrags=[],u.forEach(h=>{this.initPTS[h.frag.cc]?this.onFragLoaded(S.FRAG_LOADED,h):this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:i}=this;if(i)for(let s=0;s<i.textTracks.length;s++){const a=i.textTracks[s];if(xg(a,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return a}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:s}=this,{label:a,languageCode:o}=t[e],u=this.getExistingTrack(a,o);if(u)i[e]=u,us(i[e]),Hm(i[e],s);else{const h=this.createTextTrack("captions",a,o);h&&(h[e]=!0,i[e]=h)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,s={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,i){const s=this.media;if(s)return s.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const i=!!t.transferMedia;if(this.media=null,i)return;const{captionsTracks:s}=this;Object.keys(s).forEach(a=>{us(s[a]),delete s[a]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Sg(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)us(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],s=i.some(a=>a.textCodec===vu);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(bm(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const o=this.media,u=o?Va(o.textTracks):null;if(this.tracks.forEach((h,d)=>{let f;if(u){let m=null;for(let p=0;p<u.length;p++)if(u[p]&&xg(u[p],h)){m=u[p],u[p]=null;break}m&&(f=m)}if(f)us(f);else{const m=ip(h);f=this.createTextTrack(m,h.name,h.lang),f&&(f.mode="disabled")}f&&this.textTracks.push(f)}),u!=null&&u.length){const h=u.filter(d=>d!==null).map(d=>d.label);h.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${h.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(u=>({label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}));this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const s=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!s)return;const a=`textTrack${s[1]}`,o=this.captionsProperties[a];o&&(o.label=i.name,i.lang&&(o.languageCode=i.lang),o.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===fe.MAIN){var i,s;const{cea608Parser1:a,cea608Parser2:o,lastSn:u}=this,{cc:h,sn:d}=t.frag,f=(i=(s=t.part)==null?void 0:s.index)!=null?i:-1;a&&o&&(d!==u+1||d===u&&f!==this.lastPartIndex+1||h!==this.lastCc)&&(a.reset(),o.reset()),this.lastCc=h,this.lastSn=d,this.lastPartIndex=f}}onFragLoaded(e,t){const{frag:i,payload:s}=t;if(i.type===fe.SUBTITLE)if(s.byteLength){const a=i.decryptdata,o="stats"in t;if(a==null||!a.encrypted||o){const u=this.tracks[i.level],h=this.vttCCs;h[i.cc]||(h[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),u&&u.textCodec===vu?this._parseIMSC1(i,s):this._parseVTTs(t)}}else this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;yg(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),i.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{i.logger.log(`Failed to parse IMSC1: ${s}`),i.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:i,payload:s}=e,{initPTS:a,unparsedVttFrags:o}=this,u=a.length-1;if(!a[i.cc]&&u===-1){o.push(e);return}const h=this.hls,d=(t=i.initSegment)!=null&&t.data?Yt(i.initSegment.data,new Uint8Array(s)).buffer:s;OS(d,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,f=>{this._appendCues(f,i.level),h.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},f=>{const m=f.message==="Missing initPTS for VTT MPEGTS";m?o.push(e):this._fallbackToIMSC1(i,s),h.logger.log(`Failed to parse VTT cue: ${f}`),!(m&&u>i.cc)&&h.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:f})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||yg(t,this.initPTS[e.cc],()=>{i.textCodec=vu,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(a=>Wm(s,a))}else{const s=this.tracks[t];if(!s)return;const a=s.default?"default":"subtitles"+t;i.trigger(S.CUES_PARSED,{type:"subtitles",cues:e,track:a})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===fe.SUBTITLE&&this.onFragLoaded(S.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:s}=t;if(!(i.type===fe.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let a=0;a<s.length;a++){const o=s[a].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const u=this.extractCea608Data(o);this.cea608Parser1.addData(s[a].pts,u[0]),this.cea608Parser2.addData(s[a].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:s,type:a}){const{media:o}=this;if(!(!o||o.currentTime<i)){if(!a||a==="video"){const{captionsTracks:u}=this;Object.keys(u).forEach(h=>$u(u[h],t,i))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:u}=this;Object.keys(u).forEach(h=>$u(u[h],t,s))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let s=2;for(let a=0;a<i;a++){const o=e[s++],u=127&e[s++],h=127&e[s++];if(u===0&&h===0)continue;if((4&o)!==0){const f=3&o;(f===0||f===1)&&(t[f].push(u),t[f].push(h))}}return t}}function ip(l){return l.characteristics&&/transcribes-spoken-dialog/gi.test(l.characteristics)&&/describes-music-and-sound/gi.test(l.characteristics)?"captions":"subtitles"}function xg(l,e){return!!l&&l.kind===ip(e)&&Mu(e,l)}function GS(l,e,t,i){return Math.min(e,i)-Math.max(l,t)}function Sg(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const jS=/\s/,KS={newCue(l,e,t,i){const s=[];let a,o,u,h,d;const f=self.VTTCue||self.TextTrackCue;for(let p=0;p<i.rows.length;p++)if(a=i.rows[p],u=!0,h=0,d="",!a.isEmpty()){var m;for(let A=0;A<a.chars.length;A++)jS.test(a.chars[A].uchar)&&u?h++:(d+=a.chars[A].uchar,u=!1);a.cueStartTime=e,e===t&&(t+=1e-4),h>=16?h--:h++;const v=Zm(d.trim()),E=gc(e,t,v);l!=null&&(m=l.cues)!=null&&m.getCueById(E)||(o=new f(e,t,v),o.id=E,o.line=p+1,o.align="left",o.position=10+Math.min(80,Math.floor(h*8/32)*10),s.push(o))}return l&&s.length&&(s.sort((p,v)=>p.line==="auto"||v.line==="auto"?0:p.line>8&&v.line>8?v.line-p.line:p.line-v.line),s.forEach(p=>Wm(l,p))),s}};function VS(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const HS=/(\d+)-(\d+)\/(\d+)/;class Tg{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||qS,this.controller=new self.AbortController,this.stats=new Wu}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const a=WS(e,this.controller.signal),o=e.responseType==="arraybuffer",u=o?"byteLength":"length",{maxTimeToFirstByteMs:h,maxLoadTimeMs:d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,a),self.clearTimeout(this.requestTimeout),t.timeout=h&&oe(h)?h:d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(hr(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(m=>{var p;this.response=this.loader=m;const v=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},d-(v-s.loading.start)),!m.ok){const{status:A,statusText:T}=m;throw new QS(T||"fetch, bad network response",A,m)}s.loading.first=v,s.total=YS(m.headers)||s.total;const E=(p=this.callbacks)==null?void 0:p.onProgress;return E&&oe(t.highWaterMark)?this.loadProgressively(m,s,e,t.highWaterMark,E):o?m.arrayBuffer():e.responseType==="json"?m.json():m.text()}).then(m=>{var p,v;const E=this.response;if(!E)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const A=m[u];A&&(s.loaded=s.total=A);const T={url:E.url,data:m,code:E.status},I=(p=this.callbacks)==null?void 0:p.onProgress;I&&!oe(t.highWaterMark)&&I(s,e,m,E),(v=this.callbacks)==null||v.onSuccess(T,s,e,E)}).catch(m=>{var p;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const v=m&&m.code||0,E=m?m.message:null;(p=this.callbacks)==null||p.onError({code:v,text:E},e,m?m.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,s=0,a){const o=new hm,u=e.body.getReader(),h=()=>u.read().then(d=>{if(d.done)return o.dataLength&&a(t,i,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const f=d.value,m=f.length;return t.loaded+=m,m<s||o.dataLength?(o.push(f),o.dataLength>=s&&a(t,i,o.flush().buffer,e)):a(t,i,f.buffer,e),h()}).catch(()=>Promise.reject());return h()}}function WS(l,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Me({},l.headers))};return l.rangeEnd&&t.headers.set("Range","bytes="+l.rangeStart+"-"+String(l.rangeEnd-1)),t}function zS(l){const e=HS.exec(l);if(e)return parseInt(e[2])-parseInt(e[1])+1}function YS(l){const e=l.get("Content-Range");if(e){const i=zS(e);if(oe(i))return i}const t=l.get("Content-Length");if(t)return parseInt(t)}function qS(l,e){return new self.Request(l.url,e)}class QS extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const XS=/^age:\s*[\d.]+\s*$/im;class np{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Wu,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const i=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const a=this.xhrSetup;a?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return a(i,t.url)}).catch(o=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),a(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(o=>{var u;(u=this.callbacks)==null||u.onError({code:i.status,text:o.message},t,i,s)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:a,maxLoadTimeMs:o}=i.loadPolicy;if(s)for(const u in s)e.setRequestHeader(u,s[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=a&&oe(a)?a:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const s=t.readyState,a=this.config;if(!i.aborted&&s>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),a.timeout!==a.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),a.timeout=a.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const d=t.status,f=t.responseType==="text"?t.responseText:null;if(d>=200&&d<300){const E=f??t.response;if(E!=null){var o,u;i.loading.end=Math.max(self.performance.now(),i.loading.first);const A=t.responseType==="arraybuffer"?E.byteLength:E.length;i.loaded=i.total=A,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const T=(o=this.callbacks)==null?void 0:o.onProgress;T&&T(i,e,E,t);const I={url:t.responseURL,data:E,code:d};(u=this.callbacks)==null||u.onSuccess(I,i,e,t);return}}const m=a.loadPolicy.errorRetry,p=i.retry,v={url:e.url,data:void 0,code:d};if(Xa(m,p,!1,v))this.retry(m);else{var h;Ne.error(`${d} while loading ${e.url}`),(h=this.callbacks)==null||h.onError({code:d,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Xa(e,t,!0))this.retry(e);else{var i;Ne.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=Qu(e,i.retry),i.retry++,Ne.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&XS.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const ZS={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},JS=Oe(Oe({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:np,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:dv,bufferController:tx,capLevelController:cc,errorController:pv,fpsController:iS,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:tm,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:ZS},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},eT()),{},{subtitleStreamController:gS,subtitleTrackController:rS,timelineController:$S,audioStreamController:XE,audioTrackController:ZE,emeController:hs,cmcdController:Zx,contentSteeringController:eS,interstitialsController:fS});function eT(){return{cueHandler:KS,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function tT(l,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=ju(l),s=["manifest","level","frag"],a=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(o=>{const u=`${o==="level"?"playlist":o}LoadPolicy`,h=e[u]===void 0,d=[];a.forEach(f=>{const m=`${o}Loading${f}`,p=e[m];if(p!==void 0&&h){d.push(m);const v=i[u].default;switch(e[u]={default:v},f){case"TimeOut":v.maxLoadTimeMs=p,v.maxTimeToFirstByteMs=p;break;case"MaxRetry":v.errorRetry.maxNumRetry=p,v.timeoutRetry.maxNumRetry=p;break;case"RetryDelay":v.errorRetry.retryDelayMs=p,v.timeoutRetry.retryDelayMs=p;break;case"MaxRetryTimeout":v.errorRetry.maxRetryDelayMs=p,v.timeoutRetry.maxRetryDelayMs=p;break}}}),d.length&&t.warn(`hls.js config: "${d.join('", "')}" setting(s) are deprecated, use "${u}": ${Be(e[u])}`)}),Oe(Oe({},i),e)}function ju(l){return l&&typeof l=="object"?Array.isArray(l)?l.map(ju):Object.keys(l).reduce((e,t)=>(e[t]=ju(l[t]),e),{}):l}function iT(l,e){const t=l.loader;t!==Tg&&t!==np?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),l.progressive=!1):VS()&&(l.loader=Tg,l.progressive=!0,l.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Ha=2,nT=.1,sT=.05,rT=100;class aT extends Qg{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(rT),this.mediaSource=t.mediaSource;const i=this.media=t.media;Tt(i,"playing",this.onMediaPlaying),Tt(i,"waiting",this.onMediaWaiting),Tt(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:i}=this;i&&(Ct(i,"playing",this.onMediaPlaying),Ct(i,"waiting",this.onMediaWaiting),Ct(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,s;const a=(i=this.hls)==null?void 0:i.config;if(!a)return;const o=this.media;if(!o)return;const{seeking:u}=o,h=this.seeking&&!u,d=!this.seeking&&u,f=o.paused&&!u||o.ended||o.playbackRate===0;if(this.seeking=u,e!==t){t&&(this.ended=0),this.moved=!0,u||(this.nudgeRetry=0,a.nudgeOnVideoHole&&!f&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(d||h){h&&this.stallResolved(e);return}if(f){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1}));return}if(!Le.getBuffered(o).length){this.nudgeRetry=0;return}const m=Le.bufferInfo(o,e,0),p=m.nextStart||0,v=this.fragmentTracker;if(u&&v&&this.hls){const K=Ag(this.hls.inFlightFragments,e),O=m.len>Ha,B=!p||K||p-e>Ha&&!v.getPartialFragment(e);if(O||B)return;this.moved=!1}const E=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&v){if(!(m.len>0)&&!p)return;const O=Math.max(p,m.start||0)-e,U=!!(E!=null&&E.live)?E.targetduration*2:Ha,M=Ma(e,v);if(O>0&&(O<=U||M)){o.paused||this._trySkipBufferHole(M);return}}const A=a.detectStallWithCurrentTimeMs,T=self.performance.now(),I=this.waiting;let R=this.stalled;if(R===null)if(I>0&&T-I<A)R=this.stalled=I;else{this.stalled=T;return}const _=T-R;if(!u&&(_>=A||I)&&this.hls){var C;if(((C=this.mediaSource)==null?void 0:C.readyState)==="ended"&&!(E!=null&&E.live)&&Math.abs(e-((E==null?void 0:E.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(m),!this.media||!this.hls)return}const b=Le.bufferInfo(o,e,a.maxBufferHole);this._tryFixBufferStall(b,_,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(S.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&s&&s.length>1&&e>s.end(0)){const a=Le.bufferedInfo(Le.timeRangesToArray(this.buffered.audio),e,0);if(a.len>1&&t>=a.start){const o=Le.timeRangesToArray(s),u=Le.bufferedInfo(o,t,0).bufferedIndex;if(u>-1&&u<o.length-1){const h=Le.bufferedInfo(o,e,0).bufferedIndex,d=o[u].end,f=o[u+1].start;if((h===-1||h>u)&&f-d<1&&e-d<2){const m=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${d} -> ${f} buffered index: ${h}`);this.warn(m.message),this.media.currentTime+=1e-6;let p=Ma(e,this.fragmentTracker);p&&"fragment"in p?p=p.fragment:p||(p=void 0);const v=Le.bufferInfo(this.media,e,0);this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:G.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,frag:p,buffer:v.len,bufferInfo:v})}}}}}_tryFixBufferStall(e,t,i){var s,a;const{fragmentTracker:o,media:u}=this,h=(s=this.hls)==null?void 0:s.config;if(!u||!o||!h)return;const d=(a=this.hls)==null?void 0:a.latestLevelDetails,f=Ma(i,o);if((f||d!=null&&d.live&&i<d.fragmentStart)&&(this._trySkipBufferHole(f)||!this.media))return;const m=e.buffered,p=this.adjacentTraversal(e,i);(m&&m.length>1&&e.len>h.maxBufferHole||e.nextStart&&(e.nextStart-i<h.maxBufferHole||p))&&(t>h.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const i=this.fragmentTracker,s=e.nextStart;if(i&&s){const a=i.getFragAtPos(t,fe.MAIN),o=i.getFragAtPos(s,fe.MAIN);if(a&&o)return o.sn-a.sn<2}return!1}_reportStall(e){const{hls:t,media:i,stallReported:s,stalled:a}=this;if(!s&&a!==null&&i&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${Be(e)})`);this.warn(o.message),t.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:G.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:a}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:i,media:s}=this,a=(t=this.hls)==null?void 0:t.config;if(!s||!i||!a)return 0;const o=s.currentTime,u=Le.bufferInfo(s,o,0),h=o<u.start?u.start:u.nextStart;if(h&&this.hls){const f=u.len<=a.maxBufferHole,m=u.len>0&&u.len<1&&s.readyState<3,p=h-o;if(p>0&&(f||m)){if(p>a.maxBufferHole){let E=!1;if(o===0){const A=i.getAppendedFrag(0,fe.MAIN);A&&h<A.end&&(E=!0)}if(!E&&e){var d;if(!((d=this.hls.loadLevelObj)!=null&&d.details)||Ag(this.hls.inFlightFragments,h))return 0;let T=!1,I=e.end;for(;I<h;){const R=Ma(I,i);if(R)I+=R.duration;else{T=!0;break}}if(T)return 0}}const v=Math.max(h+sT,o+nT);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${v}`),this.moved=!0,s.currentTime=v,!(e!=null&&e.gap)){const E=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${v}`),A={type:ye.MEDIA_ERROR,details:G.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:E,reason:E.message,buffer:u.len,bufferInfo:u};e&&("fragment"in e?A.part=e:A.frag=e),this.hls.trigger(S.ERROR,A)}return v}}return 0}_tryNudgeBuffer(e){const{hls:t,media:i,nudgeRetry:s}=this,a=t==null?void 0:t.config;if(!i||!a)return 0;const o=i.currentTime;if(this.nudgeRetry++,s<a.nudgeMaxRetry){const u=o+(s+1)*a.nudgeOffset,h=new Error(`Nudging 'currentTime' from ${o} to ${u}`);this.warn(h.message),i.currentTime=u,t.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:G.BUFFER_NUDGE_ON_STALL,error:h,fatal:!1,buffer:e.len,bufferInfo:e})}else{const u=new Error(`Playhead still not moving while enough data buffered @${o} after ${a.nudgeMaxRetry} nudges`);this.error(u.message),t.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:G.BUFFER_STALLED_ERROR,error:u,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Ag(l,e){const t=Lg(l.main);if(t&&t.start<=e)return t;const i=Lg(l.audio);return i&&i.start<=e?i:null}function Lg(l){if(!l)return null;switch(l.state){case Y.IDLE:case Y.STOPPED:case Y.ENDED:case Y.ERROR:return null}return l.frag}function Ma(l,e){return e.getAppendedFrag(l,fe.MAIN)||e.getPartialFragment(l)}const oT=.25;function Ku(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Tu(l,e,t,i,s){let a=new l(e,t,"");try{a.value=i,s&&(a.type=s)}catch{a=new l(e,t,Be(s?Oe({type:s},i):i))}return a}const Fa=(()=>{const l=Ku();try{l&&new l(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class lT{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(S.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&us(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return Hm(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:i,enableID3MetadataCues:s}=this.hls.config;if(!i&&!s)return;const{samples:a}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=Ku();if(o)for(let u=0;u<a.length;u++){const h=a[u].type;if(h===Ut.emsg&&!i||!s)continue;const d=Em(a[u].data),f=a[u].pts;let m=f+a[u].duration;m>Fa&&(m=Fa),m-f<=0&&(m=f+oT);for(let v=0;v<d.length;v++){const E=d[v];if(!xm(E)){this.updateId3CueEnds(f,h);const A=Tu(o,f,m,E,h);A&&this.id3Track.addCue(A)}}}}updateId3CueEnds(e,t){var i;const s=(i=this.id3Track)==null?void 0:i.cues;if(s)for(let a=s.length;a--;){const o=s[a];o.type===t&&o.startTime<e&&o.endTime===Fa&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:s}){const{id3Track:a,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:u,enableID3MetadataCues:h}}=o;if(a&&(u||h)){let d;s==="audio"?d=f=>f.type===Ut.audioId3&&h:s==="video"?d=f=>f.type===Ut.emsg&&u:d=f=>f.type===Ut.audioId3&&h||f.type===Ut.emsg&&u,$u(a,t,i,d)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:i,timelineOffset:s,enableDateRangeMetadataCues:a,interstitialsController:o}=this.hls.config;if(!a)return;const u=Ku();if(i&&s&&!o){const{fragmentStart:A,fragmentEnd:T}=e;let I=this.assetCue;I?(I.startTime=A,I.endTime=T):u&&(I=this.assetCue=Tu(u,A,T,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),I&&(I.id=i,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(I),I.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:h}=this,{dateRanges:d}=e,f=Object.keys(d);let m=this.dateRangeCuesAppended;if(h&&t){var p;if((p=h.cues)!=null&&p.length){const A=Object.keys(m).filter(T=>!f.includes(T));for(let T=A.length;T--;){var v;const I=A[T],R=(v=m[I])==null?void 0:v.cues;delete m[I],R&&Object.keys(R).forEach(_=>{const C=R[_];if(C){C.removeEventListener("enter",this.onEventCueEnter);try{h.removeCue(C)}catch{}}})}}else m=this.dateRangeCuesAppended={}}const E=e.fragments[e.fragments.length-1];if(!(f.length===0||!oe(E==null?void 0:E.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let A=0;A<f.length;A++){const T=f[A],I=d[T],R=I.startTime,_=m[T],C=(_==null?void 0:_.cues)||{};let b=(_==null?void 0:_.durationKnown)||!1,K=Fa;const{duration:O,endDate:B}=I;if(B&&O!==null)K=R+O,b=!0;else if(I.endOnNext&&!b){const M=f.reduce((z,te)=>{if(te!==I.id){const se=d[te];if(se.class===I.class&&se.startDate>I.startDate&&(!z||I.startDate<z.startDate))return se}return z},null);M&&(K=M.startTime,b=!0)}const U=Object.keys(I.attr);for(let M=0;M<U.length;M++){const z=U[M];if(!wv(z))continue;const te=C[z];if(te)b&&!(_!=null&&_.durationKnown)?te.endTime=K:Math.abs(te.startTime-R)>.01&&(te.startTime=R,te.endTime=K);else if(u){let se=I.attr[z];Cv(z)&&(se=Cg(se));const ae=Tu(u,R,K,{key:z,data:se},Ut.dateRange);ae&&(ae.id=T,this.id3Track.addCue(ae),C[z]=ae,o&&(z==="X-ASSET-LIST"||z==="X-ASSET-URL")&&ae.addEventListener("enter",this.onEventCueEnter))}}m[T]={cues:C,dateRange:I,durationKnown:b}}}}}class uT{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:a,maxLiveSyncPlaybackRate:o}=this.config;if(!a||o===1||!i.live)return;const u=this.targetLatency;if(u===null)return;const h=s-u,d=Math.min(this.maxLatency,u+i.targetduration);if(h<d&&h>.05&&this.forwardBufferLength>1){const m=Math.min(2,Math.max(1,o)),p=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20,v=Math.min(m,Math.max(1,p));this.changeMediaPlaybackRate(t,v)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:i,targetduration:s}=e,{liveSyncDuration:a,liveSyncDurationCount:o,lowLatencyMode:u}=this.config,h=this.hls.userConfig;let d=u&&i||t;(this._targetLatencyUpdated||h.liveSyncDuration||h.liveSyncDurationCount||d===0)&&(d=a!==void 0?a:o*s);const f=s;return d+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,f)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const i=this.levelDetails;if(i===null)return null;const s=i.edge,a=e-t-this.edgeStalled,o=s-i.totalduration,u=s-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(o,a),u)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===G.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,s;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class cT extends uc{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=this.hls.config.preferManagedMediaSource,s=[],a={},o={};let u=!1,h=!1,d=!1;t.levels.forEach(f=>{const m=f.attrs;let{audioCodec:p,videoCodec:v}=f;p&&(f.audioCodec=p=za(p,i)||void 0),v&&(v=f.videoCodec=Wy(v));const{width:E,height:A,unknownCodecs:T}=f,I=(T==null?void 0:T.length)||0;if(u||(u=!!(E&&A)),h||(h=!!v),d||(d=!!p),I||p&&!this.isAudioSupported(p)||v&&!this.isVideoSupported(v)){this.log(`Some or all CODECS not supported "${m.CODECS}"`);return}const{CODECS:R,"FRAME-RATE":_,"HDCP-LEVEL":C,"PATHWAY-ID":b,RESOLUTION:K,"VIDEO-RANGE":O}=m,U=`${`${b||"."}-`}${f.bitrate}-${K}-${_}-${R}-${O}-${C}`;if(a[U])if(a[U].uri!==f.url&&!f.attrs["PATHWAY-ID"]){const M=o[U]+=1;f.attrs["PATHWAY-ID"]=new Array(M+1).join(".");const z=this.createLevel(f);a[U]=z,s.push(z)}else a[U].addGroupId("audio",m.AUDIO),a[U].addGroupId("text",m.SUBTITLES);else{const M=this.createLevel(f);a[U]=M,o[U]=1,s.push(M)}}),this.filterAndSortMediaOptions(s,t,u,h,d)}createLevel(e){const t=new ur(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(s.message),t.supportedResult=jg(s,[])}return t}isAudioSupported(e){return or(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return or(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,s,a){var o;let u=[],h=[],d=e;const f=((o=t.stats)==null?void 0:o.parsing)||{};if((i||s)&&a&&(d=d.filter(({videoCodec:R,videoRange:_,width:C,height:b})=>(!!R||!!(C&&b))&&iv(_))),d.length===0){Promise.resolve().then(()=>{if(this.hls){let R="no level with compatible codecs found in manifest",_=R;t.levels.length&&(_=`one or more CODECS in variant not supported: ${Be(t.levels.map(b=>b.attrs.CODECS).filter((b,K,O)=>O.indexOf(b)===K))}`,this.warn(_),R+=` (${_})`);const C=new Error(R);this.hls.trigger(S.ERROR,{type:ye.MEDIA_ERROR,details:G.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:C,reason:_})}}),f.end=performance.now();return}t.audioTracks&&(u=t.audioTracks.filter(R=>!R.audioCodec||this.isAudioSupported(R.audioCodec)),Ig(u)),t.subtitles&&(h=t.subtitles,Ig(h));const m=d.slice(0);d.sort((R,_)=>{if(R.attrs["HDCP-LEVEL"]!==_.attrs["HDCP-LEVEL"])return(R.attrs["HDCP-LEVEL"]||"")>(_.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&R.height!==_.height)return R.height-_.height;if(R.frameRate!==_.frameRate)return R.frameRate-_.frameRate;if(R.videoRange!==_.videoRange)return Ya.indexOf(R.videoRange)-Ya.indexOf(_.videoRange);if(R.videoCodec!==_.videoCodec){const C=pf(R.videoCodec),b=pf(_.videoCodec);if(C!==b)return b-C}if(R.uri===_.uri&&R.codecSet!==_.codecSet){const C=Wa(R.codecSet),b=Wa(_.codecSet);if(C!==b)return b-C}return R.averageBitrate!==_.averageBitrate?R.averageBitrate-_.averageBitrate:0});let p=m[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==m.length)){for(let R=0;R<m.length;R++)if(m[R].pathwayId===d[0].pathwayId){p=m[R];break}}this._levels=d;for(let R=0;R<d.length;R++)if(d[R]===p){var v;this._firstLevel=R;const _=p.bitrate,C=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${_}`),((v=this.hls.userConfig)==null?void 0:v.abrEwmaDefaultEstimate)===void 0){const b=Math.min(_,this.hls.config.abrEwmaDefaultEstimateMax);b>C&&C===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=b)}break}const E=a&&!s,A=this.hls.config,T=!!(A.audioStreamController&&A.audioTrackController),I={levels:d,audioTracks:u,subtitleTracks:h,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:a,video:s,altAudio:T&&!E&&u.some(R=>!!R.url)};f.end=performance.now(),this.hls.trigger(S.MANIFEST_PARSED,I)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const f=new Error("invalid level idx"),m=e<0;if(this.hls.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:G.LEVEL_SWITCH_ERROR,level:e,fatal:m,error:f,reason:f.message}),m)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,s=this.currentLevel,a=s?s.attrs["PATHWAY-ID"]:void 0,o=t[e],u=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,i===e&&s&&a===u)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${u?" with Pathway "+u:""} from level ${i}${a?" with Pathway "+a:""}`);const h={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(S.LEVEL_SWITCHING,h);const d=o.details;if(!d||d.live){const f=this.switchParams(o.uri,s==null?void 0:s.details,d);this.loadPlaylist(f)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),i=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===ke.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===fe.MAIN){const i=t.elementaryStreams;if(!Object.keys(i).some(a=>!!i[a]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var i;const{level:s,details:a}=t,o=t.levelInfo;if(!o){var u;this.warn(`Invalid level index ${s}`),(u=t.deliveryDirectives)!=null&&u.skip&&(a.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let h=o.details;h===t.details&&h.advanced&&(h=void 0),this.playlistLoaded(s,t,h)}else(i=t.deliveryDirectives)!=null&&i.skip&&(a.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,a=e.attrs["PATHWAY-ID"],o=e.details,u=o==null?void 0:o.age;this.log(`Loading level index ${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a?" Pathway "+a:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(S.LEVEL_LOADING,{url:i,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const i=this._levels.filter((a,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(a),a===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,a.details&&a.details.fragments.forEach(u=>u.level=-1)),!1));um(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=i.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(S.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(S.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function Ig(l){const e={};l.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function sp(){return self.SourceBuffer||self.WebKitSourceBuffer}function rp(){if(!ln())return!1;const e=sp();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function dT(){if(!rp())return!1;const l=ln();return typeof(l==null?void 0:l.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>l.isTypeSupported(lr(e,"video")))||["mp4a.40.2","fLaC"].some(e=>l.isTypeSupported(lr(e,"audio"))))}function hT(){var l;const e=sp();return typeof(e==null||(l=e.prototype)==null?void 0:l.changeType)=="function"}const fT=100;class gT extends tc{constructor(e,t,i){super(e,t,i,"stream-controller",fe.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,a=s?s.currentTime:null;if(a===null||!oe(a)||(this.log(`Media seeked to ${a.toFixed(3)}`),!this.getBufferedFrag(a)))return;const o=this.getFwdBufferInfoAtPos(s,a,fe.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${a} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:i,hls:s}=this;if(this.stopLoad(),this.setInterval(fT),this.level=-1,!this.startFragRequested){let a=s.startLevel;a===-1&&(s.config.testBandwidth&&this.levels.length>1?(a=0,this.bitrateTest=!0):a=s.firstAutoLevel),s.nextLoadLevel=a,this.level=s.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=Y.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=Y.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Y.WAITING_LEVEL:{const{levels:e,level:t}=this,i=e==null?void 0:e[t],s=i==null?void 0:i.details;if(s&&(!s.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(s))break;this.state=Y.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=Y.IDLE;break}break}case Y.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===Y.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const a=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[a]))return;const o=i[a],u=this.getMainFwdBufferInfo();if(u===null)return;const h=this.getLevelDetails();if(h&&this._streamEnded(u,h)){const A={};this.altAudio===2&&(A.type="video"),this.hls.trigger(S.BUFFER_EOS,A),this.state=Y.ENDED;return}if(!this.buffering)return;e.loadLevel!==a&&e.manualLevel===-1&&this.log(`Adapting to level ${a} from level ${this.level}`),this.level=e.nextLoadLevel=a;const d=o.details;if(!d||this.state===Y.WAITING_LEVEL||this.waitForLive(o)){this.level=a,this.state=Y.WAITING_LEVEL,this.startFragRequested=!1;return}const f=u.len,m=this.getMaxBufferLength(o.maxBitrate);if(f>=m)return;this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);const p=this.backtrackFragment?this.backtrackFragment.start:u.end;let v=this.getNextFragment(p,d);if(this.couldBacktrack&&!this.fragPrevious&&v&&Ze(v)&&this.fragmentTracker.getState(v)!==st.OK){var E;const T=((E=this.backtrackFragment)!=null?E:v).sn-d.startSN,I=d.fragments[T-1];I&&v.cc===I.cc&&(v=I,this.fragmentTracker.removeFragment(I))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(v&&this.isLoopLoading(v,p)){if(!v.gap){const T=this.audioOnly&&!this.altAudio?Fe.AUDIO:Fe.VIDEO,I=(T===Fe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;I&&this.afterBufferFlushed(I,T,fe.MAIN)}v=this.getNextFragmentLoopLoading(v,d,u,fe.MAIN,m)}v&&(v.initSegment&&!v.initSegment.data&&!this.bitrateTest&&(v=v.initSegment),this.loadFragment(v,o,p))}loadFragment(e,t,i){const s=this.fragmentTracker.getState(e);s===st.NOT_LOADED||s===st.PARTIAL?Ze(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,fe.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const a=this.getLevelDetails();if(a!=null&&a.live){const u=this.getMainFwdBufferInfo();if(!u||u.len<a.targetduration*2)return}if(!t.paused&&e){const u=this.hls.nextLoadLevel,h=e[u],d=this.fragLastKbps;d&&this.fragCurrent?i=this.fragCurrent.duration*h.maxBitrate/(1e3*d)+1:i=0}else i=0;const o=this.getBufferedFrag(t.currentTime+i);if(o){const u=this.followingBufferedFrag(o);if(u){this.abortCurrentFrag();const h=u.maxStartPTS?u.maxStartPTS:u.start,d=u.duration,f=Math.max(o.end,h+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,d*(this.couldBacktrack?.5:.125)),d*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Y.KEY_LOADING:case Y.FRAG_LOADING:case Y.FRAG_LOADING_WAITING_RETRY:case Y.PARSING:case Y.PARSED:this.state=Y.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;Tt(i,"playing",this.onMediaPlaying),Tt(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:i}=this;i&&(Ct(i,"playing",this.onMediaPlaying),Ct(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(S.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,s=!1;for(let a=0;a<t.levels.length;a++){const o=t.levels[a].audioCodec;o&&(i=i||o.indexOf("mp4a.40.2")!==-1,s=s||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=i&&s&&!hT(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==Y.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=Y.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:s,startFragRequested:a}=this,o=t.level,u=t.details,h=u.totalduration;if(!s){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""}, cc [${u.startCC}, ${u.endCC}] duration:${h}`);const d=t.levelInfo,f=this.fragCurrent;f&&(this.state===Y.FRAG_LOADING||this.state===Y.FRAG_LOADING_WAITING_RETRY)&&f.level!==t.level&&f.loader&&this.abortCurrentFrag();let m=0;if(u.live||(i=d.details)!=null&&i.live){var p;if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;m=this.alignPlaylists(u,d.details,(p=this.levelLastLoaded)==null?void 0:p.details)}if(d.details=u,this.levelLastLoaded=d,a||this.setStartPosition(u,m),this.hls.trigger(S.LEVEL_UPDATED,{details:u,level:o}),this.state===Y.WAITING_LEVEL){if(this.waitForCdnTuneIn(u))return;this.state=Y.IDLE}a&&u.live&&this.synchronizeToLiveEdge(u),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const s=this.hls.liveSyncPosition,a=this.getLoadPosition(),o=e.fragmentStart,u=e.edge,h=a>=o-t.maxFragLookUpTolerance&&a<=u;if(s!==null&&i.duration>s&&(a<s||!h)){const f=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!h&&i.readyState<4||a<u-f)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),i.readyState))if(this.warn(`Playback: ${a.toFixed(3)} is located too far from the end of live sliding playlist: ${u}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var d;const m=Le.bufferInfo(i,s,0);if(!((d=m.buffered)!=null&&d.length)){i.currentTime=s;return}if(m.start<=a){i.currentTime=s;return}const{nextStart:v}=Le.bufferedInfo(m.buffered,a,0);v&&(i.currentTime=v)}else i.currentTime=s}}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:s,payload:a}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const u=o[i.level];if(!u){this.warn(`Level ${i.level} not found on progress`);return}const h=u.details;if(!h){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const d=u.videoCodec,f=h.PTSKnown||!h.live,m=(t=i.initSegment)==null?void 0:t.data,p=this._getAudioCodec(u),v=this.transmuxer=this.transmuxer||new Dm(this.hls,fe.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),E=s?s.index:-1,A=E!==-1,T=new Zu(i.level,i.sn,i.stats.chunkCount,a.byteLength,E,A),I=this.initPTS[i.cc];v.push(a,m,p,d,i,s,h.totalduration,f,T,I)}onAudioTrackSwitching(e,t){const i=this.hls,s=this.altAudio!==0;if(qa(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.altAudio=0,this.fragmentTracker.removeAllFragments(),i.once(S.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(S.AUDIO_TRACK_SWITCHED,t)}),i.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(S.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=qa(t.url,this.hls);if(i){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){const i=t.tracks;let s,a,o=!1;for(const u in i){const h=i[u];if(h.id==="main"){if(a=u,s=h,u==="video"){const d=i[u];d&&(this.videoBuffer=d.buffer)}}else o=!0}o&&s?(this.log(`Alternate track found, use ${a}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:s}=t,a=i.type===fe.MAIN;if(a){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===Y.PARSED&&(this.state=Y.IDLE);return}const u=s?s.stats:i.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),Ze(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,s)}const o=this.media;o&&(!this._hasEnoughToStart&&Le.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),a&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=Y.ERROR;return}switch(t.details){case G.FRAG_GAP:case G.FRAG_PARSING_ERROR:case G.FRAG_DECRYPT_ERROR:case G.FRAG_LOAD_ERROR:case G.FRAG_LOAD_TIMEOUT:case G.KEY_LOAD_ERROR:case G.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(fe.MAIN,t);break;case G.LEVEL_LOAD_ERROR:case G.LEVEL_LOAD_TIMEOUT:case G.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Y.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===ke.LEVEL&&(this.state=Y.IDLE);break;case G.BUFFER_ADD_CODEC_ERROR:case G.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case G.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case G.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=Y.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Fe.AUDIO||!this.altAudio){const i=(t===Fe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,fe.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&i&&(i+=s);const a=this.getLevelDetails(),o=Le.getBuffered(e),u=o.length?o.start(0):0,h=u-i,d=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||h>0&&(h<d||this.loadingParts&&h<2*((a==null?void 0:a.partTarget)||0)))&&(this.log(`adjusting start position by ${h} to match buffer start`),i+=h,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${u}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:s}=this,a=i==null?void 0:i.frag;if(!a||this.fragContextChanged(a))return;t.fragmentError=0,this.state=Y.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=a.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),s.trigger(S.FRAG_LOADED,i),a.bitrateTest=!1}).catch(i=>{this.state===Y.STOPPED||this.state===Y.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:i}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:u,part:h,level:d}=o,{video:f,text:m,id3:p,initSegment:v}=s,{details:E}=d,A=this.altAudio?void 0:s.audio;if(this.fragContextChanged(u)){this.fragmentTracker.removeFragment(u);return}if(this.state=Y.PARSING,v){const T=v.tracks;if(T){const C=u.initSegment||u;if(this.unhandledEncryptionError(v,u))return;this._bufferInitSegment(d,T,C,a),i.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:t,tracks:T})}const I=v.initPTS,R=v.timescale,_=this.initPTS[u.cc];if(oe(I)&&(!_||_.baseTime!==I||_.timescale!==R)){const C=v.trackId;this.initPTS[u.cc]={baseTime:I,timescale:R,trackId:C},i.trigger(S.INIT_PTS_FOUND,{frag:u,id:t,initPTS:I,timescale:R,trackId:C})}}if(f&&E){A&&f.type==="audiovideo"&&this.logMuxedErr(u);const T=E.fragments[u.sn-1-E.startSN],I=u.sn===E.startSN,R=!T||u.cc>T.cc;if(s.independent!==!1){const{startPTS:_,endPTS:C,startDTS:b,endDTS:K}=f;if(h)h.elementaryStreams[f.type]={startPTS:_,endPTS:C,startDTS:b,endDTS:K};else if(f.firstKeyFrame&&f.independent&&a.id===1&&!R&&(this.couldBacktrack=!0),f.dropped&&f.independent){const O=this.getMainFwdBufferInfo(),B=(O?O.end:this.getLoadPosition())+this.config.maxBufferHole,U=f.firstKeyFramePTS?f.firstKeyFramePTS:_;if(!I&&B<U-this.config.maxBufferHole&&!R){this.backtrack(u);return}else R&&(u.gap=!0);u.setElementaryStreamInfo(f.type,u.start,C,u.start,K,!0)}else I&&_-(E.appliedTimelineOffset||0)>Ha&&(u.gap=!0);u.setElementaryStreamInfo(f.type,_,C,b,K),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(f,u,h,a,I||R)}else if(I||R)u.gap=!0;else{this.backtrack(u);return}}if(A){const{startPTS:T,endPTS:I,startDTS:R,endDTS:_}=A;h&&(h.elementaryStreams[Fe.AUDIO]={startPTS:T,endPTS:I,startDTS:R,endDTS:_}),u.setElementaryStreamInfo(Fe.AUDIO,T,I,R,_),this.bufferFragmentData(A,u,h,a)}if(E&&p!=null&&p.samples.length){const T={id:t,frag:u,details:E,samples:p.samples};i.trigger(S.FRAG_PARSING_METADATA,T)}if(E&&m){const T={id:t,frag:u,details:E,samples:m.samples};i.trigger(S.FRAG_PARSING_USERDATA,T)}}logMuxedErr(e){this.warn(`${Ze(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,s){if(this.state!==Y.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));const{audio:a,video:o,audiovideo:u}=t;if(a){const d=e.audioCodec;let f=Ba(a.codec,d);f==="mp4a"&&(f="mp4a.40.5");const m=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");const p=a.metadata;p&&"channelCount"in p&&(p.channelCount||1)!==1&&m.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&m.indexOf("android")!==-1&&a.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),d&&d!==f&&this.log(`Swapping manifest audio codec "${d}" for "${f}"`),a.levelCodec=f,a.id=fe.MAIN,this.log(`Init audio buffer, container:${a.container}, codecs[selected/level/parsed]=[${f||""}/${d||""}/${a.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=fe.MAIN;const d=o.codec;if((d==null?void 0:d.length)===4)switch(d){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${d}]${o.codec!==d?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}u&&(this.log(`Init audiovideo buffer, container:${u.container}, codecs[level/parsed]=[${e.codecs}/${u.codec}]`),delete t.video,delete t.audio);const h=Object.keys(t);if(h.length){if(this.hls.trigger(S.BUFFER_CODECS,t),!this.hls)return;h.forEach(d=>{const m=t[d].initSegment;m!=null&&m.byteLength&&this.hls.trigger(S.BUFFER_APPENDING,{type:d,data:m,frag:i,part:null,chunkMeta:s,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,fe.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,i=e==null?void 0:e[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Y.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(Le.isBuffered(e,i)?t=this.getAppendedFrag(i):Le.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,a=t.level;(!s||t.sn!==s.sn||s.level!==a)&&(this.fragPlaying=t,this.hls.trigger(S.FRAG_CHANGED,{frag:t}),(!s||s.level!==a)&&this.hls.trigger(S.LEVEL_SWITCHED,{level:a}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return oe(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(oe(t)){const i=this.getLevelDetails(),s=this.currentFrag||(i?Cn(null,i.fragments,t):null);if(s){const a=s.programDateTime;if(a!==null){const o=a+(t-s.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class mT extends qt{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[i].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=G.KEY_LOAD_ERROR,i,s,a){return new bi({type:ye.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:a,error:i,networkDetails:s})}loadClear(e,t,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,a=t.length;s<a;s++){const o=t[s];if(e.cc<=o.cc&&(!Ze(e)||!Ze(o)||e.sn<o.sn)||!i&&s==a-1)return this.emeController.selectKeySystemFormat(o).then(u=>{if(!this.emeController)return;o.setKeyFormat(u);const h=$a(u);if(h)return this.emeController.getKeySystemAccess([h])})}if(this.config.requireKeySystemAccessOnStart){const s=nr(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,s;t&&e.setKeyFormat(t);const a=e.decryptdata;if(!a){const d=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,G.KEY_LOAD_ERROR,d))}const o=a.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,G.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const u=Au(a);let h=this.keyIdToKeyInfo[u];if((i=h)!=null&&i.decryptdata.key)return a.key=h.decryptdata.key,Promise.resolve({frag:e,keyInfo:h});if(this.emeController&&(s=h)!=null&&s.keyLoadPromise)switch(this.emeController.getKeyStatus(h.decryptdata)){case"usable":case"usable-in-future":return h.keyLoadPromise.then(f=>{const{keyInfo:m}=f;return a.key=m.decryptdata.key,{frag:e,keyInfo:m}})}switch(this.log(`${this.keyIdToKeyInfo[u]?"Rel":"L"}oading${a.keyId?" keyId: "+ft(a.keyId):""} URI: ${a.uri} from ${e.type} ${e.level}`),h=this.keyIdToKeyInfo[u]={decryptdata:a,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},a.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return a.keyFormat==="identity"?this.loadKeyHTTP(h,e):this.loadKeyEME(h,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(h,e);default:return Promise.reject(this.createKeyLoadError(e,G.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${a.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s;if(!e.decryptdata.keyId&&(s=t.initSegment)!=null&&s.data){const o=Oy(t.initSegment.data);if(o.length){let u=o[0];u.some(h=>h!==0)?(this.log(`Using keyId found in init segment ${ft(u)}`),on.setKeyIdForUri(e.decryptdata.uri,u)):(u=on.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${ft(u)}`)),e.decryptdata.keyId=u}}if(!e.decryptdata.keyId&&!Ze(t))return Promise.resolve(i);const a=this.emeController.loadKey(i);return(e.keyLoadPromise=a.then(o=>(e.mediaKeySessionContext=o,i))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,s=i.loader,a=new s(i);return t.keyLoader=e.loader=a,e.keyLoadPromise=new Promise((o,u)=>{const h={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=i.keyLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(p,v,E,A)=>{const{frag:T,keyInfo:I}=E,R=Au(I.decryptdata);if(!T.decryptdata||I!==this.keyIdToKeyInfo[R])return u(this.createKeyLoadError(T,G.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),A));I.decryptdata.key=T.decryptdata.key=new Uint8Array(p.data),T.keyLoader=null,I.loader=null,o({frag:T,keyInfo:I})},onError:(p,v,E,A)=>{this.resetLoader(v),u(this.createKeyLoadError(t,G.KEY_LOAD_ERROR,new Error(`HTTP Error ${p.code} loading key ${p.text}`),E,Oe({url:h.url,data:void 0},p)))},onTimeout:(p,v,E)=>{this.resetLoader(v),u(this.createKeyLoadError(t,G.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),E))},onAbort:(p,v,E)=>{this.resetLoader(v),u(this.createKeyLoadError(t,G.INTERNAL_ABORTED,new Error("key loading aborted"),E))}};a.load(h,f,m)})}resetLoader(e){const{frag:t,keyInfo:i,url:s}=e,a=i.loader;t.keyLoader===a&&(t.keyLoader=null,i.loader=null);const o=Au(i.decryptdata)||s;delete this.keyIdToKeyInfo[o],a&&a.destroy()}}function Au(l){if(l.keyFormat!==gt.FAIRPLAY){const e=l.keyId;if(e)return ft(e)}return l.uri}function Rg(l){const{type:e}=l;switch(e){case ke.AUDIO_TRACK:return fe.AUDIO;case ke.SUBTITLE_TRACK:return fe.SUBTITLE;default:return fe.MAIN}}function Lu(l,e){let t=l.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class pT{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,s=t.loader,a=i||s,o=new a(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ke.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:i,level:s,pathwayId:a,url:o,deliveryDirectives:u,levelInfo:h}=t;this.load({id:i,level:s,pathwayId:a,responseType:"text",type:ke.LEVEL,url:o,deliveryDirectives:u,levelOrTrack:h})}onAudioTrackLoading(e,t){const{id:i,groupId:s,url:a,deliveryDirectives:o,track:u}=t;this.load({id:i,groupId:s,level:null,responseType:"text",type:ke.AUDIO_TRACK,url:a,deliveryDirectives:o,levelOrTrack:u})}onSubtitleTrackLoading(e,t){const{id:i,groupId:s,url:a,deliveryDirectives:o,track:u}=t;this.load({id:i,groupId:s,level:null,responseType:"text",type:ke.SUBTITLE_TRACK,url:a,deliveryDirectives:o,levelOrTrack:u})}onLevelsUpdated(e,t){const i=this.loaders[ke.LEVEL];if(i){const s=i.context;s&&!t.levels.some(a=>a===s.levelOrTrack)&&(i.abort(),delete this.loaders[ke.LEVEL])}}load(e){var t;const i=this.hls.config;let s=this.getInternalLoader(e);if(s){const d=this.hls.logger,f=s.context;if(f&&f.levelOrTrack===e.levelOrTrack&&(f.url===e.url||f.deliveryDirectives&&!e.deliveryDirectives)){f.url===e.url?d.log(`[playlist-loader]: ignore ${e.url} ongoing request`):d.log(`[playlist-loader]: ignore ${e.url} in favor of ${f.url}`);return}d.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let a;if(e.type===ke.MANIFEST?a=i.manifestLoadPolicy.default:a=Me({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),oe((t=e.deliveryDirectives)==null?void 0:t.part)){let d;if(e.type===ke.LEVEL&&e.level!==null?d=this.hls.levels[e.level].details:e.type===ke.AUDIO_TRACK&&e.id!==null?d=this.hls.audioTracks[e.id].details:e.type===ke.SUBTITLE_TRACK&&e.id!==null&&(d=this.hls.subtitleTracks[e.id].details),d){const f=d.partTarget,m=d.targetduration;if(f&&m){const p=Math.max(f*3,m*.8)*1e3;a=Me({},a,{maxTimeToFirstByteMs:Math.min(p,a.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(p,a.maxTimeToFirstByteMs)})}}}const o=a.errorRetry||a.timeoutRetry||{},u={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},h={onSuccess:(d,f,m,p)=>{const v=this.getInternalLoader(m);this.resetInternalLoader(m.type);const E=d.data;f.parsing.start=performance.now(),Ei.isMediaPlaylist(E)||m.type!==ke.MANIFEST?this.handleTrackOrLevelPlaylist(d,f,m,p||null,v):this.handleMasterPlaylist(d,f,m,p)},onError:(d,f,m,p)=>{this.handleNetworkError(f,m,!1,d,p)},onTimeout:(d,f,m)=>{this.handleNetworkError(f,m,!0,void 0,d)}};s.load(e,u,h)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,s){const a=this.hls,o=e.data,u=Lu(e,i),h=Ei.parseMasterPlaylist(o,u);if(h.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,i,h.playlistParsingError,s,t);return}const{contentSteering:d,levels:f,sessionData:m,sessionKeys:p,startTimeOffset:v,variableList:E}=h;this.variableList=E,f.forEach(R=>{const{unknownCodecs:_}=R;if(_){const{preferManagedMediaSource:C}=this.hls.config;let{audioCodec:b,videoCodec:K}=R;for(let O=_.length;O--;){const B=_[O];or(B,"audio",C)?(R.audioCodec=b=b?`${b},${B}`:B,gs.audio[b.substring(0,4)]=2,_.splice(O,1)):or(B,"video",C)&&(R.videoCodec=K=K?`${K},${B}`:B,gs.video[K.substring(0,4)]=2,_.splice(O,1))}}});const{AUDIO:A=[],SUBTITLES:T,"CLOSED-CAPTIONS":I}=Ei.parseMasterPlaylistMedia(o,u,h);A.length&&!A.some(_=>!_.url)&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),A.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new We({}),bitrate:0,url:""})),a.trigger(S.MANIFEST_LOADED,{levels:f,audioTracks:A,subtitles:T,captions:I,contentSteering:d,url:u,stats:t,networkDetails:s,sessionData:m,sessionKeys:p,startTimeOffset:v,variableList:E})}handleTrackOrLevelPlaylist(e,t,i,s,a){const o=this.hls,{id:u,level:h,type:d}=i,f=Lu(e,i),m=oe(h)?h:oe(u)?u:0,p=Rg(i),v=Ei.parseLevelPlaylist(e.data,f,m,p,0,this.variableList);if(d===ke.MANIFEST){const E={attrs:new We({}),bitrate:0,details:v,name:"",url:f};v.requestScheduled=t.loading.start+am(v,0),o.trigger(S.MANIFEST_LOADED,{levels:[E],audioTracks:[],url:f,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=v,this.handlePlaylistLoaded(v,e,t,i,s,a)}handleManifestParsingError(e,t,i,s,a){this.hls.trigger(S.ERROR,{type:ye.NETWORK_ERROR,details:G.MANIFEST_PARSING_ERROR,fatal:t.type===ke.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:s,stats:a})}handleNetworkError(e,t,i=!1,s,a){let o=`A network ${i?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===ke.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===ke.AUDIO_TRACK||e.type===ke.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const u=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let h=G.UNKNOWN,d=!1;const f=this.getInternalLoader(e);switch(e.type){case ke.MANIFEST:h=i?G.MANIFEST_LOAD_TIMEOUT:G.MANIFEST_LOAD_ERROR,d=!0;break;case ke.LEVEL:h=i?G.LEVEL_LOAD_TIMEOUT:G.LEVEL_LOAD_ERROR,d=!1;break;case ke.AUDIO_TRACK:h=i?G.AUDIO_TRACK_LOAD_TIMEOUT:G.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case ke.SUBTITLE_TRACK:h=i?G.SUBTITLE_TRACK_LOAD_TIMEOUT:G.SUBTITLE_LOAD_ERROR,d=!1;break}f&&this.resetInternalLoader(e.type);const m={type:ye.NETWORK_ERROR,details:h,fatal:d,url:e.url,loader:f,context:e,error:u,networkDetails:t,stats:a};if(s){const p=(t==null?void 0:t.url)||e.url;m.response=Oe({url:p,data:void 0},s)}this.hls.trigger(S.ERROR,m)}handlePlaylistLoaded(e,t,i,s,a,o){const u=this.hls,{type:h,level:d,levelOrTrack:f,id:m,groupId:p,deliveryDirectives:v}=s,E=Lu(t,s),A=Rg(s);let T=typeof s.level=="number"&&A===fe.MAIN?d:void 0;const I=e.playlistParsingError;if(I){if(this.hls.logger.warn(`${I} ${e.url}`),!u.config.ignorePlaylistParsingErrors){u.trigger(S.ERROR,{type:ye.NETWORK_ERROR,details:G.LEVEL_PARSING_ERROR,fatal:!1,url:E,error:I,reason:I.message,response:t,context:s,level:T,parent:A,networkDetails:a,stats:i});return}e.playlistParsingError=null}if(!e.fragments.length){const R=e.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(S.ERROR,{type:ye.NETWORK_ERROR,details:G.LEVEL_EMPTY_ERROR,fatal:!1,url:E,error:R,reason:R.message,response:t,context:s,level:T,parent:A,networkDetails:a,stats:i});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),h){case ke.MANIFEST:case ke.LEVEL:if(T){if(!f)T=0;else if(f!==u.levels[T]){const R=u.levels.indexOf(f);R>-1&&(T=R)}}u.trigger(S.LEVEL_LOADED,{details:e,levelInfo:f||u.levels[0],level:T||0,id:m||0,stats:i,networkDetails:a,deliveryDirectives:v,withoutMultiVariant:h===ke.MANIFEST});break;case ke.AUDIO_TRACK:u.trigger(S.AUDIO_TRACK_LOADED,{details:e,track:f,id:m||0,groupId:p||"",stats:i,networkDetails:a,deliveryDirectives:v});break;case ke.SUBTITLE_TRACK:u.trigger(S.SUBTITLE_TRACK_LOADED,{details:e,track:f,id:m||0,groupId:p||"",stats:i,networkDetails:a,deliveryDirectives:v});break}}}class li{static get version(){return cr}static isMSESupported(){return rp()}static isSupported(){return dT()}static getMediaSource(){return ln()}static get Events(){return S}static get MetadataSchema(){return Ut}static get ErrorTypes(){return ye}static get ErrorDetails(){return G}static get DefaultConfig(){return li.defaultConfig?li.defaultConfig:JS}static set DefaultConfig(e){li.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new ic,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=Ty(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=tT(li.DefaultConfig,e,t);this.userConfig=e,i.progressive&&iT(i,t);const{abrController:s,bufferController:a,capLevelController:o,errorController:u,fpsController:h}=i,d=new u(this),f=this.abrController=new s(this),m=new yv(this),p=i.interstitialsController,v=p?this.interstitialsController=new p(this,li):null,E=this.bufferController=new a(this,m),A=this.capLevelController=new o(this),T=new h(this),I=new pT(this),R=i.contentSteeringController,_=R?new R(this):null,C=this.levelController=new cT(this,_),b=new lT(this),K=new mT(this.config,this.logger),O=this.streamController=new gT(this,m,K),B=this.gapController=new aT(this,m);A.setStreamController(O),T.setStreamController(O);const U=[I,C,O];v&&U.splice(1,0,v),_&&U.splice(1,0,_),this.networkControllers=U;const M=[f,E,B,A,T,b,m];this.audioTrackController=this.createController(i.audioTrackController,U);const z=i.audioStreamController;z&&U.push(this.audioStreamController=new z(this,m,K)),this.subtitleTrackController=this.createController(i.subtitleTrackController,U);const te=i.subtitleStreamController;te&&U.push(this.subtititleStreamController=new te(this,m,K)),this.createController(i.timelineController,M),K.emeController=this.emeController=this.createController(i.emeController,M),this.cmcdController=this.createController(i.cmcdController,M),this.latencyController=this.createController(uT,M),this.coreComponents=M,U.push(d);const se=d.onErrorOut;typeof se=="function"&&this.on(S.ERROR,se,d),this.on(S.MANIFEST_LOADED,I.onManifestLoaded,I)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,s){this._emitter.off(e,t,i,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const s=e===S.ERROR;this.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:G.INTERNAL_EXCEPTION,fatal:s,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(S.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const a=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(S.ERROR,{type:ye.OTHER_ERROR,details:G.ATTACH_MEDIA_ERROR,fatal:!0,error:a});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,i=t?e.media:e,s=t?e:{media:i};this._media=i,this.trigger(S.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(S.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(S.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,i=this._url,s=this._url=Hu.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&i&&(i!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(S.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,t),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[fe.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[fe.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[fe.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=aS()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){tv(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let s=0;s<i;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,i)for(let a=s;a--;){const o=e[a].attrs["HDCP-LEVEL"];if(o&&o<=i)return a}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const i=Hg(t);return Kg(e,i,navigator.mediaCapabilities)}}li.defaultConfig=void 0;const yT=()=>{const l=wn.useRef(null),e="https://customer-cbeadsgr09pnsezs.cloudflarestream.com/74cb72d57c6a6d6d7807693d02e6707b/manifest/video.m3u8";return wn.useEffect(()=>{let t;if(l.current){const i=l.current;i.canPlayType("application/vnd.apple.mpegurl")?i.src=e:li.isSupported()&&(t=new li,t.loadSource(e),t.attachMedia(i))}return()=>{t&&t.destroy()}},[e]),D.jsxs("section",{className:"relative min-h-[90vh] md:min-h-screen flex flex-col items-center justify-center pt-32 pb-20 overflow-hidden",children:[D.jsxs("div",{className:"absolute inset-0 z-0",children:[D.jsx("video",{ref:l,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,className:"w-full h-full object-cover opacity-100"}),D.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#050505] via-transparent to-[#050505]/40"})]}),D.jsxs("div",{className:"relative z-10 text-center px-6 max-w-5xl mx-auto",children:[D.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-1.5 rounded-full border border-white/5 bg-white/5 backdrop-blur-md mb-8 md:mb-10",children:[D.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),D.jsx("span",{className:"text-[10px] md:text-[11px] font-bold uppercase tracking-widest text-white/50",children:"Our Services are Now Live"})]}),D.jsxs("h1",{className:"display-text font-semibold text-white mb-6 md:mb-8 font-aura-header",children:["Design your ",D.jsx("span",{className:"font-newsreader italic font-normal text-white",children:"vision"})," with ",D.jsx("br",{className:"hidden md:block"})," creative excellence"]}),D.jsx("p",{className:"body-large text-white/40 mb-10 md:mb-14 max-w-2xl mx-auto font-medium leading-relaxed",children:"Get an intuitive experience for shipping and monitoring your products, helping you build faster than ever before."}),D.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-6 md:gap-8",children:[D.jsx("button",{className:"shiny-cta-red w-full sm:w-auto",children:"Start Building"}),D.jsxs("button",{className:"text-white/60 font-bold hover:text-white transition-colors flex items-center gap-2 group",children:["View Live Demo",D.jsx("svg",{className:"w-4 h-4 group-hover:translate-x-1 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]})]})},_g=["Aura","Figma","Spotify","Netflix","Slack","Adobe","Disney","Tesla","Apple"],vT=()=>D.jsx("section",{className:"py-12 bg-transparent overflow-hidden",children:D.jsx("div",{className:"marquee-container opacity-20",children:D.jsx("div",{className:"marquee-content py-4",children:[..._g,..._g].map((l,e)=>D.jsxs("div",{className:"flex items-center gap-3",children:[D.jsx("div",{className:"w-6 h-6 rounded bg-white/20 flex items-center justify-center",children:D.jsx("div",{className:"w-3 h-3 border border-white/50 rounded-sm"})}),D.jsx("span",{className:"text-xl font-bold text-white tracking-widest uppercase",children:l})]},e))})})}),ET=[{title:"AI-based Web Design",description:"Experience the next generation of web design where artificial intelligence meets artistic intuition to create high-converting, intelligent digital experiences.",icon:D.jsx("svg",{className:"w-6 h-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z"})})},{title:"Mobile Application Development",description:"Develop seamless, cross-platform mobile applications that offer native performance and immersive user interfaces for both iOS and Android platforms.",icon:D.jsx("svg",{className:"w-6 h-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75a2.25 2.25 0 00-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3"})})},{title:"Full-stack and SAAS Application",description:"Scale your business with robust, end-to-end SaaS solutions built with modern tech stacks, ensuring high availability and seamless user management.",icon:D.jsxs("svg",{className:"w-6 h-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M2.25 7.125C2.25 6.504 2.754 6 3.375 6h17.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125H3.375a1.125 1.125 0 01-1.125-1.125V7.125z"}),D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 6V4.5A1.5 1.5 0 019.5 3h5A1.5 1.5 0 0116 4.5V6"}),D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 10h18M7 15h1m4 0h1m4 0h1"})]})},{title:"Wordpress Membership Website",description:"Transform your WordPress site into a powerful membership hub with sophisticated access control, recurring payments, and community features.",icon:D.jsxs("svg",{className:"w-6 h-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.998 5.998 0 00-12.03-.224m12 0a5.998 5.998 0 00-12.03-.224m12 0a5.998 5.998 0 00-12.03-.224M12 13c-3.315 0-6 2.685-6 6 0 .34.028.673.082 1M12 13c3.315 0 6 2.685 6 6 0 .34-.028.673-.082 1m-11.836 0A12.067 12.067 0 0112 21c2.17 0 4.207-.576 5.963-1.584A6.062 6.062 0 0118 18.72m-12 0a5.998 5.998 0 0012.03-.224m-12 0a5.998 5.998 0 0012.03-.224"}),D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-13.5 0a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"})]})},{title:"Wordpress Theme And Plugin",description:"Bespoke WordPress engineering delivering high-performance themes and complex custom plugins tailored precisely to your unique business logic.",icon:D.jsx("svg",{className:"w-6 h-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5"})})},{title:"Programatic and AI Powerd SEO",description:"Outrank the competition with automated content engines and AI-driven SEO strategies that dynamically adapt to algorithm changes in real-time.",icon:D.jsx("svg",{className:"w-6 h-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"})})}],xT=()=>D.jsxs("section",{id:"features",className:"py-20 md:py-32 relative overflow-hidden",children:[D.jsx("div",{className:"absolute top-0 right-0 w-[500px] h-[500px] bg-red-500/5 blur-[120px] rounded-full -mr-64 -mt-64"}),D.jsx("div",{className:"absolute bottom-0 left-0 w-[500px] h-[500px] bg-red-500/5 blur-[120px] rounded-full -ml-64 -mb-64"}),D.jsxs("div",{className:"container mx-auto px-6 text-center mb-16 md:mb-24 animate-on-scroll",children:[D.jsx("h2",{className:"font-semibold text-white mb-4 md:mb-6",children:"Our Services"}),D.jsx("p",{className:"text-white/40 max-w-2xl mx-auto font-medium leading-relaxed",children:"Empowering your digital presence with industry-leading technology and creative excellence."})]}),D.jsx("div",{className:"container mx-auto px-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8",children:ET.map((l,e)=>D.jsxs("div",{className:"glass-card group p-6 md:p-8 rounded-[32px] border border-white/5 hover:border-red-500/20 transition-all duration-500 relative overflow-hidden animate-on-scroll",style:{transitionDelay:`${e*100}ms`},children:[D.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-500/0 to-red-500/0 group-hover:from-red-500/[0.03] group-hover:to-transparent transition-all duration-500"}),D.jsxs("div",{className:"relative z-10",children:[D.jsx("div",{className:"w-14 h-14 rounded-2xl bg-white/5 border border-white/5 flex items-center justify-center mb-8 group-hover:scale-110 group-hover:bg-red-500/10 group-hover:border-red-500/20 transition-all duration-500 shadow-xl shadow-red-500/0 group-hover:shadow-red-500/5",children:l.icon}),D.jsx("h3",{className:"font-semibold text-white mb-4 tracking-tight group-hover:text-red-500 transition-colors duration-300",children:l.title}),D.jsx("p",{className:"text-white/40 leading-relaxed font-medium group-hover:text-white/60 transition-colors duration-300",children:l.description}),D.jsxs("div",{className:"mt-8 pt-8 border-t border-white/5 flex items-center gap-2 text-white/20 group-hover:text-red-500 transition-all duration-500 text-sm font-bold uppercase tracking-widest overflow-hidden",children:[D.jsx("span",{className:"transform translate-x-[-120%] group-hover:translate-x-0 transition-transform duration-500",children:"Explore Solution"}),D.jsx("svg",{className:"w-4 h-4 transform -translate-x-full group-hover:translate-x-0 transition-transform duration-500 delay-100",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 8l4 4m0 0l-4 4m4-4H3"})})]})]}),D.jsx("div",{className:"absolute bottom-0 left-0 h-[2px] w-0 bg-gradient-to-r from-transparent via-red-500 to-transparent group-hover:w-full transition-all duration-700"})]},e))})]}),ST=()=>D.jsxs("section",{id:"developers",className:"py-20 md:py-32 relative",children:[D.jsxs("div",{className:"container mx-auto px-6 text-center mb-16 md:mb-24 animate-on-scroll",children:[D.jsxs("h2",{className:"font-bold text-white mb-4 md:mb-6",children:["Loved by ",D.jsx("span",{className:"font-newsreader italic font-normal text-white",children:"passionate"})," builders"]}),D.jsx("p",{className:"text-white/40 max-w-2xl mx-auto font-medium leading-relaxed",children:"Join 10,000+ developers and creators building the future."})]}),D.jsx("div",{className:"container mx-auto px-6 columns-1 sm:columns-2 lg:columns-3 gap-6 space-y-6",children:[{text:"Aura has transformed how we monitor our deployments. The visibility is simply unparalleled.",name:"Alex Rivera",role:"CTO at Nexus"},{text:"The most intuitive platform I've used in years. It just works.",name:"Sarah Chen",role:"Lead Engineer"},{text:"Finally a tool that understands the developer workflow.",name:"Jordan Lee",role:"Senior Developer"},{text:"Beautiful design and even better functionality. A must-have for modern teams.",name:"Elena Rossi",role:"Design Lead"},{text:"The support team is incredible. They really care about your success.",name:"Mark Wilson",role:"Founder"},{text:"Shipping faster than ever thanks to Aura.",name:"David Kim",role:"Product Manager"}].map((l,e)=>D.jsxs("div",{className:"break-inside-avoid glass-card p-8 rounded-[32px] animate-on-scroll",children:[D.jsxs("p",{className:"text-white/80 text-lg mb-8 leading-relaxed font-medium capitalize",children:['"',l.text,'"']}),D.jsxs("div",{className:"flex items-center gap-4",children:[D.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-red-500/20 to-red-500/10 border border-white/10 flex items-center justify-center text-white text-xs font-bold",children:l.name[0]}),D.jsxs("div",{children:[D.jsx("h4",{className:"text-white font-bold text-sm tracking-tight",children:l.name}),D.jsx("p",{className:"text-white/40 text-xs font-bold uppercase tracking-widest",children:l.role})]})]})]},e))})]}),TT=[{name:"Growth",price:"7,500",period:"/ mo",features:["Up to 10 projects","Real-time monitoring","24/7 Support"]},{name:"Scale",price:"15,000",period:"/ mo",features:["Unlimited projects","Custom integrations","Dedicated Support","Advanced Analytics"],popular:!0},{name:"Custom",price:"10k",period:"+",features:["Enterprise Security","Unlimited Users","SLA Guarantee","Custom Onboarding"]}],AT=()=>D.jsxs("section",{id:"pricing",className:"py-20 md:py-32 relative",children:[D.jsxs("div",{className:"container mx-auto px-6 text-center mb-16 md:mb-24 animate-on-scroll",children:[D.jsx("span",{className:"text-red-500 font-bold uppercase tracking-[0.3em] text-[10px] md:text-xs mb-4 md:mb-6 block",children:"Pricing"}),D.jsxs("h2",{className:"font-semibold text-white mb-4 md:mb-6",children:["Simple, transparent ",D.jsx("span",{className:"text-red-500 font-newsreader italic font-normal",children:"pricing"})]}),D.jsx("p",{className:"text-white/40 max-w-2xl mx-auto font-medium leading-relaxed",children:"Choose the plan that fits your growth and creative excellence."})]}),D.jsx("div",{className:"container mx-auto px-6 grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8 max-w-6xl",children:TT.map((l,e)=>D.jsxs("div",{className:`relative p-8 md:p-12 rounded-[32px] md:rounded-[48px] border ${l.popular?"border-red-500/50 bg-white/[0.03]":"border-white/5 bg-white/[0.02]"} backdrop-blur-xl animate-on-scroll`,children:[l.popular&&D.jsx("span",{className:"absolute top-0 right-12 -translate-y-1/2 px-4 py-1.5 bg-red-500 rounded-full text-[10px] font-bold text-white tracking-widest uppercase shadow-xl shadow-red-500/20",children:"Popular"}),D.jsx("h3",{className:"text-2xl font-semibold text-white mb-2",children:l.name}),D.jsx("p",{className:"text-white/40 text-sm font-medium mb-10",children:"Best for growing teams and startups."}),D.jsxs("div",{className:"flex items-baseline gap-1 mb-10",children:[D.jsxs("h1",{className:"font-bold text-white tracking-tighter",children:["$",l.price]}),D.jsx("span",{className:"text-white/40 font-bold text-lg",children:l.period})]}),D.jsx("button",{className:`w-full py-4 rounded-2xl font-bold transition-all mb-10 ${l.popular?"bg-white text-black hover:bg-white/90":"bg-white/5 text-white hover:bg-white/10 border border-white/5"}`,children:"Select Plan"}),D.jsx("div",{className:"space-y-4",children:l.features.map((t,i)=>D.jsxs("div",{className:"flex items-center gap-3",children:[D.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),D.jsx("span",{className:"text-white/60 text-sm font-bold",children:t})]},i))})]},e))})]}),LT=()=>{const l=wn.useRef(null),e="https://customer-cbeadsgr09pnsezs.cloudflarestream.com/b17f76a1270818e8cdc55e8719b9ace8/manifest/video.m3u8";return wn.useEffect(()=>{let t;if(l.current){const i=l.current;i.canPlayType("application/vnd.apple.mpegurl")?i.src=e:li.isSupported()&&(t=new li,t.loadSource(e),t.attachMedia(i))}return()=>{t&&t.destroy()}},[e]),D.jsx("section",{className:"py-20 md:py-24 px-4 overflow-hidden relative",children:D.jsxs("div",{className:"max-w-6xl mx-auto glass-card p-10 md:p-32 rounded-[48px] md:rounded-[64px] text-center relative overflow-hidden animate-on-scroll",children:[D.jsx("div",{className:"absolute inset-0 z-0",children:D.jsx("video",{ref:l,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,className:"w-full h-full object-cover opacity-100"})}),D.jsx("div",{className:"absolute top-0 right-0 w-80 h-80 bg-red-600/10 blur-[100px] z-[1]"}),D.jsx("div",{className:"absolute bottom-0 left-0 w-80 h-80 bg-red-600/5 blur-[100px] z-[1]"}),D.jsxs("h2",{className:"display-text font-semibold text-white mb-10 tracking-tighter leading-tight relative z-10 font-aura-header",children:["Ready to launch ",D.jsx("br",{})," your ",D.jsx("span",{className:"text-red-500 font-newsreader italic font-normal",children:"vision?"})]}),D.jsx("p",{className:"body-large text-white/40 font-medium mb-14 max-w-2xl mx-auto relative z-10 capitalize",children:"Join the list of manufacturers and designers shipping with Aura today."}),D.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-6 md:gap-8 relative z-10",children:[D.jsx("button",{className:"shiny-cta-red w-full sm:w-auto !px-16 !py-5 md:!text-lg",children:"Get Started Now"}),D.jsxs("a",{href:"#",className:"text-white/60 font-bold hover:text-white transition-colors group",children:["Talk to an expert ",D.jsx("span",{className:"group-hover:translate-x-1 inline-block transition-transform",children:""})]})]})]})})},IT=()=>D.jsxs("footer",{className:"py-16 md:py-24 border-t border-white/5 relative bg-background overflow-hidden",children:[D.jsxs("div",{className:"container mx-auto px-6 relative z-10",children:[D.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-12 md:gap-16 mb-16 md:mb-24 animate-on-scroll",children:[D.jsxs("div",{className:"col-span-2",children:[D.jsx("div",{className:"flex items-center gap-2 mb-8",children:D.jsx("span",{className:"text-xl font-bold text-white tracking-tighter",children:"webvoss"})}),D.jsx("p",{className:"text-white/30 text-base max-w-xs font-medium leading-relaxed mb-8",children:"The next generation of website building powered by creative webvoss excellence."}),D.jsx("div",{className:"flex gap-4",children:[1,2,3,4].map(l=>D.jsx("div",{className:"w-10 h-10 rounded-full border border-white/5 bg-white/[0.03] hover:bg-white/10 transition-all flex items-center justify-center cursor-pointer",children:D.jsx("div",{className:"w-3 h-3 border border-white/20 rounded-sm"})},l))})]}),D.jsxs("div",{children:[D.jsx("h4",{className:"text-white font-bold mb-8 tracking-tight",children:"Product"}),D.jsxs("ul",{className:"space-y-4 text-white/30 text-sm font-bold",children:[D.jsx("li",{children:D.jsx("a",{href:"#features",className:"hover:text-white transition-colors",children:"Services"})}),D.jsx("li",{children:D.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Pricing"})}),D.jsx("li",{children:D.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Changelog"})}),D.jsx("li",{children:D.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Integrations"})})]})]}),D.jsxs("div",{children:[D.jsx("h4",{className:"text-white font-bold mb-8 tracking-tight",children:"Company"}),D.jsxs("ul",{className:"space-y-4 text-white/30 text-sm font-bold",children:[D.jsx("li",{children:D.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"About Us"})}),D.jsx("li",{children:D.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Careers"})}),D.jsx("li",{children:D.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Blog"})})]})]}),D.jsxs("div",{children:[D.jsx("h4",{className:"text-white font-bold mb-8 tracking-tight",children:"Legal"}),D.jsxs("ul",{className:"space-y-4 text-white/30 text-sm font-bold",children:[D.jsx("li",{children:D.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Privacy"})}),D.jsx("li",{children:D.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Terms"})})]})]})]}),D.jsxs("div",{className:"pt-8 flex flex-col items-center",children:[D.jsx("div",{className:"text-[22vw] font-bold leading-none select-none tracking-tighter text-footer-outline lowercase",children:"webvoss"}),D.jsx("p",{className:"text-white/10 text-xs font-bold uppercase tracking-[0.5em] mt-8",children:" 2026 webvoss Design Labs. All rights reserved."})]})]}),D.jsx("div",{className:"absolute -bottom-[20%] left-1/2 -translate-x-1/2 w-[100%] h-[50%] bg-red-600/5 blur-[120px] rounded-full"})]}),RT="/webvoss/assets/founder-C40a-vX8.png",_T=()=>D.jsx("section",{className:"py-20 md:py-32 relative overflow-hidden",children:D.jsx("div",{className:"container mx-auto px-6 max-w-7xl",children:D.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16 items-center",children:[D.jsxs("div",{className:"relative group animate-on-scroll order-2 lg:order-1",children:[D.jsx("div",{className:"absolute -inset-4 bg-gradient-to-tr from-red-500/20 to-transparent blur-2xl opacity-50 group-hover:opacity-100 transition-opacity"}),D.jsx("div",{className:"relative rounded-[32px] md:rounded-[48px] overflow-hidden border border-white/5 bg-white/5 aspect-square",children:D.jsx("img",{src:RT,alt:"Founder of Webvoss",className:"w-full h-full object-cover object-top grayscale hover:grayscale-0 transition-all duration-700 scale-105 group-hover:scale-100"})})]}),D.jsxs("div",{className:"animate-on-scroll order-1 lg:order-2",children:[D.jsx("span",{className:"text-red-500 font-bold uppercase tracking-[0.3em] text-[10px] md:text-xs mb-4 md:mb-6 block",children:"Leadership"}),D.jsxs("h2",{className:"font-semibold text-white mb-6 md:mb-8 font-aura-header",children:["Meet the founder and ",D.jsx("span",{className:"text-red-500 font-newsreader italic font-normal",children:"CEO"})," of Webvoss"]}),D.jsxs("div",{className:"space-y-6 text-white/50 font-medium leading-relaxed mb-10",children:[D.jsx("p",{children:"Driven by a passion for creative excellence and technological innovation, our founder envisioned Webvoss as a bridge between complex code and intuitive design."}),D.jsx("p",{className:"hidden md:block",children:"With years of experience in the industry, he leads our team with a clear mission: to empower builders and creators with the most sophisticated yet accessible AI-powered tools in the market."})]}),D.jsxs("div",{className:"flex items-center gap-6",children:[D.jsxs("div",{className:"flex flex-col",children:[D.jsx("span",{className:"text-white font-bold text-lg md:text-xl",children:"Ariful Islam"}),D.jsx("span",{className:"text-white/30 text-[10px] md:text-xs uppercase tracking-[0.2em]",children:"Founder & CEO"})]}),D.jsx("div",{className:"h-12 w-[1px] bg-white/10"}),D.jsxs("div",{className:"flex gap-4",children:[D.jsx("a",{href:"#",className:"w-10 h-10 rounded-full border border-white/5 bg-white/5 flex items-center justify-center hover:bg-white/10 transition-colors",children:D.jsx("svg",{className:"w-5 h-5 fill-white",viewBox:"0 0 24 24",children:D.jsx("path",{d:"M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"})})}),D.jsx("a",{href:"#",className:"w-10 h-10 rounded-full border border-white/5 bg-white/5 flex items-center justify-center hover:bg-white/10 transition-colors",children:D.jsx("svg",{className:"w-5 h-5 fill-white",viewBox:"0 0 24 24",children:D.jsx("path",{d:"M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.84 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"})})})]})]})]})]})})}),kT=[{title:"Aura AI Dashboard",category:"AI SaaS",image:"https://images.unsplash.com/photo-1614850523296-d8c1af93d400?auto=format&fit=crop&q=80&w=1000",link:"#"},{title:"Nexus NFT Marketplace",category:"Web3 / Crypto",image:"https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?auto=format&fit=crop&q=80&w=1000",link:"#"},{title:"Voss E-commerce Hub",category:"E-commerce",image:"https://images.unsplash.com/photo-1460925895917-afdab827c52f?auto=format&fit=crop&q=80&w=1000",link:"#"},{title:"Creative Portfolio 3.0",category:"Creative Agency",image:"https://images.unsplash.com/photo-1547658719-da2b51169166?auto=format&fit=crop&q=80&w=1000",link:"#"},{title:"Fintech Mobile App",category:"Finance",image:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?auto=format&fit=crop&q=80&w=1000",link:"#"},{title:"Social Insight Tool",category:"Analytics",image:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?auto=format&fit=crop&q=80&w=1000",link:"#"}],wT=()=>D.jsx("section",{id:"projects",className:"py-20 md:py-32 relative bg-[#050505]",children:D.jsxs("div",{className:"container mx-auto px-6",children:[D.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end mb-16 md:mb-24 gap-8 animate-on-scroll",children:[D.jsxs("div",{className:"max-w-2xl",children:[D.jsx("h2",{className:"font-semibold text-white mb-6",children:"Latest Projects"}),D.jsx("p",{className:"text-white/40 font-medium leading-relaxed",children:"Discover our latest work where innovation meets execution. We craft digital experiences that redefine industry standards."})]}),D.jsx("div",{className:"hidden md:block",children:D.jsx("button",{className:"px-8 py-4 rounded-full border border-white/10 text-white font-semibold hover:bg-white/5 transition-all duration-300",children:"View All Projects"})})]}),D.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:kT.map((l,e)=>D.jsxs("div",{className:"group relative rounded-[32px] overflow-hidden bg-white/5 border border-white/5 hover:border-red-500/30 transition-all duration-500 animate-on-scroll",style:{transitionDelay:`${e*100}ms`},children:[D.jsxs("div",{className:"aspect-[4/3] overflow-hidden",children:[D.jsx("img",{src:l.image,alt:l.title,className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700"}),D.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/20 to-transparent opacity-60 group-hover:opacity-80 transition-opacity duration-500"})]}),D.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-8 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-500",children:[D.jsx("span",{className:"text-red-500 text-sm font-bold uppercase tracking-widest mb-3 block",children:l.category}),D.jsx("h3",{className:"text-2xl font-semibold text-white mb-4",children:l.title}),D.jsxs("div",{className:"flex items-center gap-2 text-white/40 group-hover:text-white transition-colors duration-300 font-bold text-sm",children:["View Project",D.jsx("svg",{className:"w-5 h-5 transform group-hover:translate-x-1 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 8l4 4m0 0l-4 4m4-4H3"})})]})]}),D.jsx("div",{className:"absolute top-6 right-6 w-12 h-12 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-500 border border-white/10",children:D.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})})]},e))}),D.jsx("div",{className:"mt-12 md:hidden text-center",children:D.jsx("button",{className:"px-8 py-4 rounded-full border border-white/10 text-white font-semibold hover:bg-white/5 transition-all duration-300 w-full",children:"View All Projects"})})]})});function CT(){return wn.useEffect(()=>{const l={threshold:.1,rootMargin:"0px 0px -50px 0px"},e=new IntersectionObserver(i=>{i.forEach(s=>{s.isIntersecting&&(s.target.classList.add("animate"),e.unobserve(s.target))})},l);return document.querySelectorAll(".animate-on-scroll").forEach(i=>e.observe(i)),()=>e.disconnect()},[]),D.jsxs("div",{className:"min-h-screen bg-[#050505] text-white font-montserrat selection:bg-red-500/30",children:[D.jsx(fy,{}),D.jsxs("main",{children:[D.jsx(yT,{}),D.jsx(vT,{}),D.jsx(_T,{}),D.jsx(xT,{}),D.jsx(wT,{}),D.jsx(ST,{}),D.jsx(AT,{}),D.jsx(LT,{})]}),D.jsx(IT,{}),D.jsx("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-50 group hidden md:block",children:D.jsxs("div",{className:"flex items-center gap-3 px-6 py-3 rounded-2xl border border-white/5 bg-black/40 backdrop-blur-2xl text-white/40 text-sm hover:border-white/10 hover:text-white/60 transition-all cursor-pointer",children:[D.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),D.jsxs("span",{className:"flex items-center gap-2 font-bold tracking-tight",children:["Search anything...",D.jsx("kbd",{className:"px-1.5 py-0.5 rounded border border-white/5 bg-white/5 font-sans text-xs",children:" K"})]})]})})]})}hy.createRoot(document.getElementById("root")).render(D.jsx(ry.StrictMode,{children:D.jsx(CT,{})}));
